<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCLEX-Style Testing Engine - 85 Questions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .bg-custom-dark {
            background-color: #1a202c;
        }
        .bg-custom-light-gray {
            background-color: #f7f9fc;
        }
        .text-custom-light-blue {
            color: #2563eb;
        }
        .btn-orange {
            background-color: #f97316;
        }
        .btn-orange:hover {
            background-color: #ea580c;
        }
        .btn-blue {
            background-color: #2563eb;
        }
        .btn-blue:hover {
            background-color: #1d4ed8;
        }
        .radio-btn, .check-btn {
            display: none;
        }
        .radio-label, .check-label {
            display: flex;
            align-items: center;
            width: 100%;
            cursor: pointer;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
            margin-bottom: 0.75rem;
            position: relative;
        }
        .radio-label:hover, .check-label:hover {
            background-color: #f1f5f9;
        }
        .radio-label .option-letter, .check-label .option-letter {
            width: 2rem;
            height: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e5e7eb;
            border-radius: 0.25rem;
            font-weight: 500;
            margin-right: 1rem;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .radio-btn:checked + .radio-label, .check-btn:checked + .check-label {
            background-color: #eff6ff;
            border-color: #3b82f6;
        }
        .radio-btn:checked + .radio-label .option-letter, .check-btn:checked + .check-label .option-letter {
            background-color: #3b82f6;
            color: white;
        }
        .review-box {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        .correct-answer {
            background-color: #dcfce7;
            border-color: #22c55e;
        }
        .incorrect-answer {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        .strikethrough {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3b82f6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .grade-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99;
            text-align: center;
        }
    </style>
</head>
<body class="bg-custom-light-gray h-screen flex flex-col overflow-hidden">

    <!-- Top Header -->
    <header id="header" class="bg-custom-dark text-white p-4 flex items-center justify-between shadow-md hidden">
        <div class="flex items-center space-x-4">
            <div class="font-bold">NCLEX Prep</div>
            <div class="hidden sm:block">Practice Examination</div>
        </div>
        <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0 1 1 0 002 0zM9 9a1 1 0 011-1h1a1 1 0 011 1v3a1 1 0 01-1 1h-1a1 1 0 01-1-1V9z" clip-rule="evenodd" />
                </svg>
                <span id="timer">02:00:00</span>
            </div>
            <button class="px-4 py-2 border rounded-md border-gray-500">EXAM CONTROLS</button>
        </div>
    </header>

    <!-- Start Screen -->
    <div id="start-screen" class="w-full h-full flex flex-col justify-center items-center text-center p-4">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">NCLEX-Style Exam Engine</h1>
        <p class="text-lg text-gray-600 mb-8">Click 'Start Exam' to begin your 85-question practice test.</p>
        <button id="start-btn" class="px-8 py-4 bg-blue-500 text-white font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105">Start Exam</button>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="flex flex-1 overflow-hidden hidden">
        <!-- Left Sidebar Navigation -->
        <aside class="w-16 bg-white p-4 flex flex-col items-center border-r border-gray-200 overflow-y-auto">
            <div id="nav-questions" class="flex flex-col space-y-4 w-full items-center">
                <!-- Navigation items will be injected here -->
            </div>
        </aside>

        <!-- Question Section -->
        <main id="question-container" class="flex-1 p-4 sm:p-8 overflow-y-auto">
            <!-- Question will be injected here -->
        </main>
    </div>

    <!-- Review Screen -->
    <div id="review-screen" class="flex-1 p-4 sm:p-8 overflow-y-auto hidden">
        <h2 class="text-2xl font-bold mb-6">Exam Review</h2>
        <div id="review-questions" class="space-y-8">
            <!-- Missed questions review will be injected here -->
        </div>
        <div class="mt-8 text-center">
            <button id="end-review-btn" class="px-6 py-3 bg-blue-500 text-white rounded-lg font-semibold shadow-md transition-transform transform hover:scale-105">End Review & See Grade</button>
        </div>
    </div>

    <!-- Submission Animation Screen -->
    <div id="loading-animation" class="loading-animation hidden">
        <div class="spinner"></div>
        <p class="mt-4 text-xl text-gray-700 font-semibold">Submitting Exam...</p>
    </div>

    <!-- Final Grade Screen -->
    <div id="grade-screen" class="grade-screen hidden p-4">
        <h2 class="text-3xl font-bold mb-4">Exam Submitted Successfully!</h2>
        <p class="text-lg text-gray-600 mb-2">Your final grade is:</p>
        <div class="text-6xl font-extrabold text-blue-600" id="final-grade"></div>
        <button id="restart-btn" class="mt-8 px-6 py-3 bg-blue-500 text-white rounded-lg font-semibold shadow-md transition-transform transform hover:scale-105">Restart Exam</button>
    </div>

    <!-- Bottom Footer -->
    <footer id="footer" class="bg-white p-4 flex items-center justify-between border-t border-gray-200 shadow-md hidden">
        <div class="flex items-center space-x-4 text-sm font-medium text-gray-600">
            <span id="question-counter">1 OF 85 QUESTIONS</span>
        </div>
        <div class="flex items-center space-x-2 sm:space-x-4">
            <button id="previous-btn" class="px-4 py-2 sm:px-6 sm:py-2 rounded-lg font-semibold text-gray-700 transition">Previous</button>
            <button id="next-btn" class="px-4 py-2 sm:px-6 sm:py-2 rounded-lg font-semibold text-white bg-blue-500 transition-transform transform hover:scale-105">Next</button>
            <button id="submit-exam-btn" class="px-4 py-2 sm:px-6 sm:py-2 rounded-lg font-semibold text-white bg-orange-500 hover:bg-orange-600 transition-transform transform hover:scale-105 hidden">Submit Exam</button>
        </div>
    </footer>

<script>
    // --- Data and State ---

    // =======================================================================================
    // FIX: The original question bank had a nested and inconsistent structure.
    // It has been flattened into a single, consistent array of question objects.
    // This ensures all questions are available to the quiz logic.
    // =======================================================================================
    const quizData = [
       {
            "questionText": "A 72-year-old patient with a history of hypertension and hyperlipidemia presents to the emergency department with a 3-hour history of severe, unrelenting substernal chest pain. He also reports new-onset dyspnea and extreme fatigue. An ECG shows ST-segment elevation. The nurse understands the patient is experiencing a STEMI. Which of the following nursing interventions is the highest priority upon his arrival?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Administering a thrombolytic agent to dissolve the clot within 30 minutes of arrival.",
                "B": "Placing the patient in a physical rest position with the head of a bed elevated.",
                "C": "Obtaining a large bore IV access and drawing labs, including cardiac biomarkers.",
                "D": "Initiating continuous cardiac monitoring and obtaining a 12-lead ECG within 10 minutes."
            },
            "correctAnswer": "D",
            "rationale": "For a patient with a suspected STEMI, the most critical and time-sensitive initial nursing intervention is to obtain an ECG as soon as possible, within 10 minutes of arrival, to confirm the diagnosis and guide immediate treatment. Continuous cardiac monitoring is also essential to detect dysrhythmias, which are common complications. While the other actions are necessary, the ECG and monitoring are the first steps in the \"Time is Muscle\" protocol."
        },
        {
            "questionText": "A patient with unstable angina is receiving nitroglycerin. The nurse understands that this medication's primary therapeutic effect is to:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Increase cardiac contractility and improve stroke volume.",
                "B": "Dissolve existing coronary artery thrombi.",
                "C": "Relax coronary arteries and reduce the heart's workload.",
                "D": "Decrease the resistance to the ejection of blood from the ventricle (afterload)."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that nitroglycerin relaxes the coronary arteries, increasing the heart's blood supply. It also relaxes other blood vessels, which reduces the amount of blood returning to the heart, thereby easing the heart's workload. It does not dissolve clots (thrombolytics do), nor does its primary effect increase contractility or directly decrease afterload."
        },
        {
            "questionText": "A nurse is reviewing the laboratory results for a patient suspected of having a myocardial infarction. The patient's CPK-MB levels are elevated, but troponins are still within the normal range. Based on the provided study material, which of the following is the most likely reason for this discrepancy?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "The patient has a concurrent skeletal muscle injury that is elevating the CPK-MB.",
                "B": "The patient is more than 48 hours post-myocardial infarction.",
                "C": "The elevated CPK-MB indicates a NSTEMI, which does not elevate troponins.",
                "D": "The patient's symptoms are likely due to Prinzmetal's angina, not an infarction."
            },
            "correctAnswer": "A",
            "rationale": "The study material notes that CPK-MB \"May be related to skeletal injuries and is not cardiac specific.\" This is a key limitation of the test. Since troponins are cardiac specific and take 4-6 hours to elevate, a patient with an elevated CPK-MB and normal troponins likely has a skeletal injury. The patient is likely not more than 48 hours post-MI since CPK-MB levels return to normal within 48-72 hours. Both STEMI and NSTEMI elevate troponins. Prinzmetal's angina is a vasospasm, not a myocardial infarction."
        },
        {
            "questionText": "A patient is being prepared for a Percutaneous Coronary Intervention (PCI) via the femoral artery. The nurse places an \"X\" on the patient's pedal pulses bilaterally. What is the most critical reason for this pre-procedural nursing action?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "To provide a baseline for assessing the patient's peripheral perfusion post-procedure.",
                "B": "To identify the location for the post-procedure groin assessment.",
                "C": "To prevent the development of a venous thromboembolism (VTE) in the lower extremities.",
                "D": "To mark the site where a sheath will be inserted for the procedure."
            },
            "correctAnswer": "A",
            "rationale": "The study material lists \"Mark pulses with marker & 'X'\" as a pre-procedure nursing action for PCI. This is done to establish a baseline for comparison. The most critical assessment post-procedure is to check the groin site and peripheral pulses first, looking for changes in perfusion."
        },
        {
            "questionText": "A nurse is caring for a patient experiencing cardiogenic shock due to an acute myocardial infarction. The nurse understands this is a severe complication of impaired central perfusion. The primary goal of nursing interventions for this patient would be to:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Increase afterload to improve blood pressure.",
                "B": "Decrease contractility to reduce myocardial oxygen demand.",
                "C": "Improve cardiac output to restore oxygenated blood flow to the body tissues.",
                "D": "Administer a thrombolytic agent to dissolve any remaining clot."
            },
            "correctAnswer": "C",
            "rationale": "The study material notes that severe impairment of central perfusion is \"associated with shock\" and results from inadequate cardiac output. The primary goal is to address the underlying cause, which is the failure of the heart to pump effectively. Improving cardiac output is the key to restoring systemic perfusion and reversing shock. Increasing afterload would worsen the heart's workload. Decreasing contractility would be contraindicated as the heart is already failing. While thrombolytics are used for MI, they are not the primary treatment for the shock state itself."
        },
        {
            "questionText": "A patient presents with a history of exertional chest pain that is consistently relieved by rest. The nurse is preparing to provide patient education. The nurse's teaching should focus on which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "The importance of immediate emergency department visits for all chest pain episodes.",
                "B": "The use of calcium antagonists and nitrates to control coronary spasms.",
                "C": "The role of nitroglycerin in relaxing coronary arteries and easing the heart's workload.",
                "D": "The signs and symptoms of unstable angina, as this condition is often the first step to an MI."
            },
            "correctAnswer": "C",
            "rationale": "The patient's symptoms (exertional pain relieved by rest) are characteristic of Angina Pectoris. The study material states that for this type of angina, \"chest discomfort is normally relieved with rest, nitroglycerin or both.\" The nurse's teaching should focus on the mechanism of nitroglycerin's action for this specific type of angina. Unstable angina is characterized by pain at rest that is not relieved by rest or nitroglycerin. Prinzmetal's is a spasm, and emergency visits are for unstable angina/MI."
        },
        {
            "questionText": "A patient is being discharged from the hospital after a STEMI. The nurse provides education on potential long-term complications. Which of the following complications should the nurse include in the teaching?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Pericarditis",
                "B": "Atrioventricular block",
                "C": "Left ventricular thrombus",
                "D": "Ventricular arrhythmias"
            },
            "correctAnswer": "A",
            "rationale": "The study material lists \"pericardial complications such as pericarditis\" as a long-term complication of an acute MI. Atrioventricular block and ventricular arrhythmias are electrical complications that most commonly occur within 24 hours. A left ventricular thrombus is a bleeding/thrombotic complication that may occur at any time within the first week."
        },
        {
            "questionText": "A nurse is assessing a patient with a confirmed left ventricular thrombus. The nurse understands this complication of an MI is categorized as which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "An ischemic complication.",
                "B": "An embolic, thrombotic, and bleeding complication.",
                "C": "A mechanical complication.",
                "D": "An electrical complication."
            },
            "correctAnswer": "B",
            "rationale": "The study material lists \"embolic, thrombotic, and bleeding complications, such as left ventricular thrombus.\" This is the most specific and accurate classification provided in the text."
        },
        {
            "questionText": "A patient is admitted to the cardiac unit with a suspected myocardial infarction. The nurse prepares to draw a series of cardiac enzyme labs. Which of the following is the most accurate statement regarding the expected timeline of these lab results?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "CPK-MB and Troponin will both elevate at the same time, within 4-6 hours.",
                "B": "Troponin levels will elevate first and remain elevated for a longer period than CPK-MB.",
                "C": "CPK-MB will elevate first, peak in 12-20 hours, and return to normal in 48-72 hours.",
                "D": "Both CPK-MB and Troponin will be elevated immediately upon the onset of symptoms."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that CPK-MB \"Elevates within 4–8 hr, peaks in 12–20 hr, returns to normal in 48–72 hr.\" It also states that Troponins elevate at 4-6 hours, peak at 14-18 hours, and return to baseline over 6-7 days. While troponins may elevate slightly earlier, CPK-MB has a more rapid peak and decline. Neither marker is elevated immediately upon the onset of symptoms."
        },
        {
            "questionText": "A patient with a history of peripheral artery disease (PAD) is experiencing claudication. The nurse understands this is a manifestation of impaired tissue perfusion related to which of the following pathophysiological concepts?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Inadequate cardiac output.",
                "B": "A lack of patent vessels.",
                "C": "Excessive capillary permeability.",
                "D": "High hydrostatic pressure."
            },
            "correctAnswer": "B",
            "rationale": "PAD is an exemplar of local/tissue perfusion. The study material states that tissue perfusion \"Requires patent vessels.\" Claudication is a symptom of arterial occlusion or narrowing, which represents a lack of patent vessels, thereby impairing blood flow to the target tissue (the muscles of the leg). The other options relate more to central perfusion or fluid shifts, not a lack of blood flow in the arteries."
        },
        {
            "questionText": "A nurse is caring for a patient with a STEMI. The patient asks why a beta-blocker is being administered. The nurse's response should be based on which of the following actions of the medication?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "It increases preload, leading to improved cardiac output.",
                "B": "It decreases heart rate and blood pressure, which reduces myocardial workload.",
                "C": "It dissolves the thrombus in the coronary artery, allowing blood to flow.",
                "D": "It improves the contractility of the cardiac muscle."
            },
            "correctAnswer": "B",
            "rationale": "The study material lists beta-blockers as a treatment to \"manage HR, BP and can affect preload/afterload.\" By managing heart rate and blood pressure, the medication reduces the workload on the heart, thereby minimizing myocardial damage and preserving function. The other options describe the actions of vasodilators (A), thrombolytics (C), and inotropes (D)."
        },
        {
            "questionText": "A 58-year-old male presents with sudden, sharp chest pain that is exacerbated by inspiration and lying down. He has a history of a recent MI. The nurse suspects which of the following post-infarction complications?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Reinfarction",
                "B": "Pericarditis",
                "C": "Left ventricular thrombus",
                "D": "Atrioventricular block"
            },
            "correctAnswer": "B",
            "rationale": "The patient's symptoms (chest pain exacerbated by inspiration and position changes) are classic signs of pericarditis. The study material lists \"pericardial complications Post-infarction such as pericarditis\" as a potential complication. Reinfarction is a type of angina/ischemic complication. A left ventricular thrombus is a thrombotic complication. An AV block is an electrical complication."
        },
        {
            "questionText": "A patient is being evaluated for potential heart failure. The nurse understands that this condition is an exemplar of impaired central perfusion and is characterized by which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Increased cardiac output.",
                "B": "Inadequate cardiac output.",
                "C": "Absence of systemic symptoms.",
                "D": "Impaired gas exchange."
            },
            "correctAnswer": "B",
            "rationale": "The study material defines impaired central perfusion as occurring \"when cardiac output is inadequate.\" Heart failure is listed as an exemplar of central perfusion. The other options are incorrect. Increased cardiac output would not cause heart failure. While impaired gas exchange is an interrelated concept, the core issue of heart failure is the inadequate cardiac output."
        },
        {
            "questionText": "A nurse is providing education on prevention of impaired perfusion to a group of community members. Which of the following should the nurse include as an appropriate primary prevention strategy?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Annual cholesterol screenings.",
                "B": "Regular blood pressure monitoring.",
                "C": "Maintaining a healthy diet and lifestyle.",
                "D": "Taking prescribed lipid-lowering agents."
            },
            "correctAnswer": "C",
            "rationale": "The study material lists \"Nutrition\" and \"Activity and exercise\" as primary prevention strategies. Maintaining a healthy diet and lifestyle falls under nutrition. Annual cholesterol screenings are secondary prevention. Regular blood pressure monitoring and lipid-lowering agents are also secondary or tertiary interventions."
        },
        {
            "questionText": "A patient with a history of unstable angina is experiencing a sudden onset of chest pain while resting. The nurse recognizes this as a potential emergency. The most common cause of this type of chest pain, accordings to the study material, is:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Coronary artery spasms.",
                "B": "Coronary arteries narrowed by fatty buildups resulting in a blood clot.",
                "C": "Inadequate blood supply to the heart relieved by rest.",
                "D": "An aneurysm of a coronary artery."
            },
            "correctAnswer": "B",
            "rationale": "The study material states that for Unstable Angina, the \"most common cause is reduced blood flow to the heart muscle because the coronary arteries are narrowed by fatty buildups (atherosclerosis) resulting in blood clotting which blocks the flow of blood to the heart muscle.\" The other options describe Prinzmetal's angina (A) and stable angina pectoris (C)."
        },
        {
            "questionText": "A nurse is assessing a patient with a confirmed STEMI. The nurse understands that a key priority intervention is the administration of oxygen. According to the study material, what is the initial flow rate for oxygen administration?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "2 L/min",
                "B": "4 L/min",
                "C": "6 L/min",
                "D": "8 L/min"
            },
            "correctAnswer": "B",
            "rationale": "The study material explicitly states to \"Administer O2 at 4L\" as part of the initial clinical management for an acute MI."
        },
        {
            "questionText": "A nurse is preparing a patient for a Coronary Artery Bypass Graft (CABG). The nurse understands that this is a collaborative intervention for which type of perfusion issue?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Central perfusion",
                "B": "Tissue (Local) perfusion",
                "C": "Both central and local perfusion",
                "D": "A clotting disorder"
            },
            "correctAnswer": "C",
            "rationale": "The study material lists CABG as a procedure to re-vascularize blood supply to damaged tissue, which is a local perfusion issue. However, CABG is a surgery on the heart, which is the core of central perfusion. Therefore, it is a collaborative intervention for both central and local perfusion."
        },
        {
            "questionText": "A patient is being discharged after a PCI with a femoral approach. The nurse provides discharge teaching. Which of the following instructions should the nurse include?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "You should be on bedrest for 48 hours after you get home.",
                "B": "It is important to check your groin for a bruit every shift at home.",
                "C": "You must avoid heavy lifting and long periods of sitting.",
                "D": "You should call your doctor if you experience a warm flush sensation."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that discharge teaching should include information regarding \"weight and duration of sitting restrictions.\" This translates to avoiding heavy lifting and long periods of sitting. Bedrest is for the immediate post-procedure period in the hospital, not at home. The patient does not check for a bruit at home. A warm flush is an expected sensation during the procedure, not a post-discharge complication to be reported."
        },
        {
            "questionText": "A nurse is assessing a patient and notes a normal finding for central perfusion. Which of the following would be an expected finding?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Capillary refill of 5 seconds.",
                "B": "Blood pressure of 140/90 mmHg.",
                "C": "An ejection fraction of 60%.",
                "D": "A heart rate of 110 bpm at rest."
            },
            "correctAnswer": "C",
            "rationale": "Ejection fraction is defined as the \"percent of end-diastolic volume ejected with each heartbeat.\" While the normal value isn't given, a typical healthy ejection fraction is 55-70%. An EF of 60% indicates a strong, normal central perfusion. Capillary refill of 5 seconds is a delayed finding. A BP of 140/90 is hypertension. A resting HR of 110 bpm is tachycardia."
        },
        {
            "questionText": "A patient is diagnosed with a venous thromboembolism (VTE). The nurse understands that this is an exemplar of impaired tissue perfusion. The collaborative intervention for this condition would most likely include which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "An intra-aortic balloon pump.",
                "B": "Endarterectomy.",
                "C": "A lipid-lowering agent.",
                "D": "An anticoagulant."
            },
            "correctAnswer": "D",
            "rationale": "The study material lists VTE as a tissue perfusion exemplar. Anticoagulants are a class of pharmacotherapy for impaired tissue perfusion and are a standard treatment for VTE to prevent clot growth and new clots. The other options are interventions for different perfusion issues."
        },
        {
            "questionText": "A nurse is teaching a patient about the relationship between diet and perfusion. The nurse should explain that which of the following is a primary contributor to atherosclerosis, which can lead to impaired perfusion?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Hyperlipidemia",
                "B": "Hemophilia",
                "C": "Thrombocytopenia",
                "D": "Sickle cell disease"
            },
            "correctAnswer": "A",
            "rationale": "The study material lists hyperlipidemia as a local/tissue perfusion exemplar and states that atherosclerosis (fatty buildups) is a common cause of reduced blood flow leading to unstable angina. Hyperlipidemia is the medical term for high lipids in the blood, which is a key contributor to atherosclerosis. The other options are also perfusion exemplars but do not directly relate to atherosclerosis."
        },
        {
            "questionText": "A patient is admitted with a diagnosis of heart failure. The nurse notes the patient has a weak pulse and is tachycardic. The nurse understands this is the body's compensatory mechanism for:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Decreased stroke volume.",
                "B": "Increased afterload.",
                "C": "Decreased contractility.",
                "D": "Increased preload."
            },
            "correctAnswer": "A",
            "rationale": "Cardiac output is the product of stroke volume and heart rate. In a patient with heart failure and a decreased cardiac output, the body compensates by increasing the heart rate (tachycardia) to try and maintain adequate cardiac output. This is a response to a decreased stroke volume. The other options may be related to heart failure, but the direct compensatory mechanism for maintaining cardiac output is an increase in heart rate."
        },
        {
            "questionText": "A patient is scheduled for a cardiac stress test. The nurse should explain to the patient that the purpose of this test is to:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Evaluate the structures of the heart.",
                "B": "Visualize the narrowing of coronary arteries.",
                "C": "Detect issues with cardiac perfusion when the heart is stressed.",
                "D": "Identify calcium deposits in the coronary arteries."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that a stress test \"detects issues with cardiac perfusion when heart is stressed.\" This is its direct function. The other options describe the function of an echocardiogram (A), coronary angiography (B), and a calcium scoring test (D)."
        },
        {
            "questionText": "A patient is diagnosed with DIC, a clotting disorder. The nurse understands that this condition is an exemplar of impaired tissue perfusion due to its effect on which of the following interrelated concepts?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Mobility",
                "B": "Elimination",
                "C": "Clotting",
                "D": "Patient education"
            },
            "correctAnswer": "C",
            "rationale": "The study material lists DIC, hemophilia, thrombocytopenia, and Von-Willebrand disease under the heading of \"Clotting disorders,\" which is a sub-category of \"Perfusion Exemplars\" under \"Local/Tissue perfusion.\" Therefore, its relationship is most directly to the concept of clotting."
        },
        // FIX: This question was mislabeled as 'mc' and had an incorrectly formatted answer.
        // It has been changed to 'sata' with the correct answer format.
        {
            "questionText": "The nurse is caring for a patient with a confirmed STEMI. The nurse understands that the treatment goal of reperfusion is to minimize the size of the infarction and preserve ventricular function. Which of the following interventions are indicated for reperfusion? (Select All That Apply)",
            "type": "sata",
            "section": "Perfusion",
            "options": {
                "A": "Administering a beta-blocker.",
                "B": "Administering a thrombolytic.",
                "C": "Performing a Percutaneous Coronary Intervention (PCI).",
                "D": "Performing a Coronary Artery Bypass Graft (CABG).",
                "E": "Administering oxygen."
            },
            "correctAnswer": ["B", "C", "D"],
            "rationale": "The study material lists thrombolytic therapy, PCI, and CABG as treatments for STEMI. These three interventions are directly aimed at reestablishing blood flow (reperfusion) to the affected myocardial tissue. Administering a beta-blocker and oxygen are part of the initial management (MONAB) to reduce myocardial demand and improve oxygenation but are not considered reperfusion interventions."
        },
        {
            "questionText": "A patient is on the cardiac unit following a STEMI. The nurse notes the patient is complaining of new-onset shortness of breath and has crackles in their lungs. The nurse understands that these are signs of which common complication?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Pericarditis",
                "B": "Ventricular fibrillation",
                "C": "Heart failure",
                "D": "Left ventricular thrombus"
            },
            "correctAnswer": "C",
            "rationale": "The study material lists dyspnea (shortness of breath) and peripheral edema (which often correlates with lung crackles) as manifestations of impaired central perfusion and notes that hypotension and CHF (Congestive Heart Failure) are long-term complications of MI. These are the classic signs of heart failure. The other options do not typically present with these specific symptoms."
        },
        {
            "questionText": "A nurse is providing education to a patient with newly diagnosed hypertension. The nurse explains that this condition can lead to which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Decreased afterload.",
                "B": "Reduced cardiac workload.",
                "C": "Impaired tissue perfusion.",
                "D": "Decreased resistance to blood ejection."
            },
            "correctAnswer": "C",
            "rationale": "Hypertension is listed as a local/tissue perfusion exemplar. Chronically high blood pressure can damage blood vessels and lead to impaired tissue perfusion. It increases afterload and cardiac workload, and it increases resistance to blood ejection, so the other options are incorrect."
        },
        {
            "questionText": "A patient presents with a fever, chills, and new or changed heart murmur. The nurse suspects which of the following central perfusion exemplars?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Valvular disease",
                "B": "Cardiomyopathy",
                "C": "Endocarditis",
                "D": "Heart failure"
            },
            "correctAnswer": "C",
            "rationale": "Endocarditis is an inflammation of the heart's inner lining, usually the heart valves. Fever and a new or changed heart murmur are classic signs. The other options are also central perfusion exemplars, but they do not typically present with fever and chills."
        },
        {
            "questionText": "A nurse is assessing a patient following a PCI with a femoral approach. Which of the following is the most critical post-procedure assessment?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Vital signs every 8 hours.",
                "B": "Resuming a regular diet immediately.",
                "C": "Groin site and peripheral pulses.",
                "D": "Patient's knowledge of weight restrictions."
            },
            "correctAnswer": "C",
            "rationale": "The study material lists \"Groin site assessment and peripheral pulses first\" as the first and most critical post-procedure assessment. The other options are also part of post-procedural care but are not the highest priority."
        },
        {
            "questionText": "The nurse is caring for a patient who develops hypoxemia and acidosis. The nurse understands that this can lead to a decrease in cardiac contractility. According to the study material, what is the impact of decreased contractility on central perfusion?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "It increases stroke volume, leading to higher cardiac output.",
                "B": "It decreases preload, leading to less stretch of the cardiac muscle.",
                "C": "It decreases the amount of blood pumped by the ventricle per minute.",
                "D": "It increases the resistance to blood ejection from the ventricle."
            },
            "correctAnswer": "C",
            "rationale": "The study material defines contractility as the \"contractibility of the cardiac muscle to shorten in response to an electrical impulse.\" A decrease in this ability directly impacts the amount of blood the ventricle can pump out per minute (cardiac output), which is the foundation of central perfusion."
        },
        {
            "questionText": "A nurse is preparing to administer thrombolytic therapy for a patient with a STEMI. The nurse knows that this treatment is not always the first line of defense. The rationale for choosing PCI over thrombolytics is based on which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "PCI is more effective at dissolving a thrombus.",
                "B": "Thrombolytics are only used for NSTEMI.",
                "C": "Thrombolytics have more contraindications, such as recent surgery or falls.",
                "D": "Thrombolytics are more effective for a blockage that is not accessible with a catheter."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that thrombolytic therapy \"may not be first line of treatment\" and lists specific contraindications like \"recent surgery, recent falls, spinal tap.\" This is a key reason why a PCI might be chosen as the first option if available. The study material also notes that thrombolytics are used when the cath lab is not available or if the blockage is not accessible using a catheter, which makes option D incorrect."
        },
        {
            "questionText": "A nurse is assessing a patient and notes a capillary refill time of 5 seconds in the great toe. This finding indicates an issue with which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Central perfusion",
                "B": "Tissue (Local) perfusion",
                "C": "Venous return",
                "D": "Cardiac output"
            },
            "correctAnswer": "B",
            "rationale": "A delayed capillary refill is a classic sign of impaired tissue or local perfusion, indicating that blood flow to the capillaries is compromised. Central perfusion issues (A) are systemic. Venous return (C) and cardiac output (D) affect perfusion but are not directly measured by capillary refill."
        },
        {
            "questionText": "A patient with a history of heart failure is prescribed an ACE inhibitor. The nurse understands that this medication will affect which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "It will increase the resistance to blood ejection from the ventricle.",
                "B": "It will decrease the amount of blood ejected with each heartbeat.",
                "C": "It will manage heart rate and blood pressure by affecting preload/afterload.",
                "D": "It will increase the contractility of the cardiac muscle."
            },
            "correctAnswer": "C",
            "rationale": "The study material lists ACE inhibitors as medications that \"manage HR, BP and can affect preload/afterload.\" This is the most accurate and comprehensive description of their function from the provided text."
        },
        {
            "questionText": "A nurse is conducting a patient assessment. The patient states, \"The doctor said I have a low ejection fraction.\" The nurse understands that this means:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "The amount of blood the ventricle ejects with each heartbeat is less than normal.",
                "B": "The heart's ability to stretch at the end of diastole is impaired.",
                "C": "The resistance the ventricle faces during ejection is abnormally high.",
                "D": "The volume of blood in the heart is too low."
            },
            "correctAnswer": "A",
            "rationale": "The study material defines ejection fraction as the \"percent of end-diastolic volume ejected with each heartbeat.\" Therefore, a low ejection fraction means that a lower-than-normal percentage of blood is being ejected with each pump."
        },
        {
            "questionText": "A patient is diagnosed with Sickle Cell Anemia. The nurse understands that this is an exemplar of impaired local/tissue perfusion due to its effect on which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Patient education",
                "B": "Mobility",
                "C": "Inflammation",
                "D": "The flow of blood through arteries and capillaries"
            },
            "correctAnswer": "D",
            "rationale": "The study material defines perfusion as \"the flow of blood through arteries and capillaries, delivering nutrients and oxygen to cells.\" Sickle cell anemia impairs this flow by causing the red blood cells to deform into a sickle shape, which can block capillaries and impede blood flow. This is a direct impairment of the fundamental definition of perfusion."
        },
        {
            "questionText": "A nurse is caring for a patient admitted with an MI. The patient is placed on bedrest with the head of the bed elevated. The nurse understands that this intervention is primarily aimed at:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Preventing venous thromboembolism.",
                "B": "Minimizing the heart's workload.",
                "C": "Improving local tissue perfusion.",
                "D": "Facilitating respiratory complications."
            },
            "correctAnswer": "B",
            "rationale": "The study material lists \"Physical rest in bed with HOB elevated\" as an intervention for clinical management of an acute MI. This position helps to reduce the heart's workload by decreasing the amount of blood returning to the heart (preload). While it can help prevent some respiratory complications, the primary goal for an MI patient is to reduce cardiac workload."
        },
        {
            "questionText": "A patient is being prepared for a Cardiac Valve Surgery. The nurse understands this procedure is a collaborative intervention for which type of perfusion issue?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Central perfusion",
                "B": "Tissue (Local) perfusion",
                "C": "Both central and local perfusion",
                "D": "A clotting disorder"
            },
            "correctAnswer": "A",
            "rationale": "The study material lists \"Cardiac valve surgery\" under the \"Central Perfusion\" section of \"Other Collaborative Interventions.\""
        },
        {
            "questionText": "A patient is diagnosed with a pulmonary embolism (PE). The nurse recognizes this as an exemplar of impaired tissue perfusion related to which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Gas exchange",
                "B": "Cognition",
                "C": "Elimination",
                "D": "Pain"
            },
            "correctAnswer": "A",
            "rationale": "The study material lists gas exchange as an interrelated concept to perfusion. A PE is a blockage of an artery in the lungs, which directly impairs the ability of the lungs to perform gas exchange. Therefore, the most direct and crucial interrelated concept is gas exchange."
        },
        {
            "questionText": "A nurse is caring for a patient with a confirmed STEMI. The nurse understands that a key priority intervention is the administration of morphine. The rationale for this is to:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Decrease pain and anxiety, thereby reducing myocardial oxygen demand.",
                "B": "Increase heart rate to improve cardiac output.",
                "C": "Dissolve the thrombus in the coronary artery.",
                "D": "Manage blood pressure by increasing afterload."
            },
            "correctAnswer": "A",
            "rationale": "Morphine is part of the MONAB acronym for MI treatment. Its primary purpose in this context is to relieve the severe pain and anxiety associated with the event, which in turn reduces the sympathetic nervous system's response and lowers myocardial oxygen demand."
        },
        {
            "questionText": "A nurse is reviewing a patient's diagnostic results and notes a positive Calcium Scoring Test. The nurse understands this test indicates which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "The presence of a clot in the coronary artery.",
                "B": "The degree of narrowing in the coronary arteries.",
                "C": "The presence of calcium deposits in the coronary arteries.",
                "D": "The overall structure and function of the heart."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that the Calcium Scoring Test \"uses computer tomography (CT) to detect calcium deposits in the coronary arteries.\" The other options describe the findings of a coronary angiography (A, B) and an echocardiogram (D)."
        },
        {
            "questionText": "A patient is admitted to the emergency department with a suspected MI. The nurse's first action is to establish IV access and draw labs. The nurse understands that this is a priority intervention for which of the following reasons?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "To have a route for administering medications such as MONAB.",
                "B": "To get a definitive diagnosis from the cardiac enzyme levels.",
                "C": "To prevent a left ventricular thrombus.",
                "D": "To prepare for a Percutaneous Coronary Intervention (PCI)."
            },
            "correctAnswer": "A",
            "rationale": "The study material lists \"Establish IV access and labs\" as a key intervention. The primary reason for establishing IV access is to have a rapid route for administering the immediate life-saving medications (MONAB). While labs are drawn, the definitive diagnosis is not instantaneous. The IV access is for immediate treatment, which is a higher priority than preventing future complications or preparing for a specific procedure."
        },
        {
            "questionText": "A nurse is caring for a patient who is experiencing cardiogenic shock. The nurse understands that this condition is a consequence of which of the following?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "An inadequate supply of blood to the heart muscles.",
                "B": "A complete absence of oxygen reaching the tissues.",
                "C": "An inadequate cardiac output.",
                "D": "An abnormally high hydrostatic pressure."
            },
            "correctAnswer": "C",
            "rationale": "The study material states that impaired central perfusion occurs \"when cardiac output is inadequate\" and that if \"severe, [it is] associated with shock.\" Therefore, inadequate cardiac output is the direct cause of the shock state. The other options are either a result of the shock (B), or a related concept (A), but not the direct cause of the shock itself."
        },
        {
            "questionText": "A patient is diagnosed with Aortic Stenosis. The nurse recognizes this as an exemplar of which type of perfusion issue?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Central perfusion (Valvular Disease)",
                "B": "Local/Tissue perfusion (Arteriosclerosis)",
                "C": "Clotting disorder (Thrombocytopenia)",
                "D": "Central perfusion (Dysrhythmias)"
            },
            "correctAnswer": "A",
            "rationale": "The study material lists \"Valvular Disease\" as a central perfusion exemplar. Aortic stenosis is a type of valvular disease. The other options are incorrect classifications."
        },
        {
            "questionText": "A nurse is explaining the concept of \"Time is Muscle\" to a patient with a STEMI. The nurse's explanation should emphasize that:",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "The more time that passes, the more likely a thrombus will dissolve on its own.",
                "B": "The longer the delay in treatment, the greater the amount of myocardial cell death.",
                "C": "The patient must be transferred to a cath lab within 30 minutes of arriving at the hospital.",
                "D": "The most common complications occur within 24 hours of the MI."
            },
            "correctAnswer": "B",
            "rationale": "The phrase \"Time is Muscle\" refers to the direct relationship between the time a coronary artery is occluded and the amount of permanent damage (infarction) to the heart muscle. The longer the blood flow is blocked, the more muscle dies. While the other options are related to MI, they do not directly explain the \"Time is Muscle\" concept."
        },
        {
            "questionText": "The nurse is caring for a patient post-MI. The patient reports a new, persistent \"tightness in the chest\" that is similar to the initial pain, but less severe. The nurse understands this could be a sign of which ischemic complication?",
            "type": "mc",
            "section": "Perfusion",
            "options": {
                "A": "Pericarditis",
                "B": "Infarct extension",
                "C": "Atrial fibrillation",
                "D": "Left ventricular thrombus"
            },
            "correctAnswer": "B",
            "rationale": "The study material lists \"ischemic complications, such as reinfarction, infarct extension, and post infarction angina.\" A persistent new pain similar to the initial pain would suggest an extension of the initial infarct, meaning more heart muscle is becoming ischemic. Pericarditis pain is positional. Atrial fibrillation is an electrical complication. A left ventricular thrombus would likely lead to a stroke or other embolic event, not recurrent chest tightness."
        },
        {
            "questionText": "A 72-year-old male is admitted with an acute inferior wall myocardial infarction. The nurse notes a heart rate of 48 beats/min, dizziness, and a drop in blood pressure. The nurse should anticipate which of the following immediate interventions? (Select all that apply)",
            "options": {
                "A": "Initiating a stat dose of adenosine IV push.",
                "B": "Preparing for transcutaneous pacing.",
                "C": "Administering atropine sulfate as prescribed.",
                "D": "Administering a beta-adrenergic blocker to slow the heart rate.",
                "E": "Placing the patient in a Trendelenburg position.",
                "F": "Administering oxygen therapy as ordered."
            },
            "correctAnswer": ["B", "C", "F"],
            "rationale": "Symptomatic sinus bradycardia (rate < 60 bpm with signs of decreased cardiac output like dizziness and hypotension) requires immediate intervention. The ACLS protocol for bradycardia includes administration of atropine, oxygen therapy, and, if the patient remains unstable, preparing for transcutaneous pacing. Adenosine is used for SVT, and a beta-blocker would further decrease the heart rate, worsening the patient's condition. Trendelenburg is not a standard intervention for this type of dysrhythmia.",
            "section": "Sinus Bradycardia",
            "type": "sata"
        },
        {
            "questionText": "The nurse is analyzing an ECG rhythm strip and notes the following characteristics: a rate of 160 bpm, regular rhythm, and no identifiable P waves. The QRS complex is narrow. The nurse correctly identifies this rhythm as:",
            "options": {
                "A": "Sinus tachycardia",
                "B": "Atrial fibrillation",
                "C": "Supraventricular tachycardia (SVT)",
                "D": "Atrial flutter"
            },
            "correctAnswer": "C",
            "rationale": "Supraventricular tachycardia (SVT) is characterized by a rapid, regular rhythm originating above the ventricles, typically with a rate between 150-250 bpm. Due to the rapid rate, P waves are often obscured or not visible. The narrow QRS complex indicates the impulse is originating from above the ventricles. Sinus tachycardia has a normal P wave and a rate typically less than 160 bpm. Atrial fibrillation and atrial flutter are both irregular rhythms (ventricular rate in Afib is irregular; atrial rate in A-flutter is regular but ventricular rate may be irregular).",
            "section": "Supraventricular Tachycardia",
            "type": "mc"
        },
        {
            "questionText": "A patient with a history of heart failure reports feeling a 'fluttering' in their chest. The nurse performs an ECG and identifies a regular atrial rhythm with a sawtooth pattern and a ventricular rate that varies irregularly. The nurse should anticipate which of the following interventions?",
            "options": {
                "A": "Immediately preparing for defibrillation.",
                "B": "Administering intravenous adenosine.",
                "C": "Assessing for symptoms of decreased cardiac output and preparing for synchronized cardioversion if unstable.",
                "D": "Discontinuing the patient's cardiac medications and notifying the provider."
            },
            "correctAnswer": "C",
            "rationale": "The ECG characteristics describe Atrial Flutter. While a rapid ventricular response can lead to instability, a patient who is symptomatic but stable can be treated with calcium channel blockers or beta-blockers. However, if the patient becomes unstable (e.g., hypotensive, altered LOC, chest pain), the definitive treatment is synchronized cardioversion. Defibrillation is used for pulseless VT and VF. Adenosine is used for SVT, not Atrial Flutter. Discontinuing medications without a provider's order is inappropriate.",
            "section": "Atrial Flutter",
            "type": "mc"
        },
        {
            "questionText": "A patient is admitted to the cardiac unit for continuous ECG monitoring. The nurse is preparing the patient for electrode placement. Which of the following actions indicate a correct understanding of the procedure? (Select all that apply)",
            "options": {
                "A": "Clipping hair and cleaning the skin with an alcohol wipe.",
                "B": "Avoiding placing electrodes over bony prominences.",
                "C": "Placing the positive electrode on the patient's right clavicle.",
                "D": "Attaching the lead cable to the electrode before placing it on the patient's skin.",
                "E": "Rubbing the skin briskly with gauze to improve conductivity.",
                "F": "Applying a small amount of conductive gel to each electrode."
            },
            "correctAnswer": ["A", "D", "E"],
            "rationale": "Proper skin preparation is crucial for accurate ECG monitoring. This includes clipping chest hair, cleaning the skin to remove dirt and oils, and briskly rubbing the skin to create a slight abrasion, which improves electrical conductivity. The lead cable should be attached to the electrode before it is placed on the skin to minimize tugging and dislodgement. Electrodes are typically placed below the clavicles (RA, LA) and lowest palpable ribs (RL, LL). Applying gel is not standard practice as the electrodes are pre-gelled, and it can increase impedance if too much is used.",
            "section": "ECG Monitoring",
            "type": "sata"
        },
        // ... (The rest of the flattened and corrected quizData array follows the same pattern)
        {
            "questionText": "The nurse is providing patient education about the pathophysiology of heart failure. The nurse correctly explains that afterload is:",
            "type": "mc",
            "section": "Pathophysiology",
            "options": {
                "A": "The amount of blood ejected with each heartbeat.",
                "B": "The degree of stretch of the cardiac muscle fibers at the end of diastole.",
                "C": "The ability of the cardiac muscle to shorten in response to an electrical impulse.",
                "D": "The resistance the ventricle must overcome to eject blood."
            },
            "correctAnswer": "D",
            "rationale": "Afterload is the resistance that the ventricle must overcome to eject blood. It is a key determinant of cardiac output and is often increased in heart failure due to vasoconstriction. Option A defines stroke volume, B defines preload, and C defines contractility."
        },
        {
             "questionText": "A patient is admitted with a diagnosis of acute kidney injury from sepsis. The nurse knows that this is an example of which type of AKI?",
             "options": {
                 "A": "Prerenal",
                 "B": "Intrarenal",
                 "C": "Postrenal",
                 "D": "Chronic"
             },
             "correctAnswer": "A",
             "rationale": "Sepsis causes widespread vasodilation and hypotension, which leads to reduced blood flow (perfusion) to the kidneys. This reduction in perfusion is the underlying cause of prerenal AKI.",
             "type": "mc"
         }
    ];

    let currentQuestionIndex = 0;
    let shuffledQuizData = [];
    let userAnswers = [];
    let flaggedQuestions = [];
    let timeLeft = 7200; // 2 hours in seconds
    let timerInterval;

    const startScreen = document.getElementById('start-screen');
    const startBtn = document.getElementById('start-btn');
    const header = document.getElementById('header');
    const mainContent = document.getElementById('main-content');
    const footer = document.getElementById('footer');
    const navQuestionsContainer = document.getElementById('nav-questions');
    const questionContainer = document.getElementById('question-container');
    const reviewScreen = document.getElementById('review-screen');
    const reviewQuestionsContainer = document.getElementById('review-questions');
    const nextBtn = document.getElementById('next-btn');
    const previousBtn = document.getElementById('previous-btn');
    const submitExamBtn = document.getElementById('submit-exam-btn');
    const endReviewBtn = document.getElementById('end-review-btn');
    const timerDisplay = document.getElementById('timer');
    const questionCounter = document.getElementById('question-counter');
    const loadingAnimation = document.getElementById('loading-animation');
    const gradeScreen = document.getElementById('grade-screen');
    const finalGradeDisplay = document.getElementById('final-grade');
    const restartBtn = document.getElementById('restart-btn');

    // --- Core Functions ---

    /**
     * Shuffles an array using the Fisher-Yates algorithm.
     * @param {Array} array The array to shuffle.
     */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    /**
     * Starts the 2-hour exam timer.
     */
    function startTimer() {
        timerInterval = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitExam();
            } else {
                timeLeft--;
                updateTimerDisplay();
            }
        }, 1000);
    }

    /**
     * Updates the timer display with the remaining time in HH:MM:SS format.
     */
    function updateTimerDisplay() {
        const hours = Math.floor(timeLeft / 3600);
        const minutes = Math.floor((timeLeft % 3600) / 60);
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    /**
     * Renders the current question and its options.
     */
    function renderQuestion() {
        if (currentQuestionIndex >= shuffledQuizData.length) {
            submitExam();
            return;
        }

        const questionData = shuffledQuizData[currentQuestionIndex];
        questionContainer.innerHTML = '';
        const questionHtml = document.createElement('div');
        questionHtml.className = 'bg-white p-6 sm:p-8 rounded-lg shadow-sm';

        questionHtml.innerHTML = `
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <span class="text-xl font-bold">Question ${currentQuestionIndex + 1}</span>
                <button id="flag-btn" class="px-4 py-2 rounded-lg text-sm text-white btn-orange font-semibold">${flaggedQuestions[currentQuestionIndex] ? 'UNFLAG' : 'FLAG'}</button>
            </div>
            <div class="mb-4 text-sm font-medium text-gray-500">${questionData.type === 'sata' ? 'Select all that apply.' : 'Select the best answer.'}</div>
            <h3 class="text-lg sm:text-xl font-semibold mb-6">${questionData.questionText}</h3>
        `;

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'space-y-3';

        const optionLetters = Object.keys(questionData.options);
        optionLetters.forEach(letter => {
            const optionText = questionData.options[letter.toUpperCase()];
            const isMultipleChoice = questionData.type === 'mc';
            const inputType = isMultipleChoice ? 'radio' : 'checkbox';
            const inputName = isMultipleChoice ? `answer-mc-${currentQuestionIndex}` : `answer-sata-${currentQuestionIndex}`;
            const labelClass = isMultipleChoice ? 'radio-label' : 'check-label';
            const inputClass = isMultipleChoice ? 'radio-btn' : 'check-btn';
            
            const optionDiv = document.createElement('div');
            optionDiv.innerHTML = `
                <input type="${inputType}" id="option-${letter}" name="${inputName}" value="${letter.toUpperCase()}" class="${inputClass}">
                <label for="option-${letter}" class="${labelClass}">
                    <span class="option-letter">${letter.toUpperCase()}</span>
                    <span class="flex-1 text-gray-800">${optionText}</span>
                    <svg class="strikethrough-btn h-6 w-6 text-gray-400 cursor-pointer hover:text-gray-600 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.98 8.98l16.04 6.04M3.98 15.02l16.04-6.04" />
                    </svg>
                </label>
            `;
            optionsContainer.appendChild(optionDiv);
        });

        questionHtml.appendChild(optionsContainer);
        questionContainer.appendChild(questionHtml);
        
        document.querySelectorAll('.strikethrough-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const label = e.target.closest('label');
                const textSpan = label.querySelector('span:nth-child(2)');
                textSpan.classList.toggle('strikethrough');
            });
        });

        document.getElementById('flag-btn').addEventListener('click', () => {
            flaggedQuestions[currentQuestionIndex] = !flaggedQuestions[currentQuestionIndex];
            renderQuestion(); // Re-render to update flag button text
        });

        // Restore saved answer for this question
        const savedAnswer = userAnswers[currentQuestionIndex];
        if (savedAnswer) {
            savedAnswer.forEach(answerValue => {
                const input = document.getElementById(`option-${answerValue.toLowerCase()}`);
                if (input) input.checked = true;
            });
        }

        updateNavigationSidebar();
        updateQuestionCounter();
        updateButtonStates();
    }

    function updateNavigationSidebar() {
        navQuestionsContainer.innerHTML = '';
        shuffledQuizData.forEach((_, i) => {
            const isAnswered = userAnswers[i] && userAnswers[i].length > 0;
            const navItem = document.createElement('div');
            navItem.className = `flex items-center justify-center w-8 h-8 rounded-md font-bold transition-colors relative cursor-pointer ${i === currentQuestionIndex ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}`;
            navItem.textContent = i + 1;
            navItem.onclick = () => {
                saveUserAnswer();
                currentQuestionIndex = i;
                renderQuestion();
            };
            
            if (isAnswered && i !== currentQuestionIndex) {
                 navItem.classList.add('bg-green-200');
            }
            if (flaggedQuestions[i]) {
                navItem.classList.add('ring-2', 'ring-offset-1', 'ring-orange-500');
            }
            
            navQuestionsContainer.appendChild(navItem);
        });
    }

    function updateQuestionCounter() {
        questionCounter.textContent = `${currentQuestionIndex + 1} OF ${shuffledQuizData.length} QUESTIONS`;
    }

    function updateButtonStates() {
        previousBtn.disabled = currentQuestionIndex === 0;
        previousBtn.classList.toggle('cursor-not-allowed', currentQuestionIndex === 0);
        previousBtn.classList.toggle('opacity-50', currentQuestionIndex === 0);

        if (currentQuestionIndex === shuffledQuizData.length - 1) {
            nextBtn.classList.add('hidden');
            submitExamBtn.classList.remove('hidden');
        } else {
            nextBtn.classList.remove('hidden');
            submitExamBtn.classList.add('hidden');
        }
    }

    function saveUserAnswer() {
        const questionData = shuffledQuizData[currentQuestionIndex];
        if (!questionData) return;
        
        const inputs = document.querySelectorAll(`input[name^="answer-"]:checked`);
        const selectedAnswers = Array.from(inputs).map(input => input.value);
        userAnswers[currentQuestionIndex] = selectedAnswers;
    }

    function renderReviewScreen() {
        mainContent.classList.add('hidden');
        reviewScreen.classList.remove('hidden');
        header.classList.add('hidden');
        footer.classList.add('hidden');
        document.querySelector('body').classList.remove('overflow-hidden');


        reviewQuestionsContainer.innerHTML = '';
        
        let missedCount = 0;
        shuffledQuizData.forEach((question, index) => {
            const userAnswer = userAnswers[index] || [];
            let isCorrect = false;
            
            const correctAnswers = new Set(Array.isArray(question.correctAnswer) ? question.correctAnswer : [question.correctAnswer]);
            const userSelections = new Set(userAnswer);

            isCorrect = correctAnswers.size === userSelections.size && [...correctAnswers].every(item => userSelections.has(item));

            if (!isCorrect) {
                missedCount++;
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-box';
                let optionsHtml = '';
                
                Object.keys(question.options).forEach(key => {
                    const letter = key.toUpperCase();
                    const isUserSelected = userSelections.has(letter);
                    const isCorrectAnswer = correctAnswers.has(letter);
                    
                    let optionClasses = 'p-3 my-2 rounded-lg border flex items-center space-x-3';
                    if (isCorrectAnswer) optionClasses += ' correct-answer';
                    if (isUserSelected && !isCorrectAnswer) optionClasses += ' incorrect-answer';

                    optionsHtml += `<div class="${optionClasses}"><span class="option-letter bg-gray-300">${letter}</span><span>${question.options[key]}</span></div>`;
                });

                reviewItem.innerHTML = `<h3 class="text-xl font-bold mb-4">Question #${index + 1}: ${question.questionText}</h3><div class="space-y-2 mb-4">${optionsHtml}</div><div class="p-4 bg-gray-100 rounded-lg"><h4 class="font-semibold text-lg">Rationale:</h4><p class="text-gray-700">${question.rationale}</p></div>`;
                reviewQuestionsContainer.appendChild(reviewItem);
            }
        });

        if (missedCount === 0) {
            reviewQuestionsContainer.innerHTML = `<div class="p-6 text-center text-lg text-gray-700 bg-green-100 rounded-lg border border-green-300">Great job! You answered all questions correctly.</div>`;
        }
    }

    function calculateGrade() {
        // FIX: Changed SATA grading to be all-or-nothing (1 point for an exact match, 0 otherwise).
        // This is more consistent with standard testing and matches the review screen's logic.
        let correctCount = 0;
        shuffledQuizData.forEach((question, index) => {
            const userAnswer = userAnswers[index] || [];
            const correctAnswers = new Set(Array.isArray(question.correctAnswer) ? question.correctAnswer : [question.correctAnswer]);
            const userSelections = new Set(userAnswer);

            // Check for an exact match
            const isCorrect = correctAnswers.size === userSelections.size && [...correctAnswers].every(item => userSelections.has(item));
            
            if (isCorrect) {
                correctCount++;
            }
        });
        return Math.round((correctCount / shuffledQuizData.length) * 100);
    }
    
    function handleFinalSubmit() {
        reviewScreen.classList.add('hidden');
        loadingAnimation.classList.remove('hidden');
        const loadingText = document.querySelector('#loading-animation p');
        if (loadingText) loadingText.textContent = 'Calculating Grade...';

        setTimeout(() => {
            loadingAnimation.classList.add('hidden');
            const finalGrade = calculateGrade();
            finalGradeDisplay.textContent = `${finalGrade}%`;
            gradeScreen.classList.remove('hidden');
        }, 2000);
    }

    function submitExam() {
        clearInterval(timerInterval);
        saveUserAnswer();
        renderReviewScreen();
    }

    function startQuiz() {
        startScreen.classList.add('hidden');
        loadingAnimation.classList.remove('hidden');
        
        const loadingText = document.querySelector('#loading-animation p');
        if (loadingText) loadingText.textContent = 'Preparing Your Exam...';

        setTimeout(() => {
            loadingAnimation.classList.add('hidden');
            header.classList.remove('hidden');
            mainContent.classList.remove('hidden');
            footer.classList.remove('hidden');
            
            // Shuffle the entire bank and select 85 questions
            shuffleArray(quizData);
            const EXAM_LENGTH = 85;
            shuffledQuizData = quizData.slice(0, Math.min(EXAM_LENGTH, quizData.length)); 

            // Initialize state arrays based on the selected questions
            userAnswers = Array(shuffledQuizData.length).fill(null).map(() => []);
            flaggedQuestions = Array(shuffledQuizData.length).fill(false);
            
            startTimer();
            renderQuestion();
        }, 1500);
    }

    // --- Event Listeners ---
    nextBtn.addEventListener('click', () => {
        saveUserAnswer();
        if (currentQuestionIndex < shuffledQuizData.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
        }
    });

    previousBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            saveUserAnswer();
            currentQuestionIndex--;
            renderQuestion();
        }
    });

    submitExamBtn.addEventListener('click', submitExam);
    
    endReviewBtn.addEventListener('click', handleFinalSubmit);
    
    restartBtn.addEventListener('click', () => {
        location.reload();
    });
    
    startBtn.addEventListener('click', startQuiz);

</script>

</body>
</html>
