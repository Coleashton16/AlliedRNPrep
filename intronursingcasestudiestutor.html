<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NCLEX Case Studies</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Light mode tweaks */
        body {
            background-color: #f9fafb;
            color: #1f2937; /* cool gray 800 */
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .tab-button {
            background-color: #e0e7ff; /* indigo-100 */
            color: #3730a3; /* indigo-800 */
            font-weight: 600;
            user-select: none;
        }
        .tab-button.active {
            background-color: #4338ca; /* indigo-700 */
            color: #eef2ff; /* indigo-100 */
            font-weight: 700;
            box-shadow: 0 4px 8px rgb(67 56 202 / 0.4);
        }
        .option-button {
            background-color: #f3f4f6; /* gray-100 */
            color: #111827; /* gray-900 */
            border: 1px solid transparent;
            font-weight: 500;
            transition: all 0.2s ease;
            user-select: none;
        }
        .option-button:hover:not(:disabled) {
            background-color: #e0e7ff; /* indigo-100 */
            border-color: #4338ca;
        }
        .option-button:disabled {
            cursor: default;
        }

        /* Dark mode tweaks */
        body.dark {
            background-color: #0f172a; /* slate-900 */
            color: #e0e7ff; /* indigo-100 */
        }
        body.dark .card {
            background-color: #1e293b; /* slate-800 */
            border-color: #334155; /* slate-700 */
        }
        body.dark .tab-button {
            background-color: #4338ca; /* indigo-700 */
            color: #dbeafe; /* indigo-200 */
        }
        body.dark .tab-button.active {
            background-color: #c7d2fe; /* indigo-200 */
            color: #1e293b; /* slate-800 */
            box-shadow: 0 4px 8px rgb(199 210 254 / 0.6);
        }
        body.dark .option-button {
            background-color: #334155; /* slate-700 */
            color: #e0e7ff; /* indigo-100 */
            border-color: transparent;
        }
        body.dark .option-button:hover:not(:disabled) {
            background-color: #c7d2fe; /* indigo-200 */
            color: #1e293b; /* slate-800 */
            border-color: #4338ca;
        }

        .container-padding {
            padding: 24px;
        }
        @media (min-width: 768px) {
            .container-padding {
                padding: 48px;
            }
        }

        /* Rationale box tweaks */
        .rationale-box {
            border-left-width: 4px;
            border-left-color: #4338ca; /* indigo-700 */
            background-color: #eef2ff; /* indigo-100 */
            color: #3730a3; /* indigo-800 */
        }
        body.dark .rationale-box {
            border-left-color: #c7d2fe; /* indigo-200 */
            background-color: #4338ca; /* indigo-700 */
            color: #eef2ff; /* indigo-100 */
        }

    </style>
</head>
<body class="transition-colors duration-300">

    <!-- Main Container -->
    <div class="container-padding max-w-7xl mx-auto min-h-screen flex flex-col items-center">

        <!-- Header -->
        <header class="w-full flex justify-between items-center mb-8 md:mb-12">
            <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight">NCLEX Case Studies</h1>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" aria-label="Toggle dark mode"
                    class="p-2 rounded-full bg-indigo-200 hover:bg-indigo-300 dark:bg-indigo-700 dark:hover:bg-indigo-600 focus:outline-none transition-colors duration-200">
                    <svg id="moon-icon" class="w-6 h-6 dark:text-indigo-200 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                    <svg id="sun-icon" class="w-6 h-6 dark:text-indigo-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Case Study Container -->
        <div id="case-study-container" class="w-full">
            <!-- Case study content will load here -->
        </div>

        <!-- Pagination and Navigation -->
        <div class="mt-8 flex justify-between w-full max-w-3xl">
            <button id="prev-case-study" 
                class="px-6 py-2 rounded-full font-bold text-white bg-indigo-600 hover:bg-indigo-700 transition-colors duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
            <button id="next-case-study" 
                class="px-6 py-2 rounded-full font-bold text-white bg-indigo-600 hover:bg-indigo-700 transition-colors duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
        </div>
    </div>

    <!-- Modal Backdrop -->
    <div id="modal-backdrop" 
        class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div id="modal-content" 
            class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-sm transform transition-transform scale-95 md:scale-100">
            <div id="modal-body" class="mb-4 text-center text-gray-900 dark:text-gray-100"></div>
            <div id="modal-buttons" class="flex justify-center space-x-4">
                <button id="modal-ok" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">OK</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Custom alert modal function
        function showCustomAlert(message) {
            const modalBackdrop = document.getElementById('modal-backdrop');
            const modalBody = document.getElementById('modal-body');
            const modalButtons = document.getElementById('modal-buttons');
            modalBody.textContent = message;
            modalButtons.innerHTML = '<button id="modal-ok" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">OK</button>';
            modalBackdrop.style.display = 'flex';
            document.getElementById('modal-ok').addEventListener('click', () => {
                modalBackdrop.style.display = 'none';
            }, { once: true });
        }


        // Case studies data with integrated multiple concepts
        const cases = [
            {
                id: 1,
                title: "Infection Control & PPE - C. difficile Case",
                scenario: "A 68-year-old male is admitted with fever, cough, and shortness of breath. He is diagnosed with Clostridium difficile and placed on contact precautions. The nurse prepares to enter the patient's room to administer medications.",
                topics: ["Asepsis", "Infection Control", "Contact Precautions", "PPE"],
                questions: [
                    {
                        question: "Which PPE should the nurse don before entering the room?",
                        options: ["Surgical mask and gloves","Gown, gloves, and N95 respirator","Gown and gloves","Gown, gloves, and face shield"],
                        answer: 2,
                        rationale: "Contact precautions for C. diff require gown and gloves to prevent spread of spores. Masks/respirators are not required unless other airborne pathogens suspected."
                    },
                    {
                        question: "What is the most effective hand hygiene method against C. diff spores?",
                        options: ["Alcohol-based hand sanitizer","Washing hands with soap and water","Using antiseptic wipes","Sterile scrub brush"],
                        answer: 1,
                        rationale: "Alcohol sanitizers do not kill spores. Mechanical removal by washing with soap and water is necessary."
                    }
                ],
                tabs: [
                    {
                        name: "Nurse's Notes",
                        content: "Patient admitted 2 pm with 6 episodes of diarrhea in past 12 hours, temp 101.5°F. Contact precautions initiated. Patient oriented."
                    },
                    {
                        name: "Vital Signs",
                        content: "Temp: 101.5 °F\nHR: 102 bpm\nBP: 118/76 mmHg\nRR: 20 breaths/min\nO2 Sat: 96%"
                    },
                    {
                        name: "Labs",
                        content: "WBC: 16,000/mm³ (elevated)\nC. diff toxin: positive"
                    }
                ]
            },
            {
                id: 2,
                title: "Wound Care & Skin Integrity - Diabetic Pressure Ulcer",
                scenario: "A 75-year-old bedridden male with diabetes presents for routine evaluation of a sacral pressure ulcer. The wound bed is clean and pink with no signs of infection.",
                topics: ["Skin Integrity", "Wound Care", "Wound Staging", "Pressure Wounds"],
                questions: [
                    {
                        question: "What is the most appropriate stage for this wound?",
                        options: ["Stage I","Stage II","Stage III","Stage IV"],
                        answer: 1,
                        rationale: "A Stage II ulcer is partial thickness skin loss with a shallow open ulcer or ruptured blister and pink wound bed."
                    },
                    {
                        question: "What is the most critical nursing intervention to prevent wound progression?",
                        options: ["Wet-to-dry dressing every 8 hours","Turn and reposition every 2 hours","Elevate head of bed to 45 degrees","Prophylactic antibiotics"],
                        answer: 1,
                        rationale: "Frequent turning to relieve pressure is essential to prevent worsening."
                    }
                ],
                tabs: [
                    {
                        name: "Nurse's Notes",
                        content: "Patient cooperative, sacral ulcer 3cm x 2cm, pink wound bed, surrounding skin intact. Patient refuses protein-rich meals."
                    },
                    {
                        name: "Vital Signs",
                        content: "Temp: 98.6 °F\nHR: 80 bpm\nBP: 130/85 mmHg\nRR: 18 breaths/min"
                    },
                    {
                        name: "Labs",
                        content: "A1c: 8.5% (high)\nAlbumin: 2.8 g/dL (low)"
                    }
                ]
            },
            // Additional new integrated cases (excerpt of 3 shown here, add more accordingly)
            {
                id: 3,
                title: "Pain Management & Clinical Judgment - Postoperative Pain",
                scenario: "A 45-year-old patient with a fractured femur reports pain 9/10 two hours after 4mg IV morphine. He grimaces and guards his leg.",
                topics: ["Pain Management", "Clinical Judgment"],
                questions: [
                    {
                        question: "What is the nurse's priority action?",
                        options: [
                            "Reassure medication will work soon",
                            "Administer another dose of IV morphine as ordered",
                            "Conduct thorough pain and vital assessment",
                            "Notify provider of poor pain control"
                        ],
                        answer: 2,
                        rationale: "The nurse must assess thoroughly before any intervention for safety and efficacy."
                    },
                    {
                        question: "What must the nurse monitor before and after the next opioid dose?",
                        options: ["Blood pressure", "Pupil response", "Respiratory rate", "Heart rate"],
                        answer: 2,
                        rationale: "Respiratory depression is a critical risk with opioids."
                    }
                ],
                tabs: [
                    {
                        name: "Nurse's Notes",
                        content: "Patient admitted for fractured femur, pain 9/10 after 4mg morphine, grimacing. No nausea or dizziness."
                    },
                    {
                        name: "Vital Signs",
                        content: "Temp: 98.2 °F\nHR: 95 bpm\nBP: 135/85 mmHg\nRR: 16 breaths/min\nOxygen Sat: 98%"
                    },
                    {
                        name: "Labs",
                        content: "Hb: 14 g/dL\nHct: 42%"
                    }
                ]
            },
            {
                id: 4,
                title: "Isolation & Negative Pressure Room - Tuberculosis",
                scenario: "A 35-year-old patient with suspected tuberculosis is admitted and placed in a negative pressure room.",
                topics: ["Isolation", "Negative Pressure Rooms"],
                questions: [
                    {
                        question: "Why is negative pressure room required for TB?",
                        options: [
                            "Prevents outside air entering",
                            "Prevents infectious air leaving room",
                            "Maintains sterile environment",
                            "Provides positive airflow"
                        ],
                        answer: 1,
                        rationale: "Negative pressure pulls air into room, containing infectious particles."
                    },
                    {
                        question: "Which illness needs positive pressure room?",
                        options: [
                            "Measles",
                            "Tuberculosis",
                            "SARS",
                            "Patient with compromised immunity"
                        ],
                        answer: 3,
                        rationale: "Positive pressure protects immunocompromised patients by forcing air outward."
                    }
                ],
                tabs: [
                    {
                        name: "Nurse's Notes",
                        content: "Patient reports cough, night sweats, weight loss. Oriented and alert."
                    },
                    {
                        name: "Vital Signs",
                        content: "Temp: 100.8 °F\nHR: 88 bpm\nBP: 120/80 mmHg\nRR: 22 breaths/min"
                    },
                    {
                        name: "Labs",
                        content: "Chest X-ray: Infiltrates in upper lung lobes.\nTB test pending."
                    }
                ]
            },
            {
                id: 5,
                title: "Hygiene & Personal Care - Post-Stroke",
                scenario: "A 65-year-old female post-stroke patient with left-sided weakness requires a bed bath and oral care.",
                topics: ["Hygiene and Personal Care"],
                questions: [
                    {
                        question: "What is a key consideration when performing a bed bath?",
                        options: [
                            "Use hottest water for cleanliness",
                            "Maintain patient privacy and dignity",
                            "Use scented soap for mood",
                            "Perform quickly to save time"
                        ],
                        answer: 1,
                        rationale: "Privacy and dignity are paramount during hygiene care."
                    },
                    {
                        question: "Best oral care method for a stroke patient with decreased consciousness?",
                        options: [
                            "Hard bristle toothbrush",
                            "Supine positioning",
                            "Suction toothbrush to prevent aspiration",
                            "Skip oral care to avoid discomfort"
                        ],
                        answer: 2,
                        rationale: "Suction toothbrush removes fluid safely; side-lying position recommended."
                    }
                ],
                tabs: [
                    {
                        name: "Nurse's Notes",
                        content: "Patient bedridden, left weakness, decreased consciousness, intact skin."
                    },
                    {
                        name: "Vital Signs",
                        content: "Temp: 98.4 °F\nHR: 75 bpm\nBP: 140/90 mmHg\nRR: 16 breaths/min"
                    },
                    {
                        name: "Labs",
                        content: "CT Scan: Hemorrhagic stroke in right hemisphere."
                    }
                ]
            }
        ];


        let currentCaseIndex = 0;


        function renderCaseStudy(index) {
            const container = document.getElementById('case-study-container');
            const caseStudy = cases[index];
            if (!caseStudy) return;

            const topicsHtml = caseStudy.topics.map(topic => 
                `<span class="bg-indigo-200 dark:bg-indigo-800 text-indigo-800 dark:text-indigo-200 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${topic}</span>`
            ).join('');

            const tabsHtml = caseStudy.tabs.map((tab, i) =>
                `<button class="tab-button px-4 py-2 rounded-t-lg transition-colors duration-200 ${i === 0 ? 'active' : ''}" data-tab-index="${i}">${tab.name}</button>`
            ).join('');

            const questionsHtml = caseStudy.questions.map((q, qIndex) => `
                <div class="mb-6 question-block">
                    <p class="font-semibold text-lg mb-4 text-gray-900 dark:text-gray-100">${qIndex + 1}. ${q.question}</p>
                    <div class="space-y-2">
                        ${q.options.map((option, oIndex) => `
                            <button class="option-button w-full text-left p-4 rounded-lg hover:ring-2 hover:ring-indigo-500 transition-colors duration-200 border border-transparent"
                                data-question-index="${qIndex}" data-option-index="${oIndex}">
                                ${String.fromCharCode(65 + oIndex)}. ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="card rounded-3xl shadow-xl p-6 md:p-8 w-full max-w-3xl mx-auto mb-6 transition-colors duration-300">
                    <h2 class="text-2xl md:text-3xl font-bold mb-4">${caseStudy.title}</h2>
                    <p class="text-sm font-medium text-indigo-700 dark:text-indigo-300 mb-4">${topicsHtml}</p>

                    <div class="p-6 bg-indigo-100 dark:bg-indigo-900 rounded-lg mb-6 whitespace-pre-wrap text-indigo-900 dark:text-indigo-200">
                        <h3 class="font-bold mb-2 text-indigo-900 dark:text-indigo-200">Scenario</h3>
                        <p>${caseStudy.scenario}</p>
                    </div>

                    <div class="mb-6">
                        <div class="flex border-b border-indigo-300 dark:border-indigo-700 space-x-2">
                            ${tabsHtml}
                        </div>
                        <div id="tab-content" class="p-4 bg-indigo-50 dark:bg-indigo-800 rounded-b-lg rounded-tr-lg whitespace-pre-wrap text-indigo-900 dark:text-indigo-300 min-h-[80px]">
                            ${caseStudy.tabs[0].content}
                        </div>
                    </div>

                    <div id="questions-section">
                        ${questionsHtml}
                    </div>
                </div>
            `;

            // Tab event listeners
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tabIndex = parseInt(button.dataset.tabIndex);
                    document.getElementById('tab-content').textContent = caseStudy.tabs[tabIndex].content;
                });
            });

            // Options event listeners
            document.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', () => {
                    const qIndex = parseInt(button.dataset.questionIndex || button.getAttribute('data-question-index'));
                    const oIndex = parseInt(button.dataset.optionIndex || button.getAttribute('data-option-index'));
                    checkAnswer(qIndex, oIndex, caseStudy.questions[qIndex]);
                });
            });

            updatePaginationButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        function checkAnswer(questionIndex, selectedOptionIndex, questionData) {
            const questionBlock = document.querySelectorAll('.question-block')[questionIndex];
            if (!questionBlock) return;

            const allOptions = questionBlock.querySelectorAll('.option-button');
            const isCorrect = selectedOptionIndex === questionData.answer;

            allOptions.forEach((button, idx) => {
                const isSelected = idx === selectedOptionIndex;
                const isCorrectOption = idx === questionData.answer;

                button.disabled = true;
                button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'hover:bg-indigo-200', 'dark:hover:bg-indigo-600');

                if (isSelected) {
                    if (isCorrect) {
                        button.classList.add('bg-green-500', 'dark:bg-green-600', 'text-white', 'font-bold');
                    } else {
                        button.classList.add('bg-red-500', 'dark:bg-red-600', 'text-white', 'font-bold');
                    }
                }

                if (!isSelected && isCorrectOption) {
                    button.classList.add('bg-green-300', 'dark:bg-green-800', 'text-green-900', 'dark:text-green-300');
                }
            });

            if (!questionBlock.querySelector('.rationale-box')) {
                const rationaleBox = document.createElement('div');
                rationaleBox.className = 'rationale-box p-4 mt-4 rounded-lg';
                rationaleBox.innerHTML = `
                    <p class="font-bold mb-2">Rationale:</p>
                    <p>${questionData.rationale}</p>
                `;
                questionBlock.appendChild(rationaleBox);
            }

            if (!isCorrect) {
                showCustomAlert("Incorrect Answer. Review the rationale.");
            } else {
                showCustomAlert("Correct! Great job!");
            }
        }

        function updatePaginationButtons() {
            const prevBtn = document.getElementById('prev-case-study');
            const nextBtn = document.getElementById('next-case-study');
            prevBtn.disabled = currentCaseIndex === 0;
            nextBtn.disabled = currentCaseIndex === cases.length - 1;
        }

        document.getElementById('next-case-study').addEventListener('click', () => {
            if (currentCaseIndex < cases.length - 1) {
                currentCaseIndex++;
                renderCaseStudy(currentCaseIndex);
            }
        });

        document.getElementById('prev-case-study').addEventListener('click', () => {
            if (currentCaseIndex > 0) {
                currentCaseIndex--;
                renderCaseStudy(currentCaseIndex);
            }
        });

        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            if (body.classList.contains('dark')) {
                localStorage.setItem('theme', 'dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                localStorage.setItem('theme', 'light');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
        });

        // Initial theme load
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            body.classList.add('dark');
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }

        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            renderCaseStudy(currentCaseIndex);
        });
    </script>
</body>
</html>
