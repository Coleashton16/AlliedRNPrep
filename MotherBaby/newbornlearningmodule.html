<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Newborn Adaptations Master Module</title>

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		// Tailwind CSS configuration to use the Inter font and define custom animations.
		tailwind.config = {
			theme: {
				extend: {
					fontFamily: {
						sans: ['Inter', 'sans-serif'],
					},
					keyframes: {
						'fade-in': {
							'0%': { opacity: '0', transform: 'scale(0.95)' },
							'100%': { opacity: '1', transform: 'scale(1)' },
						},
					},
					animation: {
						'fade-in': 'fade-in 0.3s ease-out forwards',
					},
				},
			},
		};
	</script>

	<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
	<div id="root"></div>

	<script type="text/babel">
		// --- React and Library Setup ---
		const { useState, useEffect, useCallback, useMemo } = React;

		// --- Mock Authentication Setup for Standalone Demo (using local storage for persistence) ---
		const mockAuth = {
			onAuthStateChanged: (callback) => {
				setTimeout(() => callback({ uid: 'standalone-newborn-user' }), 100);
				return () => {};Â 
			},
			signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-newborn-user' } }),
		};

		// --- Content & Data Structure for the Learning Modules (Newborn) ---
		// Content is derived from Chapters 20, 21, 22, 23, 28, 29, 30 McKinney
		const contentData = {
			'module-1-transition': {
				title: 'Module 1: Physiological Transition Basics',
				color: 'from-pink-600 to-red-400',
				description: 'Identify the critical systemic adaptations (Respiratory and Cardiovascular) necessary for extrauterine life (Ch. 21).',
				steps: [
					{ id: 'm1-def', title: 'Physiologic Adaptations Overview', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-700">From Womb to World: The Newborn's Challenge</p>
						<p>Physiologic adaptations are necessary for a newborn to transition successfully to extrauterine life. This involves rapid, profound changes across multiple body systems.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Key Systems Involved:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Respiratory System:</strong> Switching from fluid-filled lungs to air-breathing.</li>
							<li><strong>Cardiovascular System:</strong> Closing fetal shunts and establishing pulmonary circulation.</li>
							<li><strong>Thermoregulatory System:</strong> Maintaining body heat independently.</li>
							<li><strong>Other Systems:</strong> GI, Hepatic, Renal, and Immune adaptations.</li>
						</ul>
					`},
					{ id: 'm1-resp', title: 'Respiratory Initiation (Chemical & Mechanical)', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-700">The First Breath: What Stimulates it?</p>
						<p>Respirations are stimulated by chemical, mechanical, thermal, and sensory factors.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Key Factors:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Chemical:</strong> Temporary **hypoxia and hypercapnia** (low $\text{O}_2$, high $\text{CO}_2$) stimulate the medulla's respiratory center.</li>
							<li><strong>Mechanical:</strong> **Chest compression** during vaginal birth squeezes fluid out. Recoil creates negative pressure, drawing air in.</li>
							<li><strong>Surfactant:</strong> Lines alveoli, reducing surface tension to prevent collapse. Insufficient amounts lead to **Respiratory Distress Syndrome (RDS)**.</li>
							<li><strong>Asphyxia Risk:</strong> Severe asphyxia or pulmonary hypertension can cause fetal shunts to remain open.</li>
						</ul>
					`},
					{ id: 'm1-cv', title: 'Cardiovascular Adaptation (Shunts)', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-700">Closing the Fetal Shunts</p>
						<p>The transition requires key shunts that bypassed the lungs in utero to close due to shifts in pressure (blood $\text{O}_2$ increase, pulmonary pressure drop).</p>
						<h4 class="text-lg font-bold mt-4 mb-2">The Three Fetal Shunts:</h4>
						<ol class="list-decimal list-inside ml-4">
							<li><strong>Foramen Ovale:</strong> Opening between the atria. Closes functionally within 1-2 hours.</li>
							<li><strong>Ductus Arteriosus:</strong> Connection between the pulmonary artery and aorta. Closes functionally within 10-15 hours.</li>
							<li><strong>Ductus Venosus:</strong> Bypassed the liver. Closes when the cord is clamped.</li>
						</ol>
						<p class="font-bold text-red-600 mt-3">Assessment Point:</p>
						<p>Evaluate for continuous murmurs, which may indicate a persistent patent ductus arteriosus (PDA).</p>
					`},
					{ id: 'm1-quiz', title: 'Module 1 Quiz', type: 'quiz',
						questions: [
							{ question: "What is the primary function of surfactant in the newborn lung?", options: ["To promote chest wall compression.", "To increase oxygen saturation in the blood.", "To decrease surface tension and prevent alveolar collapse.", "To dilate the ductus arteriosus."], correctAnswer: "To decrease surface tension and prevent alveolar collapse." },
							{ question: "Which change immediately after birth causes pulmonary vascular pressure to drop, assisting the transition?", options: ["Clamping of the umbilical cord.", "Drop in ambient temperature.", "Lungs filling with air/oxygenation.", "Release of adrenaline."], correctAnswer: "Lungs filling with air/oxygenation." },
							{ question: "Which fetal structure functionally closes first, usually within hours after birth?", options: ["Ductus Venosus", "Ductus Arteriosus", "Foramen Ovale", "Pulmonary Artery"], correctAnswer: "Foramen Ovale" }
						]
					}
				]
			},
			'module-2-thermoregulation': {
				title: 'Module 2: Thermoregulation & Cold Stress',
				color: 'from-blue-600 to-indigo-500',
				description: 'Identify the four mechanisms of heat loss and the dangerous consequences of cold stress (Ch. 21).',
				steps: [
					{ id: 'm2-heat-loss', title: 'Four Mechanisms of Heat Loss', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-blue-700">Newborn Vulnerabilities to Heat Loss</p>
						<p>Newborns have minimal subcutaneous fat, blood vessels close to the surface, and a large surface area relative to body volume, leading to rapid heat loss. The four types of heat loss are:</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Mechanisms and Nursing Interventions:</h4>
						<ul class="list-disc list-inside ml-4 space-y-3">
							<li><strong>EVAPORATION:</strong> Loss of heat from moisture (e.g., amniotic fluid, wet diapers).
								<p class="font-bold text-sm italic">Action: <strong>Dry the infant quickly</strong>, especially the head.</p>
							</li>
							<li><strong>CONDUCTION:</strong> Loss of heat from direct contact with cooler surfaces.
								<p class="font-bold text-sm italic">Action: Use **warmed surfaces** (e.g., radiant warmer mattress, warmed stethoscope).</p>
							</li>
							<li><strong>CONVECTION:</strong> Loss of heat to cooler circulating air (drafts, open doors).
								<p class="font-bold text-sm italic">Action: Keep the infant away from drafts; cover the infant.</p>
							</li>
							<li><strong>RADIATION:</strong> Loss of heat to a cooler solid object nearby (e.g., cold window or wall), **NOT** in direct contact.
								<p class="font-bold text-sm italic">Action: Place the bassinet away from cold outside walls/windows.</p>
							</li>
						</ul>
					`},
					{ id: 'm2-heat-prod', title: 'Heat Production & Cold Stress Cascade', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-blue-700">The Danger: Cold Stress</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Heat Production Methods (Thermogenesis):</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Increased activity (restlessness, crying).</li>
							<li>Flexion to decrease exposed surface area.</li>
							<li>**Non-shivering Thermogenesis (NST):** Metabolism of **Brown Fat**. This process uses increased oxygen and glucose.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2 text-red-600">Cold Stress Consequences:</h4>
						<p>If the newborn's core temperature drops (Hypothermia < $36.5^\circ \text{C}$ or $97.7^\circ \text{F}$), they enter a cascade that compromises critical functions:</p>
						<ul class="list-disc list-inside ml-4">
							<li>Increased **Oxygen Need** $\rightarrow$ risk of **Respiratory Distress**</li>
							<li>Increased Metabolic Rate $\rightarrow$ rapid depletion of glucose stores $\rightarrow$ **Hypoglycemia**</li>
							<li>Acidosis (due to increased anaerobic metabolism).</li>
							<li>Decreased surfactant production.</li>
							<li>Increased fatty acids which interfere with **bilirubin conjugation** $\rightarrow$ Jaundice.</li>
						</ul>
					`},
					{ id: 'm2-quiz', title: 'Module 2 Quiz', type: 'quiz',
						questions: [
							{ question: "Heat loss caused by placing a newborn directly on a cool scale is due to which mechanism?", options: ["Evaporation", "Conduction", "Convection", "Radiation"], correctAnswer: "Conduction" },
							{ question: "Why is a baby experiencing cold stress at risk for Hypoglycemia?", options: ["Decreased insulin production", "Rapid depletion of glucose stores due to increased metabolic rate (NST)", "Lack of fluid intake", "Inability to produce adrenaline"], correctAnswer: "Rapid depletion of glucose stores due to increased metabolic rate (NST)" },
							{ question: "The nursing action of covering the infant's head and keeping them away from drafts prevents heat loss primarily through:", options: ["Evaporation and Conduction", "Radiation and Conduction", "Convection and Radiation", "Evaporation and Convection"], correctAnswer: "Convection and Radiation" }
						]
					}
				]
			},
			'module-3-other-systems': {
				title: 'Module 3: Hepatic, GI, Renal & Immune Adaptations',
				color: 'from-purple-600 to-pink-500',
				description: 'Review blood values, jaundice risk, stools progression, and initial liver/kidney/immune function (Ch. 21).',
				steps: [
					{ id: 'm3-heme', title: 'Hematopoietic and Immune System', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-purple-700">Blood and Immune System Adaptations</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Hematopoietic System:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>RBC, Hgb, and Hct:</strong> Typically **higher** than adults due to the lower $\text{O}_2$ environment in utero.</li>
							<li><strong>WBC:</strong> Naturally **elevated** at birth, making it difficult to rely on this value alone to detect infection initially.</li>
							<li><strong>Clotting:</strong> Newborns have naturally low vitamin K, which is necessary to activate clotting factors. **Vitamin K injection** is given at birth to prevent Hemorrhagic Disease of the Newborn (HDN).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Immune System (Infection Defense):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>IgG:</strong> Crosses the placenta, providing **passive temporary immunity** for the first 6 months.</li>
							<li><strong>IgM:</strong> Produced rapidly by the infant in response to infection; helps protect against Gram-negative bacteria.</li>
							<li><strong>IgA:</strong> Does **not** cross the placenta. Provided primarily through **breast milk**.</li>
						</ul>
					`},
					{ id: 'm3-gi-renal', title: 'GI, Hepatic (Liver), and Renal System', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-purple-700">Metabolism, Digestion, and Excretion</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Gastrointestinal (GI) System:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Regurgitation:</strong> Common due to a relaxed cardiac sphincter.</li>
							<li><strong>Stools Progression (Key Assessment):</strong>
								<ol class="list-decimal list-inside ml-4">
									<li><strong>Meconium:</strong> Thick, tarry, dark green/black (passed within 24-48 hours).</li>
									<li><strong>Transitional Stools:</strong> Loose, greenish-brown.</li>
									<li><strong>Milk Stools:</strong> Seedy, mustard-colored, frequent (breastfed) or brownish-green (formula).</li>
								</ol>
							</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Hepatic (Liver) System:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Liver functions include blood glucose maintenance, drug metabolism, iron storage, and most importantly, **bilirubin conjugation** (conversion of unconjugated bilirubin to a soluble form for excretion). Liver immaturity leads to the high risk of Jaundice/Hyperbilirubinemia.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Renal System:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Kidneys have poor ability to concentrate urine or regulate electrolytes/fluid.</li>
							<li>Normal weight loss is **5% to 10%** in the first few days due to fluid shifts (diuresis).</li>
						</ul>
					`},
					{ id: 'm3-quiz', title: 'Module 3 Quiz', type: 'quiz',
						questions: [
							{ question: "Breast milk provides which specific immunoglobulin that does NOT cross the placenta, strengthening the infant's GI defense?", options: ["IgG", "IgM", "IgA", "IgD"], correctAnswer: "IgA" },
							{ question: "What is the primary reason Vitamin K is administered at birth?", options: ["To prevent jaundice", "To activate clotting factors and prevent HDN", "To boost the immune system", "To aid respiratory function"], correctAnswer: "To activate clotting factors and prevent HDN" },
							{ question: "The nurse assesses a newborn's stool on day 2. Which finding would be considered normal?", options: ["White, chalky stools", "Transitional greenish-brown stools", "Loose, bloody stools", "Hard, formed brown stools"], correctAnswer: "Transitional greenish-brown stools" }
						]
					}
				]
			},
			'module-4-assessment-care': {
				title: 'Module 4: Immediate Assessment & Routine Care',
				color: 'from-green-600 to-teal-500',
				description: 'Prioritize immediate interventions and understand APGAR, prophylaxis, and ongoing care (Ch. 21 & 22).',
				steps: [
					{ id: 'm4-early-assess', title: 'Initial Assessment and APGAR', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-green-700">Initial Assessment: Identifying Need for Resuscitation</p>
						<p>The initial assessment prioritizes airway, breathing, circulation, and warmth.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">The APGAR Score (1 & 5 Minutes):</h4>
						<p>A quick, objective method to assess the infant's transition to extrauterine life. Scores are 0-2 for each component (max 10):</p>
						<ol class="list-decimal list-inside ml-4 font-bold">
							<li><strong>A</strong>ppearance (Color)</li>
							<li><strong>P</strong>ulse (Heart Rate)</li>
							<li><strong>G</strong>rimace (Reflex irritability)</li>
							<li><strong>A</strong>ctivity (Muscle Tone)</li>
							<li><strong>R</strong>espiratory Effort</li>
						</ol>
						<p class="mt-2">Scores are taken at 1 and 5 minutes. If score is $\lt 7$ at 5 minutes, scoring continues every 5 minutes until 20 minutes.</p>
					`},
					{ id: 'm4-immediate-care', title: 'Immediate Care Priorities and Prophylaxis', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-green-700">Immediate Newborn Care Steps (The Golden Hour)</p>
						<ol class="list-decimal list-inside ml-4 font-bold">
							<li><strong>Maintain Warmth:</strong> Dry and cover the infant immediately (prevents Evaporation and Cold Stress). Place skin-to-skin.</li>
							<li><strong>Clear Airway:</strong> Suction mouth then nose (M before N) as needed.</li>
							<li><strong>Prophylaxis:</strong> Administer mandatory medications.</li>
						</ol>
						<h4 class="text-lg font-bold mt-4 mb-2">Mandatory Prophylaxis:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Vitamin K (IM):</strong> Given to prevent Hemorrhagic Disease of the Newborn (HDN).</li>
							<li><strong>Erythromycin Ophthalmic Ointment:</strong> Applied to eyes to prevent **Ophthalmia Neonatorum** (infection, usually gonorrhea/chlamydia, causing blindness).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Routine Care (Chapter 22):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Cord Care:</strong> Keep dry and clean with cool water/soap only if necessary; check for bleeding/oozing.</li>
							<li><strong>Bathing:</strong> Delay bathing until temperature is stable.</li>
							<li><strong>Circumcision Care:</strong> Monitor closely for complications like hemorrhage, infection, or failure to urinate.</li>
						</ul>
					`},
					{ id: 'm4-quiz', title: 'Module 4 Quiz', type: 'quiz',
						questions: [
							{ question: "What is the most critical first nursing action immediately after a newborn is delivered?", options: ["Weigh the infant.", "Suction the mouth and nose.", "Dry the infant thoroughly.", "Administer Vitamin K."], correctAnswer: "Dry the infant thoroughly." },
							{ question: "Eye prophylaxis is given to the newborn primarily to prevent blindness caused by which infections?", options: ["Staphylococcus Aureus", "Ophthalmia Neonatorum", "Hepatitis B", "Group B Streptococcus"], correctAnswer: "Ophthalmia Neonatorum" },
							{ question: "If a newborn's 5-minute APGAR score is 6, what is the required immediate nursing action?", options: ["Initiate full resuscitation immediately.", "Notify the physician.", "Continue Apgar scoring every 5 minutes (up to 20 minutes).", "Place the baby in the nursery."], correctAnswer: "Continue Apgar scoring every 5 minutes (up to 20 minutes)." }
						]
					}
				]
			},
			'module-5-screening-safety': {
				title: 'Module 5: Screening and Newborn Safety',
				color: 'from-indigo-600 to-purple-700',
				description: 'Review mandated screening tests, safe sleep guidelines, and infant security (Ch. 22).',
				steps: [
					{ id: 'm5-screen', title: 'Newborn Screening and Immunization', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-indigo-700">Mandatory Screening and Immunization</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Mandatory Screening Tests:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Universal Newborn Screening (Heel Stick):</strong> Done after **24 hours of feeding** to check for metabolic and genetic disorders (e.g., **Phenylketonuria (PKU)**, congenital hypothyroidism, galactosemia).</li>
							<li><strong>Hearing Screening:</strong> Mandatory screening to check for hearing loss (most common congenital abnormality).</li>
							<li><strong>CCHD Screening (Critical Congenital Heart Disease):</strong> Uses pulse oximetry on the right hand (pre-ductal) and one foot (post-ductal). Must be $>95\%$ in both with $\lt 3\%$ difference.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Immunization:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Hepatitis B Vaccine:</strong> Routine childhood immunization administered prior to discharge. Infants of Hep B-positive mothers receive the vaccine AND Hepatitis B immune globulin.</li>
						</ul>
					`},
					{ id: 'm5-safety', title: 'SIDS Prevention and Security', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-indigo-700">Critical Safety Checks</p>
						<h4 class="text-lg font-bold mt-4 mb-2">SIDS Prevention (Safe Sleep) - AAP Guidelines:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Place infant <strong>SUPINE</strong> (on the back) for sleep.</li>
							<li>Use a firm sleep surface.</li>
							<li>**NO** loose bedding, pillows, bumpers, or toys in the crib.</li>
							<li>Avoid **overheating**.</li>
							<li>Pacifiers **MAY** be offered at nap/bedtime to reduce risk (if $\gt 1$ month old).</li>
							<li>Ensure supervised **tummy time** when awake to prevent plagiocephaly (flat spots on the head).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Infant Security & Fall Risk:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Use matching identification bands on the infant, mother, and support person.</li>
							<li>Never leave the newborn unattended in the room.</li>
							<li>**NEVER** carry the baby when drowsy or tired to reduce risk of dropping/falls.</li>
						</ul>
					`},
					{ id: 'm5-quiz', title: 'Module 5 Quiz', type: 'quiz',
						questions: [
							{ question: "When should the Universal Newborn Screening (PKU/Hypothyroidism) blood test be performed?", options: ["Immediately after birth.", "Before the first feeding.", "After the infant has fed for at least 24 hours.", "Upon discharge from the hospital."], correctAnswer: "After the infant has fed for at least 24 hours." },
							{ question: "What is the recommended sleep position for a healthy newborn to prevent SIDS?", options: ["Prone", "Side-lying", "Semi-Fowler's", "Supine"], correctAnswer: "Supine" },
							{ question: "A normal result for CCHD screening requires oxygen saturation to be $>95\%$ in the right hand and foot with what maximum difference between the two sites?", options: ["$\lt 1\%$ difference", "$\lt 3\%$ difference", "$\lt 5\%$ difference", "No difference is allowed."], correctAnswer: "$\lt 3\%$ difference" }
						]
					}
				]
			},
			'module-6-metabolic-risk': {
				title: 'Module 6: Metabolic Emergencies (Jaundice & Hypoglycemia)',
				color: 'from-orange-500 to-yellow-600',
				description: 'Recognize the risk factors and interventions for Jaundice (Hyperbilirubinemia) and Hypoglycemia (Ch. 21 & 30).',
				steps: [
					{ id: 'm6-jaundice', title: 'Hyperbilirubinemia (Jaundice)', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-yellow-700">Jaundice: Bilirubin Conjugation Failure</p>
						<p>Jaundice (yellowing) occurs when unconjugated bilirubin builds up in the blood faster than the immature liver can conjugate it for excretion.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Risk Factors for Severe Jaundice:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Preterm or late preterm</strong> infants (immature liver and feeding difficulties).</li>
							<li>**Cold Stress** or Asphyxia (fatty acids inhibit conjugation).</li>
							<li>Significant bruising, **cephalhematoma** (excessive $\text{RBC}$ breakdown).</li>
							<li>**Blood incompatibility** (Rh or $\text{ABO}$) $\rightarrow$ excessive hemolysis.</li>
							<li>Delayed feeding (less excretion via stool).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Therapeutic Management (Ch. 30):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Priority:</strong> Prevent **Kernicterus** (bilirubin encephalopathy), which causes severe neurological damage.</li>
							<li><strong>Feeding:</strong> Promote early and frequent feeding to ensure excretion via stool (meconium).</li>
							<li><strong>Phototherapy:</strong> Light converts bilirubin into a soluble form the body can excrete. Protect eyes and genitals; maintain temperature.</li>
							<li><strong>Exchange Transfusion:</strong> Used for dangerously high levels when phototherapy is inadequate.</li>
						</ul>
					`},
					{ id: 'm6-hypoglycemia', title: 'Hypoglycemia & Management', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-yellow-700">Hypoglycemia: The Fuel Crisis ($\lt 40 \text{mg/dL}$)</p>
						<p>Newborns use glucose rapidly and are at risk for dangerous drops in blood sugar.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Infants at Increased Risk:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Born to diabetic mothers** (**LGA**) $\rightarrow$ Hyperinsulinemia leads to rapid glucose drop.</li>
							<li>**SGA** (Small for Gestational Age) or **Preterm** (poor glycogen stores).</li>
							<li>**Cold Stress**, Respiratory Distress, or Sepsis (increased metabolic demand).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Signs of Hypoglycemia (Ch. 21):</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Jitteriness/Tremors** (most common sign).</li>
							<li>Poor muscle tone, lethargy, poor suck.</li>
							<li>Tachypnea, grunting, apnea, cyanosis.</li>
							<li>High-pitched cry, irritability, seizures.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Management:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Early and adequate feeding** (colostrum/formula) is the first line of defense.</li>
							<li>If symptomatic or severely low: IV Dextrose.</li>
						</ul>
					`},
					{ id: 'm6-case', title: 'Case Study: Cold Stress & Hypoglycemia', type: 'case_study', case: {
						scenario: `A late preterm infant (35 weeks) 4 hours old has a rectal temperature of $97.0^\circ \text{F}$ ($36.1^\circ \text{C}$) and is displaying **jitteriness** and a weak suck. A heelstick glucose result is $35 \text{mg}/\text{dL}$.`,
						question: `What are the two immediate priority nursing interventions? (Select all that apply.)`,
						options: [
							"Option A: Place the infant under a radiant warmer (re-warm).",
							"Option B: Initiate immediate oral feeding of formula or expressed breast milk.",
							"Option C: Initiate an immediate heelstick for a Total Serum Bilirubin (TSB) test.",
							"Option D: Prepare for an exchange transfusion.",
							"Option E: Place the infant supine in an open crib and monitor.",
						],
						correctAnswer: [
							"Option A: Place the infant under a radiant warmer (re-warm).",
							"Option B: Initiate immediate oral feeding of formula or expressed breast milk.",
						],
						explanation: `<strong>Rationale:</strong> The infant is exhibiting **Hypothermia** ($97.0^\circ \text{F}$) and symptomatic **Hypoglycemia** ($35 \text{mg}/\text{dL}$).
						<ul>
							<li><strong>Option A (Correct):</strong> Addressing hypothermia stops the cycle of **Cold Stress**, preventing further glucose and oxygen depletion.</li>
							<li><strong>Option B (Correct):</strong> Since the infant is symptomatic (jittery) and glucose is low, immediate provision of glucose via **oral feeding** is the fastest intervention before resorting to IV dextrose.</li>
						</ul>`
					}},
					{ id: 'm6-quiz', title: 'Module 6 Quiz', type: 'quiz',
						questions: [
							{ question: "Infants born to diabetic mothers are at high risk for hypoglycemia primarily due to:", options: ["Slow metabolism", "Rebound hyperinsulinemia", "Lack of brown fat", "Immature kidneys"], correctAnswer: "Rebound hyperinsulinemia" },
							{ question: "What is the most serious neurological complication of severe, untreated hyperbilirubinemia?", options: ["Respiratory Distress Syndrome", "Intraventricular Hemorrhage", "Kernicterus (Bilirubin Encephalopathy)", "Polycythemia"], correctAnswer: "Kernicterus (Bilirubin Encephalopathy)" },
							{ question: "In a jaundiced newborn, the nurse promotes bilirubin excretion by encouraging:", options: ["Restricting feeds to rest the gut.", "Promoting frequent and adequate feeding.", "Applying ice packs to the liver.", "Limiting urination."], correctAnswer: "Promoting frequent and adequate feeding." }
						]
					}
				]
			},
			'module-7-prematurity': {
				title: 'Module 7: High-Risk Neonatal Complications',
				color: 'from-teal-500 to-cyan-600',
				description: 'Master the common complications of prematurity and acquired high-risk conditions (Ch. 29 & 30).',
				steps: [
					{ id: 'm7-resp-safety', title: 'Respiratory Support and $\text{O}_2$ Safety (ROP/BPD)', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-700">Oxygen Management: Balancing Life and Damage (Ch. 29/30)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Respiratory Distress Syndrome (RDS):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Cause:</strong> Insufficient production of **surfactant** (a key factor in prematurity).</li>
							<li><strong>S/S:</strong> **Tachypnea ($\geq 60 \text{breaths/min}$)**, Retractions, Flaring, **Grunting**, Cyanosis.</li>
							<li><strong>Rx:</strong> Exogenous **surfactant** administration; $\text{O}_2$ and ventilatory support (CPAP/ventilation).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2 text-red-600">OXYGEN SAFETY: Retinopathy of Prematurity (ROP) and BPD</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Retinopathy of Prematurity (ROP):</strong> Damage to developing retinal vessels due to **hyperoxia (excessive $\text{O}_2$) or fluctuations in $\text{O}_2$**. This causes abnormal vessel growth and can lead to blindness.
								<p class="font-bold text-sm italic mt-1">Nursing Action: Strict adherence to targeted **$\text{O}_2$ saturation ranges** ($88\%$ to $95\%$) to minimize damage.</p>
							</li>
							<li><strong>Bronchopulmonary Dysplasia (BPD):</strong> Chronic lung disease in infants who required prolonged mechanical ventilation and $\text{O}_2$. Results from barotrauma (pressure) and $\text{O}_2$ toxicity.</li>
						</ul>
					`},
					{ id: 'm7-ivh-sepsis', title: 'Neurologic and Infectious Threats (IVH & Sepsis)', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-teal-700">Protecting the Brain and Immune System (Ch. 29/30)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Intraventricular Hemorrhage (IVH):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Definition:</strong> Bleeding into the brain's ventricular system. Highest risk in extremely premature infants due to fragile cerebral blood vessels.</li>
							<li><strong>Risk Factors:</strong> Rapid changes in blood pressure, respiratory distress, and physical stress/handling.</li>
							<li><strong>Nursing Action:</strong> **Minimize stress (clustering care)**, reduce environmental stimuli, and maintain neutral, **midline head position** to prevent rapid changes in cerebral blood flow.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Sepsis Neonatorum (Infection - Ch. 30):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Risk:</strong> Immature immune system (low $\text{IgM}$, skin breakdown). Infection can occur in utero (TORCH), during birth (GBS), or after birth (nosocomial).</li>
							<li><strong>Clinical Signs:</strong> Often VAGUE! Includes **temperature instability** (low or high), **lethargy**, poor feeding, subtle color changes (mottling), and **apnea/bradycardia**. Advanced signs include jaundice, hemorrhage (petechiae), and respiratory failure.</li>
							<li><strong>Rx:</strong> Immediate **cultures** ($\text{blood/CSF}$), prompt initiation of **broad-spectrum antibiotics**.</li>
						</ul>
					`},
					{ id: 'm7-nec-nutrition', title: 'Gastrointestinal Complications (NEC) & Size/Age Issues', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-teal-700">Gut Health and Size/Age Problems (Ch. 29/30)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Necrotizing Enterocolitis (NEC):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Cause:</strong> Inflammation/necrosis of the intestinal tract, often after enteral feeding in the preterm infant due to ischemia.</li>
							<li><strong>Clinical Signs:</strong> **Feeding Intolerance**, **Abdominal Distention/tenderness**, Decreased bowel sounds, **Bloody stools**.</li>
							<li><strong>Prevention:</strong> Use **human milk** (protective factors), slow and cautious advancement of feeds.</li>
							<li><strong>Rx for Suspected NEC:</strong> **NPO** (rest the gut!), NG tube for decompression, antibiotics, potential surgery.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Size/Age Related Problems (Ch. 29/30):</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>SGA/LGA:</strong> Both Small for Gestational Age ($\lt 10 \text{th}$ percentile) and Large for Gestational Age ($\gt 90 \text{th}$ percentile) infants are at increased risk for **Hypoglycemia**. LGA infants face higher risks of **birth injuries** (fractures, nerve damage).</li>
							<li>**Postterm Infants** ($\gt 42 \text{wks}$): Often show loose, peeling skin, thin appearance, and meconium staining. They are at risk for meconium aspiration and hypoglycemia.</li>
							<li>**Polycythemia:** $\text{Hct} \gt 65\%$. Increased blood viscosity leads to thrombi, stroke, CHF, and hyperbilirubinemia.</li>
						</ul>
					`},
					{ id: 'm7-quiz', title: 'Module 7 Quiz', type: 'quiz',
						questions: [
							{ question: "What neonatal complication is specifically associated with the fluctuation or excessive administration of oxygen to preterm infants?", options: ["Bronchopulmonary Dysplasia (BPD)", "Respiratory Distress Syndrome (RDS)", "Retinopathy of Prematurity (ROP)", "Necrotizing Enterocolitis (NEC)"], correctAnswer: "Retinopathy of Prematurity (ROP)" },
							{ question: "Which nursing intervention is essential for preventing Intraventricular Hemorrhage (IVH) in a preterm infant?", options: ["Providing passive range of motion exercises.", "Maintaining a slightly Trendelenburg position.", "Minimizing stress and clustering care.", "Administering high-concentration oxygen."], correctAnswer: "Minimizing stress and clustering care." },
							{ question: "Clinical signs of Necrotizing Enterocolitis (NEC) include which of the following? (Select all that apply.)", options: ["Abdominal Distention", "Bloody Stools", "Feeding Intolerance", "High-pitched cry"], correctAnswer: ["Abdominal Distention", "Bloody Stools", "Feeding Intolerance"] },
							{ question: "A common, yet often vague, early sign of Sepsis Neonatorum that requires immediate investigation is:", options: ["Projectile vomiting", "Jaundice (after 48 hours)", "Temperature instability", "Persistent meconium stool"], correctAnswer: "Temperature instability" }
						]
					}
				]
			},
			'module-8-newborn-feeding': {
				title: 'Module 8: Newborn Feeding & Nutrition',
				color: 'from-orange-400 to-yellow-500',
				description: 'Cover breastfeeding, formula preparation, and infant hunger cues (Ch. 23).',
				steps: [
					{ id: 'm8-nutrition', title: 'Nutritional Needs and Milk Types', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-orange-700">Breast Milk vs. Formula (Ch. 23)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Nutritional Needs:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Newborns require higher amounts of protein and minerals relative to adults.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Breast Milk Composition:</h4>
						<ol class="list-decimal list-inside ml-4">
							<li>**Colostrum:** Rich in protein, vitamins, minerals, and **immunoglobulins (IgA)**. The "liquid gold" first milk.</li>
							<li>**Transitional Milk:** Appears between colostrum and mature milk.</li>
							<li>**Mature Milk:** Contains nutrients in easily digested proportions. The **hindmilk** (milk released later in the feeding) is higher in fat and helps the infant gain weight.</li>
						</ol>
						<p class="mt-4">Breast milk provides **enzymes** and **infection-preventing components** that promote normal intestinal flora and reduce risk of infections like NEC.</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Formula Feeding:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Types: Ready-to-use, concentrated liquid, or powdered.</li>
							<li>Safety: Must be diluted **exactly** according to directions. **NEVER** heat formula or breast milk in the microwave (creates hot spots).</li>
						</ul>
					`},
					{ id: 'm8-cues-problems', title: 'Feeding Cues and Concerns', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-orange-700">Identifying Hunger and Addressing Challenges</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Infant Hunger Cues:</h4>
						<p>Early cues should be addressed before the infant progresses to crying (a **late** cue):</p>
						<ul class="list-disc list-inside ml-4">
							<li>Licking or sucking movements, lip smacking.</li>
							<li>Rooting (turning head toward touch and opening mouth).</li>
							<li>Hand-to-mouth movements, sucking on hands.</li>
							<li>Increased activity/alertness.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Common Breastfeeding Concerns:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Engorgement:** Breasts are painfully full. Needs frequent emptying.</li>
							<li>**Nipple Pain:** Often due to improper latch.</li>
							<li>**Plugged Ducts:** Presents as a tender lump; requires frequent feeding/pumping and massage.</li>
							<li>**Breast Surgery/Maternal Illness:** May affect milk supply or require consultation regarding drug transfer.</li>
						</ul>
					`},
					{ id: 'm8-quiz', title: 'Module 8 Quiz', type: 'quiz',
						questions: [
							{ question: "Which component of breast milk is rich in immunoglobulins and is the first milk produced?", options: ["Mature Milk", "Foremilk", "Hindmilk", "Colostrum"], correctAnswer: "Colostrum" },
							{ question: "Which behavior is considered a **late** sign of hunger in an infant?", options: ["Rooting", "Hand to mouth movements", "Licking lips", "Crying"], correctAnswer: "Crying" },
							{ question: "Why should breast milk or formula never be heated in a microwave?", options: ["It destroys all nutrients.", "It causes separation of fat molecules.", "It creates dangerous hot spots (burn risk).", "It changes the taste dramatically."], correctAnswer: "It creates dangerous hot spots (burn risk)." }
						]
					}
				]
			},
			'module-9-maternal-postpartum': {
				title: 'Module 9: Postpartum Maternal Adaptation',
				color: 'from-pink-400 to-red-500',
				description: 'Review normal maternal adaptations and assessment in the postpartum period (Ch. 20).',
				steps: [
					{ id: 'm9-involution', title: 'Uterine Involution and Lochia', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-600">Returning to the Nonpregnant State (Ch. 20)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Involution of the Uterus:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>The process where the uterus returns to its nonpregnant size, achieved through: muscle fiber contraction, catabolic processes, and regeneration of uterine epithelium.</li>
							<li><strong>Placental Site:</strong> Heals by **exfoliation**, leaving the endometrium smooth (no scars).</li>
							<li><strong>Fundal Descent:</strong> The fundus descends about **$1 \text{cm}$ per day** and should no longer be palpable abdominally by **14 days** postpartum.</li>
							<li><strong>Afterpains:</strong> Intermittent uterine contractions (more severe in multiparas and breastfeeding women).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Lochia (Vaginal Discharge):</h4>
						<ol class="list-decimal list-inside ml-4">
							<li>**Lochia Rubra:** (Days 1-3) Dark red or bloody.</li>
							<li>**Lochia Serosa:** (Days 4-10) Pinkish/brownish.</li>
							<li>**Lochia Alba:** (Days 11-21) White, cream, or light yellow.</li>
						</ol>
						<p class="mt-2 font-bold text-red-600">Foul odor always suggests endometrial infection.</p>
					`},
					{ id: 'm9-systems', title: 'Other System Adaptations and Assessment', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-600">Key Postpartum Assessments (BUBBLE-HE)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Cardiovascular & Weight Loss:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Weight Loss:</strong> Approximately $10-13 \text{lbs}$ lost at birth. An additional $9 \text{lbs}$ over the next 2 weeks.</li>
							<li>**Blood Pressure:** Assess for **Orthostatic Hypotension** (dizziness when standing up) due to rapid fluid shifts.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Urinary and GI Systems:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Urinary:</strong> Increased bladder capacity and decreased sensitivity can lead to **urinary retention**. A distended bladder displaces the uterus and interferes with involution, risking **Postpartum Hemorrhage (PPH)**.</li>
							<li><strong>Gastrointestinal:</strong> Constipation is common due to decreased muscle tone, perineal pain, and fear of tearing sutures (lacerations).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Neurologic and Psychosocial:</h4>
						<ul class="list-disc list-inside ml-4">
							<li><strong>Headache:</strong> A common complaint. Must be differentiated between a benign cause (fluid shifts/fatigue) and a serious cause like **Spinal Headache** (from anesthesia) or **Preeclampsia** (if accompanied by blurred vision/abdominal pain).</li>
							<li>**Postpartum Blues:** Transient period of sadness, anxiety, or tearfulness (self-limiting, usually lasts less than 2 weeks).</li>
						</ul>
					`},
					{ id: 'm9-quiz', title: 'Module 9 Quiz', type: 'quiz',
						questions: [
							{ question: "The process by which the placental site heals without scarring in the postpartum uterus is called:", options: ["Atrophy", "Involution", "Exfoliation", "Regeneration"], correctAnswer: "Exfoliation" },
							{ question: "Which fundal height finding is expected on Day 10 postpartum?", options: ["At the umbilicus.", "1 cm above the symphysis pubis.", "No longer abdominally palpable.", "5 cm above the umbilicus."], correctAnswer: "No longer abdominally palpable." },
							{ question: "What is the primary risk associated with urinary retention and a distended bladder in the immediate postpartum period?", options: ["Puerperal infection.", "Perineal laceration.", "Postpartum Hemorrhage (PPH).", "Thromboembolic disorder."], correctAnswer: "Postpartum Hemorrhage (PPH)." }
						]
					}
				]
			},
			'module-10-maternal-complications': {
				title: 'Module 10: Postpartum Complications',
				color: 'from-red-600 to-red-800',
				description: 'Identify the signs and management of Postpartum Hemorrhage (PPH), Thromboembolism, and Infection (Ch. 28).',
				steps: [
					{ id: 'm10-pph', title: 'Postpartum Hemorrhage (PPH) & Trauma', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-800">The Leading Cause of Maternal Morbidity (Ch. 28)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Definition:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Blood loss of $\geq 1000 \text{mL}$ or greater, OR blood loss that causes hemodynamic instability.</li>
							<li>**Early PPH:** Occurs within the first 24 hours.</li>
							<li>**Late PPH:** Occurs from 24 hours up to 6 weeks (often due to **subinvolution** or **retained placental fragments**).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Causes (The $4 \text{ Ts}$):</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Tone ($\sim 70\%$):** **Uterine Atony** (lack of uterine muscle tone) $\rightarrow$ most common cause.</li>
							<li>**Trauma:** Lacerations of the cervix, vagina, or perineum; Hematomas.</li>
							<li>**Tissue:** Retained placental fragments or membranes.</li>
							<li>**Thrombin:** Coagulation disorders (e.g., DIC).</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Management Priority:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Identify predisposing factors (overdistention, grand multiparity, prolonged labor).</li>
							<li>Immediate action: **Uterine Massage** and check for **bladder distention**. Administer uterotonics (e.g., Pitocin, Methergine).</li>
						</ul>
					`},
					{ id: 'm10-shock-te', title: 'Hypovolemic Shock and Thromboembolic Disorders', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-800">Circulatory and Clotting Risks (Ch. 28)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Hypovolemic Shock:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>A consequence of excessive blood loss (PPH). Signs include **tachycardia**, **hypotension**, decreased $\text{O}_2 \text{sat}$, pale/cool skin, and decreased urine output.</li>
							<li>**Nursing Action:** Rapid volume replacement ($\text{IV}$ fluids, blood products) and continuous monitoring of vital signs.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Thromboembolic Disorders (TE):</h4>
						<ul class="list-disc list-inside ml-4">
							<li>Clots form due to **Virchow's Triad** (venous stasis, hypercoagulation-natural in postpartum, blood vessel injury-from birth trauma).</li>
							<li>**DVT (Deep Vein Thrombosis):** Often asymptomatic (in $75\%$ of cases). S/S include swelling, redness, tenderness, and warmth in the leg.</li>
							<li>**Pulmonary Embolism (PE):** A serious complication where a clot travels to the lung. Management is supportive.</li>
							<li>**Risk Factors:** Inactivity/bed rest, C-section, obesity, smoking, increased maternal age, increased parity.</li>
						</ul>
					`},
					{ id: 'm10-infection', title: 'Puerperal Infection and Affective Disorders', type: 'text', content: `
						<p class="text-xl font-semibold mb-3 text-red-800">Infection and Mental Health (Ch. 28)</p>
						<h4 class="text-lg font-bold mt-4 mb-2">Puerperal Infection:</h4>
						<p>Any infection of the genital tract that occurs within 6 weeks after childbirth.</p>
						<ul class="list-disc list-inside ml-4">
							<li>**Endometritis:** Infection of the uterine lining (most common).</li>
							<li>**Risk Factors:** Operative procedures ($\text{C-section}$, vacuum/forceps), multiple cervical exams, **prolonged labor**, **prolonged rupture of membranes (PROM)**, manual removal of placenta.</li>
							<li>**S/S:** Fever $\geq 100.4^\circ \text{F}$ on 2 successive days (excluding the first 24 hours), foul-smelling lochia, uterine tenderness.</li>
						</ul>
						<h4 class="text-lg font-bold mt-4 mb-2">Affective Disorders:</h4>
						<ul class="list-disc list-inside ml-4">
							<li>**Postpartum Blues:** (Discussed in Mod 9) Transient mood swings, tearfulness, self-limiting.</li>
							<li>**Postpartum Depression:** More serious, persistent sadness, irritability, severe anxiety, and difficulty bonding. Requires professional intervention.</li>
							<li>**Postpartum Psychosis:** Rarest and most severe; requires emergency treatment.</li>
						</ul>
					`},
					{ id: 'm10-quiz', title: 'Module 10 Quiz', type: 'quiz',
						questions: [
							{ question: "The most common cause of early postpartum hemorrhage (PPH) is:", options: ["Uterine Lacerations (Trauma)", "Retained Placental Tissue", "Uterine Atony (Tone)", "Coagulation Defects (Thrombin)"], correctAnswer: "Uterine Atony (Tone)" },
							{ question: "The presence of fever, foul-smelling lochia, and uterine tenderness beyond 24 hours postpartum most likely indicates:", options: ["Postpartum Blues", "Hypovolemic Shock", "Deep Vein Thrombosis (DVT)", "Endometritis (Puerperal Infection)"], correctAnswer: "Endometritis (Puerperal Infection)" },
							{ question: "In the context of PPH, checking for bladder distention is critical because a full bladder:", options: ["Is a direct sign of kidney failure.", "Displaces the uterus and prevents proper contraction.", "Causes immediate hypovolemic shock.", "Is a common side effect of uterine massage."], correctAnswer: "Displaces the uterus and prevents proper contraction." }
						]
					}
				]
			}
		};

		// The pre-assessment quiz data is compiled from the first 3 quiz questions of each module.
		// NOTE: The preAssessmentQuizData is updated to include the new and revised Module 7, 8, 9, and 10 questions.
		const preAssessmentQuizData = [
			// Module 1 Questions
			{ moduleId: 'module-1-transition', question: "What is the primary function of surfactant in the newborn lung?", options: ["To promote chest wall compression.", "To increase oxygen saturation in the blood.", "To decrease surface tension and prevent alveolar collapse.", "To dilate the ductus arteriosus."], correctAnswer: "To decrease surface tension and prevent alveolar collapse." },
			{ moduleId: 'module-1-transition', question: "Which change immediately after birth causes pulmonary vascular pressure to drop, assisting the transition?", options: ["Clamping of the umbilical cord.", "Drop in ambient temperature.", "Lungs filling with air/oxygenation.", "Release of adrenaline."], correctAnswer: "Lungs filling with air/oxygenation." },
			{ moduleId: 'module-1-transition', question: "Which fetal structure functionally closes first, usually within hours after birth?", options: ["Ductus Venosus", "Ductus Arteriosus", "Foramen Ovale", "Pulmonary Artery"], correctAnswer: "Foramen Ovale" },

			// Module 2 Questions
			{ moduleId: 'module-2-thermoregulation', question: "Heat loss caused by placing a newborn directly on a cool scale is due to which mechanism?", options: ["Evaporation", "Conduction", "Convection", "Radiation"], correctAnswer: "Conduction" },
			{ moduleId: 'module-2-thermoregulation', question: "Why is a baby experiencing cold stress at risk for Hypoglycemia?", options: ["Decreased insulin production", "Rapid depletion of glucose stores due to increased metabolic rate (NST)", "Lack of fluid intake", "Inability to produce adrenaline"], correctAnswer: "Rapid depletion of glucose stores due to increased metabolic rate (NST)" },
			{ moduleId: 'module-2-thermoregulation', question: "The nursing action of covering the infant's head and keeping them away from drafts prevents heat loss primarily through:", options: ["Evaporation and Conduction", "Radiation and Conduction", "Convection and Radiation", "Evaporation and Convection"], correctAnswer: "Convection and Radiation" },

			// Module 3 Questions
			{ moduleId: 'module-3-other-systems', question: "Breast milk provides which specific immunoglobulin that does NOT cross the placenta, strengthening the infant's GI defense?", options: ["IgG", "IgM", "IgA", "IgD"], correctAnswer: "IgA" },
			{ moduleId: 'module-3-other-systems', question: "What is the primary reason Vitamin K is administered at birth?", options: ["To prevent jaundice", "To activate clotting factors and prevent HDN", "To boost the immune system", "To aid respiratory function"], correctAnswer: "To activate clotting factors and prevent HDN" },
			{ moduleId: 'module-3-other-systems', question: "The nurse assesses a newborn's stool on day 2. Which finding would be considered normal?", options: ["White, chalky stools", "Transitional greenish-brown stools", "Loose, bloody stools", "Hard, formed brown stools"], correctAnswer: "Transitional greenish-brown stools" },

			// Module 4 Questions
			{ moduleId: 'module-4-assessment-care', question: "What is the most critical first nursing action immediately after a newborn is delivered?", options: ["Weigh the infant.", "Suction the mouth and nose.", "Dry the infant thoroughly.", "Administer Vitamin K."], correctAnswer: "Dry the infant thoroughly." },
			{ moduleId: 'module-4-assessment-care', question: "Eye prophylaxis is given to the newborn primarily to prevent blindness caused by which infections?", options: ["Staphylococcus Aureus", "Ophthalmia Neonatorum", "Hepatitis B", "Group B Streptococcus"], correctAnswer: "Ophthalmia Neonatorum" },
			{ moduleId: 'module-4-assessment-care', question: "If a newborn's 5-minute APGAR score is 6, what is the required immediate nursing action?", options: ["Initiate full resuscitation immediately.", "Notify the physician.", "Continue Apgar scoring every 5 minutes (up to 20 minutes).", "Place the baby in the nursery."], correctAnswer: "Continue Apgar scoring every 5 minutes (up to 20 minutes)." },

			// Module 5 Questions
			{ moduleId: 'module-5-screening-safety', question: "When should the Universal Newborn Screening (PKU/Hypothyroidism) blood test be performed?", options: ["Immediately after birth.", "Before the first feeding.", "After the infant has fed for at least 24 hours.", "Upon discharge from the hospital."], correctAnswer: "After the infant has fed for at least 24 hours." },
			{ moduleId: 'module-5-screening-safety', question: "What is the recommended sleep position for a healthy newborn to prevent SIDS?", options: ["Prone", "Side-lying", "Semi-Fowler's", "Supine"], correctAnswer: "Supine" },
			{ moduleId: 'module-5-screening-safety', question: "A normal result for CCHD screening requires oxygen saturation to be $>95\%$ in the right hand and foot with what maximum difference between the two sites?", options: ["$\lt 1\%$ difference", "$\lt 3\%$ difference", "$\lt 5\%$ difference", "No difference is allowed."], correctAnswer: "$\lt 3\%$ difference" },

			// Module 6 Questions
			{ moduleId: 'module-6-metabolic-risk', question: "Infants born to diabetic mothers are at high risk for hypoglycemia primarily due to:", options: ["Slow metabolism", "Rebound hyperinsulinemia", "Lack of brown fat", "Immature kidneys"], correctAnswer: "Rebound hyperinsulinemia" },
			{ moduleId: 'module-6-metabolic-risk', question: "What is the most serious neurological complication of severe, untreated hyperbilirubinemia?", options: ["Respiratory Distress Syndrome", "Intraventricular Hemorrhage", "Kernicterus (Bilirubin Encephalopathy)", "Polycythemia"], correctAnswer: "Kernicterus (Bilirubin Encephalopathy)" },
			{ moduleId: 'module-6-metabolic-risk', question: "In a jaundiced newborn, the nurse promotes bilirubin excretion by encouraging:", options: ["Restricting feeds to rest the gut.", "Promoting frequent and adequate feeding.", "Applying ice packs to the liver.", "Limiting urination."], correctAnswer: "Promoting frequent and adequate feeding." },

			// Module 7 Questions
			{ moduleId: 'module-7-prematurity', question: "What neonatal complication is specifically associated with the fluctuation or excessive administration of oxygen to preterm infants?", options: ["Bronchopulmonary Dysplasia (BPD)", "Respiratory Distress Syndrome (RDS)", "Retinopathy of Prematurity (ROP)", "Necrotizing Enterocolitis (NEC)"], correctAnswer: "Retinopathy of Prematurity (ROP)" },
			{ moduleId: 'module-7-prematurity', question: "Which nursing intervention is essential for preventing Intraventricular Hemorrhage (IVH) in a preterm infant?", options: ["Providing passive range of motion exercises.", "Maintaining a slightly Trendelenburg position.", "Minimizing stress and clustering care.", "Administering high-concentration oxygen."], correctAnswer: "Minimizing stress and clustering care." },
			{ moduleId: 'module-7-prematurity', question: "A common, yet often vague, early sign of Sepsis Neonatorum that requires immediate investigation is:", options: ["Projectile vomiting", "Jaundice (after 48 hours)", "Temperature instability", "Persistent meconium stool"], correctAnswer: "Temperature instability" },
			
			// Module 8 Questions (New)
			{ moduleId: 'module-8-newborn-feeding', question: "Which component of breast milk is rich in immunoglobulins and is the first milk produced?", options: ["Mature Milk", "Foremilk", "Hindmilk", "Colostrum"], correctAnswer: "Colostrum" },
			{ moduleId: 'module-8-newborn-feeding', question: "Which behavior is considered a **late** sign of hunger in an infant?", options: ["Rooting", "Hand to mouth movements", "Licking lips", "Crying"], correctAnswer: "Crying" },
			{ moduleId: 'module-8-newborn-feeding', question: "Why should breast milk or formula never be heated in a microwave?", options: ["It destroys all nutrients.", "It causes separation of fat molecules.", "It creates dangerous hot spots (burn risk).", "It changes the taste dramatically."], correctAnswer: "It creates dangerous hot spots (burn risk)." },

			// Module 9 Questions (New)
			{ moduleId: 'module-9-maternal-postpartum', question: "The process by which the placental site heals without scarring in the postpartum uterus is called:", options: ["Atrophy", "Involution", "Exfoliation", "Regeneration"], correctAnswer: "Exfoliation" },
			{ moduleId: 'module-9-maternal-postpartum', question: "The lochia stage characterized by pinkish/brownish discharge, typically lasting days 4-10, is:", options: ["Lochia Rubra", "Lochia Serosa", "Lochia Alba", "Lochia Purpura"], correctAnswer: "Lochia Serosa" },
			{ moduleId: 'module-9-maternal-postpartum', question: "What is the primary risk associated with a distended bladder in the immediate postpartum period?", options: ["Puerperal infection.", "Perineal laceration.", "Postpartum Hemorrhage (PPH).", "Thromboembolic disorder."], correctAnswer: "Postpartum Hemorrhage (PPH)." },

			// Module 10 Questions (New)
			{ moduleId: 'module-10-maternal-complications', question: "The most common cause of early postpartum hemorrhage (PPH) is:", options: ["Uterine Lacerations (Trauma)", "Retained Placental Tissue", "Uterine Atony (Tone)", "Coagulation Defects (Thrombin)"], correctAnswer: "Uterine Atony (Tone)" },
			{ moduleId: 'module-10-maternal-complications', question: "Which risk factor is part of Virchow's Triad and is a natural physiological state in the postpartum period?", options: ["Venous stasis", "Hypercoagulation", "Blood vessel injury", "Smoking"], correctAnswer: "Hypercoagulation" },
			{ moduleId: 'module-10-maternal-complications', question: "A mother reports a fever of $101^\circ \text{F}$ on postpartum Day 3 with foul-smelling lochia. This is most indicative of:", options: ["Postpartum Blues", "Hypovolemic Shock", "Deep Vein Thrombosis (DVT)", "Endometritis (Puerperal Infection)"], correctAnswer: "Endometritis (Puerperal Infection)" }
		];

		// --- Helper Functions ---
		const cn = (...classes) => classes.filter(Boolean).join(' ');

		// --- Child Components ---

		/**
		 * Quiz component for interactive multiple-choice questions.
		 */
		const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
			const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
			const [selectedOption, setSelectedOption] = useState([]);
			const [feedback, setFeedback] = useState(null);
			const [answers, setAnswers] = useState([]);

			const currentQuestion = questions[currentQuestionIndex];

			// Determine if the current question is multi-select (SATA)
			const isMultiSelect = Array.isArray(currentQuestion.correctAnswer) && currentQuestion.correctAnswer.length > 1;

			const handleOptionSelect = (option) => {
				if (feedback && !isPreAssessment) return;

				if (isMultiSelect) {
					setSelectedOption(prevSelected => {
						if (prevSelected.includes(option)) {
							return prevSelected.filter(item => item !== option);
						} else {
							return [...prevSelected, option];
						}
					});
				} else {
					// Single select logic
					setSelectedOption([option]); // Always store as array internally for consistent checking
				}
			};

			const checkCorrectness = (options, correctAnswers) => {
				if (Array.isArray(correctAnswers)) {
					// Multi-select (SATA) check: Must contain ALL correct answers and ONLY those correct answers.
					const correctCount = correctAnswers.filter(ans => options.includes(ans)).length;
					return correctCount === correctAnswers.length && options.length === correctAnswers.length;
				} else {
					// Single select check
					return options[0] === correctAnswers;
				}
			};

			const handlePreAssessmentNext = () => {
				if (selectedOption.length === 0) return;

				const isCorrect = checkCorrectness(selectedOption, currentQuestion.correctAnswer);

				const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
				setAnswers(updatedAnswers);

				if (currentQuestionIndex < questions.length - 1) {
					setCurrentQuestionIndex(currentQuestionIndex + 1);
					setSelectedOption([]);
					setFeedback(null);
				} else {
					onComplete(updatedAnswers);
				}
			};

			const handleRegularQuizSubmit = () => {
				if (selectedOption.length === 0) return;
				const isCorrect = checkCorrectness(selectedOption, currentQuestion.correctAnswer);
				setFeedback(isCorrect ? 'correct' : 'incorrect');
			};

			const handleRegularQuizNext = () => {
				if (!feedback) return; // Cannot proceed without submitting first

				const isCorrect = checkCorrectness(selectedOption, currentQuestion.correctAnswer);
				const finalAnswers = [...answers, { question: currentQuestion, isCorrect, score: isCorrect ? 1 : 0 }];
				
				if (currentQuestionIndex < questions.length - 1) {
					setAnswers(finalAnswers);
					setCurrentQuestionIndex(currentQuestionIndex + 1);
					setSelectedOption([]);
					setFeedback(null);
				} else {
					const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.score || 0), 0);
					onComplete({ score: finalScore, total: questions.length });
				}
			};

			const selectedAnswerText = isMultiSelect ? selectedOption : selectedOption[0];
			
			return (
				<div className="p-4 bg-white rounded-xl shadow-lg border border-gray-200 animate-fade-in">
					<h4 className="font-extrabold text-2xl text-gray-800 mb-4 flex justify-between items-center">
						<span>{isPreAssessment ? 'Diagnostic Question' : 'Module Quiz'}</span>
						<span className="text-lg font-semibold text-indigo-600">{currentQuestionIndex + 1} of {questions.length}</span>
					</h4>
					
					{isMultiSelect && <p className="text-sm font-bold text-red-500 mb-2">**SELECT ALL THAT APPLY (SATA)**</p>}
					
					<p className="font-semibold text-gray-700 mb-4 text-lg">{currentQuestion.question}</p>
					<div className="space-y-3">
						{currentQuestion.options.map((option, index) => {
							const isSelected = selectedOption.includes(option);
							const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
								? currentQuestion.correctAnswer.includes(option)
								: option === currentQuestion.correctAnswer;
							
							let optionClass = 'bg-gray-50 hover:bg-gray-100 border-gray-300';

							if (feedback && !isPreAssessment) {
								if (isCorrectOption) {
									optionClass = 'bg-green-100 border-green-500 text-green-800 font-medium';
								} else if (isSelected && !isCorrectOption) {
									optionClass = 'bg-red-100 border-red-500 text-red-800 font-medium';
								}
							} else if (isSelected) {
								optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800 font-medium shadow-inner';
							}

							return (
								<div
									key={index}
									onClick={() => handleOptionSelect(option)}
									className={cn('p-3 rounded-xl border-2 cursor-pointer transition-all duration-150 flex items-center', optionClass)}
								>
									<span className="flex-1">{option}</span>
									{feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
										isCorrectOption ? <span className="text-green-600 ml-2">â</span> : <span className="text-red-600 ml-2">â</span>
									)}
								</div>
							);
						})}
					</div>
					<div className="mt-6 text-center">
						{isPreAssessment ? (
							<button
								onClick={handlePreAssessmentNext}
								disabled={selectedOption.length === 0}
								className="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors transform hover:scale-105"
							>
								{currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
							</button>
						) : (
							<>
								{!feedback ? (
									<button
										onClick={handleRegularQuizSubmit}
										disabled={selectedOption.length === 0}
										className="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors transform hover:scale-105"
									>
										Submit Answer
									</button>
								) : (
									<button
										onClick={handleRegularQuizNext}
										className="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-colors transform hover:scale-105"
									>
										{currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'View Score'}
									</button>
								)}
							</>
						)}
					</div>
				</div>
			);
		};

		/**
		 * PreAssessmentQuiz component to handle the initial diagnostic quiz.
		 */
		const PreAssessmentQuiz = ({ onComplete, onExit }) => {
			const [results, setResults] = useState(null);

			const handleQuizComplete = (finalAnswers) => {
				const moduleResults = {};
				finalAnswers.forEach(answer => {
					const { moduleId } = answer.question;
					if (!moduleResults[moduleId]) {
						moduleResults[moduleId] = { correct: 0, total: 0 };
					}
					if (answer.isCorrect) {
						moduleResults[moduleId].correct++;
					}
					moduleResults[moduleId].total++;
				});

				const completedModules = [];
				for (const moduleId in moduleResults) {
					// Test-out criteria: 100% correct in that module's diagnostic questions.
					if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
						completedModules.push(moduleId);
					}
				}
				setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
				onComplete(completedModules);
			};

			if (results) {
				return (
					<div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
						<div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
							<h2 className="text-3xl font-extrabold text-gray-800 mb-4">Diagnostic Complete!</h2>
							<p className="text-lg text-gray-600 mb-6">
								You correctly answered {results.correct} out of {results.total} questions.
							</p>
							{results.completedModules.length > 0 ? (
								<>
									<p className="text-green-600 font-bold text-xl mb-4">You've successfully tested out of:</p>
									<ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-xl shadow-inner border border-green-200">
										{results.completedModules.map(id => <li key={id} className="font-semibold">{contentData[id].title}</li>)}
									</ul>
									<p className="text-gray-700 text-sm italic mb-6">Your progress for these modules has been marked as complete.</p>
								</>
							) : (
								<p className="text-yellow-600 font-bold text-xl mb-6 bg-yellow-50 p-4 rounded-xl shadow-inner border border-yellow-200">
									Keep going! Use the learning modules to review the content.
								</p>
							)}
							<button
								onClick={onExit}
								className="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-colors transform hover:scale-105"
							>
								Return to Dashboard
							</button>
						</div>
					</div>
				);
			}

			return (
				<div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
					<div className="bg-white rounded-2xl shadow-xl p-8 max-w-3xl w-full">
						<h2 className="text-3xl font-extrabold text-center text-gray-800 mb-6">Diagnostic Quiz (Pre-Assessment)</h2>
						<Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
					</div>
				</div>
			);
		};


		/**
		 * Dashboard component to display the available learning modules.
		 */
		const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
			let totalCompletedSteps = 0;
			let totalPossibleSteps = 0;
			let totalQuizCorrect = 0;
			let totalQuizQuestions = 0;

			// Calculate overall progress and gather quiz scores
			Object.entries(contentData).forEach(([moduleId, module]) => {
				totalPossibleSteps += module.steps.length;
				const moduleProgress = progress[moduleId] || {};
				
				Object.values(moduleProgress).forEach(stepProgress => {
					if (stepProgress.completed) {
						totalCompletedSteps++;
					}
					if (stepProgress.score !== undefined) {
						totalQuizCorrect += stepProgress.score;
					}
				});

				module.steps.forEach(step => {
					if (step.type === 'quiz' || step.type === 'case_study') {
						totalQuizQuestions += (step.type === 'quiz' ? step.questions.length : 1);
					}
				});
			});

			const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

			return (
				<div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
					<div className="w-full">
						<header className="mb-8 text-center">
							<div className="flex items-center justify-center gap-3 mb-2">
								<span className="w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center font-extrabold text-xl shadow-lg">NB</span>
								<h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Newborn Adaptations Master Module</h1>
								<span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:2.2</span>
							</div>
							<p className="text-lg text-gray-500 max-w-2xl mx-auto">Master the critical physiological transition, assessment, safety, and high-risk care of the neonate.</p>
						</header>

						{/* Skip Ahead Button */}
						<div className="mb-8 text-center">
							<button
								onClick={onStartPreAssessment}
								className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-xl shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
							>
								<div className="text-xl font-extrabold">Skip Ahead: Take Diagnostic Quiz</div>
								<div className="text-sm font-medium">Test your knowledge and potentially skip modules. ({preAssessmentQuizData.length} Questions)</div>
							</button>
						</div>

						{/* Overall Progress Bar & Reset Button */}
						<div className="mb-12 bg-white rounded-2xl shadow-xl p-6 w-full max-w-4xl mx-auto">
						Â  Â <div className="flex justify-between items-center mb-3">
							Â  <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
							Â  <buttonÂ 
									onClick={onResetProgress}
									className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2 transform hover:scale-105"
								>
									<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" /></svg>
									Reset Progress
							Â  </button>
						Â  Â </div>
						Â  Â <div className="w-full bg-gray-200 rounded-full h-4">
							Â  Â <div
								Â  className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
								Â  style={{ width: `${overallPercentage}%` }}
							Â  Â ></div>
						Â  Â </div>
						Â  Â <div className="flex justify-between items-center">
							Â  <p className="text-left text-sm text-gray-600 mt-2">
								Â  {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
							Â  </p>
							Â  <p className="text-right text-sm text-gray-600 mt-2 font-bold">{Math.round(overallPercentage)}% Completed</p>
						Â  Â </div>
						</div>

						<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
							{/* Iterate over all modules defined in contentData */}
							{Object.entries(contentData).map(([id, module]) => {
								const moduleProgress = progress[id] || {};
								// Calculate completion count for steps within the module.
								const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
								const totalSteps = module.steps.length;
								const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

								let statusText = "Not Started";
								let statusColor = "text-gray-500";
								if (completedCount === totalSteps) {
									statusText = "COMPLETED";
									statusColor = "text-green-600 font-extrabold";
								} else if (completedCount > 0) {
									statusText = "In Progress";
									statusColor = "text-yellow-600 font-bold";
								}

								return (
									<div
										key={id}
										onClick={() => onSelectModule(id)}
										className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 group flex flex-col transform animate-fade-in"
									>
										<div className="flex justify-between items-start mb-4">
											{/* Module Icon/Title Tag */}
											<div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-12 h-12 flex items-center justify-center text-white text-lg font-extrabold shadow-lg flex-shrink-0")}>
												{module.title.split(':')[0].replace('Module ', 'M')}
											</div>
											{/* Progress Circle */}
											<div className="relative w-12 h-12 flex-shrink-0">
												<svg className="w-full h-full" viewBox="0 0 36 36">
													{/* Background circle for the progress bar. */}
													<path
														className="text-gray-200"
														d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
														fill="none"
														stroke="currentColor"
														strokeWidth="3"
													/>
													{/* Foreground arc representing the completion percentage. */}
													<path
														className="text-indigo-500 transition-all duration-700"
														d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
														fill="none"
														stroke="currentColor"
														strokeWidth="3"
														strokeDasharray={`${percentage}, 100`}
														strokeLinecap="round"
														transform="rotate(-90 18 18)"
													/>
												</svg>
												<span className={cn("absolute inset-0 flex items-center justify-center text-xs font-extrabold", percentage === 100 ? 'text-green-600' : 'text-gray-600')}>
													{Math.round(percentage)}%
												</span>
											</div>
										</div>
										<h3 className="text-xl font-extrabold text-gray-800 mb-2">{module.title.split(': ')[1]}</h3>
										<p className="text-gray-500 text-sm mb-4 h-10">{module.description}</p>
										<div className="mt-auto pt-2 border-t border-gray-100">
											<p className={cn("text-sm", statusColor)}>{statusText}</p>
											<div className="flex items-center justify-between text-sm font-bold text-indigo-600 group-hover:text-indigo-700 mt-2">
												{percentage === 100 ? 'Review Module' : 'Start Learning'}Â 
												<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 ml-1 transition-transform group-hover:translate-x-1" viewBox="0 0 20 20" fill="currentColor">
													<path fillRule="evenodd" d="M12.97 4.97a.75.75 0 011.06 0l4.5 4.5a.75.75 0 010 1.06l-4.5 4.5a.75.75 0 11-1.06-1.06l3.22-3.22H4a.75.75 0 010-1.5h12.19l-3.22-3.22a.75.75 0 010-1.06z" clipRule="evenodd" />
												</svg>
											</div>
										</div>
									</div>
								);
							})}
						</div>
					</div>
				</div>
			);
		};

		/**
		 * CaseStudy component for a multiple-choice case study challenge.
		 */
		const CaseStudy = ({ caseData, onComplete }) => {
			const [selectedAnswers, setSelectedAnswers] = useState([]);
			const [showFeedback, setShowFeedback] = useState(false);
			
			const isMultiSelect = Array.isArray(caseData.correctAnswer) && caseData.correctAnswer.length > 1;

			const handleSelect = (option) => {
				if (showFeedback) return;

				if (isMultiSelect) {
					setSelectedAnswers(prevSelected => {
						if (prevSelected.includes(option)) {
							return prevSelected.filter(item => item !== option);
						} else {
							return [...prevSelected, option];
						}
					});
				} else {
					// Single select logic
					setSelectedAnswers([option]);
				}
			};

			const checkCorrectness = (options, correctAnswers) => {
				if (Array.isArray(correctAnswers)) {
					const correctCount = correctAnswers.filter(ans => options.includes(ans)).length;
					return correctCount === correctAnswers.length && options.length === correctAnswers.length;
				} else {
					return options[0] === correctAnswers;
				}
			};

			const handleSubmit = () => {
				setShowFeedback(true);
				const isCorrect = checkCorrectness(selectedAnswers, caseData.correctAnswer);
				
				if (isCorrect) {
					onComplete({ score: 1, total: 1 });
				} else {
					onComplete({ score: 0, total: 1 });
				}
			};

			return (
				<div className="p-6 bg-white rounded-xl shadow-lg border border-red-200 animate-fade-in">
					<h4 className="font-extrabold text-2xl text-red-700 mb-4 flex items-center">
						<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
							<path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 001 1h3a1 1 0 100-2h-2V6z" clipRule="evenodd" />
						</svg>
						Clinical Case Challenge
					</h4>
					{isMultiSelect && <p className="text-sm font-bold text-red-500 mb-2">**SELECT ALL THAT APPLY (SATA)**</p>}
					<div className="mb-4 p-4 bg-gray-50 rounded-lg border-l-4 border-indigo-400">
						<h5 className="font-bold text-indigo-700 mb-1">Scenario:</h5>
						<p className="text-gray-700 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
					</div>
					
					<p className="font-bold text-gray-800 mb-3 text-lg">{caseData.question}</p>
					
					<div className="space-y-3">
						{caseData.options.map(option => {
							const isSelected = selectedAnswers.includes(option);
							const isCorrectOption = Array.isArray(caseData.correctAnswer)
								? caseData.correctAnswer.includes(option)
								: option === caseData.correctAnswer;
							
							let optionClass = 'bg-gray-50 hover:bg-gray-100 border-gray-300';
							if (showFeedback) {
								if (isCorrectOption) {
									optionClass = 'bg-green-100 border-green-500 text-green-800 font-medium shadow-md';
								} else if (isSelected && !isCorrectOption) {
									optionClass = 'bg-red-100 border-red-500 text-red-800 font-medium shadow-md';
								}
							} else if (isSelected) {
								optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800 font-medium shadow-inner';
							}

							return (
								<div
									key={option}
									onClick={() => handleSelect(option)}
									className={cn('p-3 rounded-xl border-2 cursor-pointer transition-colors flex items-center', optionClass)}
								>
									<span className="flex-1">{option}</span>
									{showFeedback && (
										isCorrectOption ? <span className="text-green-600 ml-2">â</span> : (isSelected && <span className="text-red-600 ml-2">â</span>)
									)}
								</div>
							);
						})}
					</div>
					{!showFeedback && (
						<div className="mt-6 text-center">
							<button
								onClick={handleSubmit}
								disabled={selectedAnswers.length === 0}
								className="px-8 py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors transform hover:scale-105"
							>
								Submit Case Answer
							</button>
						</div>
					)}
					{showFeedback && (
						<div className="mt-6 p-4 bg-yellow-50 rounded-xl border-l-4 border-yellow-500 shadow-inner">
							<h5 className="font-bold text-yellow-800 text-lg mb-2">Detailed Rationale:</h5>
							<div className="text-sm text-yellow-900 prose-sm" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></div>
						</div>
					)}
				</div>
			);
		};

		/**
		 * StaticContentStep component for displaying basic text content.
		 */
		const StaticContentStep = ({ step, onComplete }) => {
			// Mark as complete immediately upon rendering to enable progression.
			useEffect(() => {
				onComplete();
			}, [step.id, onComplete]); // Depend on step.id to re-trigger on navigation

			return (
				<div className="prose max-w-none text-gray-700 leading-relaxed p-6 bg-white rounded-xl shadow-lg border border-gray-200 space-y-4 animate-fade-in">
					<div dangerouslySetInnerHTML={{ __html: step.content }}></div>
				</div>
			);
		};

		/**
		 * CompletionModal component displayed when a module is completed.
		 */
		const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
			if (!isOpen) return null;

			return (
				<div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
					<div className="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
						<h3 className="text-3xl font-extrabold text-indigo-700 mb-4">Module Completed! ð</h3>
						<p className="text-gray-700 text-lg mb-6">You've successfully completed all steps in this module. Great job!</p>
						<div className="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
							<button
								onClick={onClose}
								className="px-6 py-3 bg-gray-300 text-gray-800 font-bold rounded-xl hover:bg-gray-400 transition-colors shadow-md"
							>
								Back to Dashboard
							</button>
							{hasNextModule && (
								<button
									onClick={onNextModule}
									className="px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-colors transform hover:scale-105"
								>
									Continue to Next Module
								</button>
							)}
						</div>
					</div>
				</div>
			);
		};

		/**
		 * LearningModule component to manage steps within the selected module.
		 */
		const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
			const [activeStep, setActiveStep] = useState(0);
			const [isSidebarOpen, setIsSidebarOpen] = useState(false);
			const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false);

			// Reset to step 0 when module changes
			useEffect(() => {
				setActiveStep(0);
			}, [module.id]);

			const handleStepComplete = useCallback((stepId, data = {}) => {
				onProgressUpdate(module.id, stepId, { completed: true, ...data });
			}, [onProgressUpdate, module.id]);

			const moduleProgress = progress[module.id] || {};
			
			// Check if all essential steps (text, quiz, case_study) are completed
			const allStepsCompletedInModule = module.steps.every(step =>
				moduleProgress[step.id] && moduleProgress[step.id].completed
			);

			// Navigates to the next step, if available.
			const handleNextStep = () => {
				if (activeStep === module.steps.length - 1) {
					// If it's the last step and all steps in the module are completed, open the modal
					if (allStepsCompletedInModule) {
						setIsCompletionModalOpen(true);
					}
				} else if (activeStep < module.steps.length - 1) {
					// Otherwise, proceed to the next step
					setActiveStep(activeStep + 1);
				}
			};

			// Navigates to the previous step, if available.
			const handlePrevStep = () => {
				if (activeStep > 0) {
					setActiveStep(activeStep - 1);
				}
			};
			
			if (!module || !module.steps) {
				return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Error loading module.</div>;
			}

			const currentStep = module.steps[activeStep];
			
			const renderStepContent = (step) => {
				if (!step) return <p>Please select a step.</p>;

				const onCompleteForStep = (data) => handleStepComplete(step.id, data);

				switch (step.type) {
					case 'text':
						return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
					case 'case_study':
						return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
					case 'quiz':
						return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
					default:
						return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
				}
			};

			const handleModalClose = () => {
				setIsCompletionModalOpen(false);
				onBack(); // Go back to dashboard when modal is closed
			};

			const handleModalNextModule = () => {
				setIsCompletionModalOpen(false);
				onNextModule(); // Proceed to next module
			};


			return (
				<div className="fixed inset-0 bg-gray-100 flex flex-col z-20">
					{/* Header */}
					<header className="bg-white shadow-lg p-4 flex items-center justify-between z-30 flex-shrink-0">
						<button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-bold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2 transform hover:scale-105">
							<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
							<span className="hidden sm:inline">Dashboard</span>
						</button>
						<h2 className="text-xl font-extrabold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
						
						{/* Mobile sidebar toggle button */}
						<button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
							<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
						</button>
					</header>
					
					{isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
					<div className="flex flex-1 overflow-hidden">
						{/* Sidebar for navigation steps within the module. */}
						<aside className={cn(
							"bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
							isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
						)}>
							<h3 className="text-lg font-extrabold mb-4 text-indigo-700 px-3 border-b border-gray-100 pb-2">Module Steps ({activeStep + 1} / {module.steps.length})</h3>
							<nav className="space-y-1 overflow-y-auto flex-1 pr-1">
								{module.steps.map((step, index) => (
									<button
										key={step.id}
										onClick={() => {
											setActiveStep(index);
											setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
										}}
										className={cn(
											'w-full text-left p-3 rounded-xl flex items-center gap-3 transition-colors shadow-sm',
											activeStep === index ? 'bg-indigo-100 text-indigo-700 font-bold border-indigo-400 border' : 'hover:bg-gray-100 text-gray-700'
										)}
									>
										{/* Step completion indicator */}
										<div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
											{moduleProgress[step.id]?.completed ? (
												<svg className="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
											) : (
												<div className={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
											)}
										</div>
										<span className="flex-1 text-sm">{step.title}</span>
									</button>
								))}
							</nav>
						</aside>

						{/* Main content area for the current step. */}
						<main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
							<div className="max-w-5xl mx-auto">
								<h3 className="text-2xl font-extrabold text-gray-800 mb-4">{currentStep.title}</h3>
								{renderStepContent(currentStep)}

								{/* Navigation buttons for moving between steps. */}
								<div className="flex justify-between mt-8">
									<button
										onClick={handlePrevStep}
										disabled={activeStep === 0}
										className="px-6 py-3 bg-gray-300 text-gray-800 font-bold rounded-xl hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md transform hover:scale-105 disabled:hover:scale-100"
									>
										<span className="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10.707 3.293a1 1 0 010 1.414L7.414 8l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>Previous</span>
									</button>

									<button
										onClick={handleNextStep}
										disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
										className="px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors transform hover:scale-105 disabled:hover:scale-100"
									>
										{activeStep === module.steps.length - 1 ? (allStepsCompletedInModule ? 'Finish Module' : 'Complete All Steps') : <span className="flex items-center">Next <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9.293 3.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 8 9.293 4.707a1 1 0 010-1.414z" clipRule="evenodd" /></svg></span>}
									</button>
								</div>
							</div>
						</main>
					</div>
					<CompletionModal
						isOpen={isCompletionModalOpen}
						onClose={handleModalClose}
						onNextModule={handleModalNextModule}
						hasNextModule={hasNextModule}
					/>
				</div>
			);
		};

		// --- Main App Component ---
		function App() {
			const [currentModuleId, setCurrentModuleId] = useState(null);
			const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
			const [userId, setUserId] = useState(null);
			const [progress, setProgress] = useState({});
			const [isAuthReady, setIsAuthReady] = useState(false);

			// 1. Auth Setup (Local Storage)
			useEffect(() => {
				const unsubscribe = mockAuth.onAuthStateChanged((user) => {
					if (user) setUserId(user.uid);
					setIsAuthReady(true);
				});
				return () => unsubscribe();
			}, []);

			// 2. Load Progress from Local Storage
			useEffect(() => {
				if (!isAuthReady || !userId) return;
				const storedProgress = localStorage.getItem(`newborn-module-progress-${userId}`);
				if (storedProgress) {
					try {
						setProgress(JSON.parse(storedProgress));
					} catch (e) {
						console.error("Failed to parse stored progress, resetting.", e);
						setProgress({});
					}
				}
			}, [isAuthReady, userId]);

			// 3. Progress Update Handler (Persist to Local Storage)
			const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
				if (!isAuthReady || !userId) return;

				setProgress(currentProgress => {
					const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
					const newStepProgress = { ...currentStepProgress, ...data };

					// Avoid unnecessary updates if data hasn't changed.
					if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
						return currentProgress;
					}

					const newProgress = {
						...currentProgress,
						[moduleId]: {
							...(currentProgress[moduleId] || {}),
							[stepId]: newStepProgress
						}
					};

					localStorage.setItem(`newborn-module-progress-${userId}`, JSON.stringify(newProgress));
					return newProgress;
				});
			}, [isAuthReady, userId]);

			const handlePreAssessmentComplete = (completedModuleIds) => {
				const newProgress = { ...progress };
				completedModuleIds.forEach(moduleId => {
					const module = contentData[moduleId];
					if (module) {
						newProgress[moduleId] = {};
						module.steps.forEach(step => {
							// Mark all steps in the module as complete
							newProgress[moduleId][step.id] = { completed: true };
						});
					}
				});
				setProgress(newProgress);
				localStorage.setItem(`newborn-module-progress-${userId}`, JSON.stringify(newProgress));
			};
			
			const handleResetProgress = useCallback(() => {
				if (!isAuthReady || !userId) return;
				setProgress({});
				localStorage.removeItem(`newborn-module-progress-${userId}`);
				setCurrentModuleId(null);
			}, [isAuthReady, userId]);

			const handleNextModule = useCallback(() => {
				const moduleIds = Object.keys(contentData);
				const currentIndex = moduleIds.indexOf(currentModuleId);
				if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
					setCurrentModuleId(moduleIds[currentIndex + 1]);
				} else {
					setCurrentModuleId(null);
				}
			}, [currentModuleId]);

			const selectedModule = currentModuleId && contentData[currentModuleId]
														? { ...contentData[currentModuleId], id: currentModuleId }
														: null;

			const moduleIds = Object.keys(contentData);
			const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
			const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


			if (!isAuthReady) {
				return (
					<div className="min-h-screen flex items-center justify-center bg-gray-100">
						<div className="loader"></div>
						<p className="text-gray-500 ml-4">Authenticating user...</p>
					</div>
				);
			}

			return (
				<div className="bg-gray-100 min-h-screen font-sans text-gray-900">
					{isPreAssessmentActive ? (
						<PreAssessmentQuizÂ 
							onComplete={handlePreAssessmentComplete}Â 
							onExit={() => setIsPreAssessmentActive(false)}
						/>
					) : selectedModule ? (
						<LearningModule
							key={selectedModule.id}
							module={selectedModule}
							onBack={() => setCurrentModuleId(null)}
							progress={progress}
							onProgressUpdate={handleProgressUpdate}
							onNextModule={handleNextModule}
							hasNextModule={hasNextModule}
						/>
					) : (
						<DashboardÂ 
							onSelectModule={setCurrentModuleId}Â 
							progress={progress}Â 
							onResetProgress={handleResetProgress}
							onStartPreAssessment={() => setIsPreAssessmentActive(true)}
						/>
					)}
				</div>
			);
		}

		// --- Render the App into the DOM ---
		const container = document.getElementById('root');
		const root = ReactDOM.createRoot(container);
		root.render(<App />);
	</script>
</body>
</html>
