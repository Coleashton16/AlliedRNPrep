<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mother/Baby Development SDE</title>
    <!-- Google Fonts: Inter for a clean, modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define CSS Variables for consistent theming */
        :root {
            --primary-blue: #3498db;
            --primary-dark-blue: #2980b9;
            --secondary-orange: #f39c12;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --bg-light: #ecf0f1;
            --bg-white: #FFFFFF;
            --border-light: #e0e4eb;
            --success-green: #2ecc71;
            --danger-red: #e74c3c;
            --shadow-color: rgba(44, 62, 80, 0.1);
            --light-green-bg: #e6ffe6; /* Added for correct answer highlight */
            --light-red-bg: #ffe6e6;   /* Added for incorrect answer highlight */
            --light-blue-bg: #e6f7ff;  /* Added for rationale background */
        }

        /* Basic HTML and body styling for full-page layout */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent body scrolling */
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            box-sizing: border-box;
        }

        /* Quiz wrapper to manage overall layout */
        .quiz-wrapper {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header styling */
        .quiz-header {
            background: var(--bg-white);
            color: var(--text-dark);
            padding: 0.75rem 2rem;
            text-align: center;
            position: relative;
            border-bottom: 1px solid var(--border-light);
            flex-shrink: 0; /* Prevent header from shrinking */
            z-index: 10;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            max-width: 1200px; /* Constrain header content width */
            margin: 0 auto;
        }

        .logo {
            position: absolute;
            left: 0;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-blue);
        }

        .animated-icon {
            position: absolute;
            right: 0;
            animation: inspect 4s ease-in-out infinite;
        }

        .animated-icon svg { width: 30px; height: 30px; fill: var(--primary-blue); }
        .quiz-header h1 { margin: 0; font-size: 1.4rem; font-weight: 600; }
        .version-info { font-size: 0.7rem; color: var(--text-light); margin-top: 0.2rem; }
        
        /* Main content area for quiz and results */
        .quiz-content {
            padding: 1.5rem;
            flex-grow: 1; /* Allow content to fill available space */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            overflow: hidden; /* Hide overflow, allowing internal elements to scroll */
        }
        
        /* Initial screen styling */
        #initial-screen {
            text-align: center;
            padding: 2rem;
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: 0 15px 40px var(--shadow-color);
            border: 1px solid var(--border-light);
            max-width: 700px;
            width: 100%;
            box-sizing: border-box;
        }
        #initial-screen h2 { font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-dark-blue); }
        #initial-screen p { font-size: 1.1rem; line-height: 1.6; max-width: 600px; margin: 1rem auto 2rem auto; color: var(--text-light); }
        #start-btn {
            background-color: var(--primary-blue);
            color: white;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #start-btn:hover { background-color: var(--primary-dark-blue); transform: scale(1.05); }
        
        /* Quiz form styling */
        #quiz-form {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            background: var(--bg-white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 15px 40px var(--shadow-color);
            border: 1px solid var(--border-light);
            overflow: hidden; /* Allow content to scroll if needed */
            box-sizing: border-box;
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            max-width: 900px; /* Constrain quiz form width */
        }
        
        #quiz-form.is-transitioning { opacity: 0; transform: scale(0.98); }

        .question-header {
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            flex-shrink: 0; /* Prevent header from shrinking */
            border-bottom: 1px dashed var(--border-light);
            color: var(--text-light);
            font-weight: 500;
        }
        .question-header strong { font-weight: 700; color: var(--primary-blue); }
        .question-text {
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.6;
            margin-top: 0;
            margin-bottom: 1rem;
            flex-shrink: 0; /* Prevent text from shrinking */
        }
        
        .options-container { 
            flex-grow: 1; /* Allow options to take remaining space */
            overflow-y: auto; /* Enable scrolling for options if they overflow */
            padding: 0.5rem 0;
        }

        .options-container label {
            padding: 0.8rem 1.2rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .options-container label:hover { background-color: var(--bg-light); border-color: var(--primary-blue); }
        .options-container input {
            margin-right: 1rem;
            flex-shrink: 0;
            transform: scale(1.2);
            accent-color: var(--primary-blue);
        }
        
        .question-footer {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* Prevent footer from shrinking */
            flex-wrap: wrap; /* Allow elements to wrap on smaller screens */
            gap: 1rem; /* Space between footer elements */
        }
        .flag-container label { cursor: pointer; font-weight: 500; color: var(--text-light); display: flex; align-items: center; }
        .flag-container input { margin-right: 0.5rem; }
        .confidence-slider-container { display: flex; align-items: center; gap: 1rem; }
        .confidence-slider-container label { font-weight: 500; color: var(--text-light); }
        .confidence-slider { max-width: 150px; flex-grow: 1; }

        #navigation-btn {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        #navigation-btn:hover { background-color: var(--primary-dark-blue); transform: scale(1.05); }

        /* Results area styling */
        #results-area {
            animation: fadeIn 0.8s ease-out;
            box-sizing: border-box;
            width: 100%;
            height: 100%;
            overflow-y: auto; /* Enable scrolling for results content */
            padding: 2rem;
            max-width: 1000px; /* Constrain results area width */
            margin: 0 auto;
        }
        .results-summary, #confidence-analysis, #study-focus, #results-details {
            background-color: var(--bg-white);
            margin: 0 auto 2rem auto;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px var(--shadow-color);
            max-width: 100%; /* Ensure these sections fit within results-area */
            box-sizing: border-box;
        }
        .results-summary { text-align: center; }

        /* Score animation circle */
        .score-animation-container {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 8px solid var(--primary-blue);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1.5rem auto;
            position: relative;
            background-color: var(--bg-white);
        }
        .score-animation-circle {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--success-green) 0% 0%, var(--border-light) 0% 100%);
            transition: background 1.5s ease-out;
        }
        .score-animation-inner {
            position: relative;
            z-index: 2;
            background-color: var(--bg-white);
            width: calc(100% - 16px);
            height: calc(100% - 16px);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .score-animation-text { font-size: 2.5rem; font-weight: 800; color: var(--text-dark); }
        
        /* Headings for results sections */
        #confidence-analysis h3, #study-focus h3, #results-details h2 {
            margin-top: 0;
            border-bottom: 2px solid;
            padding-bottom: 1rem;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }
        #confidence-analysis h3 { color: var(--primary-dark-blue); border-color: var(--primary-blue); }
        #study-focus h3 { color: #c0392b; border-color: var(--danger-red); } /* Changed border color to danger-red */
        #results-details h2 { color: var(--text-dark); border-color: var(--border-light); }
        
        /* Individual question review in results */
        .result-question {
            border: 1px solid var(--border-light);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 12px;
        }
        .result-question p strong { display: block; margin-bottom: 1rem; font-size: 1.1em; color: var(--text-dark); }
        .result-question ul { list-style-type: none; padding: 0; margin: 0; }
        .result-question li { padding: 0.8rem 1.2rem; border-radius: 8px; margin-bottom: 0.6rem; font-size: 1rem; }
        .correct-answer-label { background-color: var(--light-green-bg); color: var(--success-green); font-weight: 600; }
        .incorrect-answer-label { background-color: var(--light-red-bg); color: var(--danger-red); text-decoration: line-through; }
        .missed-correct-answer-label { border: 2px dashed var(--success-green); } /* Highlight for correct answer not selected */
        .rationale {
            margin-top: 1.5rem;
            padding: 1.2rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary-blue);
            background-color: var(--light-blue-bg);
            font-size: 0.95rem;
        }

        /* Utility classes */
        .hidden { display: none !important; }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: confetti-fall 5s linear forwards;
            border-radius: 50%;
            z-index: 9999;
        }
        /* Message Box Styling */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .message-box {
            background-color: var(--bg-white);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-sizing: border-box;
        }

        .message-box h3 {
            margin-top: 0;
            color: var(--primary-dark-blue);
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .message-box p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .message-box button {
            background-color: var(--primary-blue);
            color: white;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .message-box button:hover {
            background-color: var(--primary-dark-blue);
        }


        /* Keyframe Animations */
        @keyframes confetti-fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
        @keyframes inspect {
            0% { transform: rotate(-15deg); }
            50% { transform: rotate(10deg); }
            100% { transform: rotate(-15deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .quiz-header { padding: 0.75rem 1rem; }
            .logo { position: static; text-align: center; margin-bottom: 0.5rem; }
            .header-content { flex-direction: column; }
            .animated-icon { position: static; margin-top: 0.5rem; }
            .quiz-header h1 { font-size: 1.2rem; }
            .quiz-content { padding: 1rem; }
            #initial-screen { padding: 1.5rem; }
            #initial-screen h2 { font-size: 2rem; }
            #initial-screen p { font-size: 1rem; }
            #start-btn { padding: 0.8rem 2rem; font-size: 1rem; }
            #quiz-form { padding: 1.5rem; }
            .question-text { font-size: 1.1rem; }
            .options-container label { padding: 0.6rem 1rem; font-size: 0.95rem; }
            .question-footer { flex-direction: column; align-items: stretch; }
            .confidence-slider-container { justify-content: space-between; width: 100%; }
            #navigation-btn { width: 100%; margin-top: 1rem; }
            #results-area { padding: 1rem; }
            .results-summary, #confidence-analysis, #study-focus, #results-details { padding: 1.5rem; }
            .score-animation-container { width: 120px; height: 120px; border-width: 6px; }
            .score-animation-inner { width: calc(100% - 12px); height: calc(100% - 12px); }
            .score-animation-text { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <div class="quiz-wrapper">
        <header class="quiz-header">
            <div class="header-content">
                <div class="logo">VSREP</div>
                <div>
                    <h1>Mother / Baby Development - SDE</h1>
                    <div class="version-info">
                        <span>Engine: V4.0</span> | <span>Test: V2.0</span>
                    </div>
                </div>
                <div class="animated-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
                </div>
            </div>
        </header>

        <main class="quiz-content">
            <div id="initial-screen">
                <h2>Welcome to the Diagnostic Exam</h2>
                <p>You will be presented with one question at a time. Once you answer, you cannot go back. Please read each question carefully before proceeding.</p>
                <button id="start-btn">Start Exam</button>
            </div>

            <form id="quiz-form" class="hidden"></form>

            <div id="results-area" class="hidden"></div>
        </main>
    </div>

    <!-- Custom Message Box HTML -->
    <div id="message-box-overlay" class="message-box-overlay hidden">
        <div class="message-box">
            <h3 id="message-box-title"></h3>
            <p id="message-box-text"></p>
            <button id="message-box-ok-btn">OK</button>
        </div>
    </div>

<script>
    // Quiz data structure: Each question now includes a 'section' for better study focus analysis.
    // 'cite_start' and 'cite: ...' tags have been removed from rationale for clean display.
    const fullQuizData = [ 
        {
            "section": "Growth & Development",
            "questionText": "A 6-month-old infant presents for a well-child check-up. The nurse notes the infant has not yet achieved head control and struggles to roll from back to abdomen. The nurse recognizes these findings as a potential delay in which developmental pattern?",
            "options": {
                "A": "Proximodistal growth",
                "B": "Cephalocaudal development",
                "C": "General to specific progression",
                "D": "Differentiation of skills"
            },
            "correctAnswer": "B",
            "rationale": "Cephalocaudal development refers to growth and skill acquisition progressing from head to toe. Head control is a primary milestone, followed by trunk control necessary for rolling. Lack of head control and difficulty rolling suggest a delay in this pattern."
        },
        {
            "section": "Cognitive Development",
            "type": "sata",
            "questionText": "A 4-year-old child insists that her teddy bear is 'sad' because it fell off the bed and needs a bandage. According to Piaget's theory, which cognitive characteristics is the child demonstrating? (Select all that apply)",
            "options": {
                "A": "Object permanence",
                "B": "Animism",
                "C": "Egocentrism",
                "D": "Conservation",
                "E": "Magical thinking"
            },
            "correctAnswer": "B,C,E",
            "rationale": "The child's belief that the teddy bear has feelings and needs a bandage (animism) and that her thoughts/actions influence events (magical thinking) are characteristic of Piaget's preoperational stage. Egocentrism is also prominent, as the child assumes the bear feels as she would. Object permanence is established earlier, and conservation develops in the concrete operational stage."
        },
        {
            "section": "Psychosocial Development",
            "questionText": "A new mother is struggling to establish a feeding routine with her 2-week-old infant. The infant often cries inconsolably, and the mother feels overwhelmed and unsure if she can meet her baby's needs. According to Erikson's theory, failure to resolve the primary developmental task at this stage can lead to:",
            "options": {
                "A": "Autonomy vs. Shame and Doubt",
                "B": "Initiative vs. Guilt",
                "C": "Trust vs. Mistrust",
                "D": "Industry vs. Inferiority"
            },
            "correctAnswer": "C",
            "rationale": "The first stage of Erikson's psychosocial development is Trust vs. Mistrust (birth to 1 year). If an infant's basic needs are not consistently met by a responsive caregiver, they may develop a sense of mistrust in the world."
        },
        {
            "section": "Immunization",
            "type": "sata",
            "questionText": "A 6-month-old infant is due for immunizations. The nurse is reviewing the child's immunization record and preparing to administer the recommended vaccines. Which of the following vaccines are typically administered at 6 months of age? (Select all that apply)",
            "options": {
                "A": "Hepatitis B (HepB) #3",
                "B": "Diphtheria-tetanus-acellular pertussis (DTaP) #3",
                "C": "Measles-mumps-rubella (MMR) #1",
                "D": "Influenza (initial dose if first season)",
                "E": "Varicella #1"
            },
            "correctAnswer": "A,B,D",
            "rationale": "At 6 months, an infant typically receives HepB #3, DTaP #3, and the initial influenza vaccine if it's their first flu season. MMR #1 and Varicella #1 are typically given at 12-15 months."
        },
        {
            "section": "Infant Care",
            "questionText": "A parent brings their 9-month-old infant to the clinic, expressing concern about persistent crying despite adequate feeding and diaper changes. The nurse's initial priority action should be to:",
            "options": {
                "A": "Educate the parent on techniques for soothing a fussy infant.",
                "B": "Assess the infant for any signs of illness or discomfort.",
                "C": "Suggest introducing new solid foods to distract the infant.",
                "D": "Advise the parent to let the infant cry to develop self-soothing."
            },
            "correctAnswer": "B",
            "rationale": "When an infant presents with persistent unexplained crying, the nurse's priority is always to rule out physiological causes such as illness, pain, or discomfort before addressing behavioral interventions. Crying can be a primary symptom of various infant health issues."
        },
        {
            "section": "Safety",
            "type": "sata",
            "questionText": "A nurse is providing anticipatory guidance to parents of a 12-month-old infant during a well-child visit. Which safety measures should the nurse emphasize for this developmental stage? (Select all that apply)",
            "options": {
                "A": "Ensure all medications and cleaning supplies are in locked cabinets.",
                "B": "Keep small objects like buttons and coins out of reach.",
                "C": "Supervise closely around water, including bathtubs and toilets.",
                "D": "Begin teaching the child about stranger danger.",
                "E": "Always place the child in a forward-facing car seat."
            },
            "correctAnswer": "A,B,C",
            "rationale": "At 12 months, infants are increasingly mobile and oral, making poisoning (meds/cleaners), choking (small objects), and drowning (water) significant risks. Stranger danger is typically introduced later when cognitive understanding is more developed. Car seat recommendations usually keep children rear-facing for as long as possible, often well past 12 months, based on manufacturer guidelines and state laws, before transitioning to forward-facing."
        },
        {
            "section": "Toddler Development",
            "questionText": "The mother of a 2-year-old reports that her child frequently says 'no' to requests and tries to do everything independently, even if it results in spills or delays. The nurse should interpret this behavior as indicative of the child striving to achieve a sense of:",
            "options": {
                "A": "Initiative",
                "B": "Identity",
                "C": "Autonomy",
                "D": "Trust"
            },
            "correctAnswer": "C",
            "rationale": "Toddlers (1-3 years old) are in Erikson's Autonomy vs. Shame and Doubt stage. Their striving for independence, saying 'no,' and attempting tasks on their own are normal expressions of developing autonomy. Shame and doubt can arise if these attempts are consistently met with criticism or overcontrol."
        },
        {
            "section": "Dental Health",
            "questionText": "A 7-year-old child presents for a dental check-up. The dental hygienist notes several lost primary teeth and the eruption of new permanent teeth. The nurse explains to the parent that during the school-age period, a key dental event is:",
            "options": {
                "A": "The complete absence of primary teeth.",
                "B": "The eruption of all third molars (wisdom teeth).",
                "C": "A mixed dentition, with both primary and permanent teeth present.",
                "D": "An increased risk for bottle-mouth caries due to poor hygiene."
            },
            "correctAnswer": "C",
            "rationale": "The school-age period (6-12 years) is characterized by a mixed dentition, where children have both primary (deciduous) and permanent teeth. Primary teeth are progressively lost and replaced by permanent ones. Complete absence of primary teeth occurs closer to adolescence, and wisdom teeth erupt much later. Bottle-mouth caries is primarily an infant/toddler issue."
        },
        {
            "section": "Growth & Development Principles",
            "questionText": "A nurse is explaining to a group of nursing students that infants typically gain control of their head and neck before they can sit unsupported. This phenomenon illustrates which principle of growth and development?",
            "options": {
                "A": "Proximodistal development",
                "B": "Differentiation",
                "C": "Cephalocaudal development",
                "D": "Reciprocal interweaving"
            },
            "correctAnswer": "C",
            "rationale": "Cephalocaudal development describes the pattern where growth and development proceed from head to foot. This means an infant gains control of their head and neck (upper body) before their trunk and lower extremities, enabling activities like sitting and eventually walking."
        },
        {
            "section": "Nutrition",
            "type": "sata",
            "questionText": "A parent asks the nurse for guidance on introducing solid foods to their 6-month-old infant. Which of the following indicators suggest the infant is developmentally ready for solid foods? (Select all that apply)",
            "options": {
                "A": "The infant can sit with good head control.",
                "B": "The infant's birth weight has doubled.",
                "C": "The extrusion reflex (tongue thrust) is no longer present.",
                "D": "The infant shows interest in food by leaning forward and opening their mouth.",
                "E": "The infant is sleeping through the night consistently."
            },
            "correctAnswer": "A,C,D",
            "rationale": "Readiness for solid foods is indicated by several developmental milestones: ability to sit with good head control, disappearance of the extrusion reflex (which prevents food from staying in the mouth), and demonstrating interest in food. Doubled birth weight is a general growth milestone, not a direct indicator of solid food readiness. Sleeping through the night is not directly related to physiological readiness for solids."
        },
        {
            "section": "Cognitive Development",
            "questionText": "During a clinic visit, a 3-year-old child points to a cloud and says, 'That cloud looks sad because it's crying rain!' This statement exemplifies which characteristic of preoperational thought?",
            "options": {
                "A": "Centration",
                "B": "Irreversibility",
                "C": "Transductive reasoning",
                "D": "Animism"
            },
            "correctAnswer": "D",
            "rationale": "Animism is the belief that inanimate objects possess human feelings and intentions. The child attributing sadness and crying to the cloud demonstrates animistic thinking, which is common in the preoperational stage."
        },
        {
            "section": "Infant Senses",
            "questionText": "A mother is concerned that her 3-month-old infant sometimes appears cross-eyed. The nurse explains that this is usually a normal finding, but a persistent lack of eye muscle control beyond which age requires further evaluation?",
            "options": {
                "A": "2 months",
                "B": "4-6 months",
                "C": "9 months",
                "D": "12 months"
            },
            "correctAnswer": "B",
            "rationale": "Transient strabismus (cross-eyes) is common in the first few months of life as eye muscles strengthen. However, if a persistent lack of eye muscle control (strabismus) continues beyond 4 to 6 months of age, it warrants further evaluation by a healthcare provider to rule out vision problems."
        },
        {
            "section": "Developmental Screening",
            "questionText": "The American Academy of Pediatrics (AAP) recommends specific developmental screenings for all children. At which age visits is autism-specific screening typically performed?",
            "options": {
                "A": "9-month and 18-month visits",
                "B": "12-month and 24-month visits",
                "C": "18-month and 24-month visits",
                "D": "24-month and 36-month visits"
            },
            "correctAnswer": "C",
            "rationale": "The AAP recommends specific autism-specific screenings at the 18-month and 24-month well-child visits, in addition to general developmental surveillance at every visit."
        },
        {
            "section": "Safety",
            "questionText": "A nurse is teaching parents of a 1-year-old about injury prevention. The nurse should emphasize that the leading cause of unintentional injury deaths in this age group is:",
            "options": {
                "A": "Motor vehicle accidents",
                "B": "Falls",
                "C": "Drowning",
                "D": "Poisoning"
            },
            "correctAnswer": "C",
            "rationale": "Drowning is the leading cause of unintentional injury deaths in toddlers and young children. This emphasizes the critical importance of constant supervision around water, even small amounts."
        },
        {
            "section": "Moral Development",
            "questionText": "A 6-year-old child tells the nurse, 'I didn't take the cookies because Mom said I'd get a timeout.' According to Kohlberg's theory of moral development, this statement reflects which stage?",
            "options": {
                "A": "Conventional, Stage 3 (Good Interpersonal Relationships)",
                "B": "Preconventional, Stage 1 (Obedience and Punishment Orientation)",
                "C": "Postconventional, Stage 5 (Social Contract and Individual Rights)",
                "D": "Preconventional, Stage 2 (Individualism and Exchange)"
            },
            "correctAnswer": "B",
            "rationale": "In Kohlberg's Preconventional Level, Stage 1 (Obedience and Punishment Orientation), moral decisions are based on avoiding punishment. The child's statement directly links behavior to the consequence of a timeout, demonstrating this stage."
        },
        {
            "section": "Play Development",
            "questionText": "A nurse observes two 2-year-old children playing in a daycare. One child is building a tower with blocks, and the other is pushing a toy car back and forth nearby. They are using similar toys but not directly interacting. The nurse identifies this as an example of:",
            "options": {
                "A": "Cooperative play",
                "B": "Associative play",
                "C": "Parallel play",
                "D": "Solitary play"
            },
            "correctAnswer": "C",
            "rationale": "Parallel play is characteristic of toddlers (around 18 months to 3 years) where children play alongside each other with similar toys but without direct interaction or shared goals. Cooperative play involves organized group activities, and associative play involves interaction without formal organization."
        },
        {
            "section": "Growth & Development Principles",
            "type": "sata",
            "questionText": "A nursing instructor is differentiating between growth and development. Which statements accurately describe these concepts? (Select all that apply)",
            "options": {
                "A": "Growth primarily refers to quantitative physical changes that are measurable.",
                "B": "Development encompasses qualitative changes in skill and capacity.",
                "C": "Maturation is solely influenced by environmental stimuli.",
                "D": "Learning is a change in behavior resulting from experience and maturation.",
                "E": "Growth and development typically follow predictable, orderly patterns."
            },
            "correctAnswer": "A,B,D,E",
            "rationale": "Growth is measurable physical increase (quantitative). Development is a qualitative increase in capability. Learning is a change in behavior due to maturation and experience. Growth and development follow predictable, orderly patterns. Maturation, however, is primarily genetically programmed physical change, although environment can influence its expression, it's not *solely* environmental."
        },
        {
            "section": "Nutrition",
            "questionText": "A mother informs the nurse that her 8-month-old infant frequently develops hives and gastrointestinal upset after consuming cow's milk-based formula. The nurse suspects which common infant allergy?",
            "options": {
                "A": "Peanut allergy",
                "B": "Egg allergy",
                "C": "Soy protein allergy",
                "D": "Cow's milk protein allergy (CMPA)"
            },
            "correctAnswer": "D",
            "rationale": "Cow's milk protein allergy (CMPA) is the most common food allergy during infancy, manifesting with symptoms such as hives, eczema, vomiting, diarrhea, and sometimes respiratory symptoms. The other allergies are also common but CMPA is highest in incidence for this age group."
        },
        {
            "section": "Psychosocial Development",
            "questionText": "A 5-year-old hospitalized child begins to suck his thumb and demand to be fed by the nurse, despite having been self-sufficient prior to admission. The nurse recognizes this behavior as:",
            "options": {
                "A": "Negativism",
                "B": "Projection",
                "C": "Regression",
                "D": "Sublimation"
            },
            "correctAnswer": "C",
            "rationale": "Regression is a defense mechanism where an individual reverts to an earlier, more immature stage of development in response to stress, illness, or trauma. The child's return to thumb sucking and dependence are classic signs of regression in a hospitalized child."
        },
        {
            "section": "Safety",
            "questionText": "The nurse is providing discharge teaching to the parents of a 10-month-old infant. The nurse should prioritize warning the parents about the increased risk of choking with the introduction of which food item, due to the infant's developing pincer grasp?",
            "options": {
                "A": "Pureed vegetables",
                "B": "Small pieces of cooked pasta",
                "C": "Whole grapes",
                "D": "Mashed potatoes"
            },
            "correctAnswer": "C",
            "rationale": "The pincer grasp allows infants to pick up small objects, increasing the choking hazard. Whole grapes, hot dogs, nuts, and large chunks of meat are classic choking hazards for infants and toddlers due to their size and shape which can easily occlude an airway."
        },
        {
            "section": "Nutrition",
            "questionText": "A school nurse is conducting a health promotion session with parents regarding childhood obesity. Which of the following recommendations should the nurse emphasize as most effective for preventing childhood obesity?",
            "options": {
                "A": "Restricting all sugary snacks and drinks from the child's diet.",
                "B": "Enrolling the child in competitive sports to increase activity levels.",
                "C": "Encouraging regular family mealtimes and limiting screen time during meals.",
                "D": "Providing larger portions of healthy foods to ensure adequate intake."
            },
            "correctAnswer": "C",
            "rationale": "Encouraging regular family mealtimes fosters positive eating habits and allows for parental modeling and supervision of food intake. Limiting screen time during meals reduces distracted eating and excessive calorie consumption, both of which are significant contributors to childhood obesity."
        },
        {
            "section": "Language Development",
            "questionText": "A parent expresses frustration about their 4-year-old child constantly asking 'Why?' and 'How?' questions about everything. The nurse's most appropriate advice to the parent is to:",
            "options": {
                "A": "Tell the child to stop asking so many questions to avoid being annoying.",
                "B": "Provide simple, honest, and age-appropriate answers to encourage curiosity.",
                "C": "Redirect the child's attention to another activity when questions become excessive.",
                "D": "Tell the child to look up the answers in a book or on the internet."
            },
            "correctAnswer": "B",
            "rationale": "Preschoolers' 'why' and 'how' questions are a sign of their developing cognitive abilities and curiosity about the world. Providing simple, honest, and age-appropriate answers encourages language development, critical thinking, and a positive learning environment."
        },
        {
            "section": "Immunization",
            "questionText": "The nurse is preparing to administer an intramuscular (IM) injection to an 18-month-old child. Which site is the most appropriate and safest for this age group?",
            "options": {
                "A": "Deltoid muscle",
                "B": "Dorsogluteal muscle",
                "C": "Ventrogluteal muscle",
                "D": "Anterolateral thigh (vastus lateralis)"
            },
            "correctAnswer": "D",
            "rationale": "The anterolateral thigh (vastus lateralis muscle) is the preferred and safest site for IM injections in infants and toddlers (up to 3 years of age) due to its large muscle mass and distance from major nerves and blood vessels. The deltoid can be used after 18 months, but the vastus lateralis is still generally preferred for larger volumes or multiple injections. Dorsogluteal is contraindicated in young children due to sciatic nerve risk."
        },
        {
            "section": "Growth & Development",
            "questionText": "A nurse is providing anticipatory guidance to a parent of a 3-year-old child. The nurse explains that during the preschool years, a common developmental characteristic related to eating is that the child's appetite often decreases. This phenomenon is often referred to as:",
            "options": {
                "A": "Food aversion",
                "B": "Physiologic anorexia",
                "C": "Selective eating",
                "D": "Sensory-based feeding disorder"
            },
            "correctAnswer": "B",
            "rationale": "Physiologic anorexia is a common and normal finding in toddlers and preschoolers, where their appetite decreases due to a slower growth rate compared to infancy. This is a physiological response and not typically a cause for concern unless weight gain is significantly affected."
        },
        {
            "section": "Cognitive Development",
            "questionText": "A parent reports that their 10-month-old infant now actively searches for a toy that has been hidden under a blanket. The nurse recognizes this behavior as the infant demonstrating mastery of:",
            "options": {
                "A": "Symbolic thought",
                "B": "Egocentrism",
                "C": "Object permanence",
                "D": "Stranger anxiety"
            },
            "correctAnswer": "C",
            "rationale": "Object permanence is the understanding that objects continue to exist even when they are out of sight. An infant actively searching for a hidden toy is a classic example of achieving object permanence, a key milestone in Piaget's sensorimotor stage."
        },
        {
            "section": "Nutrition",
            "questionText": "A nurse is counseling the parents of a picky-eating 2-year-old. The parents are concerned their child isn't getting enough nutrients. The nurse's most appropriate advice is to:",
            "options": {
                "A": "Insist the child eat everything on their plate at each meal.",
                "B": "Offer a variety of healthy foods and focus on the child's nutritional intake over a week.",
                "C": "Bribe the child with dessert for finishing vegetables.",
                "D": "Prepare only foods the child readily accepts to avoid mealtime battles."
            },
            "correctAnswer": "B",
            "rationale": "For picky eaters, it is important to offer a variety of healthy foods and allow the child to self-regulate their intake. Focusing on weekly intake rather than daily intake reduces stress, as children's appetites can fluctuate. Forcing food or bribing can create negative associations with eating. Only offering preferred foods can lead to nutritional deficiencies."
        },
        {
            "section": "Immunization",
            "questionText": "A nurse is preparing to administer the influenza vaccine. What is the minimum age at which a child can receive the inactivated influenza vaccine annually?",
            "options": {
                "A": "2 months",
                "B": "6 months",
                "C": "12 months",
                "D": "2 years"
            },
            "correctAnswer": "B",
            "rationale": "The inactivated influenza vaccine is recommended annually for all individuals 6 months of age and older who do not have contraindications. Children younger than 6 months cannot receive the influenza vaccine."
        },
        {
            "section": "Fine Motor Skills",
            "questionText": "During a well-child visit, a 4-year-old proudly demonstrates cutting out shapes with scissors, including some curved lines. The nurse recognizes this fine motor skill as typical for this age, indicating advancement in:",
            "options": {
                "A": "Palmar grasp reflex",
                "B": "Eye-hand coordination",
                "C": "Gross motor development",
                "D": "Dominant hand preference establishment"
            },
            "correctAnswer": "B",
            "rationale": "Using scissors to cut on curved lines requires significant eye-hand coordination, which develops in the preschool years. The palmar grasp reflex is an infant reflex, and while gross motor skills are also advancing, this specific task highlights fine motor and coordination. Dominant hand preference is usually established earlier, but its refinement continues."
        },
        {
            "section": "Safety",
            "type": "sata",
            "questionText": "A nurse is teaching a new parent about safe sleep practices to prevent Sudden Infant Death Syndrome (SIDS). Which recommendations align with current AAP guidelines? (Select all that apply)",
            "options": {
                "A": "Always place the infant to sleep on their back for every sleep.",
                "B": "Use a firm sleep surface, free of soft bedding, pillows, or bumper pads.",
                "C": "Allow the infant to sleep in the parent's bed for the first few months for bonding.",
                "D": "Offer a pacifier at naptime and bedtime once breastfeeding is well-established.",
                "E": "Avoid overheating the infant by dressing them lightly and keeping the room cool."
            },
            "correctAnswer": "A,B,D,E",
            "rationale": "Key AAP SIDS prevention guidelines include supine (back) sleeping, using a firm sleep surface free of soft objects, offering a pacifier (after breastfeeding is established to prevent nipple confusion), and avoiding overheating. Co-sleeping (infant in parent's bed) is strongly discouraged due to increased SIDS risk; room-sharing (infant in own crib in parent's room) is recommended."
        },
        {
            "section": "Growth & Development Principles",
            "questionText": "A neonate typically responds to a painful stimulus with a generalized, whole-body thrashing motion. As the child ages, their response becomes more localized to the site of pain. This progression exemplifies which principle of growth and development?",
            "options": {
                "A": "Cephalocaudal development",
                "B": "Proximodistal development",
                "C": "Differentiation (general to specific)",
                "D": "Sequential development"
            },
            "correctAnswer": "C",
            "rationale": "The principle of differentiation, or general to specific, states that development proceeds from generalized responses to more refined and specific ones. A neonate's global pain response evolving into a localized response in an older child is a classic example of this principle."
        },
        {
            "section": "Dental Health",
            "type": "sata",
            "questionText": "A nurse is educating parents of a 2-year-old about maintaining optimal oral hygiene. Which teaching points are appropriate for this age group? (Select all that apply)",
            "options": {
                "A": "Brushing should be supervised or performed by a parent due to developing fine motor skills.",
                "B": "Flossing is not necessary until all permanent teeth have erupted.",
                "C": "Use a small amount of fluoridated toothpaste, about the size of a grain of rice.",
                "D": "Early loss of primary teeth can impact the alignment of permanent teeth.",
                "E": "Encourage consumption of fruit juice to strengthen tooth enamel."
            },
            "correctAnswer": "A,C,D",
            "rationale": "Parents should supervise or perform brushing due to limited dexterity. A rice-sized amount of fluoridated toothpaste is recommended. Premature loss of primary teeth can lead to malocclusion of permanent teeth. Flossing should begin once two teeth touch. Fruit juice should be limited due to its sugar content and potential for dental caries."
        },
        {
            "section": "Physical Development",
            "questionText": "A parent expresses concern about their 8-year-old boy having noticeably enlarged tonsils, even when he isn't sick. The nurse explains that this finding is often normal during the school-age years because:",
            "options": {
                "A": "His immune system is underdeveloped and constantly fighting infections.",
                "B": "Enlarged tonsils and adenoids are common and often resolve with age.",
                "C": "He is likely experiencing a chronic allergic reaction.",
                "D": "It indicates a need for surgical removal (tonsillectomy)."
            },
            "correctAnswer": "B",
            "rationale": "Enlarged tonsils and adenoids are a common and often normal finding in school-age children due to lymphoid tissue growth. Unless they cause significant issues like recurrent infections, airway obstruction, or sleep apnea, they do not necessarily indicate illness or require intervention."
        },
        {
            "section": "Infant Care",
            "questionText": "A mother is preparing her 2-month-old infant for sleep. The nurse should reinforce which evidence-based recommendation to reduce the risk of Sudden Infant Death Syndrome (SIDS)?",
            "options": {
                "A": "Place the infant on their stomach to prevent aspiration.",
                "B": "Put the infant to sleep in a bassinet in the parents' room.",
                "C": "Bundle the infant snugly in several blankets to keep them warm.",
                "D": "Give the infant a bottle of milk to help them sleep soundly."
            },
            "correctAnswer": "B",
            "rationale": "The AAP strongly recommends that infants sleep in the same room as their parents, but in their own crib or bassinet (room-sharing, not bed-sharing) for at least the first six months, ideally a year. Infants should always be placed on their back to sleep. Over-bundling and bedtime bottles of milk are associated with increased SIDS risk."
        },
        {
            "section": "Play Development",
            "questionText": "A nurse observes a 4-year-old child directing a group of peers in a game of 'hospital,' assigning roles like 'doctor,' 'nurse,' and 'patient.' This type of play is most indicative of:",
            "options": {
                "A": "Solitary play",
                "B": "Parallel play",
                "C": "Cooperative play",
                "D": "Onlooker play"
            },
            "correctAnswer": "C",
            "rationale": "Cooperative play involves organized group activity with a common goal and assigned roles, typically seen in the late preschool and school-age years. The child is leading and interacting with peers to achieve a shared play objective ('hospital')."
        },
        {
            "section": "Toddler Behavior",
            "type": "sata",
            "questionText": "A parent reports that their 2-year-old has frequent temper tantrums. Which nursing interventions should be included in the teaching plan for managing tantrums? (Select all that apply)",
            "options": {
                "A": "Give in to the child's demands during a tantrum to quickly resolve it.",
                "B": "Ensure the child is in a safe environment, then ignore the tantrum.",
                "C": "Implement a 'timeout' strategy, typically one minute per year of age.",
                "D": "Verbally scold the child during the tantrum to teach them it's unacceptable.",
                "E": "Offer comfort and praise *after* the child has regained self-control."
            },
            "correctAnswer": "B,C,E",
            "rationale": "Effective tantrum management includes ensuring safety, ignoring the behavior (extinction), using timeouts (1 minute per year of age), and offering positive reinforcement once the child calms down. Giving in reinforces the tantrum, and scolding during a tantrum can escalate it or be ineffective."
        },
        {
            "section": "Adolescent Development",
            "questionText": "A 16-year-old adolescent tells the school nurse, 'I know I won't get into a car accident; those things only happen to other people.' The nurse recognizes this statement as an example of which adolescent cognitive characteristic?",
            "options": {
                "A": "Abstract thinking",
                "B": "Invincibility fable",
                "C": "Egocentrism",
                "D": "Imaginary audience"
            },
            "correctAnswer": "B",
            "rationale": "The invincibility fable is a cognitive distortion common in adolescents where they believe they are immune to negative consequences, leading to risk-taking behaviors. It's a component of adolescent egocentrism, but 'invincibility fable' specifically describes this feeling of being untouchable."
        },
        {
            "section": "Safety",
            "questionText": "A community health nurse is preparing a presentation on pediatric injury prevention. Which type of injury should the nurse identify as the leading cause of death in children and adolescents across all age groups?",
            "options": {
                "A": "Cancer",
                "B": "Congenital anomalies",
                "C": "Unintentional injury",
                "D": "Homicide"
            },
            "correctAnswer": "C",
            "rationale": "Unintentional injury is consistently the leading cause of death in children and adolescents, encompassing categories like motor vehicle accidents, drowning, burns, and falls. This highlights the critical need for comprehensive injury prevention strategies."
        },
        {
            "section": "Infant Nutrition",
            "questionText": "A parent asks the nurse why it's important to avoid giving honey to an infant younger than 12 months of age. The nurse's response should focus on the risk of:",
            "options": {
                "A": "Childhood obesity",
                "B": "Dental caries",
                "C": "Infant botulism",
                "D": "Food allergies"
            },
            "correctAnswer": "C",
            "rationale": "Honey should not be given to infants under 12 months due to the risk of infant botulism. Honey can contain Clostridium botulinum spores, which can germinate in an infant's immature digestive system and produce toxins, leading to a serious paralytic illness."
        },
        {
            "section": "Vision Health",
            "questionText": "A 9-year-old child's teacher expresses concern to the school nurse that the child frequently squints, complains of headaches after reading, and sits very close to the whiteboard. The nurse identifies these as potential indicators of:",
            "options": {
                "A": "Attention deficit hyperactivity disorder (ADHD)",
                "B": "Auditory processing disorder",
                "C": "Vision impairment",
                "D": "Learning disability"
            },
            "correctAnswer": "C",
            "rationale": "Symptoms like squinting, headaches after visual tasks, and sitting close to visual aids are classic signs of vision impairment (e.g., myopia or astigmatism) in school-age children. Children often don't verbalize 'I can't see' because their vision is all they've known, so behavioral cues are important."
        },
        {
            "section": "Play Development",
            "questionText": "A nurse is conducting a developmental assessment for a 4-year-old. When discussing play, the nurse expects to see the child primarily engaging in what type of play?",
            "options": {
                "A": "Solitary play",
                "B": "Parallel play",
                "C": "Cooperative play",
                "D": "Onlooker play"
            },
            "correctAnswer": "C",
            "rationale": "By 4 years of age, children are typically transitioning from parallel and associative play to cooperative play. This involves organized group activities, shared goals, and often imaginative role-playing, demonstrating increased social skills and interaction."
        },
        {
            "section": "Nutrition",
            "type": "sata",
            "questionText": "A nurse is educating parents about factors contributing to pediatric obesity. Which environmental factors should the nurse discuss as significant influences on a child's weight? (Select all that apply)",
            "options": {
                "A": "Limited access to safe outdoor play areas.",
                "B": "Increased availability and marketing of high-calorie, low-nutrient foods.",
                "C": "Parental genetic predisposition to obesity.",
                "D": "Frequent consumption of sweetened beverages.",
                "E": "Socioeconomic status and parental education level."
            },
            "correctAnswer": "A,B,D,E",
            "rationale": "Environmental factors significantly influencing pediatric obesity include decreased physical activity (limited play areas), easy access to unhealthy foods, high intake of sugary drinks, and socioeconomic factors like poverty and parental education. Parental genetic predisposition (option C) is a genetic factor, not environmental, although it interacts with environmental factors."
        },
        {
            "section": "Sleep Issues",
            "questionText": "A parent calls the clinic distressed, stating their 3-year-old child woke up screaming, appeared terrified, but was unresponsive to comfort and did not seem to recognize them. The child later fell back asleep and has no memory of the event. The nurse suspects the child experienced a:",
            "options": {
                "A": "Nightmare",
                "B": "Sleepwalking episode",
                "C": "Night terror",
                "D": "Seizure"
            },
            "correctAnswer": "C",
            "rationale": "Night terrors are characterized by sudden awakening with screaming, intense fear, unresponsiveness to comfort, and no memory of the event upon waking. They occur during non-REM sleep. Nightmares occur during REM sleep, and the child usually remembers them and can be comforted. Seizures would have different clinical manifestations."
        },
        {
            "section": "Adolescent Development",
            "questionText": "A nurse is educating a parent about the signs of puberty in their adolescent son. The nurse correctly identifies the *first* noticeable physical sign of puberty in boys as:",
            "options": {
                "A": "Development of pubic hair",
                "B": "Voice deepening",
                "C": "Rapid increase in height (growth spurt)",
                "D": "Testicular enlargement"
            },
            "correctAnswer": "D",
            "rationale": "The first physical manifestation of puberty in boys is typically testicular enlargement, followed by pubic hair development, increase in penis size, growth spurt, and voice changes."
        },
        {
            "section": "Environmental Health",
            "type": "sata",
            "questionText": "A community health nurse is assessing a 2-year-old child for potential lead exposure during a home visit. Which findings would indicate an increased risk for lead poisoning? (Select all that apply)",
            "options": {
                "A": "The child lives in a home built in 2005.",
                "B": "There is peeling paint on the windowsills of their pre-1978 home.",
                "C": "A parent works in battery recycling and brings work clothes home.",
                "D": "The child frequently puts non-food items (pica) in their mouth.",
                "E": "The child attends a modern, newly constructed daycare center."
            },
            "correctAnswer": "B,C,D",
            "rationale": "Risk factors for lead exposure include living in older homes (especially pre-1978) with deteriorating lead-based paint, occupational exposure of family members (lead dust brought home), and pica (ingestion of non-food items). Homes built after 1978 are unlikely to contain lead paint, and modern daycare centers pose less risk."
        },
        {
            "section": "Adolescent Health",
            "questionText": "An adolescent involved in high school football sustains a concussion. The school nurse is providing education to the parents. The nurse should emphasize that the American Academy of Pediatrics (AAP) recommends annual physical examinations for adolescents participating in athletics, which should include:",
            "options": {
                "A": "Electrocardiogram (ECG) screening for all athletes.",
                "B": "Nutritional counseling focused on performance-enhancing supplements.",
                "C": "Comprehensive concussion screening and education.",
                "D": "Screening for illicit drug use only if suspected."
            },
            "correctAnswer": "C",
            "rationale": "The AAP emphasizes yearly physical examinations for adolescent athletes, with a strong focus on comprehensive concussion screening and education due to the risks associated with sports-related head injuries. ECG screening is not universal, nutritional counseling should promote healthy eating, and drug screening typically requires specific indications."
        },
        {
            "section": "Hearing Health",
            "questionText": "A 4-month-old infant fails their routine hearing screening. The parent asks the nurse what the immediate next step should be. The nurse should advise that the infant needs to:",
            "options": {
                "A": "Be referred for a full audiological evaluation by 12 months of age.",
                "B": "Have a repeat hearing screening within one month.",
                "C": "Begin speech therapy to compensate for potential hearing loss.",
                "D": "Be observed at home for signs of hearing and language development."
            },
            "correctAnswer": "B",
            "rationale": "According to AAP guidelines, if an infant fails an initial hearing screening, a repeat screening should be performed within 1 month. Early identification and intervention for hearing loss are crucial for optimal language development."
        },
        {
            "section": "Dental Health",
            "questionText": "A nurse is providing teaching to parents of a 10-month-old infant to prevent 'baby bottle tooth decay' (early childhood caries). Which of the following is the most effective recommendation?",
            "options": {
                "A": "Allow the infant to fall asleep with a bottle containing only formula or breast milk.",
                "B": "Substitute juice for milk in the bedtime bottle to reduce sugar content.",
                "C": "Ensure the infant always goes to bed with a bottle of plain water, if a bottle is necessary.",
                "D": "Apply topical fluoride treatments to the infant's gums daily."
            },
            "correctAnswer": "C",
            "rationale": "To prevent early childhood caries, infants should not be allowed to fall asleep with a bottle containing milk, formula, juice, or any other sugary liquid, as this bathes the teeth in carbohydrates. If a bedtime bottle is absolutely necessary, it should contain only plain water."
        },
        {
            "section": "Language Development",
            "questionText": "A parent is concerned that their 13-month-old, who recently started walking independently, has reduced their babbling and use of verbal sounds. The nurse explains that this temporary decrease in vocalization is a normal developmental phenomenon often observed when infants:",
            "options": {
                "A": "Are experiencing increased stranger anxiety.",
                "B": "Are focusing intensively on mastering a new gross motor skill.",
                "C": "Have a sudden increase in cognitive processing demands.",
                "D": "Are exposed to multiple languages simultaneously."
            },
            "correctAnswer": "B",
            "rationale": "It is a normal developmental pattern for infants and toddlers to temporarily decrease their focus on one area of development (like vocalization) when they are intensely concentrating on mastering a significant new skill in another area, such as a major gross motor milestone like walking. Resources are temporarily diverted."
        },
        {
            "section": "Immunology",
            "questionText": "A nurse is discussing different types of immunity with a patient. The nurse explains that active immunity is best characterized by:",
            "options": {
                "A": "Short-term protection acquired through maternal antibodies or antitoxins.",
                "B": "Immediate protection obtained from pre-formed antibodies.",
                "C": "Long-lasting protection developed by the body's immune response to an antigen.",
                "D": "Immunity conferred by receiving a live attenuated vaccine."
            },
            "correctAnswer": "C",
            "rationale": "Active immunity occurs when an individual's own immune system produces antibodies in response to exposure to an antigen (either through natural infection or vaccination). This process leads to memory cells and typically provides long-term protection. Options A and B describe passive immunity. While live attenuated vaccines *induce* active immunity, option C is the best *characterization* of active immunity itself."
        },
        {
            "section": "Safety",
            "questionText": "An 8-year-old child is hit by a car while riding their bicycle near home. The child states, 'I thought the driver saw me because I saw their car.' The nurse identifies this cognitive distortion as a common factor in pedestrian accidents for school-age children, known as:",
            "options": {
                "A": "Egocentric reasoning",
                "B": "Invincibility fable",
                "C": "Magical thinking",
                "D": "Lack of stranger awareness"
            },
            "correctAnswer": "A",
            "rationale": "School-age children often exhibit egocentric reasoning, where they assume that if they can see something (like a car), then others (like the driver) must also be able to see them. This misconception contributes to their vulnerability in pedestrian situations. The invincibility fable is more common in adolescents, and magical thinking is characteristic of preschoolers."
        },
        {
            "section": "Growth & Development",
            "questionText": "A parent expresses awe at their infant's rapid development during the first year of life. The nurse explains that the infant's brain undergoes significant growth, doubling its weight by approximately what age?",
            "options": {
                "A": "6 months",
                "B": "9 months",
                "C": "1 year",
                "D": "2 years"
            },
            "correctAnswer": "C",
            "rationale": "The infant's brain grows rapidly, doubling in weight by approximately 1 year of age. This period of rapid brain development underscores the importance of adequate nutrition and stimulating environments during infancy."
        },
        {
            "section": "Infant Care",
            "questionText": "Immediately after an uncomplicated vaginal birth, the nurse places the newborn skin-to-skin on the mother's chest. The primary purpose of this immediate intervention, according to the American Academy of Pediatrics (AAP) and SIDS prevention guidelines, is to:",
            "options": {
                "A": "Initiate immediate weight gain in the newborn.",
                "B": "Promote early paternal-infant bonding.",
                "C": "Stabilize newborn temperature and promote breastfeeding.",
                "D": "Provide passive immunity from the mother."
            },
            "correctAnswer": "C",
            "rationale": "Immediate skin-to-skin contact (SSC) is a powerful intervention that helps stabilize the newborn's temperature, regulates breathing and heart rate, and promotes early initiation of breastfeeding. While it also aids bonding, temperature regulation and breastfeeding promotion are primary physiological benefits and a key SIDS prevention strategy postpartum."
        },
        {
            "section": "Nutrition",
            "questionText": "A nurse is providing dietary guidance for the parents of a healthy 2-year-old toddler. Regarding milk consumption, the nurse should recommend that the child consume approximately:",
            "options": {
                "A": "1 cup per day of whole milk to ensure adequate fat intake.",
                "B": "2-3 cups of whole milk daily for calcium and vitamin D.",
                "C": "4-5 cups of skim milk daily to prevent childhood obesity.",
                "D": "No more than 4 oz of juice and water, with no milk, to avoid iron deficiency."
            },
            "correctAnswer": "B",
            "rationale": "For toddlers, 2-3 cups of whole milk daily is generally recommended to provide sufficient calcium, vitamin D, and essential fats for brain development. Excessive milk intake can displace other nutrient-rich foods or contribute to iron deficiency if given in very large quantities (e.g., >24 oz/day), but 2-3 cups is appropriate. Skim milk is not recommended for toddlers unless specifically indicated by a healthcare provider."
        },
        {
            "section": "Developmental Screening",
            "questionText": "A 1-month-old infant is brought to the clinic for a well-child visit. The nurse performs a developmental screening and notes that the infant does not respond to loud noises, has a weak suck, and does not demonstrate a social smile. Which of these findings would be considered a 'red flag' for potential developmental delay at this age?",
            "options": {
                "A": "Weak suck reflex",
                "B": "Lack of response to loud noises",
                "C": "Absence of a social smile",
                "D": "All of the above"
            },
            "correctAnswer": "C",
            "rationale": "While a weak suck and lack of response to loud noises can be concerning, the absence of a social smile (typically developing by 3-5 weeks, definitely by 8-12 weeks) is a significant 'red flag' for social-emotional developmental delay in a 1-month-old infant, warranting further investigation. A 1-month-old typically startles to loud noises, and suck reflex should be strong."
        },
        {
            "section": "Play Development",
            "questionText": "A child development specialist is explaining the significance of play to a group of parents. The specialist correctly identifies that the primary function of play in a child's development is that it:",
            "options": {
                "A": "Serves mainly as a way to expend excess physical energy.",
                "B": "Is primarily for entertainment and has little educational value.",
                "C": "Is essential for fostering cognitive, emotional, social, and physical growth and learning.",
                "D": "Becomes less important as children enter school-age and focus on academics."
            },
            "correctAnswer": "C",
            "rationale": "Play is fundamental to child development across all domains. It is how children explore, learn problem-solving, develop social skills, express emotions, and refine motor skills. It is not merely for entertainment or energy expenditure and remains crucial throughout childhood, even alongside academics."
        },
        {
            "section": "Safety",
            "type": "sata",
            "questionText": "A nurse is reinforcing car seat safety with the parents of a 15-month-old toddler. Which guidelines should the nurse emphasize based on current recommendations? (Select all that apply)",
            "options": {
                "A": "The child should remain in a rear-facing car seat for as long as possible.",
                "B": "Children under 13 years of age should always ride in the back seat.",
                "C": "A forward-facing car seat with a harness can be used once the child exceeds rear-facing height/weight limits.",
                "D": "Booster seats are appropriate for toddlers who have outgrown their convertible car seat.",
                "E": "It's safe for the child to sit on a parent's lap in the car for short trips."
            },
            "correctAnswer": "A,B,C",
            "rationale": "Children should remain rear-facing for as long as possible (to the maximum height/weight limit of the seat). Children under 13 should always be in the back seat. Forward-facing seats are appropriate after outgrowing rear-facing limits. Booster seats are for older children who have outgrown a forward-facing harness seat (typically around 4-8 years old), not toddlers. Lap-sitting in a moving vehicle is never safe."
        },
        {
            "section": "Cognitive Development",
            "questionText": "A 3-year-old child insists that her doll is hungry and needs to be fed. The child is demonstrating which cognitive characteristic common in the preschool stage?",
            "options": {
                "A": "Egocentrism",
                "B": "Animism",
                "C": "Irreversibility",
                "D": "Centration"
            },
            "correctAnswer": "B",
            "rationale": "Animism is the attribution of lifelike qualities (feelings, intentions) to inanimate objects. The child believing her doll is hungry is a classic example of animistic thinking in the preoperational stage."
        },
        {
            "section": "Toddler Behavior",
            "questionText": "The parents of an 18-month-old are struggling with their child's strong preference for specific routines and becoming very upset if rituals are not followed (e.g., bedtime story order). The nurse explains that these rituals are important to the toddler because they provide a sense of:",
            "options": {
                "A": "Independence",
                "B": "Security and control",
                "C": "Creativity",
                "D": "Social interaction"
            },
            "correctAnswer": "B",
            "rationale": "Ritualism is very important to toddlers as it provides a sense of predictability, security, and control in a rapidly changing world where they are constantly developing new skills and experiencing new things. Consistent routines help them feel safe and master their environment."
        },
        {
            "section": "Adolescent Development",
            "questionText": "A nurse is teaching parents about the stages of sexual maturation in girls. The nurse correctly states that the onset of menstruation (menarche) typically occurs *after* which key developmental event?",
            "options": {
                "A": "Breast budding (thelarche)",
                "B": "Appearance of pubic hair (pubarche)",
                "C": "Peak height velocity (PHV)",
                "D": "Completion of all secondary sexual characteristics"
            },
            "correctAnswer": "C",
            "rationale": "In girls, menarche (onset of menstruation) typically occurs *after* the peak height velocity (PHV), meaning girls achieve most of their adult height before starting their menstrual periods. Thelarche (breast budding) and pubarche (pubic hair) usually precede menarche."
        },
        {
            "section": "Infant Nutrition",
            "type": "sata",
            "questionText": "A nurse is providing anticipatory guidance to parents regarding foods that pose a choking risk for a 9-month-old infant. Which food items should the nurse specifically instruct the parents to avoid? (Select all that apply)",
            "options": {
                "A": "Finely mashed avocado",
                "B": "Small, hard candies",
                "C": "Whole grapes",
                "D": "Pieces of hot dog",
                "E": "Soft-cooked, cut-up chicken"
            },
            "correctAnswer": "B,C,D",
            "rationale": "Foods that are round, coin-shaped, or have a sticky/tough texture are significant choking hazards for infants and toddlers. This includes small, hard candies; whole grapes; hot dogs (even sliced into rounds); nuts; and large chunks of meat or cheese. Finely mashed avocado and soft-cooked, cut-up chicken are generally safer when prepared appropriately."
        },
        {
            "section": "Adolescent Development",
            "questionText": "A 14-year-old adolescent frequently seeks validation from friends regarding clothing choices and spends a significant amount of time communicating with peers online. The nurse recognizes this increased reliance on the peer group as a critical component of the adolescent developmental task of:",
            "options": {
                "A": "Initiative versus guilt",
                "B": "Industry versus inferiority",
                "C": "Identity versus role confusion",
                "D": "Intimacy versus isolation"
            },
            "correctAnswer": "C",
            "rationale": "Adolescence is Erikson's stage of Identity versus Role Confusion. During this stage, adolescents explore their sense of self, values, and roles, often relying heavily on peer feedback and group affiliation to define who they are and where they fit in outside the family unit."
        },
        {
            "section": "Growth & Development Principles",
            "questionText": "The nurse is explaining to parents that their infant's ability to grasp objects with their whole hand (palmar grasp) develops before they can pick up small items with their thumb and forefinger (pincer grasp). This sequence illustrates which pattern of growth and development?",
            "options": {
                "A": "Cephalocaudal",
                "B": "General to specific",
                "C": "Proximodistal",
                "D": "Mass to specific"
            },
            "correctAnswer": "C",
            "rationale": "Proximodistal development refers to development progressing from the center of the body outwards. In motor skills, this means control of the shoulders and upper arms develops before control of the hands and fingers. The palmar grasp uses the whole hand (more proximal), while the pincer grasp uses the fingers (more distal), illustrating this pattern."
        },
        {
            "section": "Toddler Behavior",
            "questionText": "A hospitalized 2-year-old child cries loudly and becomes visibly distressed if the nursing staff deviate even slightly from his established bedtime routine. The nurse understands that adhering to the child's usual routines is crucial for this age group primarily because it helps to reduce:",
            "options": {
                "A": "Stranger anxiety",
                "B": "Separation anxiety",
                "C": "Feelings of insecurity and loss of control",
                "D": "The likelihood of regression"
            },
            "correctAnswer": "C",
            "rationale": "Toddlers thrive on routines and rituals because they provide a sense of predictability, security, and control in their environment. Deviations from these routines can lead to significant distress, as it challenges their developing autonomy and sense of mastery. While it may indirectly affect other anxieties, the primary impact is on their feeling of security."
        },
        {
            "section": "Cognitive & Language Development",
            "type": "sata",
            "questionText": "A nurse is conducting a developmental interview with the parent of a 4-year-old child. To best assess the child's cognitive and language development, which questions would be most pertinent? (Select all that apply)",
            "options": {
                "A": "How many words can your child say clearly?",
                "B": "Can your child hop on one foot or throw a ball overhand?",
                "C": "Does your child understand concepts like 'yesterday' and 'tomorrow'?",
                "D": "Does your child enjoy imaginative play and make-believe scenarios?",
                "E": "Can your child identify primary colors and count to ten?"
            },
            "correctAnswer": "A,C,D,E",
            "rationale": "Assessing vocabulary (A), understanding of time concepts (C), engagement in imaginative play (D - linked to symbolic thought), and knowledge of colors/counting (E) are all direct indicators of cognitive and language development in a 4-year-old. Gross motor skills like hopping or throwing (B) assess physical development, not primarily cognitive/language."
        },
        {
            "section": "Moral Development",
            "questionText": "A nurse is discussing moral development with parents. The nurse explains that a child who refrains from stealing a toy because they fear being punished by a parent is demonstrating behavior consistent with Kohlberg's concept of:",
            "options": {
                "A": "Conventional morality, Stage 3 (Good boy/Good girl orientation)",
                "B": "Preconventional morality, Stage 1 (Obedience and Punishment orientation)",
                "C": "Postconventional morality, Stage 5 (Social contract orientation)",
                "D": "Conventional morality, Stage 4 (Law and order orientation)"
            },
            "correctAnswer": "B",
            "rationale": "In Kohlberg's Preconventional Level, Stage 1 (Obedience and Punishment Orientation), moral decisions are based on avoiding punishment from authority figures. The child's motivation to avoid stealing stems directly from the fear of parental punishment, which aligns perfectly with this stage."
        },
        {
            "section": "Nutrition",
            "questionText": "A nurse is providing dietary counseling for a teenager. The nurse explains that the most efficient and primary source of energy needed to fuel daily activities and maintain body functions is:",
            "options": {
                "A": "Proteins",
                "B": "Fats",
                "C": "Vitamins",
                "D": "Carbohydrates"
            },
            "correctAnswer": "D",
            "rationale": "Carbohydrates are the body's primary and most readily available source of energy. While proteins and fats also provide energy, carbohydrates are preferentially used for immediate fuel and metabolic processes, especially for brain function and physical activity."
        },
        {
            "section": "Dental Health",
            "questionText": "According to current guidelines, what is the recommended daily dose of oral fluoride supplementation for a 7-year-old child who lives in an area without fluoridated water and drinks only bottled water?",
            "options": {
                "A": "0.25 mg",
                "B": "0.5 mg",
                "C": "1.0 mg",
                "D": "2.0 mg"
            },
            "correctAnswer": "C",
            "rationale": "For children aged 6 to 16 years who do not have access to fluoridated water, the recommended daily dose of oral fluoride supplementation is 1.0 mg. This helps prevent dental caries in children with insufficient fluoride intake."
        },
        {
            "section": "Moral Development",
            "questionText": "A 10-year-old child tells the nurse, 'It's wrong to cheat on a test because it's not fair to others who studied, and it's against the school rules.' This statement demonstrates the development of:",
            "options": {
                "A": "Magical thinking",
                "B": "Preconventional morality",
                "C": "An external locus of control",
                "D": "An internal locus of control and conscience"
            },
            "correctAnswer": "D",
            "rationale": "The child's reasoning, based on fairness and adherence to rules (beyond just fear of punishment), indicates the development of an internal locus of control and an emerging conscience. This aligns with later stages of moral development where individuals begin to internalize societal rules and a sense of justice, rather than simply external consequences."
        },
        {
            "section": "Immunization",
            "type": "sata",
            "questionText": "A nurse is reviewing the immunization schedule for a 12-month-old infant. Which of the following vaccines are typically due at or after 12 months of age? (Select all that apply)",
            "options": {
                "A": "Hepatitis B (HepB) #3",
                "B": "Measles-mumps-rubella (MMR) #1",
                "C": "Varicella (chickenpox) #1",
                "D": "Hepatitis A (HepA) #1",
                "E": "Diphtheria-tetanus-acellular pertussis (DTaP) #4"
            },
            "correctAnswer": "B,C,D",
            "rationale": "At 12-15 months, the first doses of MMR, Varicella, and Hepatitis A are typically administered. HepB #3 is usually given at 6-18 months (so it *could* be at 12m, but the first dose is at birth). DTaP #4 is usually at 15-18 months. Therefore, MMR, Varicella, and HepA are the most definitive *first* doses at 12m."
        },
        {
            "section": "Physical Development",
            "questionText": "A school nurse is explaining the physiological changes during the school-age years to a group of parents. The nurse correctly states that the maturation of the cardiovascular system during this period allows for more sustained physical activity due to:",
            "options": {
                "A": "An increased heart rate and decreased blood pressure.",
                "B": "The heart doubling in size and weight.",
                "C": "A decreased heart rate and increased blood pressure as the heart grows.",
                "D": "Faster circulation and reduced oxygen carrying capacity."
            },
            "correctAnswer": "C",
            "rationale": "During the school-age years, the cardiovascular system matures, leading to a decreased heart rate and an increased blood pressure as the heart grows larger and more efficient. This allows for greater cardiac output with each beat, supporting more sustained and strenuous physical activity. The heart does not double in size and weight specifically at this stage, and option D describes detrimental changes."
        },
        {
            "section": "Toddler Behavior",
            "questionText": "A 3-year-old child becomes extremely anxious and refuses to go to sleep unless her teddy bear is placed in a very specific position on her bed, and her parent reads the same two stories in the exact same order every night. The nurse explains that this adherence to rituals is a normal developmental need that provides the child with:",
            "options": {
                "A": "An outlet for negativism and defiance.",
                "B": "A means to develop imaginative play skills.",
                "C": "A sense of control and security in her world.",
                "D": "Evidence of developing concrete operational thought."
            },
            "correctAnswer": "C",
            "rationale": "Rituals and routines are profoundly important for preschoolers and toddlers. They provide a predictable structure that helps the child cope with the constant changes and new experiences of development, giving them a vital sense of control and security. While imaginative play is important, rituals primarily serve the need for predictability."
        },
        {
            "section": "Infant Nutrition",
            "questionText": "A nurse is providing anticipatory guidance to parents introducing solid foods to their 6-month-old infant. The nurse should advise against which feeding practice due to potential negative impacts on oral motor development and eating habits?",
            "options": {
                "A": "Feeding pureed foods from a spoon.",
                "B": "Introducing one new food at a time, every 3-5 days.",
                "C": "Giving pureed foods through a pouch that the infant sucks from a spout.",
                "D": "Mixing pureed vegetables with a small amount of breast milk or formula."
            },
            "correctAnswer": "C",
            "rationale": "Giving pureed foods through pouches where infants suck from a spout is discouraged because it bypasses the development of important oral motor skills needed for spoon-feeding, chewing, and managing different food textures. It can also lead to overconsumption and less awareness of satiety. Spoon-feeding, gradual introduction of foods, and mixing with milk are appropriate practices."
        },
        {
            "section": "Dental Health",
            "questionText": "A nurse is counseling the parents of a 4-year-old child who still uses a pacifier regularly, especially at night. The nurse should explain that prolonged pacifier use beyond age 3 can contribute to the development of which dental condition?",
            "options": {
                "A": "Early childhood caries (ECC)",
                "B": "Gingivitis",
                "C": "Malocclusion",
                "D": "Dental erosion"
            },
            "correctAnswer": "C",
            "rationale": "Prolonged pacifier use (and thumb-sucking) beyond age 3 can lead to malocclusion, which refers to improper alignment of teeth and jaws. This can include an open bite, posterior crossbite, or increased overjet. ECC is related to sugary liquid exposure, and gingivitis to hygiene. Dental erosion is from acid exposure."
        }
    ];

    let finalQuizData = [];
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let confidenceRatings = {};
    let flaggedForReview = new Set();
    const NUM_QUESTIONS_TO_SELECT = 30; // Number of questions to be selected for the quiz

    const initialScreen = document.getElementById('initial-screen');
    const startBtn = document.getElementById('start-btn');
    const quizForm = document.getElementById('quiz-form');
    const resultsArea = document.getElementById('results-area');
    const messageBoxOverlay = document.getElementById('message-box-overlay');
    const messageBoxTitle = document.getElementById('message-box-title');
    const messageBoxText = document.getElementById('message-box-text');
    const messageBoxOkBtn = document.getElementById('message-box-ok-btn');

    /**
     * Displays a custom message box.
     * @param {string} title - The title of the message box.
     * @param {string} message - The message content.
     */
    function showMessageBox(title, message) {
        messageBoxTitle.textContent = title;
        messageBoxText.textContent = message;
        messageBoxOverlay.classList.remove('hidden');
    }

    /**
     * Hides the custom message box.
     */
    function hideMessageBox() {
        messageBoxOverlay.classList.add('hidden');
    }

    /**
     * Prepares the quiz data by shuffling and selecting a subset of questions.
     */
    function prepareQuizData() {
        const shuffledPool = [...fullQuizData].sort(() => 0.5 - Math.random());
        const questionsNeeded = Math.min(NUM_QUESTIONS_TO_SELECT, shuffledPool.length);
        finalQuizData = shuffledPool.slice(0, questionsNeeded);
    }

    /**
     * Initializes and starts the quiz.
     */
    function prepareAndStartQuiz() {
        prepareQuizData();
        if (finalQuizData.length === 0) {
            showMessageBox("Error", "No questions loaded. Please check the quiz data.");
            return;
        }
        initialScreen.classList.add('hidden');
        quizForm.classList.remove('hidden');
        displayCurrentQuestion();
    }

    /**
     * Displays the current question on the quiz form.
     */
    function displayCurrentQuestion() {
        if (currentQuestionIndex >= finalQuizData.length) return; // Should not happen if logic is correct
        const qData = finalQuizData[currentQuestionIndex];
        
        let optionsHTML = '<div class="options-container">';
        const inputType = qData.type === 'sata' ? 'checkbox' : 'radio';
        const currentAnswer = userAnswers[currentQuestionIndex];

        for (const [key, text] of Object.entries(qData.options)) {
            let checked = '';
            if (qData.type === 'sata' && Array.isArray(currentAnswer) && currentAnswer.includes(key)) {
                checked = 'checked';
            } else if (qData.type !== 'sata' && currentAnswer === key) {
                checked = 'checked';
            }
            optionsHTML += `<label><input type="${inputType}" name="answer" value="${key}" ${checked}> ${text}</label>`;
        }
        optionsHTML += '</div>';

        const isFlagged = flaggedForReview.has(currentQuestionIndex) ? 'checked' : '';
        const currentConfidence = confidenceRatings[currentQuestionIndex] || 3; // Default to 3

        quizForm.innerHTML = `
            <div class="question-header">
                Question <strong>${currentQuestionIndex + 1}</strong> of ${finalQuizData.length}
            </div>
            <p class="question-text">${qData.questionText}</p>
            ${optionsHTML}
            <div class="question-footer">
                <div class="flag-container">
                    <label><input type="checkbox" class="flag-for-review" ${isFlagged}> Flag for Review</label>
                </div>
                <div class="confidence-slider-container">
                    <label>Confidence:</label>
                    <input type="range" min="1" max="5" value="${currentConfidence}" class="confidence-slider">
                </div>
                <button type="submit" id="navigation-btn">${(currentQuestionIndex === finalQuizData.length - 1) ? "Submit Exam" : "Next Question"}</button>
            </div>
        `;
    }
    
    /**
     * Saves the user's answer, flag status, and confidence rating for the current question.
     */
    function saveAnswer() {
        const qData = finalQuizData[currentQuestionIndex];
        if (!qData) return; // Guard against undefined question data

        const selectedOptions = quizForm.querySelectorAll('input[name="answer"]:checked');
        if (qData.type === 'sata') {
            userAnswers[currentQuestionIndex] = Array.from(selectedOptions).map(cb => cb.value);
        } else {
            userAnswers[currentQuestionIndex] = selectedOptions.length ? selectedOptions[0].value : null;
        }

        const flagInput = quizForm.querySelector('.flag-for-review');
        if(flagInput && flagInput.checked) {
            flaggedForReview.add(currentQuestionIndex);
        } else {
            flaggedForReview.delete(currentQuestionIndex); // Remove if unchecked
        }

        const confidenceInput = quizForm.querySelector('.confidence-slider');
        if(confidenceInput) {
            confidenceRatings[currentQuestionIndex] = parseInt(confidenceInput.value, 10);
        }
    }
    
    /**
     * Handles navigation between questions or quiz submission.
     */
    function handleNavigation() {
        saveAnswer(); // Save the answer before moving on

        quizForm.classList.add('is-transitioning'); // Start transition animation
        
        setTimeout(() => {
            if (currentQuestionIndex < finalQuizData.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion(); // Display next question
                quizForm.classList.remove('is-transitioning'); // End transition
            } else {
                submitQuiz(); // All questions answered, submit quiz
            }
        }, 300); // Duration of the transition
    }

    /**
     * Hides the quiz form and displays the results area.
     */
    function submitQuiz() {
        quizForm.classList.add('hidden');
        resultsArea.classList.remove('hidden');
        displayResults();
    }
    
    /**
     * Checks if a user's answer is correct for a given question.
     * @param {object} qData - The question data.
     * @param {any} userAnswer - The user's selected answer(s).
     * @returns {boolean} - True if the answer is correct, false otherwise.
     */
    function checkAnswerCorrectness(qData, userAnswer) {
        if (userAnswer === null || userAnswer === undefined) return false;
        if (qData.type === 'sata') {
            if (!Array.isArray(userAnswer) || typeof qData.correctAnswer !== 'string') return false;
            // Split correct answer string into an array, sort both for comparison
            const sortedUser = [...userAnswer].sort();
            const sortedCorrect = [...(qData.correctAnswer.split(','))].sort();
            return JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect);
        }
        return userAnswer === qData.correctAnswer;
    }

    /**
     * Displays the overall quiz results, including score, confidence analysis,
     * study focus, and detailed question review.
     */
    function displayResults() {
        let correctCount = 0;
        finalQuizData.forEach((q, i) => {
            if (checkAnswerCorrectness(q, userAnswers[i])) {
                correctCount++;
            }
        });
        const score = finalQuizData.length > 0 ? (correctCount / finalQuizData.length) * 100 : 0;

        let resultsHTML = `
            <div class="results-summary">
                <h2>Exam Complete!</h2>
                <div class="score-animation-container">
                    <div class="score-animation-circle"></div>
                    <div class="score-animation-inner">
                        <span class="score-animation-text">${score.toFixed(0)}%</span>
                    </div>
                </div>
                <p>You answered <strong>${correctCount}</strong> out of <strong>${finalQuizData.length}</strong> questions correctly.</p>
            </div>
        `;
        
        resultsArea.innerHTML = resultsHTML; // Set initial summary
        resultsArea.innerHTML += generateConfidenceAnalysis();
        resultsArea.innerHTML += generateStudyFocus();
        resultsArea.innerHTML += generateDetailedReview();

        // Animate score circle after content is rendered
        setTimeout(() => {
            const scoreCircle = document.querySelector('.score-animation-circle');
            if (scoreCircle) {
                scoreCircle.style.background = `conic-gradient(var(--success-green) ${score}%, var(--border-light) ${score}% 100%)`;
            }
        }, 100);

        // Trigger confetti for high scores
        if (score >= 80) {
            triggerConfetti();
        }
    }

    /**
     * Generates the HTML for the detailed question review section.
     * @returns {string} - HTML string for detailed review.
     */
    function generateDetailedReview() {
        let detailsHTML = '<div id="results-details"><h2>Question Review</h2>';
        finalQuizData.forEach((qData, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = checkAnswerCorrectness(qData, userAnswer);
            
            let resultBodyHTML = '<ul>';
            for (const [key, text] of Object.entries(qData.options)) {
                let li_class = '';
                const isCorrectOpt = qData.type === 'sata' ? qData.correctAnswer.includes(key) : key === qData.correctAnswer;
                const isUserSelect = Array.isArray(userAnswer) ? userAnswer.includes(key) : key === userAnswer;

                if (isCorrectOpt) {
                    li_class = 'correct-answer-label';
                }
                if (isUserSelect && !isCorrectOpt) {
                    li_class = 'incorrect-answer-label';
                }
                // If user did not select the correct option, and it was a single choice or part of a missed SATA
                if (!isUserSelect && isCorrectOpt && !isCorrect) {
                     li_class = 'missed-correct-answer-label';
                }
                resultBodyHTML += `<li class="${li_class}">${text}</li>`;
            }
            resultBodyHTML += '</ul>';

            detailsHTML += `
                <div class="result-question">
                    <p><strong>Question ${index + 1}: ${qData.questionText}</strong></p>
                    ${resultBodyHTML}
                    <div class="rationale"><strong>Rationale:</strong> ${qData.rationale || 'N/A'}</div>
                </div>`;
        });
        detailsHTML += '</div>';
        return detailsHTML;
    }
    
    /**
     * Generates the HTML for the confidence analysis section.
     * @returns {string} - HTML string for confidence analysis.
     */
    function generateConfidenceAnalysis() {
        let correctAndConfident = 0, correctButUnsure = 0, incorrectAndConfident = 0, incorrectButUnsure = 0;
        finalQuizData.forEach((qData, index) => {
            const isCorrect = checkAnswerCorrectness(qData, userAnswers[index]);
            const confidence = confidenceRatings[index] || 3; // Default confidence to 3 if not set

            if (confidence >= 4) { // Confident: 4 or 5
                if (isCorrect) correctAndConfident++;
                else incorrectAndConfident++;
            } else { // Unsure: 1, 2, or 3
                if (isCorrect) correctButUnsure++;
                else incorrectButUnsure++;
            }
        });
        return `
            <div id="confidence-analysis">
                <h3>Confidence Analysis</h3>
                <ul>
                    <li>Correct & Confident: <strong>${correctAndConfident}</strong></li>
                    <li>Correct but Unsure: <strong>${correctButUnsure}</strong></li>
                    <li>Incorrect & Confident: <strong>${incorrectAndConfident}</strong></li>
                    <li>Incorrect but Unsure: <strong>${incorrectButUnsure}</strong></li>
                </ul>
            </div>`;
    }

    /**
     * Generates the HTML for the personalized study focus section based on missed questions.
     * @returns {string} - HTML string for study focus.
     */
    function generateStudyFocus() {
        const topicCounts = {};
        finalQuizData.forEach((qData, index) => {
            if (!checkAnswerCorrectness(qData, userAnswers[index])) {
                // Use the 'section' property from question data for categorization
                const topic = qData.section || "General";
                topicCounts[topic] = (topicCounts[topic] || 0) + 1;
            }
        });
        const sortedTopics = Object.entries(topicCounts).sort((a, b) => b[1] - a[1]);
        let focusHTML = '<div id="study-focus"><h3>Personalized Study Focus</h3>';
        if (sortedTopics.length > 0) {
            focusHTML += '<p>Based on your performance, focus your review on these topics:</p><ul>';
            sortedTopics.forEach(topic => { focusHTML += `<li><strong>${topic[0]}</strong> (${topic[1]} item${topic[1] > 1 ? 's' : ''} missed)</li>`; });
            focusHTML += '</ul>';
        } else {
            focusHTML += '<p>Excellent work! No specific weak areas were identified.</p>';
        }
        focusHTML += '</div>';
        return focusHTML;
    }

    /**
     * Triggers a confetti animation for celebratory feedback.
     */
    function triggerConfetti() {
        const numConfetti = 150;
        for (let i = 0; i < numConfetti; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDelay = Math.random() * 3 + 's';
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 90%, 60%)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 6000); // Remove confetti after animation
        }
    }

    // Event Listeners
    startBtn.addEventListener('click', prepareAndStartQuiz);
    quizForm.addEventListener('submit', e => { 
        e.preventDefault(); // Prevent default form submission
        handleNavigation(); 
    });
    messageBoxOkBtn.addEventListener('click', hideMessageBox);
</script>

</body>
</html>
