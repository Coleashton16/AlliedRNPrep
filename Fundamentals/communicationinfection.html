<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asepsis and Infection Control Module</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration to use the Inter font.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out forwards',
                    },
                },
            },
        };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Library Setup ---
        // Destructure necessary hooks from the global React object.
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Mock Authentication Setup for Standalone Demo ---
        // This mock object simulates basic user authentication to allow progress tracking via localStorage.
        // In a real application, this would be replaced with actual Firebase authentication.
        const mockAuth = {
            onAuthStateChanged: (callback) => {
                // Simulate an asynchronous authentication check, providing a unique user ID.
                setTimeout(() => callback({ uid: 'standalone-infection-user' }), 100);
                return () => {}; // Returns an empty function as a cleanup/unsubscribe placeholder.
            },
            signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-infection-user' } }), // Mock anonymous sign-in.
        };

        // --- Content & Data Structure for the Learning Modules ---
        // The main content is broken down into smaller, focused modules based on concepts.
        const contentData = {
            'body-defense-system': {
                title: 'Body\'s Defense System',
                color: 'from-blue-500 to-indigo-600',
                description: 'Summarize the body’s defense system against infection.',
                learningOutcome: 'LO 26.1',
                steps: [
                    { id: 'defense-intro', title: 'Introduction to Asepsis & Infection', type: 'text', content: `Nurses are responsible for understanding their role in preventing the transmission of infectious agents. <strong>Infection control practices</strong> are essential for providing a safe health care environment for patients and the health care team who care for them. During the past several years, the number of <strong>health care–associated infections (HAIs)</strong> has increased significantly, endangering everyone in the health care environment. This chapter explores the basic aseptic technique and infection control measures necessary to protect patients and the community from the spread of potentially harmful microorganisms.<br><br>
                    <strong>Asepsis</strong> refers to freedom from and prevention of disease-causing contamination. An <strong>infection</strong> is the establishment of a pathogen in a susceptible host; a disease state is caused by the infectious agent. Many microorganisms are contagious and can cause serious illness. Although nurses cannot be familiar with every microorganism, they should be aware of how to prevent the spread of infection through aseptic interventions.<br><br>
                    The body has many defenses against microorganisms that can cause illness. The three main defenses are <strong>normal flora</strong>, the <strong>inflammatory response</strong>, and the <strong>immune response</strong>.` },
                    { id: 'normal-flora', title: 'Normal Flora: First Line of Defense', type: 'text', content: `<strong>Normal flora</strong> is a group of microorganisms (e.g., bacteria, fungi, protozoa) that live in or on the body but do not cause disease. These benign microorganisms are found in and on the skin, eyes, nose, mouth, upper throat, lower urethra, small intestine, and large intestine. The normal flora constitutes the body’s first line of defense against infection because it inhibits pathogenic microorganisms from colonizing healthy individuals (Huether, McCance, & Brasher, 2020).` },
                    { id: 'inflammatory-response', title: 'Inflammatory Response: Second Line of Defense', type: 'text', content: `The second line of defense is the <strong>inflammatory response</strong>. <strong>Inflammation</strong> is a local response to cellular injury or infection that includes capillary dilation and leukocyte infiltration. This response produces redness, heat, pain, and swelling. The leukocytes release a chemical that increases the temperature in the area. The dilation, infiltration, and increase in temperature are protective mechanisms that help the body neutralize, control, and eliminate invading pathogens, preventing them from surviving and multiplying. If inflammation becomes systemic, signs include fever (caused by prostaglandins acting on the hypothalamus), chills, malaise, and altered mental status. Inflammation causes the body to mount the third defense, which is the immune response.` },
                    { id: 'immune-response', title: 'Immune Response: Third Line of Defense', type: 'text', content: `Inflammation activates the <strong>immune response</strong>, which is the body’s attempt to protect itself from foreign and harmful substances. The immune response is initiated by recognition of <strong>antigens</strong>. An <strong>antigen</strong> is any substance that provokes an adaptive immune response. Antigens include protein molecules on the surface of pathogens and nonliving substances such as toxins, chemicals, drugs, or particles. The immune system recognizes and destroys substances that contain foreign antigens.<br><br>
                    Most people are born with innate (nonspecific) immunity (Huether, McCance, & Brasher, 2020). The adaptive mechanisms of direct (active) and indirect (passive) immunologic memory determine how a person’s immune system recognizes antigens.` },
                    { id: 'innate-immunity', title: 'Innate Immunity', type: 'text', content: `The innate (nonspecific) immune system provides immediate defense against foreign antigens. The skin, cough reflex, mucus, enzymes on the skin and in tears, and acid in the gastrointestinal tract prohibit harmful substances from entering the body. In addition to acting as a barrier to infectious agents, the innate immune system produces chemical mediators that fight infection, remove foreign substances, and activate the adaptive immune system.` },
                    { id: 'adaptive-immunity', title: 'Adaptive Immunity (Humoral & Cellular)', type: 'text', content: `The adaptive (acquired or specific) component of the immune system provides long-term immunity when the body is exposed to an antigen. <strong>Humoral (antibody-mediated)</strong> and <strong>cellular (cell-mediated) immunity</strong> are two types of adaptive immunity.<br><br>
                    <strong>Humoral immunity</strong> is a defense system that involves WBCs (B lymphocytes) that produce <strong>antibodies</strong> in response to antigens or pathogens circulating in the lymph and blood. <strong>Antibodies</strong> are immunoglobulin molecules that recognize foreign invaders. The antigen-antibody reaction initiates a complex chain of events to protect the body from the invading microorganism. Humoral immunity enables production of inflammatory molecules such as interferon and interleukin-1, which cause fever. If a pathogen gets past the innate response, it is attacked by the adaptive immune system, which generates antigen-specific antibodies and lymphocytes (Huether, McCance, & Brasher. 2020).<br><br>
                    <strong>Cellular immunity</strong> involves defense by WBCs against any microorganisms that the body does not recognize as its own. T lymphocytes, such as cytotoxic T cells, directly attack cells displaying nonself antigens (e.g., infected cells). Helper T cells release interleukins and other substances that stimulate antibody production by B cells and antigen destruction by other cells (e.g., macrophages).` },
                    { id: 'immunologic-memory', title: 'Immunologic Memory & Passive Immunity', type: 'text', content: `Adaptive immunity is antigen specific and involves active, long-term <strong>immunologic memory</strong>. As B cells and T cells develop, they learn to differentiate between the body’s tissues and substances that are not normally found in the body. Some cells are sensitized by interaction with a specific antigen and become memory cells. Subsequent exposure to the antigen produces a stronger and faster immune response by these memory cells, which can ease or prevent later illness in many cases. Long-term active immunity can be artificially acquired by <strong>immunization</strong> with vaccines.<br><br>
                    <strong>Passive immunity</strong> occurs when a person receives an antibody produced in another body. Passive immunity provides immediate but short-term protection against antigens. Infants acquire passive immunity naturally in utero or through breast milk; these antibodies disappear between the ages of 6 and 12 months. Passive immunity can be acquired artificially when antibodies are transferred from one person to another by injection of an antibody-rich serum (e.g., immunoglobulin).` },
                    { id: 'other-systems', title: 'Other Body Systems in Defense', type: 'text', content: `The integumentary, respiratory, and gastrointestinal systems each have roles in fighting infection. Skin is a barrier that is impermeable to most infectious microorganisms. Any break in the skin can create a portal of entry or exit for pathogens. The skin contains squamous epithelial cells, which help remove microorganisms and other infectious agents. Sweat decreases the likelihood of infection because its low pH inhibits bacterial growth (Huether, McCance, & Brasher, 2020).<br><br>
                    The respiratory system contains cilia and mucus, which move or trap foreign bodies, decreasing the risk for infection. The respiratory system is equipped with proteins that have antimicrobial properties and promote phagocytosis (Huether, McCance, & Brasher, 2020). The gastrointestinal system plays an active role in helping the body fight infection. The flora and low pH of the gastrointestinal tract prevent the colonization of pathogenic microorganisms by secreting toxic substances or competing with the microorganism for the nutrients needed to make it thrive (Huether, McCance, & Brasher, 2020).` },
                    { id: 'body-defense-quiz', title: 'Body\'s Defense System Quiz', type: 'quiz',
                        questions: [
                            { question: "Which of the following is considered the body's first line of defense against infection?", options: ["Inflammatory response", "Normal flora", "Humoral immunity", "Cellular immunity"], correctAnswer: "Normal flora" },
                            { question: "What is the primary function of the inflammatory response?", options: ["To produce antibodies", "To provide long-term immunity", "To neutralize, control, and eliminate invading pathogens locally", "To directly attack infected cells"], correctAnswer: "To neutralize, control, and eliminate invading pathogens locally" },
                            { question: "Which type of immunity involves B lymphocytes producing antibodies in response to antigens?", options: ["Innate immunity", "Cellular immunity", "Passive immunity", "Humoral immunity"], correctAnswer: "Humoral immunity" },
                            { question: "An infant acquiring antibodies through breast milk is an example of:", options: ["Active immunity", "Artificially acquired immunity", "Passive immunity", "Cellular immunity"], correctAnswer: "Passive immunity" },
                            { question: "Which body system acts as a barrier impermeable to most infectious microorganisms?", options: ["Respiratory system", "Gastrointestinal system", "Integumentary system", "Immune system"], correctAnswer: "Integumentary system" }
                        ]
                    },
                ]
            },
            'chain-of-infection': {
                title: 'Chain of Infection',
                color: 'from-purple-500 to-pink-600',
                description: 'Explain the links of the chain of infection.',
                learningOutcome: 'LO 26.2',
                steps: [
                    { id: 'chain-intro', title: 'Understanding the Chain of Infection', type: 'text', content: `To understand how to prevent the spread of potentially harmful microorganisms, nurses must understand the <strong>chain of infection</strong>. Breaking the chain of infection helps prevent most infections.<br><br>
                    The chain of infection has six main components: the <strong>infectious agent</strong>, the <strong>source of infection</strong>, the <strong>portal of exit</strong>, the <strong>mode of transmission</strong>, the <strong>portal of entry</strong>, and the <strong>susceptible host</strong>. Infectious agents are the first link of the chain of infection that is necessary to spread disease-causing organisms.
                    <div class="flex justify-center my-4">
                        <img src="https://placehold.co/400x300/e0e0e0/333333?text=Chain+of+Infection" alt="Diagram of the Chain of Infection" class="rounded-lg shadow-md">
                    </div>
                    <em>Figure 26.1 The chain of infection. GI, Gastrointestinal; GU, genitourinary.</em>` },
                    { id: 'infectious-agents', title: 'Infectious Agents: Pathogens', type: 'text', content: `An infectious agent that causes disease is referred to as a <strong>pathogen</strong>. Pathogens include <strong>bacteria, viruses, fungi, and parasites</strong>.<br><br>
                    <strong>Bacteria</strong> are single-cell organisms. Bacteria live as normal flora on and in the skin, eyes, nose, mouth, upper throat, lower urethra, lower intestine, and large intestine. They are capable of causing disease in the human population when they overgrow as a result of immune system compromise or when they enter different areas of the body. Bacteria have different sizes, shapes, growth patterns, and means of <strong>replication</strong>, which is a term used to describe bacterial reproduction or duplication. They are named according to their shape and are classified by their ability to live with or without oxygen (i.e., aerobic or anaerobic, respectively) and their staining qualities (i.e., Gram positive or Gram negative). Bacteria reproduce by dividing; one cell becomes two identical cells. Bacteria are identified when a sample taken from the body is cultured, and exact antibiotic sensitivity is tested so that appropriate antibiotics are prescribed.<br><br>
                    <strong>Viruses</strong> are the smallest microorganisms. Viruses reproduce inside living cells of the host and are responsible for causing many different types of disease. Illnesses range from the common cold to acquired immune deficiency syndrome (AIDS). Viruses cannot be killed by antibiotics. Certain antiviral medications are used to manage the symptoms of some viral infections. These medications, if given during the early phases of illness, can decrease the amount of time that the patient has viral symptoms.<br><br>
                    <strong>Fungi</strong>, like bacteria, are single-cell organisms that can cause infection. Molds and yeasts are examples of common fungi. Fungi are present in the air, soil, and water and are responsible for conditions such as athlete’s foot, ringworm, and yeast infections. Infections that are caused by fungi are treated with antifungal medications.<br><br>
                    <strong>Parasites</strong> are organisms that live on or in other organisms. Examples of these organisms include protozoans, helminths, and arthropods. Parasites are typically transmitted by sexual contact, insects, and domestic animals. They cause many diseases in humans. Protozoans cause malaria, helminths are responsible for intestinal worm infestations, and arthropods are responsible for transmitting many skin and systemic diseases, such as malaria.` },
                    { id: 'source-of-infection', title: 'Source of Infection (Reservoir)', type: 'text', content: `The second link of the chain is the <strong>source of infection</strong>, also called a <strong>reservoir</strong> or <strong>host</strong>. Reservoirs can be inanimate objects such as surfaces, equipment, medication, air, food, and water on which microorganisms can find nourishment and survive. Human sources of infection are health care personnel, family, friends, and patients. Nonhuman organisms such as insects, rats, birds, bats, pigs, and cows spread disease and have been the reservoirs for many epidemics in the past and for current diseases such as avian flu and mad cow disease (Centers for Disease Control and Prevention [CDC], 2020a).` },
                    { id: 'portal-of-exit', title: 'Portal of Exit', type: 'text', content: `Infection spread requires a <strong>portal of exit</strong>, which is the means by which the pathogen escapes from the reservoir of infection. Microorganisms escape through emesis, sneezes, coughs, sputum, urine, stool, blood, genital secretions, and wound drainage.` },
                    { id: 'mode-of-transmission', title: 'Mode of Transmission', type: 'text', content: `A microorganism must have a way to travel from the source to the susceptible host. The form of transportation is referred to as the <strong>mode of transmission</strong>. Modes of transmission include <strong>contact, airborne, vehicle</strong> (e.g., food, water, contaminated objects), <strong>droplet</strong>, and <strong>vector-borne</strong> (e.g., insects, animals).<br><br>
                    Most microorganisms are transmitted by <strong>contact</strong>, which is when body surfaces touch surfaces of other bodies or objects. Direct contact involves a physical transfer of the microorganism from the infected individual to a susceptible host. Indirect contact occurs when the microorganism is transferred by way of a contaminated object (e.g., a dressing, needle, or surgical instrument, such as a retractor or scalpel). In the health care setting, the most common means of transmission is contaminated hands (CDC, 2021).<br><br>
                    Some microorganisms can be transmitted through the air. <strong>Airborne transmission</strong> occurs when microorganisms are dispersed by air currents and inhaled or deposited on the skin of a susceptible host. Examples of illnesses transmitted through the air include tuberculosis, measles, and chickenpox.<br><br>
                    Some microorganisms are transmitted by droplets. <strong>Droplet transmission</strong> occurs when the mucous membranes of the respiratory tract (i.e., nose, mouth, or conjunctiva) are exposed to the secretions of an infected individual. Droplets cannot remain suspended in the air for long periods and seldom travel more than 3 feet. Examples of illnesses transmitted by droplets are influenza and respiratory syncytial virus infection (Siegel, Rhinehart, Jackson, et al., 2019).<br><br>
                    Airborne transmission and droplet transmission are often hard to differentiate. Microorganisms travel through the air in both cases, but the difference between the two modes is the size of the microorganism. Because smaller microorganisms can travel longer distances and remain suspended for longer periods, they are considered to be transmissible by air. Larger microorganisms cannot travel long distances and usually require closer contact for transmission; they are considered to be transmissible by droplet.<br><br>
                    <strong>Vectors</strong> carry the pathogens from one host to another. Vectors often are invertebrate animals such as ticks, but they also can be vertebrate animals such as raccoons, which can transmit rabies by biting. Vector-borne diseases include Lyme disease, Rocky Mountain spotted fever, West Nile virus, and viral encephalitis.` },
                    { id: 'portal-of-entry', title: 'Portal of Entry & Breaking the Chain', type: 'text', content: `For the chain of infection to continue and the microorganism to be successfully transmitted from a primary host to a susceptible host, there must be a <strong>portal of entry</strong>, or the means by which the microorganism enters the susceptible host. There are many portals of entry: the gastrointestinal tract by ingestion, the genitourinary tract by contact with mucous membranes, the respiratory tract by inhalation, the integumentary system by breaks in the skin, and the urinary tract by introduction through the urethra. Individuals who are hospitalized are at increased risk for infection because of greater exposure to infectious agents and because many of the invasive procedures that are performed access the portals of entry.<br><br>
                    The nurse can take steps at any link in the chain to halt the spread of infection. Standard precautions are used with all patients to limit direct exposure to blood and bodily fluids. Bodily discharges are disposed of immediately and properly to prevent spreading potentially harmful microorganisms. Handwashing destroys microorganisms so that others are not infected. Patients with contagious illnesses are isolated and personal protective equipment (PPE) is used when entering the room so that a removable barrier is formed between the health care worker and the patient. These and other interventions practiced to break the chain of infection are discussed later in this chapter.` },
                    { id: 'susceptible-host', title: 'Susceptible Host', type: 'text', content: `After the pathogen exits the reservoir, it must be transported to a <strong>susceptible host</strong> for the chain to be completed. A susceptible host is someone exposed to an infectious disease who is likely to contract the disease. Increased susceptibility is associated with people at the extremes of age, those who are nutritionally compromised, and those who have had recent trauma or surgery. Those who are immunocompromised because of chemotherapy, radiation treatments, long-term use of steroids, or transplantation have lower resistance to infection. Patients with chronic illnesses, such as heart or lung disease, diabetes, liver or kidney disease, and human immunodeficiency virus (HIV) infection or AIDS, also have lower resistance to infection.` },
                    { id: 'chain-of-infection-quiz', title: 'Chain of Infection Quiz', type: 'quiz',
                        questions: [
                            { question: "Which of the following is NOT a component of the chain of infection?", options: ["Infectious agent", "Mode of transmission", "Inflammatory response", "Susceptible host"], correctAnswer: "Inflammatory response" },
                            { question: "What is the most common means of microorganism transmission in a healthcare setting?", options: ["Airborne transmission", "Droplet transmission", "Contaminated hands", "Vector-borne transmission"], correctAnswer: "Contaminated hands" },
                            { question: "An illness transmitted by small droplets or particles that can remain suspended in the air for prolonged periods is known as:", options: ["Contact transmission", "Droplet transmission", "Airborne transmission", "Vehicle transmission"], correctAnswer: "Airborne transmission" },
                            { question: "Which of the following is a portal of entry for microorganisms?", options: ["Emesis", "Sneezes", "Breaks in the skin", "Wound drainage"], correctAnswer: "Breaks in the skin" },
                            { question: "A patient undergoing chemotherapy is considered a susceptible host due to:", options: ["Increased age", "Nutritional compromise", "Immunocompromise", "Recent trauma"], correctAnswer: "Immunocompromise" }
                        ]
                    },
                ]
            },
            'assessing-for-infection': {
                title: 'Assessing for Infection',
                color: 'from-red-600 to-orange-500',
                description: 'Outline techniques of assessing for infection or risk for infection.',
                learningOutcome: 'LO 26.3',
                steps: [
                    { id: 'assessment-intro', title: 'Introduction to Infection Assessment', type: 'text', content: `During assessment, a history is obtained before observation. A vigilant nursing assessment considers the patient’s susceptibility and clinical appearance and the effectiveness of the patient’s defenses against disease.<br><br>
                    Infections are classified as acute or chronic. Acute infections develop and run their course rapidly. Examples of acute infections include coughs, colds, and ear infections, which last 10 to 14 days. Chronic infections, such as infectious mononucleosis, may persist for months, as may wound and bone infections. Some infectious diseases such as certain hepatitis types and AIDS can be treated and controlled but are not curable.<br><br>
                    Some patients with an infectious disease may have no visible symptoms at presentation, whereas others can have a varied clinical picture depending on the specific infection. Signs and symptoms of infection that may be observed are fever, chills, malaise, altered mental status, headache, and fatigue. Confusion is a common presentation in the elderly and is often the first indication of an infection such as pneumonia or a urinary tract infection.` },
                    { id: 'health-history-assessment', title: 'Health History & Assessment Questions', type: 'text', content: `The nurse observes the patient’s general appearance to detect infection. Specific questions can help determine whether the patient already has or is at risk for an infection:<br>
                    <ul>
                        <li>Do you feel tired or fatigued?</li>
                        <li>Do you feel short of breath?</li>
                        <li>Do you often feel chilled and require a blanket when others in the room are comfortable?</li>
                        <li>How is your appetite?</li>
                        <li>Do you have any areas of pain, redness, swelling, and warmth?</li>
                        <li>Do you have any rashes, breaks in the skin, or reddened areas?</li>
                        <li>Do you have swollen lymph nodes?</li>
                        <li>Do you feel that you empty your bladder when you go to the bathroom?</li>
                        <li>Do you have a cough or difficulty swallowing?</li>
                        <li>Have you had a fever?</li>
                        <li>What medications are you on? Have you taken an antibiotic recently?</li>
                        <li>Have you had any infections in the past year?</li>
                        <li>Are your immunizations up-to-date?</li>
                        <li>Have you been exposed to anyone with an infection?</li>
                        <li>Have you traveled anywhere recently?</li>
                    </ul>` },
                    { id: 'vital-signs-nutritional-assessment', title: 'Vital Signs & Nutritional Assessment', type: 'text', content: `<strong>Assessment of Vital Signs:</strong> Altered vital signs can indicate an infection. Temperature elevates slightly as the infection process begins. This is one of the body’s defense mechanisms. As time passes and no interventions are initiated, the temperature continues to rise and other symptoms occur. As the infection progresses, the blood pressure rises and pulse and respiratory rates increase. Some patients with a severe infection such as sepsis may have damage to the body’s organs and may be hypothermic. Decreased blood pressure is a late sign of infection, indicating septicemia and shock. Recognizing cues early will result in a better outcome for the patient.<br><br>
                    <strong>Nutritional Assessment:</strong> Adequate nutrition is important in the body’s defense against infection. Infection depletes proteins, vitamins, minerals, and water in the body. These nutrients must be replaced to ensure adequate functioning of the body’s defense mechanisms. During the physical assessment, the nurse assesses the patient’s skin, mucous membranes, and overall appearance in addition to asking the patient about dietary intake.` },
                    { id: 'risk-assessment-diversity', title: 'Risk Assessment & Diversity Considerations', type: 'text', content: `Nurses must be aware of the many conditions that place patients at increased risk for infection. Chronic diseases, alterations in the immune system, medications such as chemotherapeutic drugs, alterations in skin integrity, malnutrition, indwelling medical devices such as urinary catheters, lack of proper immunizations, and other conditions can cause a patient to develop an infectious disease when exposed to certain microorganisms. During the physical assessment, the nurse assesses the patient’s skin and dietary intake and the integrity of invasive catheters to detect any subtle signs of infection.<br><br>
                    <strong>Diversity Considerations:</strong>
                    <ul>
                        <li><strong>Life Span:</strong> Extremes in age cause an individual to be more susceptible to infection. <strong>Infants and the elderly are at the greatest risk for infection.</strong> Infants have immature immune systems. As people age, the immune system becomes less effective due to decreased numbers of macrophages and other white blood cells. The elderly are at an increased risk for respiratory, urinary, and skin infections.</li>
                        <li><strong>Gender:</strong> Females are at greater risk for UTIs because of the anatomy of the genitourinary system. Males with an enlarged prostate may have incomplete emptying of the bladder, leaving them vulnerable to UTIs.</li>
                        <li><strong>Culture, Ethnicity, and Religion:</strong> Various cultural, ethnic, and religious factors may influence a patient’s ability or desire to seek medical assistance, which can increase the risk for developing or maintaining an infection.</li>
                        <li><strong>Disability:</strong> Disabilities causing immobility can increase the risk for respiratory, skin, and urinary tract infections.</li>
                        <li><strong>Morphology:</strong> Obesity has been linked to an increased risk for certain skin infections in the skin folds (Earlam & Woods, 2020).</li>
                    </ul>` },
                    { id: 'lab-diagnostic-tests', title: 'Laboratory and Diagnostic Tests', type: 'text', content: `The nurse monitors several laboratory tests when assessing for infection. Tests include a <strong>CBC</strong> and a <strong>differential WBC count</strong>. The normal WBC count for adults is <strong>5000 to 10,000 cells/mm<sup>3</sup></strong>. A <strong>shift to the left</strong> (i.e., relative increase in immature forms of blood cells) with a higher percentage of neutrophils than normal indicates an infection.<br><br>
                    <strong>Culture and sensitivity testing</strong> of the blood, urine, stool, sputum, or wound drainage may be indicated. Culture of a specimen determines which microorganism is causing an infection; sensitivity testing determines which antibiotics, if any, can be used to treat the infection. The presence of pathogens in a specimen is a positive result.<br><br>
                    Another laboratory test that is useful in assessing infection is the <strong>erythrocyte sedimentation rate (ESR)</strong>. The ESR measures the degree of inflammation in the body, and the result can be an indicator of infection. An ESR that remains elevated indicates a poor response to current therapy, whereas an ESR that decreases indicates a good response.` },
                    { id: 'dp-case-study-q2', title: 'Case Study: D. P. - Incisional Infection Cues', type: 'case_study', case: {
                        scenario: `Donald Parker (D. P.) is an 84-year-old male admitted 2 days ago after a fall and left hip fracture repair. His medical history includes type 2 diabetes mellitus and urinary retention with a chronic Foley catheter.
                        <br><br>
                        D. P.’s vital signs on day 2: temperature <strong>38.4° C (101.2° F)</strong>, P 98, R 20, BP 130/72, pulse oximetry 96% on room air. Alert and oriented × 4. Lungs clear. Abdomen soft and nontender with hyperactive bowel sounds. Pain 2/10, increasing to 8/10 with movement. Reports sharp, burning pain in the left hip around the surgical site. Dry sterile dressing changed, no drainage on old dressing. The skin around the incision is <strong>warm and red, and tender to the touch</strong>. Staples are intact. IV site in left forearm is without redness or swelling.
                        <br><br>
                        Laboratory results: <strong>WBCs 20,000/mm<sup>3</sup></strong>, Hgb 16 g/dL, Hct 47%, BUN 20 mg/dL, creatinine 0.8 mg/dL, potassium 4.0 mEq/L, blood glucose 150 mg/dL, sodium 142 mEq/L. D. P. also reports having had <strong>multiple watery stools this morning</strong>.`,
                        question: `Based on the assessment data for D. P., which cues would indicate possible incisional infection or other infection? (Select all that apply.)`,
                        options: [
                            "Option A: Temperature 38.4° C (101.2° F)",
                            "Option B: Pulse 98 and regular",
                            "Option C: Skin around the incision is warm and red, and tender to the touch",
                            "Option D: WBCs 20,000/mm³",
                            "Option E: Patient reports sharp, burning pain in the left hip",
                            "Option F: Multiple watery stools this morning"
                        ],
                        correctAnswer: [
                            "Option A: Temperature 38.4° C (101.2° F)",
                            "Option C: Skin around the incision is warm and red, and tender to the touch",
                            "Option D: WBCs 20,000/mm³",
                            "Option F: Multiple watery stools this morning"
                        ],
                        explanation: `<strong>Rationale:</strong>
                        Let's break down the options based on D. P.'s assessment data:
                        <ul>
                            <li><strong>Option A: Temperature 38.4° C (101.2° F) (Correct)</strong> - An elevated temperature is a classic sign of infection and the inflammatory response.</li>
                            <li><strong>Option B: Pulse 98 and regular (Incorrect)</strong> - While a pulse of 98 is slightly elevated from a typical resting rate, it's not a definitive sign of infection on its own, especially with a regular rhythm. Significant tachycardia would be more indicative.</li>
                            <li><strong>Option C: Skin around the incision is warm and red, and tender to the touch (Correct)</strong> - These are cardinal signs of localized inflammation and infection at the surgical site.</li>
                            <li><strong>Option D: WBCs 20,000/mm³ (Correct)</strong> - A normal WBC count is 5,000-10,000 cells/mm³. A count of 20,000 indicates a significant leukocytosis, a strong indicator of infection.</li>
                            <li><strong>Option E: Patient reports sharp, burning pain in the left hip (Incorrect)</strong> - While pain is present, D. P. just had hip surgery. Pain is expected. The *increase* in pain with movement and its relief with medication and position change are more indicative of surgical pain rather than a specific sign of infection, although infection can exacerbate pain. The *quality* of pain (sharp, burning) could be neuropathic or incisional.</li>
                            <li><strong>Option F: Multiple watery stools this morning (Correct)</strong> - This is a significant cue for a gastrointestinal infection, such as <em>Clostridioides difficile (C. diff)</em>, which is a common healthcare-associated infection.</li>
                        </ul>
                        <strong>Key takeaway:</strong> A combination of elevated temperature, localized signs of inflammation (redness, warmth, tenderness), and elevated WBC count strongly suggests infection. Gastrointestinal symptoms like watery stools also point to potential infection.`
                    }},
                    { id: 'assessing-for-infection-quiz', title: 'Assessing for Infection Quiz', type: 'quiz',
                        questions: [
                            { question: "Which vital sign change is an early indicator of infection?", options: ["Decreased blood pressure", "Elevated temperature", "Decreased respiratory rate", "Decreased pulse rate"], correctAnswer: "Elevated temperature" },
                            { question: "The normal white blood cell (WBC) count for adults is:", options: ["1,000-4,000 cells/mm³", "5,000-10,000 cells/mm³", "12,000-15,000 cells/mm³", "15,000-20,000 cells/mm³"], correctAnswer: "5,000-10,000 cells/mm³" },
                            { question: "A 'shift to the left' in a differential WBC count indicates:", options: ["A viral infection", "A fungal infection", "An allergic reaction", "A bacterial infection"], correctAnswer: "A bacterial infection" },
                            { question: "Which laboratory test measures the degree of inflammation in the body and can indicate infection?", options: ["Hemoglobin (Hgb)", "Hematocrit (Hct)", "Erythrocyte Sedimentation Rate (ESR)", "Blood Urea Nitrogen (BUN)"], correctAnswer: "Erythrocyte Sedimentation Rate (ESR)" },
                            { question: "Confusion in an elderly patient is often the first indication of which type of infection?", options: ["Skin infection", "Pneumonia or urinary tract infection", "Gastrointestinal infection", "Blood-borne infection"], correctAnswer: "Pneumonia or urinary tract infection" }
                        ]
                    },
                ]
            },
            'nursing-diagnoses-planning': {
                title: 'Nursing Diagnoses & Planning',
                color: 'from-green-500 to-teal-600',
                description: 'Prioritize nursing diagnoses and generate measurable goals for patients with infection.',
                learningOutcome: 'LO 26.4, LO 26.5',
                steps: [
                    { id: 'nursing-diagnosis-intro', title: 'Developing Nursing Diagnoses', type: 'text', content: `<strong>Nursing diagnoses</strong> are developed from the analysis of data collected by the nurse during the assessment stage. Nursing diagnoses clearly identify patient problems for which a nursing intervention is required and nursing care plans are developed. Many appropriate nursing diagnoses can be used for a patient with an infection. The following examples of International Classification for Nursing Practice (ICNP) nursing diagnoses are applicable to infectious disease patients:<br><br>
                    <ul>
                        <li><strong>Risk for Infection</strong>
                            <ul>
                                <li>Supporting Data: Surgical break in skin integrity; chronic disease: diabetes mellitus; left hip incision: skin around incision warm, red, and tender to touch; chronic Foley catheter</li>
                            </ul>
                        </li>
                        <li><strong>Lack of Knowledge</strong>
                            <ul>
                                <li>Supporting Data: Lack of knowledge about what causes infection, patient not washing hands after toileting or before meals</li>
                            </ul>
                        </li>
                        <li><strong>Impaired Skin Integrity</strong>
                            <ul>
                                <li>Supporting Data: Prolonged bed rest, inadequate diet, open area on the coccyx</li>
                            </ul>
                        </li>
                    </ul>
                    Nursing diagnoses based on the effects of infection on various body systems also may be appropriate.` },
                    { id: 'planning-goals', title: 'Planning: Prioritizing & Setting Goals', type: 'text', content: `The <strong>planning stage</strong> of the nursing process involves prioritizing identified nursing diagnoses, evaluating patient abilities and resources, and setting goals. The nurse carefully considers the importance of each nursing diagnosis and addresses the most critical ones first in the nursing care plan. Maslow’s hierarchy of needs is a helpful resource for ranking nursing diagnoses.<br><br>
                    Reviewing data collected during the assessment process helps the nurse recognize cues and set realistic outcome criteria based on identified patient capabilities. Goals take into consideration the economic, psychosocial, physical, and other resources available in individual situations.<br><br>
                    When developing a plan of care, collaboration with patients and families and with members of the interprofessional health care team is imperative to identify desired patient outcomes and set mutually acceptable goals. Goals are directed at alleviating the specific problems identified in each nursing diagnosis, are patient centered, and are measurable.<br><br>
                    From each nursing diagnosis, the nurse develops specific goals for the patient who has or is at risk for an infection. Examples of goal and outcome statements follow:
                    <ul>
                        <li>Patient’s incision will remain infection free during hospitalization.</li>
                        <li>Patient will maintain good personal hygiene by the end of day 3 after admission.</li>
                        <li>Patient’s open area on the coccyx will decrease in size by the end of day 4 after admission.</li>
                    </ul>` },
                    { id: 'dp-case-study-q3', title: 'Case Study: D. P. - Goal for Risk for Infection', type: 'case_study', case: {
                        scenario: `The nurse has grouped data and notices that D. P. has several cues that could indicate incisional infection.
                        <br><br>
                        <strong>Nursing Diagnosis:</strong> Risk for Infection; Supporting Data: Surgical break in skin integrity; left hip incision: skin around incision warm, red, and tender to touch; chronic disease: diabetes mellitus; chronic Foley catheter.`,
                        question: `Write a measurable, patient-centered goal for D. P. based on the nursing diagnosis of Risk for Infection.`,
                        options: [
                            "Option A: Patient will verbalize understanding of infection prevention by discharge.",
                            "Option B: Patient's WBC count will be within normal limits (5,000-10,000 cells/mm³) by day 4 of hospitalization.",
                            "Option C: Patient's left hip incision will show no further signs of infection (e.g., redness, warmth, tenderness) by day 4 of hospitalization.",
                            "Option D: Patient will ambulate without pain by day 3 of hospitalization."
                        ],
                        correctAnswer: ["Option C: Patient's left hip incision will show no further signs of infection (e.g., redness, warmth, tenderness) by day 4 of hospitalization."],
                        explanation: `<strong>Rationale:</strong>
                        The goal should be directly related to the supporting data for the nursing diagnosis "Risk for Infection" and be measurable and patient-centered.
                        <ul>
                            <li><strong>Option A: Patient will verbalize understanding of infection prevention by discharge. (Good, but not the *best* for this specific diagnosis)</strong> - This is a good goal for "Lack of Knowledge," but less direct for the "Risk for Infection" related to physical cues.</li>
                            <li><strong>Option B: Patient's WBC count will be within normal limits (5,000-10,000 cells/mm³) by day 4 of hospitalization. (Good, but not the *best* for this specific diagnosis)</strong> - This is a measurable goal related to infection, but it focuses on a lab value rather than the direct physical manifestation of the incisional infection cues.</li>
                            <li><strong>Option C: Patient's left hip incision will show no further signs of infection (e.g., redness, warmth, tenderness) by day 4 of hospitalization. (Correct)</strong> - This goal is specific, measurable, achievable, relevant, and time-bound (SMART). It directly addresses the cues of incisional infection (warmth, redness, tenderness) and aims for their resolution within a specified timeframe.</li>
                            <li><strong>Option D: Patient will ambulate without pain by day 3 of hospitalization. (Incorrect)</strong> - This goal is related to pain and mobility, not directly to the risk for infection or its signs.</li>
                        </ul>
                        <strong>Key takeaway:</strong> A strong nursing goal directly addresses the identified problem (Risk for Infection) and its supporting data (incisional signs), is patient-centered, and includes clear, measurable criteria and a timeframe.`
                    }},
                    { id: 'nursing-diagnoses-planning-quiz', title: 'Nursing Diagnoses & Planning Quiz', type: 'quiz',
                        questions: [
                            { question: "Which of the following is a key characteristic of a well-written nursing goal?", options: ["It is nurse-centered", "It is vague and general", "It is measurable", "It focuses only on short-term outcomes"], correctAnswer: "It is measurable" },
                            { question: "A patient with a chronic Foley catheter and a surgical incision has a nursing diagnosis of 'Risk for Infection'. Which supporting data is most relevant to this diagnosis?", options: ["Patient reports feeling fatigued", "Patient has a history of type 2 diabetes mellitus", "Patient has clear lung sounds", "Patient's blood pressure is 130/72 mmHg"], correctAnswer: "Patient has a history of type 2 diabetes mellitus" },
                            { question: "When prioritizing nursing diagnoses, which framework is often helpful?", options: ["The chain of infection", "Maslow's hierarchy of needs", "PQRSTU pain assessment", "The SBAR communication tool"], correctAnswer: "Maslow's hierarchy of needs" },
                            { question: "Which of the following would be an appropriate measurable outcome for a patient with 'Impaired Skin Integrity' related to a coccyx wound?", options: ["Patient will have improved skin condition", "Patient's coccyx wound will decrease in size by 2 cm within 7 days", "Patient will receive daily wound care", "Patient will report less pain at the wound site"], correctAnswer: "Patient's coccyx wound will decrease in size by 2 cm within 7 days" }
                        ]
                    },
                ]
            },
            'interventions-evaluation': {
                title: 'Interventions & Evaluation',
                color: 'from-emerald-500 to-cyan-600',
                description: 'Carry out actions and evaluate interventions to decrease the risk for infection and reverse the negative effects of infection.',
                learningOutcome: 'LO 26.6',
                steps: [
                    { id: 'interventions-intro', title: 'Infection Control & Aseptic Interventions', type: 'text', content: `The nurse plays an important role in infection control. The nurse must be proficient in aseptic technique to reduce the patient’s risk for an HAI and know what action(s) should be taken if an HAI is suspected.<br><br>
                    Nurses can implement many interventions to decrease the risk of infectious illness. Diligence in performing these interventions decreases the likelihood of spreading infections from one patient to another in a health care facility. Proper hand hygiene and proper use of PPE are important nursing actions in the prevention of HAIs. The nurse is responsible for administering antibiotics when they are necessary but questioning their use when cultures have come back negative. Using aseptic technique whenever working with indwelling catheters (IV, urinary, etc.) and following protocol when cleaning, disinfecting, or sterilizing equipment or patient rooms are also preventive measures (TJC & Pillow, 2018).` },
                    { id: 'hand-hygiene', title: 'Hand Hygiene: The Most Effective Method', type: 'text', content: `<strong>Hand hygiene</strong> includes handwashing with soap and water, use of an alcohol-based sanitizer, or use of a surgical hand scrub. It is one of the most important actions that a nurse can perform to protect the patient, self, and other patients from the spread of infection. Hand hygiene breaks the chain of infection by interrupting the mode of transmission.<br><br>
                    A surgical hand scrub must be performed before all surgical procedures and before other procedures as necessary. This type of hand hygiene is performed with an antiseptic agent. A disposable sponge is used to scrub the hands, fingers, and wrists to reduce the number of microorganisms on intact skin.` },
                    { id: 'precautions-isolation', title: 'Precautions & Isolation', type: 'text', content: `Use of <strong>standard, airborne, droplet, and contact precautions</strong> reduces the transmission of pathogens. <strong>Standard precautions</strong> are used with every patient. They are the practices that prevent the spread of infectious diseases by minimizing the risk for transmission or exposure. Because it is not possible to identify patients who may or may not be infectious at any given time, the nurse practices standard precautions in dealing with every patient to protect other patients, visitors, and staff from exposures (Siegel, Rhinehart, Jackson, et al., 2019).<br><br>
                    Patients who are immunocompromised (i.e., neutrophil count <500/mm³) may be placed in <strong>protective isolation</strong>. This type of isolation protects susceptible patients, who may not be able to fight infection, from microorganisms in the environment. Patients who are undergoing chemotherapy, irradiation, or bone marrow transplantation and patients with severe burns may be placed in protective isolation.<br><br>
                    Transmission precautions (i.e., airborne, droplet, and contact) are used in addition to standard precautions to decrease the transfer of highly transmissible pathogens. Each transmission-based precaution requires the use of specific PPE to prevent the spread of a communicable illness.<br><br>
                    <strong>Safe Practice Alert:</strong> Handwashing is the most effective method for preventing hospital-acquired infections.` },
                    { id: 'ppe-details', title: 'Personal Protective Equipment (PPE)', type: 'text', content: `<strong>Personal protective equipment (PPE)</strong> is the equipment that health care personnel use to protect against the spread of infection. Gloves, masks, goggles, face shields, gowns, caps, and shoe coverings are examples. Clean, nonsterile gloves are used when direct contact with body secretions is possible. Sterile gloves are needed during sterile procedures, such as urinary catheter insertion. Gloves decrease the risk for transferring organisms from one individual to another. Gloves are changed if they become soiled and are always changed between patients. Proper use of PPE is essential to stop the spread of microorganisms.<br><br>
                    <strong>Masks</strong> protect against the transmission of infectious agents through the air. Special particulate respirators (e.g., <strong>N95 masks</strong>) are used when a patient is suspected of having or has a contagious airborne disease such as tuberculosis. These special masks fit securely against the face and require fit-testing. The effectiveness of masks is decreased when they get wet or are worn for long periods.<br><br>
                    <strong>Waterproof gowns</strong> are used when there is a possibility that the health care provider’s clothes will become soiled by blood, urine, stool, or wound drainage. Gowns are used only once and are discarded or cleaned after each use.<br><br>
                    <strong>Caps</strong> are used to cover the individual’s hair, and <strong>shoe covers</strong> are used to protect the shoes. They are used in areas where there is a high risk for contamination, such as in the labor and delivery room and the operating room.<br><br>
                    <strong>Goggles or face shields</strong> should be worn to protect the eyes from splashes. During a study, almost half of exposures occurred at the patient bedside, and 62.4% happened to the eyes. Only 2% of nurses were wearing goggles or a face shield during the incident (Mitchell & Parker, 2015). Starting July 2018, the Occupational Safety and Health Administration (OSHA) required employers to submit all injuries or exposures, including splashes (Mitchell & Powell, 2018).<br><br>
                    <strong>Safe Practice Alert:</strong> Never recap a dirty or used needle because doing so increases the risk for exposure to blood-borne pathogens.` },
                    { id: 'immunization', title: 'Immunization: Preventing Communicable Diseases', type: 'text', content: `<strong>Immunization</strong> is the process by which an individual develops immunity against a specific agent; it is important in preventing the spread of communicable diseases. Immunizations can be acquired through various techniques, the most common of which is vaccination.<br><br>
                    Immunizations provided by vaccination protect an individual against a particular communicable disease. Although vaccine-preventable diseases were at an all-time low, there is currently an issue with underimmunized children, adolescents, and adults. The CDC has recommended schedules for immunizations for children and adults. This information is regularly updated; thus, the nurse must remain vigilant about educating patients to decrease the spread of preventable contagious diseases.<br><br>
                    <strong>Safe Practice Alert:</strong> All women of childbearing age should be up-to-date on immunizations according to CDC recommendations. Urge women trying to conceive to avoid exposure to infectious diseases.` },
                    { id: 'medical-surgical-asepsis', title: 'Medical Asepsis vs. Surgical Asepsis', type: 'text', content: `<strong>Medical asepsis</strong> and <strong>surgical asepsis</strong> are techniques used to prevent infection or to break the chain of infection. <strong>Medical asepsis</strong> is often referred to as clean technique. Medical aseptic procedures include handwashing, wearing gloves, gowning, and disinfecting. <strong>Surgical asepsis</strong>, or sterile technique, is used to prevent the introduction of microorganisms from the environment to the patient. Surgical asepsis is used for surgical procedures, invasive procedures such as catheterization, procedures that invade the bloodstream or break the skin, dressing changes, and wound care.` },
                    { id: 'disinfection-sterilization', title: 'Disinfection & Sterilization', type: 'text', content: `<strong>Disinfection</strong> and <strong>sterilization</strong> are used to remove potentially harmful microorganisms and eliminate microorganisms as potential sources of infection. <strong>Disinfection</strong> is the removal of pathogenic microorganisms; it typically destroys all pathogenic microorganisms except spores from inanimate objects. Germicidal agents are used to disinfect objects, and antiseptic agents are used to disinfect skin. Examples of chemical disinfectants include alcohol and chlorhexidine (Rutala & Weber, 2016).<br><br>
                    <strong>Sterilization</strong> is a process used to destroy all microorganisms, including their spores. Sterilization is used on equipment that is entering a sterile body cavity. Many items are purchased as sterile or can be sterilized through physical or chemical means. The nurse should always check the expiration on the package before use. If the date on the package has expired, the contents are no longer considered sterile. Physical sterilization occurs through steam, boiling water, dry heat, or radiation. Chemical sterilization occurs through the use of gases such as ethylene oxide gas or solutions (Rutala & Weber, 2016).` },
                    { id: 'dp-case-study-q4', title: 'Case Study: D. P. - Nursing Interventions for Incision', type: 'case_study', case: {
                        scenario: `The nurse is generating a plan of care for D. P. and has listed <strong>Risk for Infection</strong> as his primary nursing diagnosis. The goal is: <strong>Patient’s incision will remain infection-free during hospitalization.</strong>`,
                        question: `Identify at least three nursing interventions with rationales to help achieve this goal.`,
                        options: [
                            "Option A: Monitor the patient’s temperature every 4 hours.",
                            "Option B: Administer Hydrocodone 5 mg PO q 4 h PRN for pain.",
                            "Option C: Cleanse incision with sterile saline solution and change dressing every 8 hours.",
                            "Option D: Encourage the patient to ambulate frequently.",
                            "Option E: Monitor the white blood cell (WBC) count as ordered.",
                            "Option F: Ensure optimal nutrition by offering high-protein supplements."
                        ],
                        correctAnswer: [
                            "Option A: Monitor the patient’s temperature every 4 hours.",
                            "Option C: Cleanse incision with sterile saline solution and change dressing every 8 hours.",
                            "Option E: Monitor the white blood cell (WBC) count as ordered.",
                            "Option F: Ensure optimal nutrition by offering high-protein supplements."
                        ],
                        explanation: `<strong>Rationale:</strong>
                        The goal is for D. P.'s incision to remain infection-free. Interventions should directly support this goal.
                        <ul>
                            <li><strong>Option A: Monitor the patient’s temperature every 4 hours. (Correct)</strong> - Rationale: An elevated temperature after surgery or a diagnostic procedure may indicate the start of an infection. Early detection allows for timely intervention.</li>
                            <li><strong>Option B: Administer Hydrocodone 5 mg PO q 4 h PRN for pain. (Incorrect)</strong> - Rationale: This intervention addresses pain management, which is important for patient comfort and mobility, but does not directly prevent incisional infection.</li>
                            <li><strong>Option C: Cleanse incision with sterile saline solution and change dressing every 8 hours. (Correct)</strong> - Rationale: This intervention directly addresses wound care. Using sterile saline and frequent dressing changes (as ordered) helps to keep the incision clean, remove potential pathogens, and create a barrier against environmental contamination.</li>
                            <li><strong>Option D: Encourage the patient to ambulate frequently. (Incorrect)</strong> - Rationale: Ambulation is important for preventing respiratory and circulatory complications and promoting overall recovery, but it does not directly prevent incisional infection.</li>
                            <li><strong>Option E: Monitor the white blood cell (WBC) count as ordered. (Correct)</strong> - Rationale: An elevated total WBC count is an indicator of infection. Monitoring this lab value helps to detect systemic infection or worsening localized infection.</li>
                            <li><strong>Option F: Ensure optimal nutrition by offering high-protein supplements. (Correct)</strong> - Rationale: Optimal nutrition, especially adequate protein intake, is crucial for wound healing and supporting the body's immune response, thereby decreasing the risk of infection.</li>
                        </ul>
                        <strong>Key takeaway:</strong> Interventions for infection prevention should be targeted, measurable, and supported by a clear rationale directly linking them to the goal of preventing or managing infection.`
                    }},
                    { id: 'dp-case-study-q5', title: 'Case Study: D. P. - Hand-off Report for Discharge', type: 'case_study', case: {
                        scenario: `D. P. is being discharged back to the skilled nursing facility on day 4. Vital signs are within normal limits. He is ambulating with a walker and supervision of one. He will continue physical therapy at the facility. His incision is dry, pink, and open to air. Staples are intact, edges of the incision are well approximated, and the area is cleansed with sterile saline once per shift. His <em>C. diff</em> cultures were negative, and he has not had any more episodes of diarrhea.`,
                        question: `What information regarding infection control is important for the nurse to share in the hand-off report to the nursing facility? (Select all that apply.)`,
                        options: [
                            "Option A: Status of the left hip incision and ongoing care requirements.",
                            "Option B: History of type 2 diabetes mellitus.",
                            "Option C: Results of <em>C. diff</em> cultures and resolution of diarrhea.",
                            "Option D: Current medication list, including antibiotics.",
                            "Option E: Patient's ambulation status with a walker.",
                            "Option F: Presence of a chronic Foley catheter and associated care."
                        ],
                        correctAnswer: [
                            "Option A: Status of the left hip incision and ongoing care requirements.",
                            "Option C: Results of <em>C. diff</em> cultures and resolution of diarrhea.",
                            "Option D: Current medication list, including antibiotics.",
                            "Option F: Presence of a chronic Foley catheter and associated care."
                        ],
                        explanation: `<strong>Rationale:</strong>
                        A comprehensive hand-off report ensures continuity of care and highlights critical infection control information for the receiving facility.
                        <ul>
                            <li><strong>Option A: Status of the left hip incision and ongoing care requirements. (Correct)</strong> - Rationale: The incision is a potential portal of entry for infection. Reporting its current status (dry, pink, well-approximated) and the ongoing care (cleansing with sterile saline once per shift, open to air) is crucial for continued monitoring and prevention of surgical site infection.</li>
                            <li><strong>Option B: History of type 2 diabetes mellitus. (Important, but not *directly* infection control specific for hand-off)</strong> - Rationale: While diabetes increases susceptibility to infection, it's part of the general medical history that would be in the patient's chart. The hand-off focuses on *changes* or *active issues* related to infection control.</li>
                            <li><strong>Option C: Results of <em>C. diff</em> cultures and resolution of diarrhea. (Correct)</strong> - Rationale: Knowing the <em>C. diff</em> cultures were negative and diarrhea has resolved is vital. If they had been positive, specific contact precautions would be needed. This information prevents unnecessary precautions or alerts the receiving facility to a resolved issue.</li>
                            <li><strong>Option D: Current medication list, including antibiotics. (Correct)</strong> - Rationale: Cefuroxime is an antibiotic. The receiving facility needs to know which antibiotics D. P. is on, the dosage, frequency, and duration, to ensure proper administration and completion of the course, which is critical for treating any existing infection and preventing antibiotic resistance.</li>
                            <li><strong>Option E: Patient's ambulation status with a walker. (Important, but not *directly* infection control specific for hand-off)</strong> - Rationale: This is important for mobility and fall risk, but not a direct infection control parameter for the hand-off.</li>
                            <li><strong>Option F: Presence of a chronic Foley catheter and associated care. (Correct)</strong> - Rationale: Indwelling urinary catheters are a significant risk factor for urinary tract infections (HAIs). The receiving facility needs to be aware of its presence and any specific care requirements to prevent infection.</li>
                        </ul>
                        <strong>Key takeaway:</strong> Hand-off reports should focus on current, relevant, and actionable information, especially concerning infection risks, active treatments (like antibiotics), and specific care needs that impact infection prevention. `
                    }},
                    { id: 'evaluation', title: 'Evaluation of Interventions', type: 'text', content: `<strong>Evaluation</strong> is an ongoing portion of the nursing process. Measure the success of infection prevention and control techniques by determining whether the patient and health care team achieved the goals for reducing or preventing infection. A clear description of any signs and symptoms of systemic or local infection is necessary to give all nurses a baseline for comparative evaluation. Document the patient’s response before and after an infection control measure, such as the absence of a fever or wound infection. These would be expected outcomes for measuring the success of nursing interventions. Determine the degree of wound healing and signs of infection by observing wounds during dressing change. Closely monitor patients determined to be at risk for any signs and symptoms of an infection. For example, the patient with an indwelling catheter is at risk for a urinary tract infection. In addition, the patient who has undergone a surgical procedure is at risk for a surgical site infection, and the patient with decreased mobility is at risk for a respiratory tract infection. Closely assess all surgical sites for swelling, erythema, or purulent drainage. Monitor breath sounds for changes and observe sputum character for change in color or consistency. Laboratory test results should be reviewed for leukocytes or an abnormality in the neutrophil count. In addition, assess the patient’s knowledge related to infection. A patient at risk for infection needs to understand the measures needed to reduce the risk for obtaining or spreading an infection. Give the patients and/or family caregivers the opportunity to discuss prevention and control measures while demonstrating procedures such as hand hygiene to assess their ability to comply with care techniques. Sometimes, patients and/or family caregivers require new information or previously instructed information needs reinforcement.` },
                    { id: 'interventions-evaluation-quiz', title: 'Interventions & Evaluation Quiz', type: 'quiz',
                        questions: [
                            { question: "Which of the following is the most effective method for preventing hospital-acquired infections?", options: ["Wearing gloves for all patient contact", "Administering prophylactic antibiotics", "Diligent hand hygiene", "Using sterile technique for all procedures"], correctAnswer: "Diligent hand hygiene" },
                            { question: "When should clean, nonsterile gloves be used?", options: ["During all sterile procedures", "When direct contact with body secretions is possible", "Only when a patient is in isolation", "When preparing a sterile field"], correctAnswer: "When direct contact with body secretions is possible" },
                            { question: "A patient with a neutrophil count <500/mm³ should be placed in which type of isolation?", options: ["Contact precautions", "Airborne precautions", "Droplet precautions", "Protective isolation"], correctAnswer: "Protective isolation" },
                            { question: "What is the primary purpose of an N95 respirator mask?", options: ["To protect against large droplets", "To prevent splashes to the face", "To protect against airborne transmission of small particles", "To cover hair in sterile environments"], correctAnswer: "To protect against airborne transmission of small particles" },
                            { question: "The process used to destroy all microorganisms, including their spores, is called:", options: ["Disinfection", "Medical asepsis", "Sterilization", "Antisepsis"], correctAnswer: "Sterilization" }
                        ]
                    },
                ]
            },
            'skills-review': {
                title: 'Skills & Review',
                color: 'from-sky-700 to-indigo-500',
                description: 'Review key skills and test your comprehensive knowledge.',
                learningOutcome: 'All LOs',
                steps: [
                    { id: 'skill-hand-hygiene', title: 'Skill 26.1: Hand Hygiene', type: 'text', content: `<strong>Purpose:</strong> Hand hygiene is essential to prevent the spread of microorganisms. It is standard practice for patient care.<br><br>
                    <strong>Resources:</strong> Soap, warm running water, paper towels, alcohol-based hand sanitizer.<br><br>
                    <strong>Interprofessional Collaboration And Delegation:</strong> Hand hygiene is mandatory for all health care workers who come in contact with patients or their belongings; it is not delegated. Hand hygiene is mandated for all patients. It is important for the nurse to speak up when observing anyone not following required hand hygiene.<br><br>
                    <strong>Evidence-Based Practice:</strong>
                    <ul>
                        <li>Alcohol-based products and sanitizers should not be used when one or both hands are visibly soiled (CDC, 2021; Gould, Moralejo, Drey, et al., 2017).</li>
                        <li>Natural fingernails should be kept short and trimmed often (CDC, 2021).</li>
                    </ul>
                    <br>
                    <strong>Procedure: Handwashing: Soap and Water Method</strong>
                    <ol>
                        <li>Introduce self and educate the patient regarding handwashing if a procedure is taking place within a patient room.</li>
                        <li>Turn on cold or warm water at a medium flow.</li>
                        <li>Wet the wrists and hands, with fingers pointing downward.</li>
                        <li>Apply soap.</li>
                        <li>Lather; rub using a circular movement; wash for 20 seconds in this order: palms, backs of hands, wrists, between fingers (interlaced, including thumbs), fingers, fingertips (clean under nails).</li>
                        <li>Rinse from wrist to fingertips, keeping hands with fingers pointing downward, hands slightly apart.</li>
                        <li>Using clean paper towels, dry thoroughly in the same order (from wrists to fingers), using a patting motion.</li>
                        <li>Throw the paper towels in an appropriate receptacle.</li>
                        <li>Turn off the water by holding the faucet with a clean, dry paper towel.</li>
                        <li>Throw the paper towel in an appropriate receptacle.</li>
                    </ol>
                    <br>
                    <strong>Procedure: Hand Hygiene: Sanitizer Method</strong>
                    <ol>
                        <li>Apply an appropriate amount of hand sanitizer into the palm of one hand.</li>
                        <li>Rub hands together using a circular motion, spreading sanitizer over palms and backs of both hands, then the wrist; continue until dry. Do not wave hands to dry because microorganisms may be in the air.</li>
                        <li>Gloves should not be applied until hands are dry.</li>
                    </ol>` },
                    { id: 'skill-sterile-gloving', title: 'Skill 26.2: Sterile Gloving', type: 'text', content: `<strong>Purpose:</strong> Sterile gloving technique protects highly susceptible patients, open wounds, and sterile objects from the transfer of microorganisms. Sterile gloving technique is required in most procedures mandating sterile technique.<br><br>
                    <strong>Resources:</strong> Sterile gloves of correct size, a flat, clean, dry work surface above waist height near the location of the procedure.<br><br>
                    <strong>Interprofessional Collaboration And Delegation:</strong> Sterile gloving is mandated for any health care provider who is participating in a procedure that requires sterile technique; it is not delegated. Sterile gloving may be performed by unlicensed assistive personnel (UAP) who are assisting in a procedure and have been trained in the proper application. The nurse must make sure that sterile technique is maintained. The nurse should verify facility policy before involving UAP in sterile procedures.<br><br>
                    <strong>Procedure: Applying Sterile Gloves</strong>
                    <ol>
                        <li>If gloving is taking place in a patient room, introduce self; explain the procedure.</li>
                        <li>Perform hand hygiene.</li>
                        <li>Peel open the glove package using a slow, smooth motion.</li>
                        <li>Put the inner glove package on the working surface. The working surface must be above waist level; the side of the package marked “cuff” must be closest to the person who is to glove.</li>
                        <li>Open the inner package, using thumbs and index fingers to gently pull the package edges apart.</li>
                        <li>With the thumb and two fingers of the nondominant hand, grasp the inside edge of the cuff of the glove for the dominant hand.</li>
                        <li>Pull the glove onto the dominant hand, with both hands held above the waist and over the sterile field.</li>
                        <li>Slide all gloved fingers underneath the cuff of the remaining glove (sterile gloved hand to sterile outer glove); hold the gloved thumb apart.</li>
                        <li>Pull the glove onto the nondominant hand, with hands held above the waist and over the sterile field; keep the gloved thumb apart. Do not use the sterile-gloved thumb to help pull on the second glove.</li>
                        <li>Adjust the gloves to fit correctly by carefully pinching and shifting each glove with the other hand. Do not “snap” the gloves to adjust them.</li>
                        <li>Hold both hands together and interlock the fingers; hold hands above the waist and away from the body.</li>
                    </ol>
                    <br>
                    <strong>Procedure: Removing Sterile Gloves</strong>
                    <ol>
                        <li>With the dominant hand, grasp the surface of the glove from the nondominant hand right below the base of the thumb; pull off without touching exposed skin.</li>
                        <li>Keep the removed glove crumpled in the hand that is still gloved.</li>
                        <li>Slide a finger or thumb of the gloveless hand under the cuff of the glove on the other hand (skin to skin); the remaining fingers of the ungloved hand should avoid touching the glove.</li>
                        <li>Peel off the second glove, turning it inside out and encasing the first glove inside the second glove.</li>
                        <li>Discard the gloves in an appropriate receptacle.</li>
                        <li>Perform hand hygiene.</li>
                    </ol>` },
                    { id: 'skill-ppe', title: 'Skill 26.3: Personal Protective Equipment (PPE)', type: 'text', content: `<strong>Purpose:</strong> Use of personal protective equipment (PPE) prevents the spread of microorganisms. PPE may be required for specialized procedures. Use of PPE protects self and others when caring for patients on isolation precautions or when any contact with blood or body fluids may be expected.<br><br>
                    <strong>Resources:</strong> Surgical mask with ties or ear loops; face shield; N95 respirator; long-sleeved, nonsterile isolation gown; goggles or protective eyewear; nonsterile gloves; laundry receptacle; container or receptacle for eyewear.<br><br>
                    <strong>Interprofessional Collaboration And Delegation:</strong> PPE is mandated for all health care workers who come in contact with patients in isolation or in situations in which contact with blood or body fluids may be expected; it is not delegated. It is important to speak up when seeing anyone not following appropriate and prescribed PPE requirements. Not following PPE requirements may cause harm to the health care worker and the patient.<br><br>
                    <strong>Evidence-Based Practice:</strong> The order of putting on and removing PPE is important in preventing contamination. Equipment is put on in order, starting with whatever part of the body is considered most contaminated and moving to the cleanest. Removing PPE should occur in an isolation anteroom, if available, or just inside the patient’s door before leaving the room (CDC, 2016; Siegel, Rhinehart, Jackson, et al., 2019). The CDC (2020b) recommends removing gloves, then gown, then performing hand hygiene either inside or outside the room depending on how the room is set up. Goggles or face shield are removed next, followed by the N95 respirator or mask. Hand hygiene is performed again.<br><br>
                    <strong>Procedure: Applying PPE</strong>
                    <ol>
                        <li>Wash hands.</li>
                        <li>Put on a gown. Tie at the neck, tie at the waist, and pull sleeves to wrists.</li>
                        <li>Put on a mask. For a surgical mask with ties, tie the top strings above ears; tie bottom strings around neck; adjust the metal nose bridge. For a surgical mask with ear loops, loop around ears; adjust the metal nose bridge.</li>
                        <li>Put on eyewear, which fits over the mask if not connected to the mask.</li>
                        <li>Put on gloves and pull cuffs over the gown.</li>
                        <li>Introduce self and explain the procedure and the need for PPE.</li>
                    </ol>
                    <br>
                    <strong>Procedure: Removing PPE</strong>
                    <ol>
                        <li>Remove gloves.</li>
                        <li>Remove gown: Untie at the waist, untie at the neck, and grasp the gown on the inside of the neck in back and pull it down from the shoulders, pulling it off inside out and rolling it into a ball.</li>
                        <li>Put the gown into an appropriate receptacle for disposal or cleaning.</li>
                        <li>Perform hand hygiene, either inside or outside the patient’s room depending on how the room is set up.</li>
                        <li>Remove eyewear (if separate from mask): Handle by the earpieces and lift away from the face.</li>
                        <li>Put eyewear into an appropriate receptacle for disposal or cleaning.</li>
                        <li>Remove mask: Untie at the bottom and then untie at the top or slide ear loops over ears while holding onto the ties or loops. Pull away from the face without touching the outside of the mask.</li>
                        <li>Throw the mask into an appropriate receptacle.</li>
                        <li>Perform hand hygiene.</li>
                    </ol>` },
                    { id: 'skill-sterile-fields', title: 'Skill 26.4: Sterile Fields', type: 'text', content: `<strong>Purpose:</strong> Use of a sterile field prevents the spread of microorganisms. A sterile field is used in procedures requiring sterile technique.<br><br>
                    <strong>Resources:</strong> Sterile procedural kit, sterile disposable drape, flat, clean, dry work surface above waist height near the location of the procedure.<br><br>
                    <strong>Interprofessional Collaboration And Delegation:</strong> Preparing a sterile field may not be delegated to UAP without special training to work in areas such as surgical units or possibly the emergency department. Check facility policy before considering delegation.<br><br>
                    <strong>Procedure: Preparing an Individually Wrapped Sterile Drape</strong>
                    <ol>
                        <li>If procedure is taking place in a patient room, introduce self; explain the procedure and the need for special handling.</li>
                        <li>Wash hands.</li>
                        <li>Open the packaging.</li>
                        <li>With the thumb and index finger, lift the drape out of its cover by the corner.</li>
                        <li>Hold the drape above the waist and away from the body. With the thumb and index finger of the other hand, grasp the other corner and let the drape unfold.</li>
                        <li>Place the lower section of the drape on the work surface farthest away; then, place the upper section onto the closest surface.</li>
                        <li>Place items that were not included in the kit onto the sterile field.</li>
                    </ol>
                    <br>
                    <strong>Procedure: Preparing a Sterile Field Using a Commercial Procedural Kit</strong>
                    <ol>
                        <li>If procedure is taking place in a patient room, introduce self; explain the procedure and the need for special handling.</li>
                        <li>Wash hands.</li>
                        <li>Open the outer packaging and remove the procedural kit; place it on the work surface.</li>
                        <li>With the thumb and index finger: Grasp the outer 1 inch of the drape. Unfold the first flap away from you. Do not reach across the kit; reach around it to open.</li>
                        <li>Continue opening the cover by opening the first side flap, keeping the hand and arm to the side of the field. Then, open the second side flap.</li>
                        <li>Finish opening the sterile packaging by unfolding the last flap toward you. Stand back and let it fall flat on the work surface. Do not let it touch you or your clothing.</li>
                        <li>Place items that were not included in the kit onto the sterile field.</li>
                        <li>Apply sterile gloves.</li>
                        <li>Place items included in the kit onto the field; do not place them on the outer edge.</li>
                    </ol>
                    <br>
                    <strong>Procedure: Adding Sterile Supplies to a Sterile Field</strong>
                    <ol>
                        <li>The hands are not yet gloved.</li>
                        <li>Following the package instructions, open each individually wrapped sterile item while holding it away from the body. Drop the item from a height of 10 inches onto the center of the sterile field. Do not hold the arm across the sterile field; approach from the side of the field.</li>
                        <li>To open a large, sterile item, hold it in the nondominant hand and peel away the packaging with the dominant hand. Let the outer (nonsterile) side of the wrapping cover the nondominant hand while dropping or placing the item in the center of the field. Do not hold the arm across the sterile field; approach from the side of the field.</li>
                        <li>To pour liquid into a sterile container within the sterile field, hold the lid of the bottle in the nondominant hand with the inside facing up. Hold the bottle in the dominant hand and pour the liquid slowly into the sterile container. Place the bottle on a nonsterile surface and replace the lid.</li>
                    </ol>` },
                    { id: 'final-review-quiz', title: 'Comprehensive Review Quiz', type: 'quiz',
                        questions: [
                            { question: "The nurse is caring for a patient who has been diagnosed with methicillin-resistant Staphylococcus aureus (MRSA) located in her incision. What transmission-based precautions will the nurse implement for the patient?", options: ["Private room", "Private, negative-airflow room", "Mask worn by the staff when entering the room", "Mask worn by the staff and the patient when leaving the patient’s room"], correctAnswer: "Private room" },
                            { question: "A new patient is admitted to a medical unit with <em>Clostridioides difficile</em>. Which type of precautions or isolation does the nurse know is appropriate for this patient?", options: ["Airborne precautions", "Droplet precautions", "Contact precautions", "Protective isolation"], correctAnswer: "Contact precautions" },
                            { question: "The nurse is providing patient education on infection prevention. Which definition of an infection does the nurse use as a teaching point?", options: ["An illness resulting from living in an unclean environment", "A result of lack of knowledge about food preparation", "A disease resulting from pathogens in or on the body", "An acute or chronic illness resulting from traumatic injury"], correctAnswer: "A disease resulting from pathogens in or on the body" },
                            { question: "The nurse is caring for a patient who had abdominal surgery and has developed an infection in the wound while hospitalized. Which agent is most likely the cause of the infection?", options: ["Virus", "Bacterium", "Fungus", "Spore"], correctAnswer: "Bacterium" },
                            { question: "A nurse is preparing to change a sterile dressing and has put on a pair of sterile gloves. To maintain surgical asepsis, what else must the nurse do?", options: ["Keep the amount of splashes on the sterile field to a minimum.", "If a sneeze is imminent, cover the nose and mouth with a gloved hand.", "With a moist saline sponge, use the dominant hand to clean the wound and then apply a dry dressing.", "Regard the outer 1 inch of the sterile field as contaminated."], correctAnswer: "Regard the outer 1 inch of the sterile field as contaminated." },
                            { question: "What is the proper order of removal of soiled personal protective equipment (PPE) when the nurse leaves the patient’s room?", options: ["Gown, goggles, mask, gloves, and exit the room", "Gloves, wash hands, gown, mask, and wash hands", "Gloves, gown, wash hands, goggles, mask, and wash hands", "Goggles, mask, gloves, gown, and wash hands"], correctAnswer: "Gloves, gown, wash hands, goggles, mask, and wash hands" },
                            { question: "Of the following hospitalized patients, who is most at risk for acquiring a health care–associated infection?", options: ["A 60-year-old who smokes two packs of cigarettes per day", "A 40-year-old who has an indwelling urinary catheter in place", "A 65-year-old who is a vegetarian and slightly underweight", "A 60-year-old who has a white blood cell count of 6000"], correctAnswer: "A 40-year-old who has an indwelling urinary catheter in place" },
                            { question: "A patient develops food poisoning from contaminated food. What is the means of transmission for the infectious organism?", options: ["Direct contact", "Vector", "Vehicle", "Airborne"], correctAnswer: "Vehicle" },
                            { question: "Of the following assessment findings, which cues indicate to a nurse that a patient has a surgical site infection? (Select all that apply.)", options: ["Redness or warmth at the affected site", "Purulent drainage at the incision site", "Tenderness and localized pain", "Wound with well-approximated edges", "White blood cell count 6500 cells/mm³"], correctAnswer: ["Redness or warmth at the affected site", "Purulent drainage at the incision site", "Tenderness and localized pain"] }
                        ]
                    },
                ]
            }
        };

        // The pre-assessment quiz data now includes questions for all new modules.
        const preAssessmentQuizData = [
            // Questions for Module 1: Body's Defense System
            { moduleId: 'body-defense-system', question: "Which of the following is considered the body's first line of defense against infection?", options: ["Inflammatory response", "Normal flora", "Humoral immunity", "Cellular immunity"], correctAnswer: "Normal flora" },
            { moduleId: 'body-defense-system', question: "Which type of immunity involves B lymphocytes producing antibodies in response to antigens?", options: ["Innate immunity", "Cellular immunity", "Passive immunity", "Humoral immunity"], correctAnswer: "Humoral immunity" },

            // Questions for Module 2: Chain of Infection
            { moduleId: 'chain-of-infection', question: "Which of the following is NOT a component of the chain of infection?", options: ["Infectious agent", "Mode of transmission", "Inflammatory response", "Susceptible host"], correctAnswer: "Inflammatory response" },
            { moduleId: 'chain-of-infection', question: "What is the most common means of microorganism transmission in a healthcare setting?", options: ["Airborne transmission", "Droplet transmission", "Contaminated hands", "Vector-borne transmission"], correctAnswer: "Contaminated hands" },

            // Questions for Module 3: Assessing for Infection
            { moduleId: 'assessing-for-infection', question: "Which vital sign change is an early indicator of infection?", options: ["Decreased blood pressure", "Elevated temperature", "Decreased respiratory rate", "Decreased pulse rate"], correctAnswer: "Elevated temperature" },
            { moduleId: 'assessing-for-infection', question: "The normal white blood cell (WBC) count for adults is:", options: ["1,000-4,000 cells/mm³", "5,000-10,000 cells/mm³", "12,000-15,000 cells/mm³", "15,000-20,000 cells/mm³"], correctAnswer: "5,000-10,000 cells/mm³" },

            // Questions for Module 4: Nursing Diagnoses & Planning
            { moduleId: 'nursing-diagnoses-planning', question: "Which of the following is a key characteristic of a well-written nursing goal?", options: ["It is nurse-centered", "It is vague and general", "It is measurable", "It focuses only on short-term outcomes"], correctAnswer: "It is measurable" },
            { moduleId: 'nursing-diagnoses-planning', question: "When prioritizing nursing diagnoses, which framework is often helpful?", options: ["The chain of infection", "Maslow's hierarchy of needs", "PQRSTU pain assessment", "The SBAR communication tool"], correctAnswer: "Maslow's hierarchy of needs" },

            // Questions for Module 5: Interventions & Evaluation
            { moduleId: 'interventions-evaluation', question: "Which of the following is the most effective method for preventing hospital-acquired infections?", options: ["Wearing gloves for all patient contact", "Administering prophylactic antibiotics", "Diligent hand hygiene", "Using sterile technique for all procedures"], correctAnswer: "Diligent hand hygiene" },
            { moduleId: 'interventions-evaluation', question: "A patient with a neutrophil count <500/mm³ should be placed in which type of isolation?", options: ["Contact precautions", "Airborne precautions", "Droplet precautions", "Protective isolation"], correctAnswer: "Protective isolation" },

            // Questions for Module 6: Skills & Review (Selected from comprehensive review)
            { moduleId: 'skills-review', question: "A new patient is admitted to a medical unit with <em>Clostridioides difficile</em>. Which type of precautions or isolation does the nurse know is appropriate for this patient?", options: ["Airborne precautions", "Droplet precautions", "Contact precautions", "Protective isolation"], correctAnswer: "Contact precautions" },
            { moduleId: 'skills-review', question: "Of the following hospitalized patients, who is most at risk for acquiring a health care–associated infection?", options: ["A 60-year-old who smokes two packs of cigarettes per day", "A 40-year-old who has an indwelling urinary catheter in place", "A 65-year-old who is a vegetarian and slightly underweight", "A 60-year-old who has a white blood cell count of 6000"], correctAnswer: "A 40-year-old who has an indwelling urinary catheter in place" },
        ];

        // --- Helper Functions ---
        // Utility for conditionally joining Tailwind CSS classes.
        const cn = (...classes) => classes.filter(Boolean).join(' ');


        // --- Child Components ---

        /**
         * Quiz component for interactive multiple-choice questions.
         * Users answer questions and receive immediate feedback.
         */
        const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState([]); // Changed to array for multi-select
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];

            // Handle option selection for both single and multiple choice
            const handleOptionSelect = (option) => {
                if (feedback && !isPreAssessment) return; // Prevent changing answer after feedback in regular quiz

                if (Array.isArray(currentQuestion.correctAnswer)) {
                    // Multi-select (SATA)
                    setSelectedOption(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    // Single select
                    setSelectedOption(option);
                }
            };

            const handlePreAssessmentNext = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                // Logic for checking correctness for both single and multi-select
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
                setAnswers(updatedAnswers);

                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    onComplete(updatedAnswers);
                }
            };
            
            const handleRegularQuizSubmit = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                setFeedback(isCorrect ? 'correct' : 'incorrect');
            };

            const handleRegularQuizNext = () => {
                // Ensure the current answer is recorded before moving to the next question
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                const finalAnswers = [...answers, { question: currentQuestion, isCorrect }];
                
                if (currentQuestionIndex < questions.length - 1) {
                    setAnswers(finalAnswers);
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.isCorrect ? 1 : 0), 0);
                    onComplete({ score: finalScore, total: questions.length });
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Quiz: {currentQuestionIndex + 1} of {questions.length}</h4>
                    <p className="font-semibold text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: currentQuestion.question }}></p>
                    <div className="space-y-2">
                        {currentQuestion.options.map((option, index) => {
                            const isSelected = Array.isArray(selectedOption) ? selectedOption.includes(option) : selectedOption === option;
                            const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
                                ? currentQuestion.correctAnswer.includes(option)
                                : option.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';

                            if (feedback && !isPreAssessment) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={index}
                                    onClick={() => handleOptionSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : <span className="text-red-600 mr-2">✗</span>
                                        )}
                                        <span className="flex-1" dangerouslySetInnerHTML={{ __html: option }}></span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center">
                        {isPreAssessment ? (
                               <button
                                    onClick={handlePreAssessmentNext}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
                                </button>
                        ) : (
                            <>
                            {!feedback ? (
                                <button
                                    onClick={handleRegularQuizSubmit}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    Submit Answer
                                </button>
                            ) : (
                                <button
                                    onClick={handleRegularQuizNext}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Next Question
                                </button>
                            )}
                            </>
                        )}
                    </div>
                </div>
            );
        };
        
        /**
         * PreAssessmentQuiz component to handle the initial diagnostic quiz.
         * Displays quiz questions and then results, allowing users to "test out" of modules.
         */
        const PreAssessmentQuiz = ({ onComplete, onExit }) => {
            const [results, setResults] = useState(null);

            const handleQuizComplete = (finalAnswers) => {
                const moduleResults = {};
                finalAnswers.forEach(answer => {
                    const { moduleId } = answer.question;
                    if (!moduleResults[moduleId]) {
                        moduleResults[moduleId] = { correct: 0, total: 0 };
                    }
                    if (answer.isCorrect) {
                        moduleResults[moduleId].correct++;
                    }
                    moduleResults[moduleId].total++;
                });

                const completedModules = [];
                for (const moduleId in moduleResults) {
                    // For pre-assessment, a module is "completed" if all its questions in the pre-assessment quiz were answered correctly.
                    if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
                        completedModules.push(moduleId);
                    }
                }
                setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
                onComplete(completedModules);
            };

            if (results) {
                return (
                    <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Assessment Complete!</h2>
                            <p className="text-lg text-gray-600 mb-6">
                                You correctly answered {results.correct} out of {results.total} questions.
                            </p>
                            {results.completedModules.length > 0 ? (
                                <>
                                    <p className="text-green-600 font-semibold mb-4">You've tested out of the following modules:</p>
                                    <ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-lg">
                                        {results.completedModules.map(id => <li key={id}>{contentData[id].title}</li>)}
                                    </ul>
                                </>
                            ) : (
                                <p className="text-yellow-600 font-semibold mb-6">You haven't tested out of any modules. You can proceed to the main modules for learning.</p>
                            )}
                            <button
                                onClick={onExit}
                                className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">Diagnostic Quiz</h2>
                        <Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
                    </div>
                </div>
            );
        };


        /**
         * Dashboard component to display the available learning modules.
         * It allows users to select a module to start learning.
         * Shows progress for each module using a circular progress bar and status.
         */
        const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
            let totalCompletedSteps = 0;
            let totalPossibleSteps = 0;
            let totalQuizCorrect = 0;
            let totalQuizQuestions = 0;

            // Calculate overall progress and gather quiz scores
            Object.entries(contentData).forEach(([moduleId, module]) => {
                totalPossibleSteps += module.steps.length;
                const moduleProgress = progress[moduleId] || {};
                
                Object.values(moduleProgress).forEach(stepProgress => {
                    if (stepProgress.completed) {
                        totalCompletedSteps++;
                    }
                    if (stepProgress.score !== undefined) {
                        totalQuizCorrect += stepProgress.score;
                    }
                });

                module.steps.forEach(step => {
                    if (step.type === 'quiz') {
                        totalQuizQuestions += step.questions.length;
                    }
                });
            });


            const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

            return (
                <div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
                    <div className="w-full">
                        <header className="mb-8 text-center">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                {/* Text placeholder for the main application identifier */}
                                <span className="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-lg">IC</span>
                                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Asepsis and Infection Control Module</h1>
                                <span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:1.0</span>
                            </div>
                            <p className="text-lg text-gray-500 max-w-2xl mx-auto">Master infection control practices, understand the body's defenses, and apply aseptic techniques in nursing scenarios.</p>
                        </header>

                        {/* Skip Ahead Button */}
                        <div className="mb-8 text-center">
                            <button
                                onClick={onStartPreAssessment}
                                className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-lg shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
                            >
                                <div className="text-xl">Skip Ahead: Take Diagnostic Quiz</div>
                                <div className="text-sm font-normal">Test your knowledge and potentially skip modules.</div>
                            </button>
                        </div>

                        {/* Overall Progress Bar & Reset Button */}
                        <div className="mb-8 bg-white rounded-2xl shadow-lg p-6 w-full">
                           <div className="flex justify-between items-center mb-3">
                                <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
                                <button 
                                    onClick={onResetProgress}
                                    className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" /></svg>
                                    Reset Progress
                                </button>
                           </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div
                                    className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
                                    style={{ width: `${overallPercentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between items-center">
                                <p className="text-left text-sm text-gray-600 mt-2">
                                    {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
                                </p>
                                <p className="text-right text-sm text-gray-600 mt-2">{Math.round(overallPercentage)}% Completed</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                            {/* Iterate over all modules defined in contentData */}
                            {Object.entries(contentData).map(([id, module]) => {
                                const moduleProgress = progress[id] || {};
                                // Calculate completion count for steps within the module.
                                const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
                                const totalSteps = module.steps.length;
                                const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

                                let statusText = "Not Started";
                                let statusColor = "text-gray-500";
                                if (completedCount === totalSteps) {
                                    statusText = "Completed";
                                    statusColor = "text-green-600";
                                } else if (completedCount > 0) {
                                    statusText = "In Progress";
                                    statusColor = "text-yellow-600";
                                }

                                // Get quiz score for this module if available
                                const quizStep = module.steps.find(step => step.type === 'quiz');
                                const quizProgress = quizStep ? moduleProgress[quizStep.id] : null;

                                return (
                                    <div
                                        key={id}
                                        onClick={() => onSelectModule(id)}
                                        // Styling for module cards, including hover effects.
                                        className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group flex flex-col"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            {/* Placeholder for module icon: Displays the first letter of the module title. */}
                                            <div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-10 h-10 flex items-center justify-center text-white text-lg font-bold shadow-md flex-shrink-0")}>
                                                {module.title.split(' ').map(word => word.charAt(0)).join('')}
                                            </div>
                                            {/* Progress Circle */}
                                            <div className="relative w-12 h-12 flex-shrink-0">
                                                <svg className="w-full h-full" viewBox="0 0 36 36">
                                                    {/* Background circle for the progress bar. */}
                                                    <path
                                                        className="text-gray-200"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                    />
                                                    {/* Foreground arc representing the completion percentage. */}
                                                    <path
                                                        className="text-indigo-500"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                        strokeDasharray={`${percentage}, 100`}
                                                        strokeLinecap="round"
                                                        transform="rotate(-90 18 18)"
                                                    />
                                                </svg>
                                                <span className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-600">{Math.round(percentage)}%</span>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">{module.title}</h3>
                                        <p className="text-gray-500 text-sm mb-2 h-10">{module.description}</p>
                                        <div className="mt-auto">
                                            <p className={cn("text-sm font-semibold", statusColor)}>{statusText}</p>
                                            {quizProgress && quizProgress.score !== undefined && (
                                                <p className="text-sm text-gray-600 mt-1">Quiz Score: {quizProgress.score} / {quizStep.questions.length}</p>
                                            )}
                                            <div className="flex items-center justify-end text-sm font-medium text-indigo-600 group-hover:text-indigo-700 mt-2">
                                                Start Learning <span className="ml-1 transition-transform group-hover:translate-x-1">&rarr;</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        /**
         * CaseStudy component for a multiple-choice case study challenge.
         * Presents a scenario and a question with multiple options.
         */
        const CaseStudy = ({ caseData, onComplete }) => {
            // State to store the user's selected answer.
            const [selectedAnswer, setSelectedAnswer] = useState([]); // Changed to array for multi-select
            const [showFeedback, setShowFeedback] = useState(false);

            // Handles the selection of an answer option.
            const handleSelect = (option) => {
                if (showFeedback) return; // Prevents changing the answer once feedback is shown

                if (Array.isArray(caseData.correctAnswer)) {
                    // Multi-select (SATA)
                    setSelectedAnswer(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    // Single select
                    setSelectedAnswer(option);
                }
            };

            const handleSubmit = () => {
                setShowFeedback(true);
                const isCorrect = Array.isArray(caseData.correctAnswer)
                    ? caseData.correctAnswer.every(ans => selectedAnswer.includes(ans)) && selectedAnswer.length === caseData.correctAnswer.length
                    : selectedAnswer.toLowerCase() === caseData.correctAnswer.toLowerCase();
                
                if (isCorrect) {
                    onComplete(); // Marks the step as complete if the correct answer is chosen.
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Case Study Challenge</h4>
                    {/* Scenario description, using dangerouslySetInnerHTML to render HTML bold tags */}
                    <p className="bg-blue-100 text-blue-800 p-3 rounded-md mb-4 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
                    <p className="font-semibold text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: caseData.question }}></p>
                    <div className="space-y-2">
                        {caseData.options.map(option => {
                            const isSelected = Array.isArray(selectedAnswer) ? selectedAnswer.includes(option) : selectedAnswer === option;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrectOption = Array.isArray(caseData.correctAnswer)
                                ? caseData.correctAnswer.includes(option)
                                : option.toLowerCase() === caseData.correctAnswer.toLowerCase();
                            
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling for options.
                            if (showFeedback) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown 
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red 
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission 
                            } 

                            return (
                                <div
                                    key={option}
                                    onClick={() => handleSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {showFeedback && ( // Display a checkmark or cross icon if feedback is active 
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : (isSelected && <span className="text-red-600 mr-2">✗</span>)
                                        )}
                                        <span className="flex-1" dangerouslySetInnerHTML={{ __html: option }}></span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {!showFeedback && (
                        <div className="mt-4 text-center">
                            <button
                                onClick={handleSubmit}
                                disabled={selectedAnswer === null || (Array.isArray(selectedAnswer) && selectedAnswer.length === 0)}
                                className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Submit Answer
                            </button>
                        </div>
                    )}
                    {showFeedback && ( // Display the explanation after an answer has been selected.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Explanation</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * StaticContentStep component for displaying basic text content.
         * Marks itself as complete immediately on render.
         */
        const StaticContentStep = ({ step, onComplete }) => {
            // For 'text' type steps, mark them as complete immediately upon rendering.
            // The effect should only run once when the component mounts to prevent an infinite loop.
            useEffect(() => {
                onComplete();
            }, []); // Empty dependency array ensures this runs only once.

            // Using dangerouslySetInnerHTML to render HTML content (e.g., <strong> tags).
            return (
                <div className="prose max-w-none text-gray-700 leading-relaxed p-4 bg-gray-50 rounded-lg shadow-inner space-y-4" dangerouslySetInnerHTML={{ __html: step.content }}>
                </div>
            );
        };

        /**
         * CompletionModal component displayed when a module is completed.
         */
        const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
                        <h3 className="text-2xl font-bold text-indigo-700 mb-4">Module Completed! 🎉</h3>
                        <p className="text-gray-700 mb-6">You've successfully completed all steps in this module. Great job!</p>
                        <div className="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={onClose}
                                className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-colors shadow-sm"
                            >
                                Back to Dashboard
                            </button>
                            {hasNextModule && (
                                <button
                                    onClick={onNextModule}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Continue to Next Module
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * LearningModule component to manage steps within the selected module.
         * Provides navigation between steps and renders the appropriate content for each.
         */
        const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
            const [activeStep, setActiveStep] = useState(0); // Manages the index of the currently active step.
            const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Controls the visibility of the sidebar on mobile.
            const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false); // State for completion modal 

            // Callback function to update the completion status of a specific step.
            const handleStepComplete = useCallback((stepId, data = {}) => {
                onProgressUpdate(module.id, stepId, { completed: true, ...data });
            }, [onProgressUpdate, module.id]);

            const moduleProgress = progress[module.id] || {};
            
            // Check if all steps in the current module are completed
            const allStepsCompletedInModule = module.steps.every(step =>
                moduleProgress[step.id] && moduleProgress[step.id].completed
            );

            // Navigates to the next step, if available.
            const handleNextStep = () => {
                // If it's the last step and all steps in the module are completed, open the modal 
                if (activeStep === module.steps.length - 1 && allStepsCompletedInModule) {
                    setIsCompletionModalOpen(true);
                } else if (activeStep < module.steps.length - 1) {
                    setActiveStep(activeStep + 1);
                }
            };

            // Navigates to the previous step, if available.
            const handlePrevStep = () => {
                if (activeStep > 0) {
                    setActiveStep(activeStep - 1);
                }
            };
            
            // Ensure module and its steps are defined before accessing properties 
            if (!module || !module.steps) {
                console.error("LearningModule received invalid module prop:", module);
                return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Loading module...</div>;
            }

            const currentStep = module.steps[activeStep];
            
            // Renders the appropriate content component based on the current step's type.
            // This function acts as a router for different interactive and static content types.
            const renderStepContent = (step) => {
                if (!step) return <p>Please select a step.</p>;

                const onCompleteForStep = (data) => handleStepComplete(step.id, data);

                switch (step.type) {
                    case 'text':
                        return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
                    case 'case_study':
                        return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
                    case 'quiz':
                        return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
                    default:
                        // Fallback for unrecognized step types, ensuring robust error handling.
                        return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
                }
            };

            const handleModalClose = () => {
                setIsCompletionModalOpen(false);
                onBack(); // Go back to dashboard when modal is closed 
            };

            const handleModalNextModule = () => {
                setIsCompletionModalOpen(false);
                onNextModule(); // Proceed to next module 
            };


            return (
                <div className="fixed inset-0 bg-gray-100 flex flex-col z-20">
                    {/* Header for the learning module, including back button and module title. */}
                    <header className="bg-white shadow-md p-4 flex items-center justify-between z-30 flex-shrink-0">
                        <button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                            <span className="hidden sm:inline">Dashboard</span>
                        </button>
                        <div className="flex items-center gap-3">
                            <h2 className="text-xl font-bold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
                        </div>
                        {/* Mobile sidebar toggle button using text/emoji placeholders. */}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </header>
                    {isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar for navigation steps within the module. */}
                        <aside className={cn(
                            "bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
                            isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
                        )}>
                            <h3 className="text-lg font-semibold mb-4 text-gray-700 px-3">Module Steps</h3>
                            <nav className="space-y-1 overflow-y-auto flex-1 pr-1">
                                {module.steps.map((step, index) => (
                                    <button
                                        key={step.id}
                                        onClick={() => {
                                            setActiveStep(index);
                                            setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
                                        }}
                                        className={cn(
                                            'w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors',
                                            activeStep === index ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'hover:bg-gray-100 text-gray-700'
                                        )}
                                    >
                                        {/* Step completion indicator */}
                                        <div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                                            {moduleProgress[step.id]?.completed ? (
                                                <svg className="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                            ) : (
                                                <div className={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
                                            )}
                                        </div>
                                        <span className="flex-1 text-sm">{step.title}</span>
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        {/* Main content area for the current step. */}
                        <main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
                            <div className="max-w-5xl mx-auto">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">{currentStep.title}</h3>
                                {renderStepContent(currentStep)}

                                {/* Navigation buttons for moving between steps. */}
                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevStep}
                                        disabled={activeStep === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                                    >
                                        Previous
                                    </button>

                                    <button
                                        onClick={handleNextStep}
                                        disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
                                        className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                    >
                                        {activeStep === module.steps.length - 1 ? 'Finish Module' : 'Next'}
                                    </button>
                                </div>
                            </div>
                        </main>
                    </div>
                    <CompletionModal
                        isOpen={isCompletionModalOpen}
                        onClose={handleModalClose}
                        onNextModule={handleModalNextModule}
                        hasNextModule={hasNextModule}
                    />
                </div>
            );
        };
        
        // --- Main App Component ---
        /**
         * The root component of the Cardiac Rhythm Interpretation learning module application.
         * Manages overall application state, including module selection, user ID, and progress.
         */
        function App() {
            // State for the currently selected learning module's ID. Null means Dashboard is active.
            const [currentModuleId, setCurrentModuleId] = useState(null);
            const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
            // State for the authenticated user's ID, used for local storage progress tracking.
            const [userId, setUserId] = useState(null);
            // State for storing the user's progress across all modules and steps.
            const [progress, setProgress] = useState({});
            // State to indicate if authentication is complete and user ID is available.
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Effect hook for handling initial authentication and setting the user ID.
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged((user) => {
                    if (user) setUserId(user.uid);
                    setIsAuthReady(true); // Mark authentication as ready once user is determined.
                });
                return () => unsubscribe(); // Cleanup the auth state listener on component unmount.
            }, []); // Empty dependency array ensures this runs only once on mount.

            // Effect hook for loading user progress from localStorage after authentication is ready.
            useEffect(() => {
                if (!isAuthReady || !userId) return; // Only proceed if auth is ready and userId is available.
                const storedProgress = localStorage.getItem(`infection-control-module-progress-${userId}`);
                if (storedProgress) {
                    try {
                        setProgress(JSON.parse(storedProgress)); // Attempt to parse and set stored progress.
                    } catch (e) {
                        console.error("Failed to parse stored progress, resetting.", e);
                        setProgress({}); // Reset progress if parsing fails (e.g., corrupted data).
                    }
                }
            }, [isAuthReady, userId]); // Reruns when auth status or userId changes.

            // Callback function to update and persist the user's progress for a specific step.
            const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
                if (!isAuthReady || !userId) return;

                setProgress(currentProgress => {
                    const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
                    const newStepProgress = { ...currentStepProgress, ...data };

                    // If the old and new step data are identical, do not update state.
                    // This prevents the infinite re-render loop.
                    // Note: This check is important for static content steps that call onComplete() immediately.
                    if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
                        return currentProgress;
                    }

                    // Otherwise, proceed with the update.
                    const newProgress = {
                        ...currentProgress,
                        [moduleId]: {
                            ...(currentProgress[moduleId] || {}),
                            [stepId]: newStepProgress
                        }
                    };

                    localStorage.setItem(`infection-control-module-progress-${userId}`, JSON.stringify(newProgress));
                    return newProgress;
                });
            }, [isAuthReady, userId]);

            const handlePreAssessmentComplete = (completedModuleIds) => {
                const newProgress = { ...progress };
                completedModuleIds.forEach(moduleId => {
                    const module = contentData[moduleId];
                    if (module) {
                        newProgress[moduleId] = {};
                        module.steps.forEach(step => {
                            newProgress[moduleId][step.id] = { completed: true };
                        });
                    }
                });
                setProgress(newProgress);
                localStorage.setItem(`infection-control-module-progress-${userId}`, JSON.stringify(newProgress));
                // The results screen is now part of the PreAssessmentQuiz component.
                // We just need to handle exiting it.
            };
            
            // Callback to reset all progress
            const handleResetProgress = useCallback(() => {
                if (!isAuthReady || !userId) return;
                // Clear from state
                setProgress({});
                // Clear from localStorage
                localStorage.removeItem(`infection-control-module-progress-${userId}`);
            }, [isAuthReady, userId]);

            // Function to navigate to the next module in the sequence
            const handleNextModule = useCallback(() => {
                const moduleIds = Object.keys(contentData);
                const currentIndex = moduleIds.indexOf(currentModuleId);
                if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
                    setCurrentModuleId(moduleIds[currentIndex + 1]);
                } else {
                    // If it's the last module, go back to the dashboard.
                    setCurrentModuleId(null);
                }
            }, [currentModuleId]);

            // Determine which module is currently selected based on `currentModuleId`.
            const selectedModule = currentModuleId && contentData[currentModuleId]
                                                            ? { ...contentData[currentModuleId], id: currentModuleId }
                                                            : null;

            const moduleIds = Object.keys(contentData);
            const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
            const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


            return (
                <div className="bg-gray-100 min-h-screen font-sans text-gray-900">
                    {isPreAssessmentActive ? (
                        <PreAssessmentQuiz 
                            onComplete={handlePreAssessmentComplete} 
                            onExit={() => setIsPreAssessmentActive(false)}
                        />
                    ) : selectedModule ? (
                        <LearningModule
                            key={selectedModule.id}
                            module={selectedModule}
                            onBack={() => setCurrentModuleId(null)}
                            progress={progress}
                            onProgressUpdate={handleProgressUpdate}
                            onNextModule={handleNextModule}
                            hasNextModule={hasNextModule}
                        />
                    ) : (
                        <Dashboard 
                            onSelectModule={setCurrentModuleId} 
                            progress={progress} 
                            onResetProgress={handleResetProgress}
                            onStartPreAssessment={() => setIsPreAssessmentActive(true)}
                        />
                    )}
                </div>
            );
        }

        // --- Render the App into the DOM ---
        // Get the DOM element where the React application will be mounted.
        const container = document.getElementById('root');
        // Create a React root, which is the entry point for React 18+ applications.
        const root = ReactDOM.createRoot(container);
        // Render the main App component into the root.
        root.render(<App />);
    </script>
</body>
</html>
