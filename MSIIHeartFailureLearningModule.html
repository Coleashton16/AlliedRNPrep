<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardiac Perfusion Nursing Module</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration to use the Inter font.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out forwards',
                    },
                },
            },
        };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Library Setup ---
        // Destructure necessary hooks from the global React object.
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Mock Authentication Setup for Standalone Demo ---
        // This mock object simulates basic user authentication to allow progress tracking via localStorage.
        // In a real application, this would be replaced with actual Firebase authentication.
        const mockAuth = {
            onAuthStateChanged: (callback) => {
                // Simulate an asynchronous authentication check, providing a unique user ID.
                setTimeout(() => callback({ uid: 'standalone-perfusion-user' }), 100);
                return () => {}; // Returns an empty function as a cleanup/unsubscribe placeholder.
            },
            signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-perfusion-user' } }), // Mock anonymous sign-in.
        };

        // --- Content & Data Structure for the Learning Modules ---
        // The main content is broken down into smaller, focused modules based on concepts from the PPTX.
        const contentData = {
            'perfusion-fundamentals': {
                title: 'Perfusion Fundamentals',
                color: 'from-blue-500 to-indigo-600',
                description: 'Understand the core concepts of perfusion, including central and tissue perfusion, and cardiac output.',
                steps: [
                    { id: 'perfusion-learning-outcomes', title: 'Perfusion: Learning Outcomes', type: 'text', content: `As nursing professionals, a deep understanding of **perfusion** is fundamental to patient care. This module will equip you with the knowledge and skills to:<br><br>
                        <ul>
                            <li><strong>Assess</strong> persons with optimal perfusion, those at risk, and those who are experiencing poor perfusion.</li>
                            <li><strong>Recognize</strong> when an individual has problems with perfusion.</li>
                            <li><strong>Identify</strong> factors that minimize the risk of perfusion disorders.</li>
                            <li><strong>Implement</strong> appropriate nursing and collaborative interventions to optimize perfusion.</li>
                            <li><strong>Evaluate</strong> the plan of care for individuals with problems of perfusion.</li>
                        </ul>
                        These outcomes are critical for providing holistic and effective care to patients with diverse perfusion needs.` },
                    { id: 'perfusion-definition', title: 'What is Perfusion?', type: 'text', content: `At its core, **perfusion** is the **blood flow through arteries and capillaries delivering nutrients and oxygen to cells**. Think of it as the body's internal delivery system, ensuring every cell receives what it needs to function.<br><br>
                        We differentiate between two main types:<br>
                        <ul>
                            <li><strong>Central Perfusion:</strong> This is the **action of the heart and large vessels to perfuse body organs and tissues**. It's the overall pumping force.</li>
                            <li><strong>Tissue Perfusion:</strong> This refers to **blood flow through arteries and capillaries to specific target tissues** (e.g., kidneys, brain, muscles).</li>
                        </ul>
                        These two types are interconnected; effective central perfusion is necessary for adequate tissue perfusion.` },
                    { id: 'central-perfusion-principles', title: 'Principles of Central Perfusion', type: 'text', content: `Central perfusion relies on several key physiological principles:<br><br>
                        <ul>
                            <li><strong>Conduction:</strong> The heart's pumping action depends on **electrical impulses that travel through cardiac tissue and trigger contraction**, leading to pumping action and ultimately perfusion. The normal pathway is from the **SA node &rarr; contraction of atria &rarr; AV node &rarr; Bundle of His & Purkinje fibers &rarr; contraction of ventricles**.</li>
                            <li><strong>Cardiac Cycle:</strong> This involves two phases:
                                <ul>
                                    <li>**Systole:** **Ventricular contraction**, when blood is ejected from the heart.</li>
                                    <li>**Diastole:** **Ventricles fill with blood**, the relaxation phase.</li>
                                </ul>
                            </li>
                            <li><strong>Cardiac Output (CO):</strong> The **amount of blood pumped by the heart per minute**. A normal adult cardiac output is typically **4-6 Liters/minute**.</li>
                        </ul>
                        Understanding these principles is vital for recognizing deviations from normal cardiac function.` },
                    { id: 'cardiac-output-determinants', title: 'Cardiac Output: Key Determinants', type: 'text', content: `The fundamental equation for cardiac output is: <strong>Cardiac Output ($\text{CO}$) = Heart Rate ($\text{HR}$) $\times$ Stroke Volume ($\text{SV}$)</strong><br><br>
                        Let's break down the components of this vital calculation:<br>
                        <ul>
                            <li><strong>Heart Rate ($\text{HR}$):</strong> The **number of cardiac contractions per minute**. Metabolic demands, such as exercise, fever, or stress, directly affect heart rate.</li>
                            <li><strong>Stroke Volume ($\text{SV}$):</strong> The **amount of blood ejected from each ventricle during contraction**. Stroke volume is influenced by three primary factors:
                                <ul>
                                    <li><strong>Preload:</strong> The **force that stretches the heart before contraction**, primarily attributed to the amount of blood in the ventricles at the end of diastole. Greater preload means more stretch.</li>
                                    <li><strong>Contractility:</strong> The **strength of contraction** of the heart muscle. A greater preload often leads to a greater strength of contraction (Frank-Starling law).</li>
                                    <li><strong>Afterload:</strong> The **force exerted by the ventricles to open the aortic and pulmonic valves**. This is influenced by **systemic vascular resistance (SVR)**, which is the resistance created by the systemic arteries that the heart must overcome to eject blood. High blood pressure increases afterload.</li>
                                </ul>
                            </li>
                        </ul>` },
                    { id: 'tissue-perfusion-arterial-bp', title: 'Tissue Perfusion and Arterial Blood Pressure', type: 'text', content: `**Tissue perfusion** is directly affected by **arterial blood pressure (BP)**. Arterial BP is determined by a combination of **cardiac output (CO)** and **systemic vascular resistance (SVR)**. The arteries play a crucial role in maintaining BP by **constricting or dilating in response to various stimuli**, thereby regulating blood flow to target tissues.<br><br>
                        This dynamic regulation ensures that tissues receive adequate blood supply even under varying physiological demands.` },
                    { id: 'perfusion-quiz', title: 'Perfusion Fundamentals Quiz', type: 'quiz',
                        questions: [
                            { question: "Which of the following best defines perfusion?", options: ["The process of gas exchange in the lungs.", "Blood flow through arteries and capillaries delivering nutrients and oxygen to cells.", "The heart's electrical activity.", "The relaxation phase of the cardiac cycle."], correctAnswer: "Blood flow through arteries and capillaries delivering nutrients and oxygen to cells." },
                            { question: "What is the formula for Cardiac Output (CO)?", options: ["CO = BP x SVR", "CO = HR x SV", "CO = Preload + Afterload", "CO = Systole - Diastole"], correctAnswer: "CO = HR x SV" },
                            { question: "The force that stretches the heart before contraction, attributed by the amount of blood in the ventricles at end of diastole, is known as:", options: ["Afterload", "Contractility", "Preload", "Systemic Vascular Resistance"], correctAnswer: "Preload" },
                            { question: "Which component of the electrical pathway initiates the impulse that causes atrial contraction?", options: ["AV Node", "Bundle of His", "Purkinje Fibers", "SA Node"], correctAnswer: "SA Node" }
                        ]
                    },
                ]
            },
            'acute-coronary-syndrome': {
                title: 'Acute Coronary Syndrome (ACS)',
                color: 'from-red-600 to-rose-500',
                description: 'Learn about angina, myocardial infarction (MI) types, assessment, and management.',
                steps: [
                    { id: 'acs-overview', title: 'Acute Coronary Syndrome Overview', type: 'text', content: `**Acute Coronary Syndrome (ACS)** is a term used to describe a range of conditions associated with sudden, reduced blood flow to the heart. It's often caused by a rupture of plaque in a coronary artery, leading to a cascade of events:<br><br>
                        1. **Plaque ruptures** in a coronary artery.
                        2. **Platelet aggregation** occurs at the site of rupture.
                        3. **Clot formation** begins, obstructing blood flow.
                        4. **Vasoconstriction** further narrows the artery.
                        5. This can lead to **50% or more occlusion**, resulting in **myocardial ischemia**.<br><br>
                        ACS includes conditions like **unstable angina** and **myocardial infarction (MI)**. Prompt recognition and intervention are critical to minimize heart muscle damage.
                        ` },
                    { id: 'unstable-angina', title: 'Unstable Angina', type: 'text', content: `**Unstable Angina** is a critical form of ACS where **ischemia causes chest pain at rest or with exertion**. Unlike stable angina, it:<br>
                        <ul>
                            <li>May be **poorly relieved by rest or nitroglycerin**.</li>
                            <li>May **last longer than 15 minutes**.</li>
                            <li>Often presents with **ST changes on EKG** (ST depression or T-wave inversion, but NO ST elevation).</li>
                            <li>Shows **no changes in Troponin** levels, indicating **no myocardial cell death** yet.</li>
                        </ul>
                        Unstable angina is a warning sign of an impending myocardial infarction and requires immediate medical attention.` },
                    { id: 'myocardial-infarction-types', title: 'Myocardial Infarction: NSTEMI vs. STEMI', type: 'text', content: `When blood flow is not restored, **myocardial tissue injury and necrosis (cell death)** occur, leading to a **Myocardial Infarction (MI)**. There are two main types:<br><br>
                        <h4>NSTEMI (Non-ST-Elevation Myocardial Infarction)</h4>
                        <ul>
                            <li>Characterized by **myocardial ischemia**.</li>
                            <li>Involves a **partial blockage of a coronary artery**.</li>
                            <li>ECG findings: **ST depression** or **T-wave inversion**.</li>
                            <li>Presents with **elevated cardiac biomarkers** (troponin, CK-MB, CK).</li>
                        </ul>
                        <h4>STEMI (ST-Elevation Myocardial Infarction)</h4>
                        <ul>
                            <li>Indicates **myocardial necrosis** (tissue death).</li>
                            <li>Results from **100% occlusion of a coronary artery**.</li>
                            <li>ECG findings: **ST elevation** (a true emergency!).</li>
                            <li>Presents with **elevated cardiac biomarkers** (troponin, CK-MB, CK).</li>
                        </ul>
                        ` },
                    { id: 'pain-assessment-pqrst', title: 'Pain Assessment: The PQRST Approach', type: 'text', content: `When assessing a patient experiencing chest pain, using the **PQRST** mnemonic ensures a thorough evaluation:<br><br>
                        <ul>
                            <li><strong>P - Precipitating/Alleviating Factors:</strong> What makes the pain better or worse?</li>
                            <li><strong>Q - Quality of Pain:</strong> How does the pain feel? (e.g., crushing, squeezing, burning, sharp, dull)</li>
                            <li><strong>R - Region and Radiation:</strong> Where is the pain located, and does it spread elsewhere?</li>
                            <li><strong>S - Severity:</strong> How intense is the pain on a scale of 0-10?</li>
                            <li><strong>T - Timing:</strong> When did the pain start, and how long has it lasted? Is it intermittent or constant?</li>
                        </ul>
                        While PQRST is essential, remember that chest pain can have other causes (etiologies) beyond cardiac issues.
                                                ` },
                    { id: 'differentiating-chest-pain', title: 'Differentiating Chest Pain Etiologies', type: 'text', content: `It's crucial to differentiate cardiac chest pain from other causes. PQRST symptoms can overlap with:<br><br>
                        <ul>
                            <li>**Pulmonary disorders:** (e.g., pneumonia, pulmonary embolism) often cause sharp, pleuritic pain.</li>
                            <li>**Musculoskeletal disorders:** (e.g., costochondritis) typically cause localized tenderness.</li>
                            <li>**Esophageal disorders:** (e.g., hiatal hernia, reflux esophagitis, spasm) can mimic cardiac pain, often described as burning.</li>
                            <li>**Pericarditis:** Inflammation of the sac around the heart, causing sharp, positional pain.</li>
                            <li>**Anxiety and panic disorders:** Can lead to chest tightness and palpitations.</li>
                        </ul>
                        However, **angina pectoris (acute coronary syndrome)**, including unstable angina and MI, often presents with specific characteristics:
                        <ul>
                            <li>**Usual distribution of pain with myocardial ischemia:** Central, pressure, squeezing, gripping, heaviness, tightness, exertional/stress-related, retrosternal.</li>
                            <li>**Less common sites of pain with myocardial ischemia:** Left arm, jaw, back, neck, epigastrium, right side.</li>
                        </ul>
                        **Higher probability of ischemia** is associated with central, pressure, squeezing, gripping, heaviness, tightness, exertional/stress-related, retrosternal pain. **Lower probability** is associated with sharp, fleeting, shifting, pleuritic, or positional pain, as well as stabbing, tearing, ripping, or burning sensations. This is a critical distinction in your assessment.
                        ` },
                    { id: 'mi-warning-signs', title: 'Myocardial Infarction: Warning Signs', type: 'text', content: `Recognizing the cues for a Myocardial Infarction is vital. Remember, symptoms can vary, especially in women.<br><br>
                        <h4>Common Pain or Discomfort:</h4>
                        <ul>
                            <li>**Substernal chest pain/pressure** radiating to the left arm.</li>
                            <li>Pain or discomfort in the **jaw, back, shoulder, or abdomen**.</li>
                            <li>Occurs **without cause**, often in the morning.</li>
                            <li>Relieved **only by opiates** (not by rest or nitroglycerin).</li>
                            <li>Lasts **30 minutes or more**.</li>
                        </ul>
                        <h4>Associated Symptoms:</h4>
                        <ul>
                            <li>Lightheadedness, dizziness, disorientation/acute confusion.</li>
                            <li>Anxiety, fear.</li>
                            <li>Nausea/vomiting.</li>
                            <li>Diaphoresis (excessive sweating).</li>
                            <li>Dyspnea (shortness of breath), feeling "short of breath."</li>
                            <li>Fatigue, palpitations, irregular heart rate.</li>
                            <li>Cough, wheezing, choking sensation.</li>
                            <li>Diminished/unequal pulses, distended neck veins.</li>
                            <li>Epigastric distress.</li>
                            <li>Dysrhythmias, especially **sinus tachycardia with premature ventricular contractions** within the first few hours after MI.</li>
                        </ul>
                        **Important for Women:** Women may experience **different or less classic symptoms**, including feeling very tired for days or weeks before a heart attack, heartburn, a cough, heart flutters, or loss of appetite.
                        ` },
                    { id: 'mi-diagnostic-assessment', title: 'MI Diagnostic Assessment', type: 'text', content: `When an MI is suspected, a rapid and accurate diagnostic assessment is crucial:<br><br>
                        <h4>Laboratory Assessment:</h4>
                        <ul>
                            <li><strong>Troponins:</strong> Myocardial muscle proteins released into the bloodstream with myocardial muscle injury. They are **cardiac specific**.
                                <ul>
                                    <li>Levels are elevated at **4–6 hours**, peak at **12–18 hours**, and return to baseline over **6–7 days**.</li>
                                    <li>Normal Range: Cardiac troponin T < 0.1 ng/mL, Cardiac troponin I < 0.03 ng/mL.</li>
                                </ul>
                            </li>
                            <li><strong>Creatine Kinase (CK) MB:</strong> An enzyme found in myocardium, elevated in **3 to 6 hours** after infarction, peaks at **10 hours**, and normalizes within **2 to 3 days**. CK-MB has **low specificity** compared to troponins.</li>
                        </ul>
                        <h4>Other Diagnostic Assessments:</h4>
                        <ul>
                            <li><strong>Electrocardiogram (ECG) alterations:</strong> Can detect myocardial ischemia or infarction (ST elevation, ST depression, T-wave inversion). An **ECG within 10 minutes** of arrival is critical.</li>
                            <li><strong>Chest x-ray:</strong> May be normal or show cardiac enlargement (hypertrophy, dilation) suggestive of heart failure (HF) or ventricular aneurysm, or pulmonary congestion, cardiac calcifications.</li>
                            <li><strong>Echocardiogram:</strong> Assesses wall motion, degree of valve abnormality, ischemic mitral regurgitation, presence of cardiac tamponade, ejection fraction, and chamber enlargement.</li>
                            <li><strong>Coronary angiography:</strong> **Visualizes narrowing/occlusion of coronary arteries**; the gold standard for identifying blockages.</li>
                            <li><strong>Stress test:</strong> Detects issues with cardiac perfusion when the heart is stressed (e.g., by exercise or medication).</li>
                        </ul>` },
                    { id: 'acs-ami-management', title: 'ACS/AMI Management: Initial Steps', type: 'text', content: `Immediate and systematic management of ACS/AMI is essential to preserve heart muscle. Initial steps include:<br><br>
                        <ul>
                            <li><strong>IV access</strong> and **Lab tests** (including Troponins, CK-MB, CK).</li>
                            <li>Perform an **EKG within 10 minutes** of arrival.</li>
                            <li>Monitor **vital signs** and perform ongoing **assessments**.</li>
                            <li>Administer medications following the **MONAB** protocol (if not contraindicated):
                                <ul>
                                    <li><strong>M - Morphine or opioids</strong> for pain control and to reduce myocardial oxygen demand.</li>
                                    <li><strong>O - Oxygen</strong> to maintain O2 saturation > 92%.</li>
                                    <li><strong>N - Nitroglycerin</strong> sublingual, if blood pressure is within an acceptable range (hold if SBP < 90 mmHg).</li>
                                    <li><strong>A - Aspirin</strong> (chewable) loading dose of 162-325 mg to prevent further platelet aggregation.</li>
                                    <li><strong>B - Beta-blocker</strong> to decrease myocardial oxygen demand and reduce the risk of arrhythmias; **contraindicated in acute HF, cardiogenic shock, bradycardia, or hypotension**.</li>
                                </ul>
                            </li>
                            <li>Provide **emotional support** to the patient and family.</li>
                            <li>Ensure **bed rest with HOB elevated** to minimize cardiac workload.</li>
                            <li>Monitor **Intake and Output (I&O)** and **tissue perfusion**.</li>
                            <li>Prevent **respiratory complications** and **pressure injuries**.</li>
                            <li>**Report changes** in the patient's condition immediately.</li>
                            <li>**Evaluate interventions** continuously.</li>
                        </ul>` },
                    { id: 'stemi-management', title: 'STEMI Management: Reperfusion Strategies', type: 'text', content: `**STEMI is a medical emergency requiring immediate reperfusion** to save myocardial tissue. "Time is Muscle!"<br><br>
                        The primary goal is to re-establish blood flow as quickly as possible:<br>
                        <ul>
                            <li>**Immediate reperfusion with Percutaneous Coronary Intervention (PCI)** is the preferred treatment if available. The goal is a **"door-to-balloon time" of less than 90 minutes**.
                                <ul>
                                    <li>During PCI, **dual antiplatelet therapy** with IV heparin and ticagrelor (an adenosine diphosphate receptor antagonist/P2Y12 inhibitor) is typically initiated.</li>
                                    <li>A **Glycoprotein IIb/IIIa inhibitor or direct thrombin inhibitor** may also be administered during the PCI procedure.</li>
                                </ul>
                            </li>
                            <li>If PCI is unavailable within 90 minutes of STEMI presentation, **reperfusion using an intravenous thrombolytic agent** (e.g., alteplase (tPA), reteplase (rPA), tenecteplase (TNK-tPA)) should be administered. Thrombolytics dissolve the thrombus in the coronary artery, allowing blood flow to resume.</li>
                        </ul>` },
                    { id: 'nstemi-management', title: 'NSTEMI Management', type: 'text', content: `Management for NSTEMI varies depending on patient stability and risk:<br><br>
                        <ul>
                            <li>For **stable, asymptomatic NSTEMI** patients, antiplatelet agents are key.</li>
                            <li>**PCI** can be performed within **48 hours of admission** if necessary, especially for high-risk patients.</li>
                            <li>In NSTEMI patients who experience **refractory ischemia** or ischemia with **hemodynamic or electrical instability**, PCI should be performed **emergently**.</li>
                        </ul>` },
                    { id: 'cardiac-catheterization-purpose', title: 'Cardiac Catheterization: Diagnostic Uses', type: 'text', content: `**Cardiac catheterization** is an invasive diagnostic test used to evaluate various heart conditions, including:<br><br>
                        <ul>
                            <li>**Congenital abnormalities**</li>
                            <li>**Coronary Artery Disease (CAD)**</li>
                            <li>**Myocardial disease**</li>
                            <li>**Valvular disease** and **valvular dysfunction**</li>
                        </ul>
                        It also helps to:
                        <ul>
                            <li>Assess conditions like stable angina, unstable angina, heart failure, ventricular dysrhythmias, and cardiogenic shock.</li>
                            <li>Determine the best therapeutic options: **percutaneous transluminal coronary angioplasty (PTCA)**, **stents**, **coronary artery bypass graft (CABG)**, valvulotomy versus valvular replacement.</li>
                            <li>Evaluate the effects of medical or invasive treatment on cardiovascular function, such as PTCA or CABG patency.</li>
                        </ul>
                        ` },
                    { id: 'cardiac-catheterization-prep', title: 'Cardiac Catheterization: Pre-Procedure Care', type: 'text', content: `Careful preparation is essential before cardiac catheterization:<br><br>
                        <ul>
                            <li>**Patient Education:** Inform the patient what to expect: palpitations as the catheter is passed up to the left ventricle, and a heat or hot flash sensation as contrast medium is injected into the heart. The cardiologist will explain the risks.</li>
                            <li>**Consent:** The cardiologist or interventional radiologist will obtain written informed consent.</li>
                            <li>**Preop Tests:** Ensure completion of CXR, CBC, coagulation studies, 12-lead EKG, electrolytes, BUN, and Creatinine.</li>
                            <li>**Hydration:** Maintain hydration before and after the procedure for renal protection, to eliminate or minimize contrast-induced renal toxicity.</li>
                            <li>**NPO Status:** Patients may have clear liquids 2 hours before the procedure; **no solids or other liquids 6 hours before the procedure**.</li>
                            <li>**Site Prep:** The catheterization site is antiseptically prepared, and hairs are clipped per agency policy.</li>
                            <li>**Allergy Assessment:** Assess for allergy to iodine-based contrast media; premedication with antihistamine or steroid may be given to patients with a history of allergy.</li>
                            <li>**Medications:** A mild sedative (moderate sedation) is typically given before the procedure.
                                <ul>
                                    <li>**Diuretics** are held to prevent dehydration and kidney stress.</li>
                                    <li>**Metformin** is held 24-48 hours before and after the procedure due to the risk of lactic acidosis in case of contrast-induced nephropathy.</li>
                                    <li>**Anticoagulants** (warfarin, apixaban, rivaroxaban, dabigatran, edoxaban) are held to decrease the risk of bleeding; some patients may be bridged with heparin.</li>
                                </ul>
                            </li>
                            <li>**Baseline Assessment:** Assess vital signs, peripheral pulses, and auscultate the heart & lungs to establish baselines.</li>
                        </ul>` },
                    { id: 'cardiac-catheterization-post-care', title: 'Cardiac Catheterization: Post-Procedure Care', type: 'text', content: `Post-procedure care is critical to prevent complications and monitor recovery:<br><br>
                        <ul>
                            <li>**Bedrest:** Maintain bedrest for 2-6 hours depending on the type of vascular closure device used.</li>
                            <li>**Positioning:** Supine position or HOB at 30 degrees during bedrest.</li>
                            <li>**Extremity Management:** Keep the insertion site extremity straight; use a soft knee brace if femoral access was used.</li>
                            <li>**Monitoring Vital Signs:** Monitor vital signs frequently: **every 15 min x 1 hr, then q 30 min x 2 hr or until stable, then q 4 hr** per agency policy.</li>
                            <li>**Insertion Site Assessment:** **Assess the insertion site for bleeding or hematoma** at each vital sign assessment.</li>
                            <li>**Peripheral Pulse Assessment:** **Assess peripheral pulses, skin temperature, and color** with each vital sign assessment, comparing to baseline. Observe for complications.</li>
                            <li>**Urine Output:** Monitor urine output carefully.</li>
                            <li>**Pain Management:** Administer pain medication as needed.</li>
                            <li>**Home Instructions:** Provide thorough discharge instructions:
                                <ul>
                                    <li>Avoid lifting and strenuous exercise for several days.</li>
                                    <li>Do not remove the dressing for 24 hours.</li>
                                    <li>Observe and report swelling, redness, warmth, and pain at the insertion site.</li>
                                </ul>
                            </li>
                        </ul>` },
                    { id: 'mi-complications', title: 'Complications of Acute Myocardial Infarction', type: 'text', content: `An MI can lead to various complications, both immediate and long-term:<br><br>
                        <ul>
                            <li>**Reinfarction, infarct extension, and post-infarction angina:** Indicating ongoing or recurrent ischemia.</li>
                            <li>**Hypotension** and **Heart Failure (HF)**: Due to reduced cardiac pumping ability.</li>
                            <li>**Dysrhythmias:**
                                <ul>
                                    <li>**Ventricular arrhythmias** (e.g., VT, V-fib).</li>
                                    <li>**Atrial fibrillation**.</li>
                                    <li>**Atrioventricular block**.</li>
                                </ul>
                            </li>
                            <li>**Pericarditis:** Inflammation of the sac surrounding the heart.</li>
                            <li>**Mechanical Complications:** Aneurysm (bulging of the heart wall).</li>
                            <li>**Embolic, thrombotic, and bleeding complications:** Including left ventricular thrombus, venous thromboembolism (VTE), and vascular access site bleeding after PCI.</li>
                        </ul>` },
                    { id: 'patient-education-acs', title: 'Patient Education: ACS & MI', type: 'text', content: `Comprehensive patient education is vital for preventing future cardiac events and promoting recovery:<br><br>
                        <ul>
                            <li>**Seek immediate medical attention/ER** if symptoms suggest an MI, such as chest pain or discomfort, shortness of breath, nausea, or lightheadedness.</li>
                            <li>**Contact emergency services (call 911)** if nitroglycerin does not provide relief from chest pain.</li>
                            <li>Adopt a **low-salt diet** to help manage high blood pressure and reduce the heart's workload.</li>
                            <li>Participate in **cardiac rehabilitation** to support recovery from AMI.</li>
                            <li>**Cease smoking** – a critical risk factor.</li>
                            <li>Ensure **medication adherence** as prescribed.</li>
                        </ul>` },
                    { id: 'acs-mi-quiz', title: 'ACS & MI Knowledge Check', type: 'quiz',
                        questions: [
                            { question: "Which of the following is characteristic of Unstable Angina?", options: ["Relieved by rest and nitroglycerin", "No ST changes on EKG", "Causes chest pain at rest or exertion, poorly relieved by rest", "No changes in Troponin, but leads to cell death"], correctAnswer: "Causes chest pain at rest or exertion, poorly relieved by rest" },
                            { question: "A patient presents with ST elevation on their EKG and elevated cardiac biomarkers. This indicates:", options: ["Unstable Angina", "NSTEMI", "STEMI", "Prinzmetal's Angina"], correctAnswer: "STEMI" },
                            { question: "When performing a pain assessment for a patient with chest pain, 'Q' in PQRST stands for:", options: ["Quantity", "Quality", "Quickness", "Quivering"], correctAnswer: "Quality" },
                            { question: "What is the primary goal for STEMI management with PCI?", options: ["Administering thrombolytics within 30 minutes", "Monitoring for cardiac arrhythmias", "Achieving 'door-to-balloon' time < 90 minutes", "Providing emotional support"], correctAnswer: "Achieving 'door-to-balloon' time < 90 minutes" },
                            { question: "A patient is scheduled for a cardiac catheterization. Which medication should be held 24-48 hours before the procedure due to the risk of lactic acidosis?", options: ["Aspirin", "Metformin", "Nitroglycerin", "Beta-blocker"], correctAnswer: "Metformin" }
                        ]
                    },
                ]
            },
            'heart-failure': {
                title: 'Heart Failure (HF)',
                color: 'from-purple-600 to-pink-500',
                description: 'Explore the types, causes, clinical manifestations, diagnostics, and management of heart failure.',
                steps: [
                    { id: 'hf-definition', title: 'Heart Failure: A Perfusion Exemplar', type: 'text', content: `**Heart Failure (HF)** is a complex clinical syndrome resulting from any structural or functional cardiac disorder that impairs the ability of the ventricle to fill or eject blood. It's a major perfusion exemplar because the heart cannot pump enough blood to meet the body's metabolic needs.<br><br>
                        HF can be classified into different types based on which side of the heart is primarily affected and the mechanism of dysfunction.` },
                    { id: 'left-sided-hf', title: 'Left-Sided Heart Failure', type: 'text', content: `**Left-sided Heart Failure** occurs when the left ventricle cannot pump enough blood to the body, leading to blood backing up into the lungs. This is the most common type of HF.<br><br>
                        <h4>Typical Causes:</h4>
                        <ul>
                            <li>**Hypertension** (high blood pressure).</li>
                            <li>**Coronary Artery Disease (CAD)**.</li>
                            <li>**Valvular disease** (e.g., aortic or mitral valve issues).</li>
                        </ul>
                        <h4>Two Main Types of Left-Sided HF:</h4>
                        <p><strong>1. Systolic Heart Failure (HFrEF - Heart Failure with Reduced Ejection Fraction):</strong></p>
                        <ul>
                            <li>Known as "forward failure" due to **weak contraction** of the left ventricle.</li>
                            <li>Characterized by **increased preload** (ventricular dilation) and often **increased afterload** (e.g., from hypertension).</li>
                            <li>Leads to a **reduced ejection fraction (EF) to less than 40%**.</li>
                            <li>Results in **decreased tissue perfusion** throughout the body and **pulmonary and systemic congestion**.</li>
                        </ul>
                        <p><strong>2. Diastolic Heart Failure (HFpEF - Heart Failure with Preserved Ejection Fraction):</strong></p>
                        <ul>
                            <li>Often called a "stiff left ventricle" because the **left ventricle cannot relax sufficiently** during diastole.</li>
                            <li>This leads to **insufficient ventricular filling**, requiring more pressure to move blood into and out of the left ventricle.</li>
                            <li>Symptoms are often similar to systolic HF, but the **ejection fraction may be normal or near normal**.</li>
                        </ul>
                        ` },
                    { id: 'left-sided-hf-manifestations', title: 'Clinical Manifestations of Left-Sided HF', type: 'text', content: `The symptoms of left-sided heart failure are primarily related to **pulmonary congestion** and **decreased cardiac output**:<br><br>
                        <ul>
                            <li>**Respiratory Symptoms:**
                                <ul>
                                    <li>**SOB or Dyspnea** (shortness of breath).</li>
                                    <li>**Crackles** (rales) in the lungs.</li>
                                    <li>**Dry, hacking cough**.</li>
                                    <li>**Pink-tinged, frothy sputum** (a sign of advanced pulmonary edema).</li>
                                    <li>**Pleural effusion**.</li>
                                    <li>**Paroxysmal Nocturnal Dyspnea (PND):** Sudden awakenings with shortness of breath at night.</li>
                                    <li>**Orthopnea:** Shortness of breath when lying flat.</li>
                                    <li>**Tachypnea:** Rapid breathing.</li>
                                </ul>
                            </li>
                            <li>**Cardiovascular Symptoms:**
                                <ul>
                                    <li>**Tachycardia**.</li>
                                    <li>**S3 and S4 heart sounds**.</li>
                                    <li>**Left ventricle heaves at the apex of the heart**.</li>
                                    <li>**Pulsus alternans:** Alternating strong and weak pulse.</li>
                                    <li>**Displacement of the point of maximal impulse (PMI)**.</li>
                                </ul>
                            </li>
                            <li>**Systemic Symptoms (due to decreased tissue perfusion):**
                                <ul>
                                    <li>Changes in **mental status** (restlessness, confusion).</li>
                                    <li>Fatigue, exertional dyspnea.</li>
                                    <li>Cool, pale extremities, delayed capillary refill, cyanosis.</li>
                                    <li>Decreased partial arterial pressure of oxygen (PaO2).</li>
                                </ul>
                            </li>
                        </ul>` },
                    { id: 'right-sided-hf', title: 'Right-Sided Heart Failure', type: 'text', content: `**Right-sided Heart Failure** occurs when the right ventricle cannot pump enough blood to the lungs, leading to a backup of blood in the systemic venous circulation.<br><br>
                        <h4>Causes:</h4>
                        <ul>
                            <li>**Left ventricular failure** (most common, as blood backs up from the left side into the lungs, increasing pressure in the pulmonary vessels, which the right side then struggles against).</li>
                            <li>**Right ventricular MI**.</li>
                            <li>**Pulmonary hypertension**.</li>
                        </ul>
                        When the right ventricle cannot empty completely, it results in **increased volume and pressure in the venous system and peripheral edema**.<br><br>
                        <h4>Clinical Manifestations of Right-Sided HF:</h4>
                        <ul>
                            <li>**Jugular vein distention (JVD)**.</li>
                            <li>**Increased abdominal girth**.</li>
                            <li>**Dependent edema** (e.g., in legs, sacrum).</li>
                            <li>**Hepatomegaly** (enlarged liver) and **hepatojugular reflux**.</li>
                            <li>**Ascites** (fluid accumulation in the abdomen).</li>
                            <li>**Anorexia, GI distress, weight gain** (due to fluid retention and liver congestion).</li>
                            <li>**Weight** is the most reliable indicator of fluid gain/loss.</li>
                        </ul>
                        ` },
                    { id: 'high-output-failure', title: 'High-Output Failure', type: 'text', content: `**High-Output Failure** is a less common type of heart failure where the heart is pumping a normal or even above-normal amount of blood, but it's still insufficient to meet the body's extremely high metabolic demands. In this situation, the **cardiac output remains normal or above normal**.<br><br>
                        <h4>Causes:</h4>
                        It's caused by increased metabolic needs or hyperkinetic conditions, such as:
                        <ul>
                            <li>**Septicemia** (sepsis).</li>
                            <li>**High fever**.</li>
                            <li>**Severe anemia**.</li>
                            <li>**Hyperthyroidism**.</li>
                        </ul>
                        In these conditions, the body's tissues demand so much oxygen and nutrients that even a healthy heart struggles to keep up, leading to signs and symptoms of heart failure.` },
                    { id: 'hf-diagnostic-assessment', title: 'Heart Failure: Diagnostic Assessment', type: 'text', content: `Accurate diagnosis of heart failure involves a combination of laboratory and imaging assessments:<br><br>
                        <h4>Laboratory Assessment:</h4>
                        <ul>
                            <li>**Serum Electrolytes:** May show elevated BUN, Creatinine, and decreased creatinine clearance (indicating renal dysfunction, which can be both a cause and effect of HF).</li>
                            <li>**Fluid Retention Indicators:** Often have low Hct due to hemodilution (if fluid overloaded).</li>
                            <li>**Anemia Assessment:** If HF is from anemia, check hemoglobin and hematocrit.</li>
                            <li>**BNP (B-type Natriuretic Peptide):** Elevated levels indicate ventricular stretch and are a key biomarker for HF.</li>
                            <li>**Urinalysis:** May reveal microalbuminuria and high specific gravity, serving as an early warning sign of renal involvement.</li>
                            <li>**ABGs (Arterial Blood Gases):**
                                <ul>
                                    <li>**Hypoxemia** (low oxygen in blood).</li>
                                    <li>**Respiratory alkalosis** from hyperventilation.</li>
                                    <li>**Respiratory acidosis** from CO2 retention (in more severe cases).</li>
                                    <li>**Metabolic acidosis** from lactic acid accumulation (due to poor tissue perfusion).</li>
                                </ul>
                            </li>
                        </ul>
                        <h4>Imaging Assessment:</h4>
                        <ul>
                            <li>**Chest X-ray (CXR):** Can show **cardiomegaly** (heart enlargement from hypertrophy or dilation), pulmonary congestion, or cardiac calcifications.</li>
                            <li>**Echocardiography:** Considered the **best tool to diagnose HF**. It evaluates:
                                <ul>
                                    <li>**Ejection fraction (EF)**.</li>
                                    <li>Cardiac valvular changes, pericardial effusion.</li>
                                    <li>Chamber enlargement, ventricular hypertrophy.</li>
                                </ul>
                            </li>
                            <li>**Radionuclide Studies:** Used to indicate the cause of HF.</li>
                            <li>**Multigated Acquisition (MUGA) Scans:** Provide information on left ventricular EF and velocity.</li>
                        </ul>` },
                    { id: 'hf-compensatory-mechanisms', title: 'Compensatory Mechanisms in Heart Failure', type: 'text', content: `When the heart begins to fail, the body activates several compensatory mechanisms to try and maintain cardiac output and systemic blood pressure. While these initially help, over time they can worsen heart failure:<br><br>
                        <ul>
                            <li>**Decreased Cardiac Output & Systemic Blood Pressure** lead to:</li>
                            <li>**Baroreceptors Activated:** In the left ventricle, aortic arch, and carotid sinus.</li>
                            <li>**Vasomotor Regulatory Centers in Medulla Stimulated** &rarr; **Sympathetic Nervous System (SNS) Activated**:
                                <ul>
                                    <li>Increased **Catecholamines** (epinephrine and norepinephrine).</li>
                                    <li>Results in **Vasoconstriction**, increased **Afterload**, increased **Blood Pressure**, and increased **Heart Rate**.</li>
                                    <li>This also contributes to **Ventricular remodeling** (hypertrophy and dilation of the ventricle, genetically large cells, impaired contractility).</li>
                                </ul>
                            </li>
                            <li>**Decreased Perfusion to Kidneys** &rarr; **Renin-Angiotensin-Aldosterone System (RAAS) Activated**:
                                <ul>
                                    <li>Kidneys release **Renin**.</li>
                                    <li>Renin activates **Angiotensin I**, which converts to **Angiotensin II** in the lungs.</li>
                                    <li>Angiotensin II causes **Vasoconstriction** (increasing afterload and BP) and stimulates the release of **Aldosterone** from the kidneys.</li>
                                    <li>Aldosterone leads to **retention of sodium and water**, and release of **Arginine Vasopressin** (ADH) and **Cytokines** (tumor necrosis factor-$\alpha$). This increases preload.</li>
                                    <li>The retention of fluid also contributes to **Ventricular remodeling**.</li>
                                </ul>
                            </li>
                        </ul>
                        This intricate system tries to compensate, but chronic activation ultimately overburdens the failing heart.
                        ` },
                    { id: 'hf-stages-acc-aha', title: 'Stages of Heart Failure (ACC/AHA)', type: 'text', content: `The American College of Cardiology (ACC) and American Heart Association (AHA) classify heart failure into stages to guide treatment and prognosis:<br><br>
                        <h4>Stage A: At Risk for HF</h4>
                        <ul>
                            <li>**Asymptomatic**, with no structural heart abnormalities.</li>
                            <li>Focus on **prevention of HF** and **risk factor modification** (e.g., managing hypertension, diabetes, hyperlipidemia).</li>
                        </ul>
                        <h4>Stage B: Pre-HF</h4>
                        <ul>
                            <li>**Asymptomatic**, but has **structural heart disease**, elevated biomarkers, or abnormal cardiac imaging (e.g., LV hypertrophy, LV dilation, reduced EF).</li>
                            <li>Focus on **early intervention** with medications like ACE inhibitors (ACEi), Angiotensin Receptor Blockers (ARB), Angiotensin Receptor-Neprilysin Inhibitors (ARNI), beta-blockers, and statins (if indicated).</li>
                        </ul>
                        <h4>Stage C: Symptomatic HF</h4>
                        <ul>
                            <li>Has **structural heart disease with prior or current symptoms of HF**: dyspnea, fatigue, exercise intolerance, edema.</li>
                            <li>Management includes ARNI/ACEi, beta-blockers, Sodium-Glucose Cotransporter-2 (SGLT2) inhibitors, aldosterone antagonists, digoxin, and diuretics.</li>
                            <li>May also involve device therapies like Internal Cardioverter Defibrillators (ICD) or Cardiac Resynchronization Therapy (CRT) / Biventricular pacemakers.</li>
                        </ul>
                        <h4>Stage D: Advanced HF</h4>
                        <ul>
                            <li>**Refractory, end-stage HF** with persistent symptoms despite maximal therapy, frequent hospitalizations, and advanced structural disease.</li>
                            <li>Treatment options include Left Ventricular Assist Devices (LVAD), heart transplant, or palliative care.</li>
                        </ul>` },
                    { id: 'hf-medications-overview', title: 'Heart Failure Medications: Overview', type: 'text', content: `Pharmacological management is a cornerstone of heart failure treatment. The goals of treatment are to:<br><br>
                        <ul>
                            <li>**Risk reduction**.</li>
                            <li>**Manage critical components of cardiac output** (preload, afterload, contractility).</li>
                            <li>**Control compensatory mechanisms**.</li>
                            <li>**Manage comorbidities**: BP control, glucose control, weight loss, optimize lipid levels.</li>
                            <li>Encourage **smoking cessation**.</li>
                        </ul>
                        Many classes of medications are used, each with a specific mechanism of action to improve cardiac function and reduce symptoms.` },
                    { id: 'hf-meds-ace-inhibitors', title: 'HF Meds: ACE Inhibitors', type: 'text', content: `**Class: Angiotensin-Converting Enzyme (ACE) Inhibitors**<br>
                        **Examples:** Lisinopril (Prinivil, Zestril), Benazepril (Lotensin), Captopril (Capoten), Enalapril/enalaprilat (Vasotec), Fosinopril (Monopril), Quinapril (Accupril), Ramipril (Altace), Trandolapril (Mavik)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>**Decrease BP and afterload** by preventing the conversion of angiotensin I to angiotensin II (a potent vasoconstrictor).</li>
                            <li>**Relieve signs and symptoms of HF**.</li>
                            <li>**Prevent progression of HF** by reducing cardiac remodeling.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Observe for **dizziness, symptomatic hypotension** (hold if SBP less than 90 mmHg).</li>
                            <li>Monitor for **increased serum potassium** (K#) and **worsening renal function**.</li>
                            <li>Watch for **angioedema** (swelling of face, lips, tongue, or throat) – a serious side effect.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Avoid over-the-counter **NSAIDs**, as they can reduce the effectiveness of ACE inhibitors.</li>
                            <li>Report persistent dry cough (a common side effect).</li>
                        </ul>` },
                    { id: 'hf-meds-arbs', title: 'HF Meds: Angiotensin Receptor Blockers (ARBs)', type: 'text', content: `**Class: Angiotensin Receptor Blockers (ARBs)**<br>
                        **Examples:** Valsartan (Diovan), Candesartan (Atacand), Eprosartan (Teveten), Irbesartan (Avapro), Telmisartan (Micardis), Losartan (Cozaar)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>**Decrease BP and afterload** by blocking angiotensin II from binding to its receptors.</li>
                            <li>**Relieve signs and symptoms of HF**.</li>
                            <li>**Prevent progression of HF**.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Observe for **symptomatic hypotension** (hold if SBP less than 90 mmHg).</li>
                            <li>Monitor for **increased serum potassium (K#)**, sodium (Na), and **worsening renal function**.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>**Regular BP monitoring** is essential.</li>
                            <li>Similar to ACE inhibitors, they are often used when ACE inhibitors are not tolerated (e.g., due to cough).</li>
                        </ul>` },
                    { id: 'hf-meds-arnis', title: 'HF Meds: Angiotensin Receptor-Neprilysin Inhibitors (ARNIs)', type: 'text', content: `**Class: Angiotensin Receptor-Neprilysin Inhibitors (ARNIs)**<br>
                        **Example:** Valsartan/Sacubitril (Entresto)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>This is a **newer class of medication that combines an ARB with a neprilysin inhibitor**.</li>
                            <li>**Neprilysin** is an enzyme that breaks down natriuretic peptides (like BNP), which are naturally diuretic and vasodilatory. By **blocking neprilysin**, ARNIs allow natriuretic peptides to remain active, **increasing urine output and dilating blood vessels**, thus reducing preload and afterload.</li>
                            <li>They also **inhibit the breakdown of bradykinin** (though bradykinin is a cause of angioedema, so careful monitoring is needed).</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>The **combination of an ACE inhibitor and ARNI increases the risk for angioedema**. They should **not be given at the same time or within 36-hours of an ACE inhibitor**.</li>
                            <li>Should **not be given to patients who have had angioedema in the past**.</li>
                            <li>Monitor for symptomatic hypotension and renal dysfunction.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Understand the 36-hour washout period when switching from an ACE inhibitor.</li>
                            <li>Report any signs of swelling (angioedema) immediately.</li>
                        </ul>` },
                    { id: 'hf-meds-antidysrhythmics', title: 'HF Meds: Antidysrhythmics', type: 'text', content: `**Class: Antidysrhythmics**<br>
                        **Examples:** Amiodarone (Cordarone), Sotalol (Betapace), Ibutilide (Corvert)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>Class III antiarrhythmic agents that have **sympatholytic (antiadrenergic) effects on the heart and AV node blocking properties**.</li>
                            <li>Used to **suppress atrial fibrillation and significant ventricular dysrhythmias**, which are common in HF.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>**Side effects can be significant:** pulmonary toxicity, skin discoloration (blue-gray), hepatic dysfunction, thyroid enlargement, corneal deposits, optic neuropathy.</li>
                            <li>Significant **interactions with warfarin and digoxin**.</li>
                            <li>**Monitor cardiac rhythm (EKG)**, BP, and HR closely.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Educate about potential side effects and the importance of regular follow-up monitoring.</li>
                            <li>Report any new or worsening symptoms.</li>
                        </ul>` },
                    { id: 'hf-meds-anticoagulants', title: 'HF Meds: Anticoagulants', type: 'text', content: `**Class: Anticoagulants**<br>
                        **Examples:** Heparin, Low molecular weight heparin (Lovenox, Fragmin), Dabigatran (Pradaxa), Warfarin (Coumadin)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>**Inhibit specific factors in the clotting cascade** and **decrease the risk of thrombus formation**.</li>
                            <li>Given in patients with **dysrhythmias** (e.g., atrial fibrillation) to prevent stroke, and for **venous thromboembolism (VTE) prophylaxis**.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>**Monitor for bleeding:** from gums, puncture sites, hemoptysis, hematuria.</li>
                            <li>Monitor coagulation labs: **PT/INR** (for warfarin), **aPTT** (for heparin).</li>
                            <li>Monitor for **thrombocytopenia** (low platelet count).</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Emphasize the importance of **follow-up lab monitoring**.</li>
                            <li>Teach about the impact of **alcohol and food containing vitamin K** (for warfarin).</li>
                            <li>Educate on bleeding precautions.</li>
                        </ul>` },
                    { id: 'hf-meds-antianxiety', title: 'HF Meds: Anti-Anxiety Agents', type: 'text', content: `**Class: Anti-anxiety agents (Benzodiazepines)**<br>
                        **Examples:** Alprazolam (Xanax), Chlordiazepoxide (Librium), Diazepam (Valium), Lorazepam (Ativan)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>Act as **CNS depressants**, producing relaxation and calmness.</li>
                            <li>Used to manage **anxiety**, which is common in patients with heart conditions.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Monitor for **drowsiness, ataxia, dizziness**.</li>
                            <li>These medications can cause respiratory depression, especially if combined with other CNS depressants.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Teach about non-pharmacological methods for anxiety reduction: relaxation techniques, deep breathing exercises, massage, guided imagery.</li>
                            <li>Warn about potential for sedation and impaired coordination.</li>
                        </ul>` },
                    { id: 'hf-meds-beta-blockers', title: 'HF Meds: Beta-adrenergic Blocking Agents (Beta-blockers)', type: 'text', content: `**Class: Beta-adrenergic Blocking Agents (Beta-blockers)**<br>
                        **Examples:** Metoprolol (Lopressor, Toprol), Atenolol (Tenormin), Carvedilol (Coreg), Ivabradine (a newer drug)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>**Dilate blood vessels and decrease afterload**.</li>
                            <li>**Decrease heart rate and myocardial oxygen demand**.</li>
                            <li>**Reduce signs and symptoms of HF**, hypotension, and fatigue.</li>
                            <li>**Improve exercise capacity**.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Observe for **decreased heart rate, symptomatic hypotension, and fatigue**.</li>
                            <li>Can **worsen bronchospasm in patients with reactive airway disease** (e.g., asthma, COPD), so monitor closely.</li>
                            <li>**Ivabradine** is a newer agent specifically for reducing heart rate.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Teach about side effects like fatigue, dizziness, and fluid retention.</li>
                            <li>Instruct patients to **take their pulse** before administration and to hold the medication and contact their provider if HR is below a specified limit (e.g., < 60 bpm).</li>
                        </ul>` },
                    { id: 'hf-meds-cardiac-glycoside', title: 'HF Meds: Cardiac Glycoside (Digoxin)', type: 'text', content: `**Class: Cardiac Glycoside (Positive Inotropic Medication)**<br>
                        **Example:** Digoxin (Lanoxin)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>**Increases cardiac contractility** (positive inotropic effect) and **reduces heart rate** (negative chronotropic effect).</li>
                            <li>It inhibits the Na-K pump in myocardial cells, stimulating calcium influx via the Na-calcium exchange pump, thus increasing cardiac contractility.</li>
                            <li>Slows down AV node conduction, which decreases heart rate.</li>
                            <li>Used in patients with **NYHA III or IV symptoms** (more severe HF).</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Monitor closely for **digoxin toxicity**: nausea, vomiting, visual disturbances (e.g., **yellow halos around lights**), bradycardia, dysrhythmias.</li>
                            <li>**Electrolyte interaction is crucial:** If **potassium (K) increases, the action of digoxin is inhibited**. If **potassium (K) decreases, digoxin action is enhanced** (increasing toxicity risk).</li>
                            <li>**Take apical pulse for one full minute before administration.** Hold if HR < 60 bpm (or per provider's order) and contact the provider.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Recognize and report signs of toxicity.</li>
                            <li>Understand the importance of regular pulse checks and avoiding sudden changes in potassium intake.</li>
                        </ul>` },
                    { id: 'hf-meds-diuretics', title: 'HF Meds: Diuretics', type: 'text', content: `**Class: Diuretics**<br>
                        Diuretics are essential for managing fluid overload in heart failure.<br><br>
                        <h4>Loop Diuretics:</h4>
                        **Examples:** Bumetanide (Bumex), Furosemide (Lasix), Torsemide (Demadex), Metolazone (Zaroxolyn)<br>
                        **MOA:** Block sodium and chloride reabsorption in the loop of Henle, leading to increased excretion of water.
                        **Nursing/Patient Ed:**
                        <ul>
                            <li>**Decrease preload** and increase diuresis, decreasing pulmonary and peripheral edema, and hypertension.</li>
                            <li>Monitor **I&O**.</li>
                            <li>Monitor for **hypokalemia**, orthostatic hypotension, and dysrhythmias.</li>
                            <li>If the patient is diabetic, monitor **blood glucose** as some loop diuretics can affect it.</li>
                            <li>Emphasize **daily weight** monitoring and **sodium and water restriction**.</li>
                            <li>Report if edema worsens.</li>
                        </ul>
                        <h4>Thiazide Diuretics:</h4>
                        **Example:** Hydrochlorothiazide (Hydrodiuril)<br>
                        **MOA:** Block sodium reabsorption in the distal convoluted tubule.<br>
                        **Nursing/Patient Ed:** Similar to loop diuretics, but generally less potent. Monitor for hypokalemia and dehydration.
                        <br>
                        <h4>Aldosterone Antagonists (Potassium-Sparing Diuretics):</h4>
                        **Examples:** Spironolactone (Aldactone), Eplerenone (Inspra)<br>
                        **MOA:** Block the release of aldosterone, which is activated in HF. By blocking aldosterone, these drugs enhance the excretion of sodium and the **retention of potassium**.<br>
                        **Nursing/Patient Ed:**
                        <ul>
                            <li>Monitor for **hyperkalemia** and renal dysfunction.</li>
                            <li>Watch for gynecomastia (breast enlargement in men) with spironolactone.</li>
                            <li>Avoid **NSAIDs and COX-2 inhibitors** as they can worsen hyperkalemia and renal dysfunction.</li>
                            <li>Avoid **high-potassium-containing foods**.</li>
                        </ul>` },
                    { id: 'hf-meds-nitrates', title: 'HF Meds: Nitrates', type: 'text', content: `**Class: Nitrates**<br>
                        **Examples:** Hydralazine and isosorbide dinitrate (BiDil), Nitroglycerin (NTG), Isosorbide dinitrate (Isordil), Isosorbide mononitrate (Imdur)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>Potent **vasodilators** that directly act on the vessel wall to produce vasodilation and increase blood flow.</li>
                            <li>**Decrease preload** by venous dilation, **lower myocardial oxygen demand**, and **decrease blood pressure**.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Monitor **BP closely**; hold if SBP less than 90 mmHg.</li>
                            <li>Monitor for common side effects like **headache** and **orthostatic hypotension**.</li>
                            <li>**Hydralazine and isosorbide dinitrate (BiDil)** should not be used in patients who have not tried ACE inhibitors or ARBs first.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Report headaches, which are common and usually treatable with acetaminophen.</li>
                            <li>Change positions slowly to prevent dizziness from orthostatic hypotension.</li>
                        </ul>` },
                    { id: 'hf-meds-phosphodiesterase-inhibitors', title: 'HF Meds: Phosphodiesterase Inhibitors', type: 'text', content: `**Class: Phosphodiesterase Inhibitors**<br>
                        **Examples:** Milrinone (Primacor), Inamrinone (Inocor)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>Act as **positive inotropic agents** (increase contractility) and **vasodilators**.</li>
                            <li>Block the enzyme phosphodiesterase III in cardiac and smooth muscle, leading to increased amounts of calcium available for myocardial contraction.</li>
                            <li>Indicated in **acute decompensated heart failure** when the heart needs immediate support.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Patient must be on a **cardiac monitor for the duration of administration**.</li>
                            <li>Usually administered as a **short-term IV infusion for 2 to 3 days**.</li>
                            <li>Constant monitoring for **ventricular dysrhythmias** is critical.</li>
                            <li>Monitor for **thrombocytopenia** and headache.</li>
                            <li>Implement **bleeding precautions**.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Due to IV administration in acute settings, education will focus on safety and reporting new symptoms.</li>
                        </ul>` },
                    { id: 'hf-meds-sglt2-inhibitors', title: 'HF Meds: Sodium-Glucose Cotransporter-2 (SGLT2) Inhibitors', type: 'text', content: `**Class: Sodium-Glucose Cotransporter-2 (SGLT2) Inhibitors**<br>
                        **Examples:** Empagliflozin (Jardiance), Dapagliflozin (Farxiga), Canagliflozin (Invokana), Ertugliflozin (Steglatro)<br><br>
                        **Mechanism of Action (MOA):**
                        <ul>
                            <li>SGLT2 proteins in the proximal tubule of the kidneys normally reabsorb 90% of filtered glucose back into the bloodstream.</li>
                            <li>SGLT2 inhibitors **block the reabsorption of glucose**, leading to **more glucose being excreted in the urine**.</li>
                            <li>This results in **decreased blood glucose**, **osmotic diuresis** (increased urine output), and **mild natriuresis** (sodium loss). These effects reduce cardiac workload and improve outcomes in HF.</li>
                        </ul>
                        **Nursing Considerations:**
                        <ul>
                            <li>Monitor for **hypoglycemia** (especially in diabetic patients) and **ketoacidosis/DKA**.</li>
                            <li>Monitor **eGFR, BUN, and Creatinine**; the drug may be stopped with kidney decline.</li>
                            <li>Assess **hydration status** due to the risk for **volume depletion, hypotension, and dizziness**.</li>
                            <li>Monitor for **UTI & genital mycotic infections** due to increased glucose in urine.</li>
                            <li>Hold the drug when scheduled for diagnostics with contrast dye, surgery, or serious illness.</li>
                        </ul>
                        **Patient Education:**
                        <ul>
                            <li>Practice **perineal/genital hygiene** to reduce the risk of yeast infections.</li>
                            <li>Report signs of infection: dysuria, fever, genital itching/discharge.</li>
                            <li>**Stay hydrated**.</li>
                            <li>Report signs of DKA: persistent abdominal pain, nausea, vomiting.</li>
                            <li>Teach patients (especially those with diabetes) to **monitor blood glucose**.</li>
                        </ul>` },
                    { id: 'hf-assessment-management-guide', title: 'HF Assessment & Management Guide', type: 'text', content: `Managing heart failure requires continuous assessment and a multi-faceted approach. Key nursing considerations include:<br><br>
                        <h4>Assessment:</h4>
                        <ul>
                            <li>Monitor for **hyper and hypotension**, **tachycardia**, **tachypnea**.</li>
                            <li>Auscultate for **pulmonary crackles** and assess for **dry cough**.</li>
                            <li>Identify **dysrhythmias**.</li>
                            <li>Monitor **urine output** and **daily weight**.</li>
                            <li>Review labs: **Elevated BNP, Creatinine, BUN, hepatic enzymes**. Look for **hypokalemia** (especially with diuretics) and **anemia**.</li>
                        </ul>
                        <h4>Management:</h4>
                        <ul>
                            <li>Ensure adequate **oxygenation**.</li>
                            <li>Maintain **HOB elevated** to improve breathing.</li>
                            <li>Administer prescribed **medications** (as discussed in previous steps).</li>
                            <li>Implement **salt and water restriction**: typically **2 Liter/2 gram Na or less** per day.</li>
                            <li>Encourage appropriate **activity and rest periods**.</li>
                            <li>Consider referral to **cardiac rehab, Life Vest, or AICD** (Automatic Implantable Cardioverter-Defibrillator) as indicated.</li>
                            <li>Educate the patient on **recognizing worsening signs and symptoms**.</li>
                            <li>Perform **depression screening**, as it's common in chronic illness.</li>
                        </ul>
                        This comprehensive approach helps to stabilize the patient, reduce symptoms, and prevent disease progression.
                        ` },
                    { id: 'hf-weight-fluid-management', title: 'HF: Weight & Fluid Management', type: 'text', content: `Effective weight and fluid management are crucial for patients with heart failure to prevent exacerbations:<br><br>
                        <h4>Daily Weight Monitoring:</h4>
                        <ul>
                            <li>**Weigh daily, even if asymptomatic.**</li>
                            <li>Weigh at the **same time of the day**, preferably before eating or drinking, after urination, using the same scale, and wearing the same amount of clothing. This ensures accuracy and consistency.</li>
                            <li>The goal is to **maintain "dry weight"** (the patient's optimal weight without excess fluid).</li>
                            <li>**Report sudden weight gain immediately:** **3 pounds over 2 days** or **3 to 5 lbs in 1 week** indicates significant fluid retention and potential worsening HF.</li>
                        </ul>
                        <h4>Fluid Restriction:</h4>
                        <ul>
                            <li>A fluid restriction of **1.5-2 L per day** is often prescribed, based on patient symptoms and fluid status.</li>
                            <li>Teach patients strategies to lessen thirst, such as **chewing sugarless gum or candy**.</li>
                        </ul>` },
                    { id: 'hf-sodium-exercise-monitoring', title: 'HF: Sodium, Exercise, & Ongoing Monitoring', type: 'text', content: `Beyond medications, lifestyle management is key in heart failure:<br><br>
                        <h4>Sodium Intake:</h4>
                        <ul>
                            <li>For patients in **Stages A & B heart failure**, restrict daily sodium intake to **1500 milligrams** to help manage fluid retention and blood pressure.</li>
                        </ul>
                        <h4>Exercise:</h4>
                        <ul>
                            <li>**Regular physical activity is recommended** and considered safe and effective for heart failure patients who have the capability to do so.</li>
                            <li>However, patients should **always talk to their physician before starting** or significantly changing an exercise regimen.</li>
                        </ul>
                        <h4>Ongoing Monitoring (FACES):</h4>
                        Regular monitoring of symptoms is vital for early detection of worsening HF. Educate patients to be aware of:
                        <ul>
                            <li>**F** - **Fatigue**</li>
                            <li>**A** - limitation of **Activities**</li>
                            <li>**C** - chest **Congestion** or **Cough**</li>
                            <li>**E** - **Edema**</li>
                            <li>**S** - **Shortness of Breath**</li>
                            <li>Also, be aware of swelling or abdominal discomfort, sudden weight gain, and difficulty sleeping.</li>
                        </ul>` },
                    { id: 'lvad', title: 'Left Ventricular Assist Devices (LVAD)', type: 'text', content: `For patients with advanced heart failure, a **Left Ventricular Assist Device (LVAD)** can provide critical support. An LVAD is a mechanical pump implanted in the chest that helps the heart pump blood.<br><br>
                        **How an LVAD Works:** It continuously takes blood from the left ventricle and moves it to the aorta, effectively working with the heart to help pump more blood with less work.<br><br>
                        LVADs are used as different types of therapies:
                        <ul>
                            <li>**Bridge to Transplant:** Supports the heart while the patient awaits a heart transplant.</li>
                            <li>**Destination Therapy:** A long-term solution for patients who are not candidates for a heart transplant.</li>
                            <li>**Bridge to Recovery:** In some cases, the LVAD can allow the heart to recover, and the device may eventually be removed (less common).</li>
                        </ul>
                        ` },
                    { id: 'lvad-post-op-care', title: 'LVAD: Post-Operative Care Themes', type: 'text', content: `Post-operative care for LVAD patients is intensive and focuses on several key themes:<br><br>
                        **Primary Goal: Activity and Infection Prevention**<br>
                        <ul>
                            <li>**Early Mobilization:** Getting the patient **up and out of bed** as soon as possible is critical for recovery and preventing complications.</li>
                            <li>**Respiratory Care:** Frequent use of **incentive spirometry** to prevent pulmonary complications (e.g., pneumonia, atelectasis).</li>
                            <li>**Chest Tubes:** Management of chest tubes for drainage after surgery.</li>
                            <li>**Pain Management:** Effective pain control to facilitate activity and comfort.</li>
                            <li>**Activity & Restrictions:** Careful management of activity levels and any physical restrictions during recovery.</li>
                            <li>**Emotional Care:** Providing emotional support is paramount as patients and families adjust to living with an LVAD.</li>
                        </ul>` },
                    { id: 'hf-quiz', title: 'Heart Failure Knowledge Check', type: 'quiz',
                        questions: [
                            { question: "Which type of heart failure is characterized by a 'stiff left ventricle' where the left ventricle cannot relax sufficiently during diastole?", options: ["Systolic Heart Failure", "Right-Sided Heart Failure", "Diastolic Heart Failure", "High-Output Failure"], correctAnswer: "Diastolic Heart Failure" },
                            { question: "A patient with left-sided heart failure presents with pink-tinged, frothy sputum. This is a sign of:", options: ["Normal cardiac output", "Improved oxygenation", "Advanced pulmonary edema", "Decreased preload"], correctAnswer: "Advanced pulmonary edema" },
                            { question: "Which of the following laboratory findings is a key biomarker for heart failure, indicating ventricular stretch?", options: ["Elevated Creatinine", "Low Hemoglobin", "Elevated BNP", "Decreased Potassium"], correctAnswer: "Elevated BNP" },
                            { question: "According to ACC/AHA stages, a patient who is asymptomatic but has structural heart disease like LV hypertrophy is in which stage of HF?", options: ["Stage A", "Stage B", "Stage C", "Stage D"], correctAnswer: "Stage B" },
                            { question: "When administering Digoxin to a heart failure patient, the nurse should hold the medication and contact the provider if the apical heart rate is below what threshold?", options: ["50 bpm", "60 bpm", "70 bpm", "80 bpm"], correctAnswer: "60 bpm" },
                            { question: "Which instruction is most critical for a nurse to provide a patient with heart failure regarding daily weight monitoring?", options: ["Weigh once a week at any time of day.", "Report a sudden weight gain of 1 pound in a week.", "Weigh daily at the same time, before eating, after urination, with similar clothing.", "Only weigh if you feel symptomatic."], correctAnswer: "Weigh daily at the same time, before eating, after urination, with similar clothing." }
                        ]
                    },
                ]
            },
            'shock-hypovolemic': {
                title: 'Shock & Hypovolemic Shock',
                color: 'from-sky-700 to-cyan-600',
                description: 'Understand the stages of shock and specific management for hypovolemic shock.',
                steps: [
                    { id: 'shock-definition', title: 'Shock: A Critical Perfusion Issue', type: 'text', content: `**Shock** is a life-threatening condition characterized by **widespread abnormal cellular metabolism occurring when gas exchange and tissue perfusion do not maintain cell function**. Essentially, the body's cells aren't getting enough oxygen and nutrients, leading to cellular dysfunction and organ damage. It's a critical breakdown in the body's delivery system.<br><br>
                        Understanding the stages of shock is crucial for early recognition and intervention.` },
                    { id: 'shock-initial-stage', title: 'Initial Stage of Shock', type: 'text', content: `The **Initial Stage of Shock** is often subtle and challenging to detect:<br><br>
                        <ul>
                            <li>**Decreased perfusion begins** at the cellular level.</li>
                            <li>**Compensatory responses** are initiated, including vascular constriction and increased heart rate, attempting to maintain vital organ perfusion.</li>
                            <li>It is **difficult to detect indicators of shock at this stage** as there are often no obvious clinical signs or symptoms. The body is successfully compensating.</li>
                        </ul>
                        Nurses need a high index of suspicion, especially in at-risk patients, to catch subtle changes.` },
                    { id: 'shock-compensatory-stage', title: 'Compensatory Stage of Shock', type: 'text', content: `In the **Compensatory Stage of Shock**, the body's mechanisms are actively working to maintain homeostasis despite decreased perfusion:<br><br>
                        <ul>
                            <li>**Decreased perfusion triggers compensatory mechanisms** more actively.</li>
                            <li>**Kidney and hormonal compensatory mechanisms are activated** (e.g., activation of the Renin-Angiotensin-Aldosterone System and release of ADH).</li>
                            <li>As a result, **urine output decreases** (due to renal vasoconstriction and fluid retention) and **blood vessel constriction increases** (to shunt blood to vital organs).</li>
                            <li>**Thirst and anxiety** are common **subjective changes** reported by patients as early signs of sympathetic nervous system activation and fluid shifts.</li>
                        </ul>
                        At this stage, signs are more apparent, and intervention can often prevent progression.` },
                    { id: 'shock-progressive-stage', title: 'Progressive Stage of Shock', type: 'text', content: `The **Progressive Stage of Shock** is a life-threatening emergency where compensatory mechanisms begin to fail and organ damage becomes evident:<br><br>
                        <ul>
                            <li>**Vital organs develop hypoxia**, and **some tissues begin to die** due to prolonged inadequate perfusion.</li>
                            <li>Clinical signs become pronounced: **rapid, low pulse; low BP; pallor; cool, moist skin; anuria (absence of urine output); and a decrease in oxygen saturation**.</li>
                            <li>This is a **life-threatening emergency**.</li>
                            <li>**Conditions causing shock must be corrected within 1 hour or less** to prevent irreversible damage and death.</li>
                        </ul>
                        Immediate, aggressive intervention is paramount in this stage.` },
                    { id: 'shock-refractory-stage', title: 'Refractory Stage of Shock', type: 'text', content: `The **Refractory Stage of Shock** represents irreversible shock, where interventions are no longer effective:<br><br>
                        <ul>
                            <li>The patient is **not responding to therapies**.</li>
                            <li>**Too little oxygen reaches tissues**; cell death and tissue damage become widespread and severe.</li>
                            <li>**MODS (Multiple Organ Dysfunction Syndrome)** develops – a sequence of cell damage caused by the massive release of toxic metabolites and enzymes from dying cells.</li>
                            <li>Clinical presentation includes: **rapid loss of consciousness, nonpalpable pulse, cold, dusky extremities; slow, shallow respirations; and unmeasurable oxygen saturation**.</li>
                            <li>At this stage, organ damage is so extensive that recovery is highly unlikely, despite interventions.</li>
                        </ul>` },
                    { id: 'hypovolemic-shock', title: 'Hypovolemic Shock: Perfusion Exemplar', type: 'text', content: `**Hypovolemic Shock** is a specific type of shock caused by **loss of vascular volume resulting in decreased Mean Arterial Pressure (MAP)**. This reduction in circulating blood volume leads to inadequate tissue perfusion.<br><br>
                        <h4>Causes of Hypovolemic Shock:</h4>
                        <ul>
                            <li>**Hemorrhage:** Trauma, GI bleeding, surgery.</li>
                            <li>**Dehydration:** Severe vomiting, diarrhea, excessive urination (e.g., diabetes insipidus), inadequate fluid intake.</li>
                            <li>**Fluid Shifts:** Burns (fluid loss from damaged capillaries), ascites (fluid moves into third space), severe pancreatitis.</li>
                        </ul>
                        Early recognition and aggressive fluid resuscitation are key to managing hypovolemic shock.` },
                    { id: 'hypovolemic-shock-assessment', title: 'Hypovolemic Shock: Recognize Cues & Assessment', type: 'text', content: `Assessing a patient for hypovolemic shock involves recognizing specific physiological cues:<br><br>
                        <h4>Laboratory Assessment:</h4>
                        <ul>
                            <li>**Decreased pH:** Indicating metabolic acidosis due to anaerobic metabolism and lactic acid accumulation.</li>
                            <li>**Decreased PaO2:** Lower partial pressure of arterial oxygen.</li>
                            <li>**Increased PaCO2:** Higher partial pressure of arterial carbon dioxide (late sign, indicates respiratory compensation failing).</li>
                            <li>**Increased lactic acid:** Directly reflecting **increased anaerobic metabolism** as cells are deprived of oxygen.</li>
                            <li>**Hemoglobin & Hematocrit:** Can be **increased** (due to fluid shift, dehydration, hemoconcentration) or **decreased** (due to hemorrhage).</li>
                            <li>**Increased potassium:** Can occur due to dehydration and acidosis (potassium shifts out of cells).</li>
                        </ul>
                        <h4>Clinical Assessment (from previous stages):</h4>
                        <ul>
                            <li>Rapid, weak pulse; hypotension.</li>
                            <li>Cool, clammy skin; pallor.</li>
                            <li>Decreased urine output (oliguria/anuria).</li>
                            <li>Altered mental status (anxiety, confusion, loss of consciousness).</li>
                            <li>Tachypnea (rapid breathing).</li>
                            <li>Delayed capillary refill.</li>
                            <li>Thirst.</li>
                        </ul>` },
                    { id: 'hypovolemic-shock-management', title: 'Care Management of Hypovolemic Shock', type: 'text', content: `Immediate and systematic care management is crucial for hypovolemic shock:<br><br>
                        <ul>
                            <li>Ensure a **patent airway** and adequate breathing.</li>
                            <li>Establish **large bore IV(s)** (e.g., 14-18 gauge) for rapid fluid and medication administration.</li>
                            <li>**Promote O2 saturation > 91%** with supplemental oxygen.</li>
                            <li>**Elevate feet 30 degrees higher than head** (Trendelenburg position modified) to improve venous return to the heart, but be cautious with head injury.</li>
                            <li>**Manage overt bleeding** immediately if present (e.g., apply direct pressure, tourniquet).</li>
                            <li>**Administer drugs/fluids** as ordered:
                                <ul>
                                    <li>**Vasoconstrictors** (e.g., norepinephrine, dopamine) to increase blood pressure (used after adequate fluid resuscitation).</li>
                                    <li>**Blood transfusions** (packed red blood cells, plasma, platelets) for hemorrhagic shock.</li>
                                    <li>**IV fluids** (e.g., crystalloids like Normal Saline or Lactated Ringer's) for volume expansion.</li>
                                    <li>**Electrolytes** to correct imbalances.</li>
                                </ul>
                            </li>
                            <li>Continuous monitoring of vital signs, urine output, and mental status.</li>
                        </ul>` },
                    { id: 'shock-quiz', title: 'Shock & Hypovolemic Shock Quiz', type: 'quiz',
                        questions: [
                            { question: "In which stage of shock are compensatory mechanisms activated, leading to decreased urine output and increased blood vessel constriction?", options: ["Initial Stage", "Compensatory Stage", "Progressive Stage", "Refractory Stage"], correctAnswer: "Compensatory Stage" },
                            { question: "A patient in the Progressive Stage of shock would likely present with which of the following?", options: ["No obvious indicators of shock", "Normal blood pressure and pulse", "Rapid, low pulse; low BP; cool, moist skin; anuria", "Responding well to therapies"], correctAnswer: "Rapid, low pulse; low BP; cool, moist skin; anuria" },
                            { question: "Which of the following is a key laboratory finding indicating increased anaerobic metabolism in hypovolemic shock?", options: ["Decreased lactic acid", "Increased PaO2", "Increased pH", "Increased lactic acid"], correctAnswer: "Increased lactic acid" },
                            { question: "What is an immediate nursing intervention for a patient experiencing hypovolemic shock?", options: ["Administering a beta-blocker", "Elevating the head of the bed to 90 degrees", "Establishing large bore IV(s)", "Administering oral fluids"], correctAnswer: "Establishing large bore IV(s)" },
                            { question: "MODS (Multiple Organ Dysfunction Syndrome) is characteristic of which stage of shock?", options: ["Initial Stage", "Compensatory Stage", "Progressive Stage", "Refractory Stage"], correctAnswer: "Refractory Stage" }
                        ]
                    },
                ]
            },
            'final-review': {
                title: 'Final Review & Case Studies',
                color: 'from-green-500 to-teal-400',
                description: 'Reinforce your knowledge with critical thinking case studies and a final review quiz.',
                steps: [
                    { id: 'final-case-study-1', title: 'Case Study: Chest Pain Evaluation', type: 'case_study', case: {
                        scenario: `You are the charge nurse in the ED. A 68-year-old male arrives by ambulance complaining of "crushing chest pain" that started about 45 minutes ago while raking leaves. He states the pain radiates to his left arm and jaw. He took three sublingual nitroglycerin tablets at home with no relief. His current vital signs are BP 100/60 mmHg, HR 110 bpm, RR 22, SpO2 94% on room air. He is pale, diaphoretic, and anxious. His initial EKG shows ST elevation in leads II, III, aVF.`,
                        question: `Based on this presentation, what is the most likely diagnosis and the priority intervention?`,
                        options: [
                            "Option A: Unstable Angina; Administer oral aspirin and continue monitoring.",
                            "Option B: NSTEMI; Prepare for cardiac catheterization within 48 hours.",
                            "Option C: STEMI; Activate the cath lab for immediate PCI.",
                            "Option D: Pericarditis; Administer NSAIDs and pain medication.",
                            "Option E: Anxiety attack; Reassure the patient and administer an anxiolytic."
                        ],
                        correctAnswer: "Option C: STEMI; Activate the cath lab for immediate PCI.",
                        explanation: `<strong>Rationale:</strong>
                        The patient's presentation of "crushing chest pain" radiating to the left arm and jaw, unrelieved by nitroglycerin, coupled with diaphoresis, anxiety, and specifically **ST elevation on EKG**, is highly indicative of a **STEMI (ST-Elevation Myocardial Infarction)**.

                        Let's analyze the options:
                        <ul>
                            <li><strong>Option A: Unstable Angina; Administer oral aspirin and continue monitoring. (Incorrect)</strong> While aspirin is appropriate, ST elevation clearly indicates MI, not just unstable angina. Monitoring alone is insufficient.</li>
                            <li><strong>Option B: NSTEMI; Prepare for cardiac catheterization within 48 hours. (Incorrect)</strong> NSTEMI does not involve ST elevation. For STEMI, PCI is emergent, not within 48 hours.</li>
                            <li><strong>Option C: STEMI; Activate the cath lab for immediate PCI. (Correct)</strong> STEMI is a true emergency requiring immediate reperfusion. PCI with a "door-to-balloon" time of less than 90 minutes is the gold standard for restoring blood flow to the occluded coronary artery.</li>
                            <li><strong>Option D: Pericarditis; Administer NSAIDs and pain medication. (Incorrect)</strong> Pericarditis pain is often sharp, positional, and may improve with leaning forward. While pain medication is needed, the EKG findings point away from pericarditis and directly to MI.</li>
                            <li><strong>Option E: Anxiety attack; Reassure the patient and administer an anxiolytic. (Incorrect)</strong> While the patient is anxious, his EKG findings and severe, radiating chest pain are definitive for a cardiac event, not solely an anxiety attack.</li>
                        </ul>
                        <strong>Key takeaway:</strong> ST elevation on EKG in the context of chest pain is a critical indicator for STEMI, demanding immediate reperfusion.`
                    }},
                    { id: 'final-case-study-2', title: 'Case Study: Heart Failure Exacerbation', type: 'case_study', case: {
                        scenario: `You are caring for a 75-year-old patient with a history of chronic heart failure. Today, he reports increased shortness of breath, especially when lying flat, and has noticed his ankles are more swollen. His daily weights reveal a gain of 4 lbs in the last 3 days. Lung sounds reveal bilateral crackles. Current medication includes Furosemide 40mg daily and Lisinopril 10mg daily.`,
                        question: `Which nursing intervention is the most appropriate initial action?`,
                        options: [
                            "Option A: Administer prescribed Furosemide and assess urine output.",
                            "Option B: Increase the dose of Lisinopril.",
                            "Option C: Encourage increased fluid intake to improve renal perfusion.",
                            "Option D: Instruct the patient to perform deep breathing exercises only.",
                            "Option E: Document findings and wait for the physician's rounds."
                        ],
                        correctAnswer: "Option A: Administer prescribed Furosemide and assess urine output.",
                        explanation: `<strong>Rationale:</strong>
                        The patient is showing classic signs of acute decompensated heart failure, including increased SOB (orthopnea), bilateral crackles, peripheral edema, and a significant weight gain (4 lbs in 3 days). These indicate fluid overload.

                        Let's analyze the options:
                        <ul>
                            <li><strong>Option A: Administer prescribed Furosemide and assess urine output. (Correct)</strong> Furosemide is a loop diuretic, crucial for removing excess fluid in heart failure. Administering it as prescribed and monitoring its effectiveness (urine output) is the most direct and appropriate initial nursing action to alleviate fluid overload.</li>
                            <li><strong>Option B: Increase the dose of Lisinopril. (Incorrect)</strong> While Lisinopril (an ACE inhibitor) is a cornerstone of chronic HF management, increasing its dose isn't the immediate priority for acute fluid overload, and this typically requires a physician's order.</li>
                            <li><strong>Option C: Encourage increased fluid intake to improve renal perfusion. (Incorrect)</strong> The patient is clearly fluid overloaded. Increasing fluid intake would worsen his symptoms and condition.</li>
                            <li><strong>Option D: Instruct the patient to perform deep breathing exercises only. (Incorrect)</strong> While deep breathing is beneficial for lung expansion, it's insufficient to address the underlying fluid overload and associated respiratory distress.</li>
                            <li><strong>Option E: Document findings and wait for the physician's rounds. (Incorrect)</strong> The patient's symptoms suggest acute worsening of HF, which requires immediate intervention, not just documentation and waiting.</li>
                        </ul>
                        <strong>Key takeaway:</strong> For acute heart failure exacerbations with fluid overload, prompt administration of diuretics and monitoring of fluid status are paramount.`
                    }},
                    { id: 'final-case-study-3', title: 'Case Study: Post-Cardiac Catheterization Complication', type: 'case_study', case: {
                        scenario: `You are monitoring a patient 2 hours after a cardiac catheterization via the right femoral approach. The patient complains of increasing pain at the insertion site. Upon assessment, you note a rapidly expanding hematoma at the site, and the right pedal pulse is now faint compared to the baseline. His BP is 98/56 mmHg, and HR is 105 bpm.`,
                        question: `What is your IMMEDIATE priority nursing action?`,
                        options: [
                            "Option A: Administer PRN pain medication and re-assess in 30 minutes.",
                            "Option B: Apply direct manual pressure to the insertion site, call the physician, and prepare for potential intervention.",
                            "Option C: Elevate the head of the bed to 45 degrees to reduce groin pressure.",
                            "Option D: Document the findings and increase the frequency of vital sign monitoring.",
                            "Option E: Ambulate the patient gently to promote circulation."
                        ],
                        correctAnswer: "Option B: Apply direct manual pressure to the insertion site, call the physician, and prepare for potential intervention.",
                        explanation: `<strong>Rationale:</strong>
                        This patient is exhibiting signs of a serious post-cardiac catheterization complication: a rapidly expanding hematoma and a diminished pedal pulse, indicative of active bleeding and potential vascular compromise. The dropping BP and rising HR suggest hypovolemia.

                        Let's analyze the options:
                        <ul>
                            <li><strong>Option A: Administer PRN pain medication and re-assess in 30 minutes. (Incorrect)</strong> While pain management is important, a rapidly expanding hematoma and diminished pulse are signs of an emergent complication that cannot wait 30 minutes.</li>
                            <li><strong>Option B: Apply direct manual pressure to the insertion site, call the physician, and prepare for potential intervention. (Correct)</strong> Applying direct manual pressure is crucial to control bleeding and prevent further hematoma expansion. Immediately notifying the physician is necessary to get orders for further interventions (e.g., fluid resuscitation, surgical repair). This is an emergent situation.</li>
                            <li><strong>Option C: Elevate the head of the bed to 45 degrees to reduce groin pressure. (Incorrect)</strong> Elevating the head of the bed would increase pressure on the femoral site and potentially worsen bleeding. Keeping the leg flat/straight is generally preferred for femoral access post-catheterization.</li>
                            <li><strong>Option D: Document the findings and increase the frequency of vital sign monitoring. (Incorrect)</strong> While documenting and increasing monitoring are standard, they are insufficient as immediate sole interventions for an active, worsening complication. Direct action is needed.</li>
                            <li><strong>Option E: Ambulate the patient gently to promote circulation. (Incorrect)</strong> Ambulation would be contraindicated and dangerous, as it would disrupt the insertion site and worsen bleeding.</li>
                        </ul>
                        <strong>Key takeaway:</strong> Active bleeding and vascular compromise post-cardiac catheterization are emergencies requiring immediate direct pressure, rapid physician notification, and preparation for intervention.`
                    }},
                    { id: 'final-review-quiz', title: 'Comprehensive Perfusion Review', type: 'quiz',
                        questions: [
                            { question: "Which of the following conditions is a primary cause of right-sided heart failure?", options: ["Hypertension", "Coronary Artery Disease", "Left Ventricular Failure", "Valvular Disease of the Aortic Valve"], correctAnswer: "Left Ventricular Failure" },
                            { question: "A patient in the refractory stage of shock is characterized by:", options: ["Effective compensatory mechanisms", "Correction of underlying conditions within 1 hour", "Widespread tissue death and MODS", "Only subjective changes like thirst and anxiety"], correctAnswer: "Widespread tissue death and MODS" },
                            { question: "When assessing a patient post-cardiac catheterization with femoral access, what is a crucial initial nursing action?", options: ["Encouraging fluid intake immediately", "Assessing peripheral pulses distal to the site", "Allowing patient to sit up for comfort", "Administering oral pain medication first"], correctAnswer: "Assessing peripheral pulses distal to the site" },
                            { question: "Which medication class is contraindicated in acute HF, cardiogenic shock, bradycardia, or hypotension when managing an AMI?", options: ["Aspirin", "Nitroglycerin", "Beta-blockers", "Morphine"], correctAnswer: "Beta-blockers" },
                            { question: "A nurse is educating a patient with heart failure about diet. What is the recommended daily sodium intake for patients in Stages A & B HF?", options: ["500 milligrams", "1500 milligrams", "3000 milligrams", "No restriction is needed"], correctAnswer: "1500 milligrams" },
                            { question: "Which of the following is an expected laboratory finding in a patient with hypovolemic shock?", options: ["Increased pH", "Decreased lactic acid", "Increased hemoglobin and hematocrit (due to dehydration)", "Decreased potassium"], correctAnswer: "Increased hemoglobin and hematocrit (due to dehydration)" },
                            { question: "What is the primary role of an LVAD (Left Ventricular Assist Device) in advanced heart failure?", options: ["To completely replace the heart's function.", "To continuously take blood from the left ventricle and move it to the aorta.", "To regulate the heart's electrical rhythm.", "To dissolve blood clots in coronary arteries."], correctAnswer: "To continuously take blood from the left ventricle and move it to the aorta." }
                        ]
                    }
                ]
            }
        };

        // The pre-assessment quiz data now includes questions for all new modules.
        const preAssessmentQuizData = [
            // Questions for Perfusion Fundamentals
            { moduleId: 'perfusion-fundamentals', question: "Which of the following best defines perfusion?", options: ["The process of gas exchange in the lungs.", "Blood flow through arteries and capillaries delivering nutrients and oxygen to cells.", "The heart's electrical activity.", "The relaxation phase of the cardiac cycle."], correctAnswer: "Blood flow through arteries and capillaries delivering nutrients and oxygen to cells." },
            { moduleId: 'perfusion-fundamentals', question: "What is the formula for Cardiac Output (CO)?", options: ["CO = BP x SVR", "CO = HR x SV", "CO = Preload + Afterload", "CO = Systole - Diastole"], correctAnswer: "CO = HR x SV" },

            // Questions for Acute Coronary Syndrome
            { moduleId: 'acute-coronary-syndrome', question: "Which of the following is characteristic of Unstable Angina?", options: ["Relieved by rest and nitroglycerin", "No ST changes on EKG", "Causes chest pain at rest or exertion, poorly relieved by rest", "No changes in Troponin, but leads to cell death"], correctAnswer: "Causes chest pain at rest or exertion, poorly relieved by rest" },
            { moduleId: 'acute-coronary-syndrome', question: "A patient presents with ST elevation on their EKG and elevated cardiac biomarkers. This indicates:", options: ["Unstable Angina", "NSTEMI", "STEMI", "Prinzmetal's Angina"], correctAnswer: "STEMI" },

            // Questions for Heart Failure
            { moduleId: 'heart-failure', question: "Which type of heart failure is characterized by a 'stiff left ventricle' where the left ventricle cannot relax sufficiently during diastole?", options: ["Systolic Heart Failure", "Right-Sided Heart Failure", "Diastolic Heart Failure", "High-Output Failure"], correctAnswer: "Diastolic Heart Failure" },
            { moduleId: 'heart-failure', question: "A patient with left-sided heart failure presents with pink-tinged, frothy sputum. This is a sign of:", options: ["Normal cardiac output", "Improved oxygenation", "Advanced pulmonary edema", "Decreased preload"], correctAnswer: "Advanced pulmonary edema" },

            // Questions for Shock & Hypovolemic Shock
            { moduleId: 'shock-hypovolemic', question: "In which stage of shock are compensatory mechanisms activated, leading to decreased urine output and increased blood vessel constriction?", options: ["Initial Stage", "Compensatory Stage", "Progressive Stage", "Refractory Stage"], correctAnswer: "Compensatory Stage" },
            { moduleId: 'shock-hypovolemic', question: "A patient in the Progressive Stage of shock would likely present with which of the following?", options: ["No obvious indicators of shock", "Normal blood pressure and pulse", "Rapid, low pulse; low BP; cool, moist skin; anuria", "Responding well to therapies"], correctAnswer: "Rapid, low pulse; low BP; cool, moist skin; anuria" },

            // Questions for Final Review
            { moduleId: 'final-review', question: "What is the primary role of an LVAD (Left Ventricular Assist Device) in advanced heart failure?", options: ["To completely replace the heart's function.", "To continuously take blood from the left ventricle and move it to the aorta.", "To regulate the heart's electrical rhythm.", "To dissolve blood clots in coronary arteries."], correctAnswer: "To continuously take blood from the left ventricle and move it to the aorta." },
            { moduleId: 'final-review', question: "Which medication class is contraindicated in acute HF, cardiogenic shock, bradycardia, or hypotension when managing an AMI?", options: ["Aspirin", "Nitroglycerin", "Beta-blockers", "Morphine"], correctAnswer: "Beta-blockers" }
        ];

        // --- Helper Functions ---
        // Utility for conditionally joining Tailwind CSS classes.
        const cn = (...classes) => classes.filter(Boolean).join(' ');


        // --- Child Components ---

        /**
         * Quiz component for interactive multiple-choice questions.
         * Users answer questions and receive immediate feedback.
         */
        const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState([]); // Changed to array for multi-select
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];

            // Handle option selection for both single and multiple choice
            const handleOptionSelect = (option) => {
                if (feedback && !isPreAssessment) return; // Prevent changing answer after feedback in regular quiz

                if (Array.isArray(currentQuestion.correctAnswer)) {
                    // Multi-select (SATA)
                    setSelectedOption(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    // Single select
                    setSelectedOption(option);
                }
            };

            const handlePreAssessmentNext = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                // Logic for checking correctness for both single and multi-select
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
                setAnswers(updatedAnswers);

                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    onComplete(updatedAnswers);
                }
            };
            
            const handleRegularQuizSubmit = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                setFeedback(isCorrect ? 'correct' : 'incorrect');
            };

            const handleRegularQuizNext = () => {
                // Ensure the current answer is recorded before moving to the next question
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                const finalAnswers = [...answers, { question: currentQuestion, isCorrect }];
                
                if (currentQuestionIndex < questions.length - 1) {
                    setAnswers(finalAnswers);
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.isCorrect ? 1 : 0), 0);
                    onComplete({ score: finalScore, total: questions.length });
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Quiz: {currentQuestionIndex + 1} of {questions.length}</h4>
                    <p className="font-semibold text-gray-700 mb-3">{currentQuestion.question}</p>
                    <div className="space-y-2">
                        {currentQuestion.options.map((option, index) => {
                            const isSelected = Array.isArray(selectedOption) ? selectedOption.includes(option) : selectedOption === option;
                            const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
                                ? currentQuestion.correctAnswer.includes(option)
                                : option.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';

                            if (feedback && !isPreAssessment) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={index}
                                    onClick={() => handleOptionSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : <span className="text-red-600 mr-2">✗</span>
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center">
                        {isPreAssessment ? (
                               <button
                                 onClick={handlePreAssessmentNext}
                                 disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                 className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                               >
                                 {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
                               </button>
                        ) : (
                            <>
                            {!feedback ? (
                                <button
                                    onClick={handleRegularQuizSubmit}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    Submit Answer
                                </button>
                            ) : (
                                <button
                                    onClick={handleRegularQuizNext}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Next Question
                                </button>
                            )}
                            </>
                        )}
                    </div>
                </div>
            );
        };
        
        /**
         * PreAssessmentQuiz component to handle the initial diagnostic quiz.
         * Displays quiz questions and then results, allowing users to "test out" of modules.
         */
        const PreAssessmentQuiz = ({ onComplete, onExit }) => {
            const [results, setResults] = useState(null);

            const handleQuizComplete = (finalAnswers) => {
                const moduleResults = {};
                finalAnswers.forEach(answer => {
                    const { moduleId } = answer.question;
                    if (!moduleResults[moduleId]) {
                        moduleResults[moduleId] = { correct: 0, total: 0 };
                    }
                    if (answer.isCorrect) {
                        moduleResults[moduleId].correct++;
                    }
                    moduleResults[moduleId].total++;
                });

                const completedModules = [];
                for (const moduleId in moduleResults) {
                    // For pre-assessment, a module is "completed" if all its questions in the pre-assessment quiz were answered correctly.
                    if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
                        completedModules.push(moduleId);
                    }
                }
                setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
                onComplete(completedModules);
            };

            if (results) {
                return (
                    <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Assessment Complete!</h2>
                            <p className="text-lg text-gray-600 mb-6">
                                You correctly answered {results.correct} out of {results.total} questions.
                            </p>
                            {results.completedModules.length > 0 ? (
                                <>
                                    <p className="text-green-600 font-semibold mb-4">You've tested out of the following modules:</p>
                                    <ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-lg">
                                        {results.completedModules.map(id => <li key={id}>{contentData[id].title}</li>)}
                                    </ul>
                                </>
                            ) : (
                                <p className="text-yellow-600 font-semibold mb-6">You haven't tested out of any modules. You can proceed to the main modules for learning.</p>
                            )}
                            <button
                                onClick={onExit}
                                className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">Diagnostic Quiz</h2>
                        <Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
                    </div>
                </div>
            );
        };


        /**
         * Dashboard component to display the available learning modules.
         * It allows users to select a module to start learning.
         * Shows progress for each module using a circular progress bar and status.
         */
        const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
            let totalCompletedSteps = 0;
            let totalPossibleSteps = 0;
            let totalQuizCorrect = 0;
            let totalQuizQuestions = 0;

            // Calculate overall progress and gather quiz scores
            Object.entries(contentData).forEach(([moduleId, module]) => {
                totalPossibleSteps += module.steps.length;
                const moduleProgress = progress[moduleId] || {};
                
                Object.values(moduleProgress).forEach(stepProgress => {
                    if (stepProgress.completed) {
                        totalCompletedSteps++;
                    }
                    if (stepProgress.score !== undefined) {
                        totalQuizCorrect += stepProgress.score;
                    }
                });

                module.steps.forEach(step => {
                    if (step.type === 'quiz') {
                        totalQuizQuestions += step.questions.length;
                    }
                });
            });


            const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

            return (
                <div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
                    <div className="w-full">
                        <header className="mb-8 text-center">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                {/* Text placeholder for the main application identifier */}
                                <span className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-lg">PP</span>
                                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Perfusion Pathways Module</h1>
                                <span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:1.0</span>
                            </div>
                            <p className="text-lg text-gray-500 max-w-2xl mx-auto">Master essential perfusion concepts, from fundamentals to managing critical conditions like shock.</p>
                        </header>

                        {/* Skip Ahead Button */}
                        <div className="mb-8 text-center">
                            <button
                                onClick={onStartPreAssessment}
                                className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-lg shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
                            >
                                <div className="text-xl">Skip Ahead: Take Diagnostic Quiz</div>
                                <div className="text-sm font-normal">Test your knowledge and potentially skip modules.</div>
                            </button>
                        </div>

                        {/* Overall Progress Bar & Reset Button */}
                        <div className="mb-8 bg-white rounded-2xl shadow-lg p-6 w-full">
                           <div className="flex justify-between items-center mb-3">
                               <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
                               <button 
                                       onClick={onResetProgress}
                                       className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2"
                                   >
                                       <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                           <path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" />
                                       </svg>
                                       Reset Progress
                               </button>
                           </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div
                                    className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
                                    style={{ width: `${overallPercentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between items-center">
                                <p className="text-left text-sm text-gray-600 mt-2">
                                    {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
                                </p>
                                <p className="text-right text-sm text-gray-600 mt-2">{Math.round(overallPercentage)}% Completed</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                            {/* Iterate over all modules defined in contentData */}
                            {Object.entries(contentData).map(([id, module]) => {
                                const moduleProgress = progress[id] || {};
                                // Calculate completion count for steps within the module.
                                const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
                                const totalSteps = module.steps.length;
                                const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

                                let statusText = "Not Started";
                                let statusColor = "text-gray-500";
                                if (completedCount === totalSteps) {
                                    statusText = "Completed";
                                    statusColor = "text-green-600";
                                } else if (completedCount > 0) {
                                    statusText = "In Progress";
                                    statusColor = "text-yellow-600";
                                }

                                // Get quiz score for this module if available
                                const quizStep = module.steps.find(step => step.type === 'quiz');
                                const quizProgress = quizStep ? moduleProgress[quizStep.id] : null;

                                return (
                                    <div
                                        key={id}
                                        onClick={() => onSelectModule(id)}
                                        // Styling for module cards, including hover effects.
                                        className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group flex flex-col"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            {/* Placeholder for module icon: Displays the first letter of the module title. */}
                                            <div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-10 h-10 flex items-center justify-center text-white text-lg font-bold shadow-md flex-shrink-0")}>
                                                {module.title.split(' ').map(word => word.charAt(0)).join('')}
                                            </div>
                                            {/* Progress Circle */}
                                            <div className="relative w-12 h-12 flex-shrink-0">
                                                <svg className="w-full h-full" viewBox="0 0 36 36">
                                                    {/* Background circle for the progress bar. */}
                                                    <path
                                                        className="text-gray-200"
                                                        d="M18 2.0845
                                                             a 15.9155 15.9155 0 0 1 0 31.831
                                                             a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                    />
                                                    {/* Foreground arc representing the completion percentage. */}
                                                    <path
                                                        className="text-indigo-500"
                                                        d="M18 2.0845
                                                             a 15.9155 15.9155 0 0 1 0 31.831
                                                             a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                        strokeDasharray={`${percentage}, 100`}
                                                        strokeLinecap="round"
                                                        transform="rotate(-90 18 18)"
                                                    />
                                                </svg>
                                                <span className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-600">{Math.round(percentage)}%</span>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">{module.title}</h3>
                                        <p className="text-gray-500 text-sm mb-2 h-10">{module.description}</p>
                                        <div className="mt-auto">
                                            <p className={cn("text-sm font-semibold", statusColor)}>{statusText}</p>
                                            {quizProgress && quizProgress.score !== undefined && (
                                                <p className="text-sm text-gray-600 mt-1">Quiz Score: {quizProgress.score} / {quizStep.questions.length}</p>
                                            )}
                                            <div className="flex items-center justify-end text-sm font-medium text-indigo-600 group-hover:text-indigo-700 mt-2">
                                                Start Learning <span className="ml-1 transition-transform group-hover:translate-x-1">&rarr;</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        /**
         * CaseStudy component for a multiple-choice case study challenge.
         * Presents a scenario and a question with multiple options.
         * For Case Studies, multiple correct answers are possible as per the original code and the user's intent.
         */
        const CaseStudy = ({ caseData, onComplete }) => {
            // State to store the user's selected answers (array for multi-select).
            const [selectedAnswers, setSelectedAnswers] = useState([]);
            const [feedbackShown, setFeedbackShown] = useState(false);

            // Handles the selection of an answer option.
            const handleSelect = (option) => {
                if (feedbackShown) return; // Prevent changing the answer once feedback is shown.

                setSelectedAnswers(prevSelected => {
                    if (prevSelected.includes(option)) {
                        return prevSelected.filter(item => item !== option);
                    } else {
                        return [...prevSelected, option];
                    }
                });
            };

            const handleSubmit = () => {
                setFeedbackShown(true);
                // Check if all correct answers are selected and no incorrect ones.
                const isCorrect = caseData.correctAnswer.every(ans => selectedAnswers.includes(ans)) &&
                                  selectedAnswers.length === caseData.correctAnswer.length;
                if (isCorrect) {
                    onComplete({ score: 1 }); // Mark as complete with a score of 1 for correct.
                } else {
                    onComplete({ score: 0 }); // Mark as complete with a score of 0 for incorrect.
                }
            };

            const isAnswerSelected = selectedAnswers.length > 0;

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Case Study Challenge</h4>
                    {/* Scenario description, using dangerouslySetInnerHTML to render HTML bold tags */}
                    <p className="bg-blue-100 text-blue-800 p-3 rounded-md mb-4 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
                    <p className="font-semibold text-gray-700 mb-3">{caseData.question}</p>
                    <div className="space-y-2">
                        {caseData.options.map(option => {
                            const isSelected = selectedAnswers.includes(option);
                            const isCorrectOption = caseData.correctAnswer.includes(option);
                            
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';
                            if (feedbackShown) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={option}
                                    onClick={() => handleSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedbackShown && ( // Display a checkmark or cross icon if feedback is active
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : (isSelected && <span className="text-red-600 mr-2">✗</span>)
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {!feedbackShown && (
                        <div className="mt-4 text-center">
                            <button
                                onClick={handleSubmit}
                                disabled={!isAnswerSelected}
                                className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Submit Answer
                            </button>
                        </div>
                    )}
                    {feedbackShown && ( // Display the explanation after an answer has been selected.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Explanation</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * StaticContentStep component for displaying basic text content.
         * Marks itself as complete immediately on render.
         */
        const StaticContentStep = ({ step, onComplete }) => {
            // For 'text' type steps, mark them as complete immediately upon rendering.
            // The effect should only run once when the component mounts to prevent an infinite loop.
            useEffect(() => {
                onComplete({ score: 1 }); // Mark as complete with a score of 1 for reading content.
            }, []); // Empty dependency array ensures this runs only once.

            // Using dangerouslySetInnerHTML to render HTML content (e.g., <strong> tags).
            return (
                <div className="prose max-w-none text-gray-700 leading-relaxed p-4 bg-gray-50 rounded-lg shadow-inner space-y-4" dangerouslySetInnerHTML={{ __html: step.content }}>
                </div>
            );
        };

        /**
         * CompletionModal component displayed when a module is completed.
         */
        const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
                        <h3 className="text-2xl font-bold text-indigo-700 mb-4">Module Completed! 🎉</h3>
                        <p className="text-gray-700 mb-6">You've successfully completed all steps in this module. Great job!</p>
                        <div className="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={onClose}
                                className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-colors shadow-sm"
                            >
                                Back to Dashboard
                            </button>
                            {hasNextModule && (
                                <button
                                    onClick={onNextModule}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Continue to Next Module
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * LearningModule component to manage steps within the selected module.
         * Provides navigation between steps and renders the appropriate content for each.
         */
        const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
            const [activeStep, setActiveStep] = useState(0); // Manages the index of the currently active step.
            const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Controls the visibility of the sidebar on mobile.
            const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false); // State for completion modal 

            // Callback function to update the completion status of a specific step.
            const handleStepComplete = useCallback((stepId, data = {}) => {
                onProgressUpdate(module.id, stepId, { completed: true, ...data });
            }, [onProgressUpdate, module.id]);

            const moduleProgress = progress[module.id] || {};
            
            // Check if all steps in the current module are completed
            const allStepsCompletedInModule = module.steps.every(step =>
                moduleProgress[step.id] && moduleProgress[step.id].completed
            );

            // Navigates to the next step, if available.
            const handleNextStep = () => {
                // If it's the last step and all steps in the module are completed, open the modal 
                if (activeStep === module.steps.length - 1 && allStepsCompletedInModule) {
                    setIsCompletionModalOpen(true);
                } else if (activeStep < module.steps.length - 1) {
                    setActiveStep(activeStep + 1);
                }
            };

            // Navigates to the previous step, if available.
            const handlePrevStep = () => {
                if (activeStep > 0) {
                    setActiveStep(activeStep - 1);
                }
            };
            
            // Ensure module and its steps are defined before accessing properties 
            if (!module || !module.steps) {
                console.error("LearningModule received invalid module prop:", module);
                return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Loading module...</div>;
            }

            const currentStep = module.steps[activeStep];
            
            // Renders the appropriate content component based on the current step's type.
            // This function acts as a router for different interactive and static content types.
            const renderStepContent = (step) => {
                if (!step) return <p>Please select a step.</p>;

                const onCompleteForStep = (data) => handleStepComplete(step.id, data);

                switch (step.type) {
                    case 'text':
                        return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
                    case 'case_study':
                        return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
                    case 'quiz':
                        return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
                    default:
                        // Fallback for unrecognized step types, ensuring robust error handling.
                        return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
                }
            };

            const handleModalClose = () => {
                setIsCompletionModalOpen(false);
                onBack(); // Go back to dashboard when modal is closed 
            };

            const handleModalNextModule = () => {
                setIsCompletionModalOpen(false);
                onNextModule(); // Proceed to next module 
            };


            return (
                <div className="fixed inset-0 bg-gray-100 flex flex-col z-20">
                    {/* Header for the learning module, including back button and module title. */}
                    <header className="bg-white shadow-md p-4 flex items-center justify-between z-30 flex-shrink-0">
                        <button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                            <span className="hidden sm:inline">Dashboard</span>
                        </button>
                        <div className="flex items-center gap-3">
                            <h2 className="text-xl font-bold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
                        </div>
                        {/* Mobile sidebar toggle button using text/emoji placeholders. */}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </header>
                    {isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar for navigation steps within the module. */}
                        <aside className={cn(
                            "bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
                            isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
                        )}>
                            <h3 className="text-lg font-semibold mb-4 text-gray-700 px-3">Module Steps</h3>
                            <nav className="space-y-1 overflow-y-auto flex-1 pr-1">
                                {module.steps.map((step, index) => (
                                    <button
                                        key={step.id}
                                        onClick={() => {
                                            setActiveStep(index);
                                            setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
                                        }}
                                        className={cn(
                                            'w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors',
                                            activeStep === index ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'hover:bg-gray-100 text-gray-700'
                                        )}
                                    >
                                        {/* Step completion indicator */}
                                        <div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                                            {moduleProgress[step.id]?.completed ? (
                                                <svg className="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                            ) : (
                                                <div className={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
                                            )}
                                        </div>
                                        <span className="flex-1 text-sm">{step.title}</span>
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        {/* Main content area for the current step. */}
                        <main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
                            <div className="max-w-5xl mx-auto">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">{currentStep.title}</h3>
                                {renderStepContent(currentStep)}

                                {/* Navigation buttons for moving between steps. */}
                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevStep}
                                        disabled={activeStep === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                                    >
                                        Previous
                                    </button>

                                    <button
                                        onClick={handleNextStep}
                                        disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
                                        className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                    >
                                        {activeStep === module.steps.length - 1 ? 'Finish Module' : 'Next'}
                                    </button>
                                </div>
                            </div>
                        </main>
                    </div>
                    <CompletionModal
                        isOpen={isCompletionModalOpen}
                        onClose={handleModalClose}
                        onNextModule={handleModalNextModule}
                        hasNextModule={hasNextModule}
                    />
                </div>
            );
        };
        
        // --- Main App Component ---
        /**
         * The root component of the Cardiac Rhythm Interpretation learning module application.
         * Manages overall application state, including module selection, user ID, and progress.
         */
        function App() {
            // State for the currently selected learning module's ID. Null means Dashboard is active.
            const [currentModuleId, setCurrentModuleId] = useState(null);
            const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
            // State for the authenticated user's ID, used for local storage progress tracking.
            const [userId, setUserId] = useState(null);
            // State for storing the user's progress across all modules and steps.
            const [progress, setProgress] = useState({});
            // State to indicate if authentication is complete and user ID is available.
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Effect hook for handling initial authentication and setting the user ID.
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged((user) => {
                    if (user) setUserId(user.uid);
                    setIsAuthReady(true); // Mark authentication as ready once user is determined.
                });
                return () => unsubscribe(); // Cleanup the auth state listener on component unmount.
            }, []); // Empty dependency array ensures this runs only once on mount.

            // Effect hook for loading user progress from localStorage after authentication is ready.
            useEffect(() => {
                if (!isAuthReady || !userId) return; // Only proceed if auth is ready and userId is available.
                const storedProgress = localStorage.getItem(`cardiac-rhythm-module-progress-${userId}`);
                if (storedProgress) {
                    try {
                        setProgress(JSON.parse(storedProgress)); // Attempt to parse and set stored progress.
                    } catch (e) {
                        console.error("Failed to parse stored progress, resetting.", e);
                        setProgress({}); // Reset progress if parsing fails (e.g., corrupted data).
                    }
                }
            }, [isAuthReady, userId]); // Reruns when auth status or userId changes.

            // Callback function to update and persist the user's progress for a specific step.
            const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
                if (!isAuthReady || !userId) return;

                setProgress(currentProgress => {
                    const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
                    const newStepProgress = { ...currentStepProgress, ...data };

                    // If the old and new step data are identical, do not update state.
                    // This prevents the infinite re-render loop.
                    // Also handles potential score updates from quizzes/case studies.
                    if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
                        return currentProgress;
                    }

                    // Otherwise, proceed with the update.
                    const newProgress = {
                        ...currentProgress,
                        [moduleId]: {
                            ...(currentProgress[moduleId] || {}),
                            [stepId]: newStepProgress
                        }
                    };

                    localStorage.setItem(`cardiac-rhythm-module-progress-${userId}`, JSON.stringify(newProgress));
                    return newProgress;
                });
            }, [isAuthReady, userId]);

            const handlePreAssessmentComplete = (completedModuleIds) => {
                const newProgress = { ...progress };
                completedModuleIds.forEach(moduleId => {
                    const module = contentData[moduleId];
                    if (module) {
                        newProgress[moduleId] = {};
                        module.steps.forEach(step => {
                            newProgress[moduleId][step.id] = { completed: true };
                        });
                    }
                });
                setProgress(newProgress);
                localStorage.setItem(`cardiac-rhythm-module-progress-${userId}`, JSON.stringify(newProgress));
                // The results screen is now part of the PreAssessmentQuiz component.
                // We just need to handle exiting it.
            };
            
            // Callback to reset all progress
            const handleResetProgress = useCallback(() => {
                if (!isAuthReady || !userId) return;
                // Clear from state
                setProgress({});
                // Clear from localStorage
                localStorage.removeItem(`cardiac-rhythm-module-progress-${userId}`);
            }, [isAuthReady, userId]);

            // Function to navigate to the next module in the sequence
            const handleNextModule = useCallback(() => {
                const moduleIds = Object.keys(contentData);
                const currentIndex = moduleIds.indexOf(currentModuleId);
                if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
                    setCurrentModuleId(moduleIds[currentIndex + 1]);
                } else {
                    // If it's the last module, go back to the dashboard.
                    setCurrentModuleId(null);
                }
            }, [currentModuleId]);

            // Determine which module is currently selected based on `currentModuleId`.
            const selectedModule = currentModuleId && contentData[currentModuleId]
                                                    ? { ...contentData[currentModuleId], id: currentModuleId }
                                                    : null;

            const moduleIds = Object.keys(contentData);
            const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
            const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


            return (
                <div className="bg-gray-100 min-h-screen font-sans text-gray-900">
                    {isPreAssessmentActive ? (
                        <PreAssessmentQuiz 
                            onComplete={handlePreAssessmentComplete} 
                            onExit={() => setIsPreAssessmentActive(false)}
                        />
                    ) : selectedModule ? (
                        <LearningModule
                            key={selectedModule.id}
                            module={selectedModule}
                            onBack={() => setCurrentModuleId(null)}
                            progress={progress}
                            onProgressUpdate={handleProgressUpdate}
                            onNextModule={handleNextModule}
                            hasNextModule={hasNextModule}
                        />
                    ) : (
                        <Dashboard 
                            onSelectModule={setCurrentModuleId} 
                            progress={progress} 
                            onResetProgress={handleResetProgress}
                            onStartPreAssessment={() => setIsPreAssessmentActive(true)}
                        />
                    )}
                </div>
            );
        }

        // --- Render the App into the DOM ---
        // Get the DOM element where the React application will be mounted.
        const container = document.getElementById('root');
        // Create a React root, which is the entry point for React 18+ applications.
        const root = ReactDOM.createRoot(container);
        // Render the main App component into the root.
        root.render(<App />);
    </script>
</body>
</html>
