<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacology Cardiac Glycosides SDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary-blue: #3498db;
            --primary-dark-blue: #2980b9;
            --secondary-orange: #f39c12;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --bg-light: #ecf0f1;
            --bg-white: #FFFFFF;
            --border-light: #e0e4eb;
            --success-green: #2ecc71;
            --danger-red: #e74c3c;
            --shadow-color: rgba(44, 62, 80, 0.1);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            box-sizing: border-box;
        }

        .quiz-wrapper {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .quiz-header {
            background: var(--bg-white);
            color: var(--text-dark);
            padding: 0.75rem 2rem;
            text-align: center;
            position: relative;
            border-bottom: 1px solid var(--border-light);
            flex-shrink: 0;
            z-index: 10;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            position: absolute;
            left: 0;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-blue);
        }

        .animated-icon {
            position: absolute;
            right: 0;
            animation: inspect 4s ease-in-out infinite;
        }

        .animated-icon svg { width: 30px; height: 30px; fill: var(--primary-blue); }
        .quiz-header h1 { margin: 0; font-size: 1.4rem; font-weight: 600; }
        .version-info { font-size: 0.7rem; color: var(--text-light); margin-top: 0.2rem; }
        
        .quiz-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        #initial-screen { text-align: center; padding: 2rem; }
        #initial-screen h2 { font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-dark-blue); }
        #initial-screen p { font-size: 1.1rem; line-height: 1.6; max-width: 600px; margin: 1rem auto 2rem auto; color: var(--text-light); }
        #start-btn { background-color: var(--primary-blue); color: white; padding: 1rem 2.5rem; font-size: 1.1rem; font-weight: 600; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
        #start-btn:hover { background-color: var(--primary-dark-blue); transform: scale(1.05); }
        
        #quiz-form {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            background: var(--bg-white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 15px 40px var(--shadow-color);
            border: 1px solid var(--border-light);
            overflow: hidden;
            box-sizing: border-box;
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        
        #quiz-form.is-transitioning { opacity: 0; transform: scale(0.98); }

        .question-header { font-size: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; flex-shrink: 0; border-bottom: 1px dashed var(--border-light); color: var(--text-light); font-weight: 500; }
        .question-header strong { font-weight: 700; color: var(--primary-blue); }
        .question-text { font-size: 1.25rem; font-weight: 500; line-height: 1.6; margin-top: 0; margin-bottom: 1rem; flex-shrink: 0; }
        
        .options-container { 
            flex-grow: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0.5rem 0;
        }

        .options-container label { padding: 0.8rem 1.2rem; margin-bottom: 0.75rem; font-size: 1rem; border: 2px solid var(--border-light); border-radius: 10px; display: flex; align-items: center; transition: all 0.2s ease-in-out; cursor: pointer; }
        .options-container label:hover { background-color: var(--bg-light); border-color: var(--primary-blue); }
        .options-container input { margin-right: 1rem; flex-shrink: 0; transform: scale(1.2); accent-color: var(--primary-blue); }
        
        .question-footer { margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-light); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .flag-container label { cursor: pointer; font-weight: 500; color: var(--text-light); display: flex; align-items: center; }
        .flag-container input { margin-right: 0.5rem; }
        .confidence-slider-container { display: flex; align-items: center; gap: 1rem; }
        .confidence-slider-container label { font-weight: 500; color: var(--text-light); }
        .confidence-slider { max-width: 150px; }

        #navigation-btn { padding: 0.8rem 2rem; font-size: 1rem; background-color: var(--primary-blue); color: white; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        #navigation-btn:hover { background-color: var(--primary-dark-blue); transform: scale(1.05); }

        #results-area { animation: fadeIn 0.8s ease-out; box-sizing: border-box; width: 100%; height: 100%; overflow-y: auto; padding: 2rem; }
        .results-summary, #confidence-analysis, #study-focus, #results-details { background-color: var(--bg-white); margin: 0 auto 2rem auto; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 30px var(--shadow-color); max-width: 1000px; }
        .results-summary { text-align: center; }

        .score-animation-container { width: 150px; height: 150px; border-radius: 50%; border: 8px solid var(--primary-blue); display: flex; justify-content: center; align-items: center; margin: 1.5rem auto; position: relative; background-color: var(--bg-white); }
        .score-animation-circle { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(var(--success-green) 0% 0%, var(--border-light) 0% 100%); transition: background 1.5s ease-out; }
        .score-animation-inner { position: relative; z-index: 2; background-color: var(--bg-white); width: calc(100% - 16px); height: calc(100% - 16px); border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .score-animation-text { font-size: 2.5rem; font-weight: 800; color: var(--text-dark); }
        
        #confidence-analysis h3, #study-focus h3, #results-details h2 { margin-top: 0; border-bottom: 2px solid; padding-bottom: 1rem; font-size: 1.5rem; margin-bottom: 1.5rem; }
        #confidence-analysis h3 { color: var(--primary-dark-blue); border-color: var(--primary-blue); }
        #study-focus h3 { color: #c0392b; border-color: #e74c3c; }
        #results-details h2 { color: var(--text-dark); border-color: var(--border-light); }
        
        .result-question { border: 1px solid var(--border-light); padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 12px; }
        .result-question p strong { display: block; margin-bottom: 1rem; font-size: 1.1em; color: var(--text-dark); }
        .result-question ul { list-style-type: none; padding: 0; margin: 0; }
        .result-question li { padding: 0.8rem 1.2rem; border-radius: 8px; margin-bottom: 0.6rem; font-size: 1rem; }
        .correct-answer-label { background-color: var(--light-green-bg); color: #27ae60; font-weight: 600; }
        .incorrect-answer-label { background-color: var(--light-red-bg); color: var(--danger-red); text-decoration: line-through; }
        .missed-correct-answer-label { border: 2px dashed var(--success-green); }
        .rationale { margin-top: 1.5rem; padding: 1.2rem; border-radius: 10px; border-left: 4px solid var(--primary-blue); background-color: var(--light-blue-bg); font-size: 0.95rem; }

        .hidden { display: none !important; }
        .confetti { position: fixed; width: 10px; height: 10px; opacity: 0; animation: confetti-fall 5s linear forwards; border-radius: 50%; z-index: 9999; }
        @keyframes confetti-fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        @keyframes inspect { 0% { transform: rotate(-15deg); } 50% { transform: rotate(10deg); } 100% { transform: rotate(-15deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="quiz-wrapper">
        <header class="quiz-header">
            <div class="header-content">
                <div class="logo">VSREP</div>
                <div>
                    <h1>Pharmacology Cardiac Glycosides - SDE</h1>
                    <div class="version-info">
                        <span>Engine: V4.0</span> | <span>Test: V1.0</span>
                    </div>
                </div>
                <div class="animated-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
                </div>
            </div>
        </header>

        <main class="quiz-content">
            <div id="initial-screen">
                <h2>Welcome to the Diagnostic Exam</h2>
                <p>You will be presented with one question at a time. Once you answer, you cannot go back. Please read each question carefully before proceeding.</p>
                <button id="start-btn">Start Exam</button>
            </div>

            <form id="quiz-form" class="hidden"></form>

            <div id="results-area" class="hidden"></div>
        </main>
    </div>

<script>
    const fullQuizData = [ 
     {
    "questionText": "A 68-year-old male patient is recovering on the cardiac unit after an acute myocardial infarction (MI). He has developed bilateral crackles up to the mid-lung fields, jugular venous distention, and a 2-kg weight gain over 48 hours. His blood pressure is 160/92 mm Hg, heart rate 88 bpm, and respiratory rate 22. Which nursing intervention should the nurse implement first?",
    "options": {
      "A": "Administer a prescribed diuretic medication",
      "B": "Increase the patient’s oral fluid intake",
      "C": "Elevate the head of the bed to 45 degrees",
      "D": "Encourage bed rest and limit activity"
    },
    "correctAnswer": "C",
    "rationale": "Elevating the head of the bed improves oxygenation and reduces pulmonary congestion, which is a priority in fluid overload. Diuretics are important but positioning helps alleviate respiratory distress immediately.",
    "section": "Cardiac/Post-MI",
    "type": "mc"
  },
  {
    "questionText": "A 65-year-old female with chronic heart failure presents with symptoms indicating possible fluid volume excess. Which of the following findings should the nurse expect? (Select all that apply)",
    "options": {
      "A": "Weight gain of 3 pounds in 24 hours",
      "B": "Decreased urine output",
      "C": "Distended neck veins",
      "D": "Hypotension",
      "E": "Peripheral edema"
    },
    "correctAnswer": ["A", "B", "C", "E"],
    "rationale": "Weight gain, decreased urine output, distended neck veins, and peripheral edema are signs of fluid volume overload. Hypotension is not typical; blood pressure is usually elevated or normal.",
    "section": "Fluid Volume Excess",
    "type": "sata"
  },
  {
    "questionText": "A patient is receiving IV fluids after an acute myocardial infarction and suddenly develops increased crackles in the lungs and elevated blood pressure. What is the nurse’s best immediate response?",
    "options": {
      "A": "Slow or discontinue the IV fluids",
      "B": "Notify the dietary department to restrict sodium",
      "C": "Give a prescribed pain medication",
      "D": "Encourage deep breathing exercises"
    },
    "correctAnswer": "A",
    "rationale": "Signs of fluid overload require the nurse to slow or stop IV fluids immediately to prevent worsening of the condition.",
    "section": "Fluid Volume Excess",
    "type": "mc"
  },
  {
    "questionText": "A client recovering from a ST-elevation myocardial infarction (STEMI) is at risk for fluid volume overload. Which nursing assessments should the nurse regularly perform? (Select all that apply)",
    "options": {
      "A": "Monitor daily weights",
      "B": "Assess lung sounds for crackles",
      "C": "Check for jugular vein distention",
      "D": "Measure peripheral pulses every hour",
      "E": "Evaluate intake and output records"
    },
    "correctAnswer": ["A", "B", "C", "E"],
    "rationale": "Daily weights, lung sounds, jugular venous distention, and intake/output monitoring are essential indicators of fluid status. Peripheral pulses are less specific to fluid overload monitoring.",
    "section": "Fluid Volume Excess",
    "type": "sata"
  },
  {
    "questionText": "A patient diagnosed with heart failure after myocardial infarction is experiencing fluid volume overload with pulmonary congestion. Which medication should the nurse anticipate being prescribed to reduce preload and fluid retention?",
    "options": {
      "A": "Beta blockers",
      "B": "Calcium channel blockers",
      "C": "Diuretics",
      "D": "ACE inhibitors"
    },
    "correctAnswer": "C",
    "rationale": "Diuretics promote fluid excretion, reducing preload and managing fluid overload in heart failure.",
    "section": "Medications",
    "type": "mc"
  },
  {
    "questionText": "A 70-year-old female patient is 24 hours post-anterior myocardial infarction and shows tachycardia, hypotension (BP 85/50 mm Hg), cool clammy skin, and confusion. What is the nurse’s priority action?",
    "options": {
      "A": "Administer a bolus of IV fluids",
      "B": "Notify the healthcare provider immediately",
      "C": "Assist the patient to a sitting position",
      "D": "Encourage deep breathing exercises"
    },
    "correctAnswer": "B",
    "rationale": "These signs indicate cardiogenic shock, a medical emergency requiring prompt intervention by the provider.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A client recovering from myocardial infarction has manifestations indicating left-sided heart failure. Which findings support this diagnosis? (Select all that apply)",
    "options": {
      "A": "Crackles heard bilaterally in lung fields",
      "B": "Jugular venous distention",
      "C": "S3 heart sound",
      "D": "Peripheral edema",
      "E": "Frothy sputum"
    },
    "correctAnswer": ["A", "C", "E"],
    "rationale": "Crackles, S3 heart sound, and frothy sputum are specific to left ventricular failure. Jugular venous distention and peripheral edema typically indicate right-sided failure.",
    "section": "Heart Failure",
    "type": "sata"
  },
  {
    "questionText": "A 68-year-old male post-myocardial infarction has sudden onset of dyspnea, pink frothy sputum, and bilateral crackles. What is the nurse’s immediate action?",
    "options": {
      "A": "Position the patient in high-Fowler's position",
      "B": "Encourage the patient to cough forcefully",
      "C": "Administer a prescribed beta blocker",
      "D": "Increase IV fluid rate"
    },
    "correctAnswer": "A",
    "rationale": "High-Fowler's position optimizes respiratory function and relieves distress caused by pulmonary edema.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A patient with acute coronary syndrome is at risk for fluid volume overload. Which nursing assessments are essential? (Select all that apply)",
    "options": {
      "A": "Daily weights",
      "B": "Lung auscultation for crackles",
      "C": "Monitoring intake and output",
      "D": "Assessment of peripheral pulses",
      "E": "Checking for jugular venous distention"
    },
    "correctAnswer": ["A", "B", "C", "E"],
    "rationale": "Monitoring daily weights, lung sounds, intake/output, and jugular venous distention are key to fluid status assessment.",
    "section": "Fluid Volume Excess",
    "type": "sata"
  },
  {
    "questionText": "A patient diagnosed with heart failure after MI is prescribed medication to decrease cardiac workload by reducing afterload. Which medication is most appropriate?",
    "options": {
      "A": "Furosemide (Lasix)",
      "B": "Nitroprusside",
      "C": "Digoxin",
      "D": "Metoprolol"
    },
    "correctAnswer": "B",
    "rationale": "Nitroprusside is a potent vasodilator that reduces afterload, improving cardiac output in heart failure.",
    "section": "Medications",
    "type": "mc"
  },
 {
    "questionText": "A 58-year-old man with a history of coronary artery disease is admitted for unstable angina. He suddenly complains of severe chest pain that radiates to his left arm and jaw. His blood pressure is 90/60 mm Hg, heart rate 120 bpm, and he appears diaphoretic. What is the nurse’s immediate action?",
    "options": {
      "A": "Administer nitroglycerin sublingually",
      "B": "Place the patient in a supine position",
      "C": "Call for emergency assistance and prepare for ECG",
      "D": "Encourage the patient to take slow deep breaths"
    },
    "correctAnswer": "C",
    "rationale": "Severe chest pain with hemodynamic instability suggests possible MI requiring immediate intervention including ECG and advanced care.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A client admitted for acute myocardial infarction is receiving IV nitroglycerin. The nurse notes the patient is dizzy with a blood pressure of 88/54 mm Hg. What is the priority nursing action?",
    "options": {
      "A": "Increase the rate of IV fluids",
      "B": "Hold the nitroglycerin and notify the healthcare provider",
      "C": "Assist the patient to stand and ambulate",
      "D": "Administer oxygen"
    },
    "correctAnswer": "B",
    "rationale": "Hypotension and dizziness are signs of nitroglycerin overdose or excessive vasodilation; medication should be held and provider notified.",
    "section": "Medication Safety",
    "type": "mc"
  },
  {
    "questionText": "A 70-year-old woman has just returned from percutaneous coronary intervention (PCI). She reports pain at the catheter insertion site and has swelling around the area. What is the nurse’s best action?",
    "options": {
      "A": "Elevate the affected limb and apply ice",
      "B": "Apply firm pressure and notify the healthcare provider",
      "C": "Administer prescribed analgesics and monitor",
      "D": "Encourage ambulation to improve circulation"
    },
    "correctAnswer": "B",
    "rationale": "Pain and swelling indicate possible hematoma or bleeding at the catheter site requiring immediate intervention.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A patient with heart failure presents with 3+ pitting edema in bilateral lower extremities, shortness of breath, and a weight gain of 4 pounds in 3 days. Which dietary instruction should the nurse prioritize?",
    "options": {
      "A": "Increase potassium intake",
      "B": "Restrict sodium intake",
      "C": "Increase protein intake",
      "D": "Limit carbohydrate consumption"
    },
    "correctAnswer": "B",
    "rationale": "Sodium restriction helps prevent fluid retention in heart failure patients experiencing fluid overload.",
    "section": "Dietary Management",
    "type": "mc"
  },
  {
    "questionText": "A client with chronic stable angina reports chest pain at rest lasting 20 minutes. Which statement by the nurse is most appropriate?",
    "options": {
      "A": "Use your nitroglycerin now and call 911 if pain persists.",
      "B": "Try to rest and wait for the pain to subside.",
      "C": "Increase your physical activity to improve circulation.",
      "D": "Take an aspirin and monitor your blood pressure."
    },
    "correctAnswer": "A",
    "rationale": "Chest pain at rest may indicate unstable angina or MI; immediate nitroglycerin use and emergency care if unresolved is critical.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "During assessment, a nurse finds a client’s jugular veins distended while sitting at 45 degrees. The client has bilateral crackles and confusion. What is the priority nursing diagnosis?",
    "options": {
      "A": "Ineffective airway clearance",
      "B": "Decreased cardiac output",
      "C": "Risk for infection",
      "D": "Impaired urinary elimination"
    },
    "correctAnswer": "B",
    "rationale": "JVD, crackles, and confusion signal heart failure leading to decreased cardiac output and perfusion requiring urgent management.",
    "section": "Nursing Diagnoses",
    "type": "mc"
  },
  {
    "questionText": "A 55-year-old client receiving dobutamine for cardiogenic shock has a heart rate of 140 bpm and new onset of premature ventricular contractions (PVCs). What is the best nursing action?",
    "options": {
      "A": "Document and continue to monitor",
      "B": "Decrease the infusion rate and notify the provider",
      "C": "Administer antiarrhythmic medication immediately",
      "D": "Increase the infusion rate to improve cardiac output"
    },
    "correctAnswer": "B",
    "rationale": "Dobutamine can cause tachycardia and arrhythmias; rate adjustment and provider notification are warranted.",
    "section": "Medication Safety",
    "type": "mc"
  },
  {
    "questionText": "Which clinical finding best indicates worsening left ventricular failure in a client with acute myocardial infarction?",
    "options": {
      "A": "Peripheral edema",
      "B": "Neck vein distension",
      "C": "Crackles halfway up the lung fields",
      "D": "Bradycardia"
    },
    "correctAnswer": "C",
    "rationale": "Crackles indicate pulmonary congestion from left ventricular failure; peripheral and neck veins relate more to right-sided failure.",
    "section": "Clinical Signs",
    "type": "mc"
  },
  {
    "questionText": "A client post-myocardial infarction is prescribed metoprolol. What parameter should the nurse assess before administration?",
    "options": {
      "A": "Blood glucose level",
      "B": "Heart rate and blood pressure",
      "C": "Respiratory rate and breath sounds",
      "D": "Serum potassium level"
    },
    "correctAnswer": "B",
    "rationale": "Beta blockers slow heart rate and reduce BP; medication should be held if bradycardic or hypotensive.",
    "section": "Medication Safety",
    "type": "mc"
  },
  {
    "questionText": "A patient with acute coronary syndrome is experiencing chest pain unrelieved by nitroglycerin. Which action should the nurse take first?",
    "options": {
      "A": "Administer morphine as prescribed",
      "B": "Prepare the client for coronary angiography",
      "C": "Administer aspirin chewable tablet",
      "D": "Obtain a 12-lead ECG"
    },
    "correctAnswer": "D",
    "rationale": "ECG is critical for diagnosis of MI and guides treatment prior to other interventions.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A client receiving tissue plasminogen activator (tPA) for STEMI develops sudden severe headache and altered level of consciousness. What is the nurse's priority action?",
    "options": {
      "A": "Document findings and continue monitoring",
      "B": "Administer prescribed antipyretics",
      "C": "Stop the infusion and notify the healthcare provider immediately",
      "D": "Assess vital signs every 30 minutes"
    },
    "correctAnswer": "C",
    "rationale": "Symptoms indicate possible intracranial hemorrhage, a life-threatening complication requiring immediate action.",
    "section": "Emergency Response",
    "type": "mc"
  },
{
    "questionText": "A client is transferred to the cardiac surgical unit after coronary artery bypass graft surgery. Which nursing interventions are appropriate? (Select all that apply)",
    "options": {
      "A": "Encourage incentive spirometer use every hour while awake",
      "B": "Monitor chest tube output hourly",
      "C": "Assess neurologic status every 2 to 4 hours",
      "D": "Limit patient movement to the bed for 24 hours",
      "E": "Provide pain control with prescribed analgesics"
    },
    "correctAnswer": ["A", "B", "C", "E"],
    "rationale": "Incentive spirometry, chest tube monitoring, neuro checks, and adequate pain control are essential; prolonged bed rest is not recommended.",
    "section": "Postoperative Care",
    "type": "sata"
  },
  {
    "questionText": "A client post-myocardial infarction suddenly develops tachypnea, pink frothy sputum, and crackles in both lungs consistent with pulmonary edema. What is the nurse’s most important immediate intervention?",
    "options": {
      "A": "Administer supplemental oxygen and position patient upright",
      "B": "Increase IV fluid rate",
      "C": "Encourage deep breathing exercises",
      "D": "Prepare to administer beta-blocker medication"
    },
    "correctAnswer": "A",
    "rationale": "Managing airway and breathing by oxygen and upright positioning is the priority in pulmonary edema to relieve respiratory distress.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A 62-year-old man with a history of hypertension presents with sudden onset of crushing chest pain radiating to his left arm. His blood pressure is 142/88 mm Hg, and heart rate is 102 bpm. Which initial action should the nurse take?",
    "options": {
      "A": "Administer sublingual nitroglycerin",
      "B": "Help the patient ambulate regularly",
      "C": "Encourage drinking water to reduce blood pressure",
      "D": "Provide high-flow oxygen via non-rebreather mask"
    },
    "correctAnswer": "A",
    "rationale": "Nitroglycerin relieves ischemic chest pain by dilating coronary arteries, which improves blood flow.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A client admitted for acute myocardial infarction reports feeling anxious and short of breath. Auscultation reveals crackles in the lower lung fields. Which is the priority nursing diagnosis?",
    "options": {
      "A": "Anxiety related to hospitalization",
      "B": "Impaired gas exchange related to pulmonary congestion",
      "C": "Risk for ineffective airway clearance",
      "D": "Acute pain related to myocardial ischemia"
    },
    "correctAnswer": "B",
    "rationale": "Crackles indicate pulmonary congestion, which compromises gas exchange and requires urgent intervention.",
    "section": "Nursing Diagnoses",
    "type": "mc"
  },
  {
    "questionText": "A patient with heart failure is prescribed spironolactone. What should the nurse teach the patient about this medication?",
    "options": {
      "A": "Report muscle weakness or cramps",
      "B": "Avoid foods high in potassium",
      "C": "Take medication only when symptoms worsen",
      "D": "Expect increased urination immediately"
    },
    "correctAnswer": "A",
    "rationale": "Spironolactone is a potassium-sparing diuretic; hyperkalemia can cause muscle weakness and cramps.",
    "section": "Medication Education",
    "type": "mc"
  },
  {
    "questionText": "A client post-open heart surgery has a chest tube in place. Which assessment finding requires immediate intervention?",
    "options": {
      "A": "Chest tube drainage of 50 mL over the past hour",
      "B": "Sudden bright red drainage of 200 mL",
      "C": "Mild bubbling in the suction chamber",
      "D": "Client reporting mild incisional pain"
    },
    "correctAnswer": "B",
    "rationale": "Sudden increased bright red drainage may indicate hemorrhage and requires urgent attention.",
    "section": "Postoperative Monitoring",
    "type": "mc"
  },
  {
    "questionText": "A client with chronic heart failure presents with a weight gain of 5 pounds in one week and increasing dyspnea. Which lifestyle modification should the nurse prioritize?",
    "options": {
      "A": "Perform daily exercise regardless of symptoms",
      "B": "Limit fluid intake as prescribed",
      "C": "Increase sodium intake to prevent hyponatremia",
      "D": "Use pillows to sleep flat in bed"
    },
    "correctAnswer": "B",
    "rationale": "Fluid restriction reduces fluid overload and helps prevent worsening heart failure symptoms.",
    "section": "Lifestyle Management",
    "type": "mc"
  },
  {
    "questionText": "A patient experiences ventricular tachycardia with a pulse. What is the nurse’s next best action?",
    "options": {
      "A": "Prepare for immediate defibrillation",
      "B": "Administer oxygen and prepare for cardioversion",
      "C": "Start CPR immediately",
      "D": "Document the rhythm and continue monitoring"
    },
    "correctAnswer": "B",
    "rationale": "Cardioversion is indicated for pulsed ventricular tachycardia to restore normal rhythm.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "Which teaching point is essential for a patient taking atorvastatin after myocardial infarction?",
    "options": {
      "A": "Avoid consuming grapefruit or grapefruit juice",
      "B": "Increase intake of high-fat foods",
      "C": "Expect muscle pain and do not report it",
      "D": "Stop medication once cholesterol levels normalize"
    },
    "correctAnswer": "A",
    "rationale": "Grapefruit inhibits statin metabolism, increasing risk of toxicity.",
    "section": "Medication Education",
    "type": "mc"
  },
  {
    "questionText": "A patient returns to the unit after coronary artery bypass graft surgery. The nurse notes the patient's blood pressure is 85/55 mm Hg and heart rate is 115 bpm. The patient appears pale and diaphoretic. What is the immediate nursing action?",
    "options": {
      "A": "Notify the healthcare provider immediately",
      "B": "Assist patient to a sitting position",
      "C": "Encourage deep breathing and coughing exercises",
      "D": "Administer prescribed beta blockers"
    },
    "correctAnswer": "A",
    "rationale": "Hypotension with tachycardia and diaphoresis indicate possible shock or bleeding requiring urgent evaluation.",
    "section": "Emergency Response",
    "type": "mc"
  },
  {
    "questionText": "A client with congestive heart failure presents with peripheral edema, distended neck veins, and hepatomegaly. Which side of the heart is most likely failing?",
    "options": {
      "A": "Left side",
      "B": "Right side",
      "C": "Both sides equally",
      "D": "Neither side"
    },
    "correctAnswer": "B",
    "rationale": "Right-sided heart failure results in systemic venous congestion causing peripheral edema, JVD, and hepatomegaly.",
    "section": "Heart Failure",
    "type": "mc"
  },
  {
    "questionText": "A patient is admitted with an ST-elevation myocardial infarction (STEMI). Which laboratory marker is most specific for myocardial injury?",
    "options": {
      "A": "Creatine kinase (CK-MB)",
      "B": "Troponin I",
      "C": "Myoglobin",
      "D": "Lactate dehydrogenase (LDH)"
    },
    "correctAnswer": "B",
    "rationale": "Troponin I is highly specific and sensitive for myocardial cell injury.",
    "section": "Laboratory Values",
    "type": "mc"
  },
  {
    "questionText": "A client with acute heart failure is prescribed furosemide. Which adverse effect should the nurse monitor for closely?",
    "options": {
      "A": "Hyperkalemia",
      "B": "Hypokalemia",
      "C": "Hypertension",
      "D": "Bradycardia"
    },
    "correctAnswer": "B",
    "rationale": "Furosemide is a loop diuretic that can cause potassium loss.",
    "section": "Medication Monitoring",
    "type": "mc"
  },
  {
    "questionText": "A nurse is teaching a patient how to take nitroglycerin tablets. Which statement by the patient indicates correct understanding?",
    "options": {
      "A": "I should take the tablet with a full glass of water.",
      "B": "I can repeat the dose every 5 minutes if pain continues, up to three doses.",
      "C": "I should chew the tablet before swallowing.",
      "D": "I should take the tablet only when I am in bed."
    },
    "correctAnswer": "B",
    "rationale": "This is the correct dosing for acute angina relief.",
    "section": "Patient Education",
    "type": "mc"
  },
  {
    "questionText": "A client is admitted with symptoms of a pulmonary embolism. Which assessment findings support this diagnosis?",
    "options": {
      "A": "Sudden onset dyspnea, pleuritic chest pain, and tachycardia",
      "B": "Gradual onset of cough with hemoptysis",
      "C": "Pedal edema and weight gain",
      "D": "Bradycardia and hypotension"
    },
    "correctAnswer": "A",
    "rationale": "These are classic signs of pulmonary embolism.",
    "section": "Clinical Assessment",
    "type": "mc"
  },
  {
    "questionText": "After administering a beta blocker to a patient post-MI, which assessment finding would indicate an adverse effect requiring intervention?",
    "options": {
      "A": "Heart rate of 55 bpm",
      "B": "Respiratory rate of 18 breaths per minute",
      "C": "Blood pressure of 108/70 mm Hg",
      "D": "Oxygen saturation of 96%"
    },
    "correctAnswer": "A",
    "rationale": "Bradycardia (<60 bpm) may require dose adjustment or holding the medication.",
    "section": "Medication Monitoring",
    "type": "mc"
  },
  {
    "questionText": "Which of the following is most important for a nurse to monitor in a client receiving IV dopamine for cardiogenic shock?",
    "options": {
      "A": "Blood glucose levels",
      "B": "Urine output",
      "C": "Serum potassium",
      "D": "Platelet count"
    },
    "correctAnswer": "B",
    "rationale": "Urine output reflects effective tissue perfusion and is a key indicator of dopamine effectiveness.",
    "section": "Critical Monitoring",
    "type": "mc"
  }
  
    ];

    let finalQuizData = [];
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let confidenceRatings = {};
    let flaggedForReview = new Set();
    const NUM_QUESTIONS_TO_SELECT = 30;

    const initialScreen = document.getElementById('initial-screen');
    const startBtn = document.getElementById('start-btn');
    const quizForm = document.getElementById('quiz-form');
    const resultsArea = document.getElementById('results-area');

    function prepareQuizData() {
        const shuffledPool = [...fullQuizData].sort(() => 0.5 - Math.random());
        const questionsNeeded = Math.min(NUM_QUESTIONS_TO_SELECT, shuffledPool.length);
        finalQuizData = shuffledPool.slice(0, questionsNeeded);
    }

    function prepareAndStartQuiz() {
        prepareQuizData();
        if (finalQuizData.length === 0) {
            alert("No questions loaded.");
            return;
        }
        initialScreen.classList.add('hidden');
        quizForm.classList.remove('hidden');
        displayCurrentQuestion();
    }

    function displayCurrentQuestion() {
        if (currentQuestionIndex >= finalQuizData.length) return;
        const qData = finalQuizData[currentQuestionIndex];
        
        let optionsHTML = '<div class="options-container">';
        const inputType = qData.type === 'sata' ? 'checkbox' : 'radio';
        
        for (const [key, text] of Object.entries(qData.options)) {
            optionsHTML += `<label><input type="${inputType}" name="answer" value="${key}"> ${text}</label>`;
        }
        optionsHTML += '</div>';

        quizForm.innerHTML = `
            <div class="question-header">
                Question <strong>${currentQuestionIndex + 1}</strong> of ${finalQuizData.length}
            </div>
            <p class="question-text">${qData.questionText}</p>
            ${optionsHTML}
            <div class="question-footer">
                <div class="flag-container">
                    <label><input type="checkbox" class="flag-for-review"> Flag for Review</label>
                </div>
                <div class="confidence-slider-container">
                    <label>Confidence:</label>
                    <input type="range" min="1" max="5" value="3" class="confidence-slider">
                </div>
                 <button type="submit" id="navigation-btn">${(currentQuestionIndex === finalQuizData.length - 1) ? "Submit Exam" : "Next Question"}</button>
            </div>
        `;
    }
    
    function saveAnswer() {
        const qData = finalQuizData[currentQuestionIndex];
        if (!qData) return;

        const selectedOptions = quizForm.querySelectorAll('input[name="answer"]:checked');
        if (qData.type === 'sata') {
            userAnswers[currentQuestionIndex] = Array.from(selectedOptions).map(cb => cb.value);
        } else {
            userAnswers[currentQuestionIndex] = selectedOptions.length ? selectedOptions[0].value : null;
        }

        const flagInput = quizForm.querySelector('.flag-for-review');
        if(flagInput && flagInput.checked) {
            flaggedForReview.add(currentQuestionIndex);
        }

        const confidenceInput = quizForm.querySelector('.confidence-slider');
        if(confidenceInput) {
            confidenceRatings[currentQuestionIndex] = parseInt(confidenceInput.value, 10);
        }
    }
    
    // --- FUNCTION RESTORED ---
    function handleNavigation() {
        saveAnswer();
        quizForm.classList.add('is-transitioning');
        
        setTimeout(() => {
            if (currentQuestionIndex < finalQuizData.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
                quizForm.classList.remove('is-transitioning');
            } else {
                submitQuiz();
            }
        }, 300);
    }

    function submitQuiz() {
        quizForm.classList.add('hidden');
        resultsArea.classList.remove('hidden');
        displayResults();
    }
    
    function checkAnswerCorrectness(qData, userAnswer) {
        if (userAnswer === null || userAnswer === undefined) return false;
        if (qData.type === 'sata') {
            if (!Array.isArray(userAnswer) || typeof qData.correctAnswer !== 'string') return false;
            const sortedUser = [...userAnswer].sort();
            const sortedCorrect = [...(qData.correctAnswer.split(','))].sort();
            return JSON.stringify(sortedUser) === JSON.stringify(sortedCorrect);
        }
        return userAnswer === qData.correctAnswer;
    }

    function displayResults() {
        let correctCount = 0;
        finalQuizData.forEach((q, i) => { if (checkAnswerCorrectness(q, userAnswers[i])) correctCount++; });
        const score = finalQuizData.length > 0 ? (correctCount / finalQuizData.length) * 100 : 0;

        let resultsHTML = `
            <div class="results-summary">
                 <h2>Exam Complete!</h2>
                 <div class="score-animation-container">
                    <div class="score-animation-circle"></div>
                    <div class="score-animation-inner">
                        <span class="score-animation-text">${score.toFixed(0)}%</span>
                    </div>
                 </div>
                 <p>You answered <strong>${correctCount}</strong> out of <strong>${finalQuizData.length}</strong> questions correctly.</p>
            </div>
        `;
        
        resultsArea.innerHTML = resultsHTML;
        resultsArea.innerHTML += generateConfidenceAnalysis();
        resultsArea.innerHTML += generateStudyFocus();
        resultsArea.innerHTML += generateDetailedReview();

        setTimeout(() => {
            const scoreCircle = document.querySelector('.score-animation-circle');
            if (scoreCircle) {
                scoreCircle.style.background = `conic-gradient(var(--success-green) ${score}%, var(--border-light) ${score}% 100%)`;
            }
        }, 100);

        if (score >= 80) {
            triggerConfetti();
        }
    }

    function generateDetailedReview() {
        let detailsHTML = '<div id="results-details"><h2>Question Review</h2>';
        finalQuizData.forEach((qData, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = checkAnswerCorrectness(qData, userAnswer);
            
            let resultBodyHTML = '<ul>';
            for (const [key, text] of Object.entries(qData.options)) {
                let li_class = '';
                const isCorrectOpt = qData.type === 'sata' ? qData.correctAnswer.includes(key) : key === qData.correctAnswer;
                const isUserSelect = Array.isArray(userAnswer) ? userAnswer.includes(key) : key === userAnswer;
                if (isCorrectOpt) li_class = 'correct-answer-label';
                if (isUserSelect && !isCorrectOpt) li_class = 'incorrect-answer-label';
                if (!isUserSelect && isCorrectOpt && !isCorrect) li_class = 'missed-correct-answer-label';
                resultBodyHTML += `<li class="${li_class}">${text}</li>`;
            }
            resultBodyHTML += '</ul>';

            detailsHTML += `
                <div class="result-question">
                    <p><strong>Question ${index + 1}: ${qData.questionText}</strong></p>
                    ${resultBodyHTML}
                    <div class="rationale"><strong>Rationale:</strong> ${qData.rationale || 'N/A'}</div>
                </div>`;
        });
        detailsHTML += '</div>';
        return detailsHTML;
    }
    
    function generateConfidenceAnalysis() {
        let correctAndConfident = 0, correctButUnsure = 0, incorrectAndConfident = 0, incorrectButUnsure = 0;
        finalQuizData.forEach((qData, index) => {
            const isCorrect = checkAnswerCorrectness(qData, userAnswers[index]);
            const confidence = confidenceRatings[index] || 3;
            if (confidence >= 4) { if (isCorrect) correctAndConfident++; else incorrectAndConfident++; } 
            else { if (isCorrect) correctButUnsure++; else incorrectButUnsure++; }
        });
        return `
            <div id="confidence-analysis">
                <h3>Confidence Analysis</h3>
                <ul>
                    <li>Correct & Confident: <strong>${correctAndConfident}</strong></li>
                    <li>Correct but Unsure: <strong>${correctButUnsure}</strong></li>
                    <li>Incorrect & Confident: <strong>${incorrectAndConfident}</strong></li>
                    <li>Incorrect but Unsure: <strong>${incorrectButUnsure}</strong></li>
                </ul>
            </div>`;
    }

    function generateStudyFocus() {
        const topicCounts = {};
        finalQuizData.forEach((qData, index) => {
            if (!checkAnswerCorrectness(qData, userAnswers[index])) {
                const topic = qData.section || "General";
                topicCounts[topic] = (topicCounts[topic] || 0) + 1;
            }
        });
        const sortedTopics = Object.entries(topicCounts).sort((a, b) => b[1] - a[1]);
        let focusHTML = '<div id="study-focus"><h3>Personalized Study Focus</h3>';
        if (sortedTopics.length > 0) {
            focusHTML += '<p>Based on your performance, focus your review on these topics:</p><ul>';
            sortedTopics.forEach(topic => { focusHTML += `<li><strong>${topic[0]}</strong> (${topic[1]} item${topic[1] > 1 ? 's' : ''} missed)</li>`; });
            focusHTML += '</ul>';
        } else {
            focusHTML += '<p>Excellent work! No specific weak areas were identified.</p>';
        }
        focusHTML += '</div>';
        return focusHTML;
    }

    function triggerConfetti() {
        const numConfetti = 150;
        for (let i = 0; i < numConfetti; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDelay = Math.random() * 3 + 's';
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 90%, 60%)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 6000);
        }
    }

    startBtn.addEventListener('click', prepareAndStartQuiz);
    quizForm.addEventListener('submit', e => { 
        e.preventDefault(); 
        handleNavigation(); 
    });
</script>

</body>
</html>
